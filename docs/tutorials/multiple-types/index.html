<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" type="text/css" href="../../style/code.css"><link rel="stylesheet" type="text/css" href="../../style/fonts.css"><link rel="stylesheet" type="text/css" href="../../style/scrollbar.css"><link rel="stylesheet" type="text/css" href="../../style/base.css"><link rel="stylesheet" type="text/css" href="../../style/main.css"><link rel="stylesheet" type="text/css" href="../../style/heading.css"><link rel="stylesheet" type="text/css" href="../../style/list.css"><link rel="stylesheet" type="text/css" href="../../style/link.css"><link rel="stylesheet" type="text/css" href="../../style/catalogue.css"><link rel="stylesheet" type="text/css" href="../../style/desktop.css"><link rel="stylesheet" type="text/css" href="../../style/atelier-lakeside-light.css"><link rel="stylesheet" type="text/css" href="../css/style.css"><script type="text/javascript" src="../../js/d3.5.15.0.min.js"></script><script type="text/javascript" src="../../js/d3-interpolate-path.2.1.1.min.js"></script><script type="text/javascript" src="../../js/lib/highlight.min.js"></script><script type="text/javascript" src="../../dl/dalian.min.js"></script><title>Multiple types | tutorials</title></head><body><main><div class="main-content-centered"><h1>Multiple types</h1><p>In this tutorial we learn how to use the axis components in a smart way to emulate having multiple chart types on one chart.</p><h2>Data</h2><p>In this example, we use the monthly sea surface temperature anomaly from the <a href="https://www.metoffice.gov.uk/hadobs/hadsst4/data/download.html">Met Office Hadley Center</a>.Loading and parsing the data with the Fetch API is fairly straightforward as it comes in a CSV containing numbers only (the data is copied as a Github Gist):</p><pre><code class="hljs javascript">const URL = 'https://gist.githubusercontent.com/synesenom/38f6ac1567aab8dba68b0dbf476d8a71/raw/monthly-temperature-anomaly.csv'

(async () => {
  // Fetch our data.
  const raw = await fetch(URL)
    .then(response => response.text())
  const data = raw.split('\n')
    .map(d => {
      // For this guide's purpose, let's extract the year and anomaly
      // value only.
      const cols = d.split(',')
      return {
        x: +cols[0],
        y: +cols[2]
      }
    })
})()
</code></pre><p>A sample of what the file would be seen by Javascript:</p><pre class="data">[
    {x: 1850, y: -0.35138},
    {x: 1850, y: -0.34437},
    {x: 1850, y: -0.58001},
    {x: 1850, y: -0.34222},
    {x: 1850, y: -0.25093},
    ...
]
</pre><h2>The scatter plot</h2><p>We start with a scatter plot showing all anomaly values for each year.Following the <a href="https://synesenom.github.io/dalian/catalogue/charts/scatter-plot/">example</a> in the catalogue:</p><div class="chart-container" id="chart-step-final"></div><script>(async () => {
  // Fetch our data.
  const raw = await fetch('https://gist.githubusercontent.com/synesenom/38f6ac1567aab8dba68b0dbf476d8a71/raw/monthly-temperature-anomaly.csv')
    .then(response => response.text())
  const values = raw.split('\n')
    .map(d => {
      // For this guide's purpose, let's extract the year and anomaly
      // value only.
      const cols = d.split(',')
      return {
        x: +cols[0],
        y: +cols[2]
      }
    })

  // Add scatter plot.
  const scatter = dalian.ScatterPlot('chart-step-final', '#chart-step-final')
    .data([{
      name: 'monthly',
      values
    }])

    // Read dimensions from the container.
    .width(parseFloat(d3.select('#chart-step-final').style('width')))
    .height(parseFloat(d3.select('#chart-step-final').style('padding-bottom')))
    .margins(50)

    // Set color to grayish, add some opacity and set dot size.
    .color.palette('LightSlateGrey')
    .opacity(0.1)
    .size(4)

    // Set up axes.
    .leftAxis.label('Time [year]')
    .bottomAxis.label('Anomaly [%]')

    .render()

  // STEP 2

  // Calculate yearly average. We are using d3.nest to quickly aggregate yearly values.
  const trend = d3.nest()
    .key(d => d.x)
    .rollup(v => d3.mean(v, d => d.y))
    .entries(values)
    .map(d => Object.assign(d.value, {
      x: +d.key,
      y: d.value
    }))

  // STEP 3
  // Add trend.
  const line = dalian.LineChart('chart-step-final-trend', '#chart-step-final')
    .data([{
      name: 'trend',
      values: trend
    }])

    // Read dimensions from the container.
    .width(parseFloat(d3.select('#chart-step-final').style('width')))
    .height(parseFloat(d3.select('#chart-step-final').style('padding-bottom')))
    .margins(50)

    // Set color to grayish, add some opacity and set dot size.
    .color.palette('firebrick')

    // Set up axes.
    .leftAxis.label('Time [year]')
    .bottomAxis.label('Anomaly [%]')

    .smoothing(true)
    .render()

  // STEP 4
  const range = d3.extent(trend, d => d.y)
  scatter.yRange.min(range[0])
    .yRange.max(range[1])
    .yRange.compressMin(0.1)
    .yRange.compressMax(0.1)
    .render()
  line.yRange.min(range[0])
    .yRange.max(range[1])
    .yRange.compressMin(0.1)
    .yRange.compressMax(0.1)
    .render()

  // STEP 5
  line.leftAxis.hideAxisLine(true)
    .leftAxis.hideTicks(true)
    .leftAxis.label('')
    .bottomAxis.hideAxisLine(true)
    .bottomAxis.hideTicks(true)
    .bottomAxis.label('')
    .render()
  scatter.tooltip.on(true)
    .render()

  // STEP 6
})()
</script></div></main></body><script>//capture.run(function () {
hljs.initHighlighting.called = false
hljs.initHighlighting()
//})
</script></html>