// https://www.npmjs.com/package/dalian v0.4.2 Copyright 2020 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],t):t((e=e||self).dalian={},e.d3,e.d3)}(this,(function(e,t,a){"use strict";var r=(e,t,a=!1)=>{const r=e;return(...e)=>{a?(t(...e),r(...e)):(r(...e),t(...e))}},n=(e,...t)=>{const{self:a,api:r}=e;return t.reduce((e,t)=>{const n=t(e.self,e.api);return{self:Object.assign(a,n.self),api:Object.assign(r,n.api)}},{self:a,api:r})},i=e=>(""+e).replace(/ /g,"__");function s(e){const t=window.getComputedStyle(e),a={};for(let e=0;e<t.length;e++)a[t[e]]=t.getPropertyValue(t[e]);return a}function l(e,t){for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e.style[a]=t[a])}const o=document.createElement("canvas"),c=o.getContext("2d"),d=document.createElement("div");d.style.opacty=0;const p=document.createElement("img");var u=async(e,t=3,a="png",r=.92)=>{const n=(new window.XMLSerializer).serializeToString(e),i=function(e){d.appendChild(e),document.body.appendChild(d);const t=e.getBoundingClientRect();return document.body.removeChild(d),t}(e);return o.width=i.width*t,o.height=i.height*t,o.style.width=i.width+"px",o.style.height=i.height+"px",c.scale(t,t),p.setAttribute("src","data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(n)))),new Promise(e=>{p.onload=()=>{c.drawImage(p,0,0),e(o.toDataURL("image/"+a,r))}})};const g=document.createElement("a");var m=["#333333","#0072b2","#56b4e9","#009e73","#f0e442","#e69f00","#d55e00","#cc79a7"],h=["#77aadd","#99ddff","#44bb99","#bbcc33","#aaaa00","#eedd88","#ee8866","#ffaabb","#dddddd"],y="#eee",x=["#364b9a","#4a7bb7","#6ea6cd","#98cae1","#c2e4ef","#eaeccc","#feda8b","#fdb366","#f67e4b","#dd3d2d","#a50026"],f="#eee",v=["#fefbe9","#fcf7d5","#f5f3c1","#eaf0b5","#ddecbf","#d0e7ca","#c2e3d2","#b5ddd8","#a8d8dc","#9bd2e1","#8dcbe4","#81c4e7","#7bbce7","#7eb2e4","#88a5dd","#9398d2","#9b8ac4","#9d7db2","#9a709e","#906388","#805770","#684957","#46353a"];const b={protan:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deutan:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritan:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}};function _(e){return{r:3.063218*e.x-1.393325*e.y-.475802*e.z,g:-.969243*e.x+1.875966*e.y+.041555*e.z,b:.067871*e.x-.228834*e.y+1.069251*e.z}}function w(e,a){let r=1.75,n=2.75;return t.rgb((r*a.r+e.r)/n,(r*a.g+e.g)/n,(r*a.b+e.b)/n)}function k(e){let a=Math.round(.299*e.r+.587*e.g+.114*e.b);return t.rgb(a,a,a)}function z(e,a){let r={r:Math.pow(e.r/255,2.2),g:Math.pow(e.g/255,2.2),b:Math.pow(e.b/255,2.2)};var n;r={x:.430574*(n=r).r+.34155*n.g+.178325*n.b,y:.222015*n.r+.706655*n.g+.07133*n.b,z:.020183*n.r+.129553*n.g+.93918*n.b};const i=r.x+r.y+r.z;r.u=0,r.v=0,0!==i&&(r.u=r.x/i,r.v=r.y/i);let s,l=.312713*r.y/.329016,o=.358271*r.y/.329016,c={y:0};s=r.u<b[a].cpu?(b[a].cpv-r.v)/(b[a].cpu-r.u):(r.v-b[a].cpv)/(r.u-b[a].cpu);let d=r.v-r.u*s;c.u=(b[a].ayi-d)/(s-b[a].am),c.v=s*c.u+d;let p={x:c.u*r.y/c.v,y:r.y,z:(1-(c.u+c.v))*r.y/c.v};c.x=l-p.x,c.z=o-p.z,c=_(c),p=_(p);const u={r:c.r?((p.r<0?0:1)-p.r)/c.r:0,g:c.g?((p.g<0?0:1)-p.g)/c.g:0,b:c.b?((p.b<0?0:1)-p.b)/c.b:0},g=Math.max(u.r>1||u.r<0?0:u.r,u.g>1||u.g<0?0:u.g,u.b>1||u.b<0?0:u.b);p.r=p.r+g*c.r,p.g=p.g+g*c.g,p.b=p.b+g*c.b;const m=e=>255*(e<=0?0:e>=1?1:Math.pow(e,1/2.2));return t.rgb(m(p.r),m(p.g),m(p.b))}const M={protanopia:e=>z(e,"protan"),protanomaly:e=>w(e,z(e,"protan")),deuteranopia:e=>z(e,"deutan"),deuteranomaly:e=>w(e,z(e,"deutan")),tritanopia:e=>z(e,"tritan"),tritanomaly:e=>w(e,z(e,"tritan")),achromatopsia:e=>k(e),achromatomaly:e=>w(e,k(e))};const C="categorical",j="sequential",A="diverging";function O(e){switch(e){default:case C:return m;case j:return v;case A:return x}}function $(e){switch(e){default:case C:return"#fff";case j:return f;case A:return y}}var F=(e,a)=>{const r={policy:C,on:e=>e.name},n={policy:r.policy,palette:O(r.policy),missing:$(r.policy),deficiency:void 0,on:r.on,scale:e=>e,buildMapper(){const e=function(e,t){if("string"==typeof e)return t(e)+"";if(Array.isArray(e))return e.map(t);{const a={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=t(e[r]));return a}}(n.palette||O(n.policy),(a=n.deficiency,void 0===M[a]?e=>e:e=>M[a](t.rgb(e))));var a;const r=e=>{const t=n.on(e);return null===t?null:n.scale(t)};switch(n.policy){default:case C:return i=e,s=n.missing,l=r,"string"==typeof i?()=>i:Array.isArray(i)?(()=>{const e=[];return t=>{const a=l(t);if(null===a)return s;{const t=e.indexOf(a);return i[t>-1?t:e.push(a)-1]}}})():"object"==typeof i?e=>{const t=l(e);return null===t?s:i[t]}:void 0;case j:return function(e,a,r){if("string"==typeof e||Array.isArray(e)||(console.warn(`Palette type (${typeof e}) is incompatible with ${j} color policy, fallback to default color palette.`),e=O(j)),"string"==typeof e){const n=t.interpolateRgb("#fff",e);return e=>{const t=r(e);return null===t?a:n(t)}}if(Array.isArray(e)){const n=t.piecewise(t.interpolateRgb.gamma(2.2),e);return e=>{const t=r(e);return null===t?a:n(t)}}}(e,n.missing,r);case A:return function(e,a,r){Array.isArray(e)||(console.warn(`Palette type (${typeof e}) is incompatible with ${A} color policy, fallback to default color palette.`),e=O(A));const n=t.piecewise(t.interpolateRgb.gamma(2.2),e);return e=>{const t=r(e);return n((t+1)/2)}}(e,n.missing,r)}var i,s,l}};return e=Object.assign(e||{},{_color:{init(t,a){n.policy=t,n.on=a,n.palette=O(t),n.missing=$(t),e._color.mapper=n.buildMapper()},scale(t){n.scale=t,e._color.mapper=n.buildMapper()},mapper:n.buildMapper()}}),a=Object.assign(a||{},{color:{policy:(t=r.policy)=>(n.policy=t,e._color.mapper=n.buildMapper(),a),palette(t,r){if("string"==typeof t&&t.startsWith("palette-"))switch(t){case"palette-wong":n.palette=m;break;case"palette-light":n.palette=h;break;case"palette-sunset":n.palette=x;break;case"palette-iridescent":n.palette=v}else n.palette=t;return n.missing=r||"#fff",e._color.mapper=n.buildMapper(),a},deficiency:t=>(n.deficiency=t,e._color.mapper=n.buildMapper(),a),on:(t=r.on)=>(n.on=t,e._color.mapper=n.buildMapper(),a)}}),{self:e,api:a}};const T="dalian-style-container";var S=(()=>{const e={container:void 0,styles:[]};function a(){return(e.container||t.select("#"+T)).empty()&&(e.container=t.select("head").append("style").attr("id",T)),e.container}function r(e,t,a){const r=Object.entries(t).map(([e,t])=>`${e}:${t};`).join("");return`${function(e){switch(e){default:case"class":return".";case"id":return"#"}}(a)}${e}{${r}}`}function n(t,n,i="class"){if(void 0===e.styles.find(e=>e.selector===t)){const s=r(t,n,i),l=a();l.text(l.text()+s),e.styles.push({selector:t,type:i,entry:s})}}function i(t,n,i){let s=e.styles.find(e=>e.selector===t);void 0!==n&&(s.entry=r(t,n,i),a().text(e.styles.map(e=>e.entry).join("")))}let s={addClass:(e,t)=>(n(e,t,"class"),s),updateClass:(e,t)=>(i(e,t,"class"),s),addId:(e,t)=>(n(e,t,"id"),s),updateId:(e,t)=>(i(e,t,"id"),s)};return s})();const W="dalian-description";var D=(e,a)=>{S.addClass(W,{position:"absolute",width:"auto","max-width":"500px",padding:"10px",background:"#fff","box-shadow":"0 0 3px #000","border-radius":"3px",color:"#000","font-size":".8em","font-family":"inherit","line-height":"1.35em","pointer-events":"none"});const r={id:e._widget.id+"-description",getDescription:()=>void 0===r.elem||r.elem.empty()?t.select("body").append("div").attr("id",r.id).attr("class",W).style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px"):r.elem,removeDescription:()=>{void 0===r.elem||r.elem.empty()||(r.elem.remove(),delete r.elem)}};return a=Object.assign(a||{},{description:n=>(void 0===n?e._widget.container.on("contextmenu.description",null):e._widget.container.on("contextmenu.description",()=>{t.event.preventDefault(),r.elem=r.getDescription().html(n)}).on("mouseleave.description",()=>{r.removeDescription()}),a)}),{self:e,api:a}},R=(e,t)=>{const a=12,n="black";return(e=Object.assign(e||{},{_font:{size:a+"px",color:n}}))._widget.update=r(e._widget.update,()=>{e._widget.container.style("font-size",e._font.size).style("color",e._font.color)},!0),t=Object.assign(t||{},{font:{size:(r=a)=>(e._font.size=r+"px",t),color:(a=n)=>(e._font.color=a,t)}}),{self:e,api:t}},H=(e,t)=>{const a={callbacks:{}};return{self:e=Object.assign(e||{},{_mouse:{over:(...e)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...e)},leave:(...e)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...e)},click:(...e)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...e)},isEnabled:e=>"function"==typeof a.callbacks[e],hasAny:()=>Object.values(a.callbacks).reduce((e,t)=>e||"function"==typeof t,!1)}}),api:t=Object.assign(t||{},{mouse:{over:e=>(a.callbacks.over=e,t),leave:e=>(a.callbacks.leave=e,t),click:e=>(a.callbacks.click=e,t)}})}};const I="dalian-placeholder",B="dalian-placeholder-message";var P=(e,t)=>{S.addClass(I,{display:"table",position:"absolute",left:0,top:0,color:"inherit","font-family":"inherit","font-size":"inherit","pointer-events":"none"}).addClass(B,{display:"table-cell","vertical-align":"middle","line-height":"normal","text-align":"center",color:"inherit","font-family":"inherit","font-size":"inherit"});const a={id:e._widget.id+"-placeholder"};return e._widget.update=r(e._widget.update,t=>{e._widget.content.transition().duration(t).style("opacity",void 0===a.placeholder?1:0),e._widget.disable(void 0!==a.placeholder),void 0===a.placeholder?void 0===a.container||a.container.empty()||(a.container.transition().duration(t).style("opacity",0).remove(),delete a.container):((void 0===a.container||a.container.empty())&&(a.container=e._widget.container.append("div").attr("id",a.id).attr("class",I).style("width",e._widget.size.width).style("height",e._widget.size.height).style("opacity",0),a.content=a.container.append("span").attr("class",B).html(a.placeholder)),a.container.style("font-size","inherit").style("color","inherit").transition().duration(t).style("width",e._widget.size.width).style("height",e._widget.size.height).style("opacity",1),a.content.html(a.placeholder))}),t=Object.assign(t||{},{placeholder:e=>(a.placeholder=e,t)}),{self:e,api:t}},L=(e,t)=>{for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.style(a,t[a]);return e};const E=document.createElement("canvas"),q=E.getContext("2d");function X(e,t,a){const r=a,n=200+q.measureText(e).width,i=200+r;!function(e,t){E.style.width=e+"px",E.width=e,E.style.height=t+"px",E.height=t}(n,i),q.font=a+"px "+t,q.fillStyle="#fff",q.fillRect(0,0,n,i),q.fillStyle="#000",q.fillText(e,100,100+r);const s=q.getImageData(0,0,n,i).data.filter((e,t)=>t%4==0),l=Math.floor(s.findIndex(e=>e<255)/n);return s.reverse(),{min:l,max:i-Math.floor(s.findIndex(e=>e<255)/n)}}var Y=(e,a,r,n)=>{const i={x:0,y:0},s={width:300,height:200},l=0,o={parent:"string"==typeof r||r instanceof HTMLElement?t.select(r):r,initialized:!1,pos:{x:{attr:"left",ignore:"right",value:i.x+"px"},y:{attr:"top",ignore:"bottom",value:i.y+"px"}}},c={};c._widget={id:`dalian-widget-${e}-${a}`,container:void 0,size:{width:s.width+"px",height:s.height+"px",innerWidth:s.width+"px",innerHeight:s.height+"px"},margins:{left:l,right:l,top:l,bottom:l},transition:!1,disabled:!1,getMouse:()=>{const e=t.mouse(c._widget.container.node());return[e[0]-c._widget.margins.left,e[1]-c._widget.margins.top]},getElem:(e,t)=>o.initialized?e.transition().duration(t):(setTimeout(()=>{o.initialized=!0},t),e),getDefs:()=>(void 0===o.defs&&(o.defs=c._widget.content.append("defs")),o.defs),getStyle:()=>window.getComputedStyle(c._widget.container.node()),getFontMetrics:()=>(e=>{const t=X("x",e,100),a=X("y",e,100),r=X("h",e,100),n=X("H",e,100),i=t.max-t.min;return{xHeight:i/100,capHeight:(n.max-n.min)/100,descender:(a.max-a.min-i)/100,ascender:(r.max-r.min)/100}})(window.getComputedStyle(c._widget.container.node()).fontFamily),update:e=>{c._widget.getElem(c._widget.container,e).style(o.pos.x.ignore,null).style(o.pos.x.attr,o.pos.x.value).style(o.pos.y.ignore,null).style(o.pos.y.attr,o.pos.y.value).style("width",c._widget.size.width).style("height",c._widget.size.height)},disable:e=>{c._widget.disabled=e}};try{c._widget.container=o.parent.append("div").attr("id",c._widget.id).attr("class","dalian-widget dalian-widget-"+e),L(c._widget.container,{position:"absolute",width:c._widget.size.width,height:c._widget.size.height,left:o.pos.x+"px",top:o.pos.y+"px","font-family":"inherit","font-size":"inherit","font-color":"inherit"}),c._widget.content=c._widget.container.append(n).attr("class","dalian-widget-content"),L(c._widget.content,{position:"absolute",width:"100%",height:"100%",left:0,top:0,"font-family":"inherit","font-size":"inherit","font-color":"inherit","pointer-events":"none"})}catch(e){throw Error("MissingDOMException: DOM is not present.")}const d={id:()=>c._widget.id,x:(e=i.x)=>(o.pos.x.attr=e>=0?"left":"right",o.pos.x.ignore=e>=0?"right":"left",o.pos.x.value=Math.abs(e)+"px",d),y:(e=i.y)=>(o.pos.y.attr=e>=0?"top":"bottom",o.pos.y.ignore=e>=0?"bottom":"top",o.pos.y.value=Math.abs(e)+"px",d),width:(e=s.width)=>(c._widget.size.width=e+"px",c._widget.size.innerWidth=e-c._widget.margins.left-c._widget.margins.right+"px",d),height:(e=s.height)=>(c._widget.size.height=e+"px",c._widget.size.innerHeight=e-c._widget.margins.top-c._widget.margins.bottom+"px",d),margins:(e=l)=>{switch(typeof e){case"undefined":default:c._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":c._widget.margins={left:e,right:e,top:e,bottom:e};break;case"object":c._widget.margins=Object.assign(c._widget.margins,e)}return c._widget.size.innerWidth=parseInt(c._widget.size.width)-c._widget.margins.left-c._widget.margins.right+"px",c._widget.size.innerHeight=parseInt(c._widget.size.height)-c._widget.margins.top-c._widget.margins.bottom+"px",d},render:e=>(c._widget.update(e),d)};return{self:c,api:d}},G=(e,t,a,o="svg")=>{let{self:c,api:d}=n(Y(e,t,a,o),F,D,R,H,P);const p=(()=>{const e=t+"-dalian-plots-clipper";return{clipId:e,clip:c._widget.getDefs().append("clipPath").attr("id",e).append("rect").attr("x",0).attr("y",0).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),update(e){c._widget.getElem(p.clip,e).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),c._widget.getElem(c._chart.plots,e).attr("width",c._widget.size.innerWidth+"px").attr("height",c._widget.size.innerHeight+"px").attr("transform",`translate(${c._widget.margins.left}, ${c._widget.margins.top})`)}}})();return c=Object.assign(c||{},{_chart:{data:[],plots:c._widget.content.append("g").attr("class","dalian-plots-container"),clipId:p.clipId,transformData:e=>e,plotGroups(e,t){const a=c._chart.plots.attr("clip-path",`url(#${p.clipId})`).transition().duration(t);c._chart.plots.selectAll(".plot-group").data(c._chart.data,e=>e.name).join(t=>t.append("g").attr("class",e=>"plot-group "+i(e.name)).style("shape-rendering","geometricPrecision").call(e.enter||(e=>e)),e=>e,t=>t.transition(a).call(e.exit||(e=>e)).remove()).on("mouseover.chart",c._mouse.over).on("mouseleave.chart",c._mouse.leave).on("click.chart",c._mouse.click).each(()=>{c._chart.plots.style("pointer-events","none"),c._widget.transition=!0}).call(e.updateBefore||(e=>e)).transition(a).call(e.update||(e=>e)).on("end",()=>{c._chart.plots.style("pointer-events",c._tooltip&&c._tooltip.isOn()||c._mouse.hasAny()?"all":"none"),c._widget.transition=!1})}}}),c._widget.update=r(c._widget.update,p.update),d=Object.assign(d,{data:e=>(c._chart.data=c._chart.transformData(e),d),download:async e=>{const t=(e=>{const t=Array.from(e.querySelectorAll("*")).map(s),a=e.cloneNode(!0);return l(a,s(e)),a.querySelectorAll("*").forEach((e,a)=>l(e,t[a])),a.style.backgroundColor=e.parentNode.style.backgroundColor||"#fff",a})(c._widget.content.node());((e,t,a)=>{g.download=`${t}.${a}`,g.href=e,document.body.appendChild(g),g.click(),document.body.removeChild(g)})(await u(t),e,"png")}}),{self:c,api:d}},V=(e,t)=>{for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.attr(a,t[a]);return e},N=(e,t,a,n,i)=>{const s={format:e=>e,values:null,tickAnchor:null,tickColor:"currentColor"};let l=t._widget.content.append("g").attr("class","dalian-axis-container "+e).style("font-family","inherit").style("font-size","inherit"),o=l.append("g").attr("class","axis "+e).style("font-family","inherit").style("font-size","inherit");o.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");let c={margin:{left:0,top:0,right:0,bottom:0},format:s.format,values:s.values,scale:n,container:l,tickColor:s.tickColor,ticks:!0,tickAnchor:s.tickAnchor,axisLine:!0,update:e=>{t._widget.getElem(c.container,e).attr("transform","translate("+(t._widget.margins.left+c.margin.left-c.margin.right)+","+(t._widget.margins.top+c.margin.top-c.margin.bottom)+")").style("width",t._widget.size.innerWidth).style("height",t._widget.size.innerHeight),d.fn.scale(c.scale.scale).tickFormat(c.format).tickSize(c.ticks?6:0).tickPadding(c.ticks?3:9).tickValues(c.values||null),t._widget.getElem(d.axis,e).call(d.fn).selectAll("path").style("opacity",c.axisLine?1:0),o.selectAll(".tick > text").attr("text-anchor",c.tickAnchor),o.selectAll(".tick > line").attr("stroke",c.tickColor)}};t._widget.update=r(t._widget.update,c.update);let d={fn:a().ticks(5),axis:o,margin:e=>(c.margin=Object.assign(c.margin,e),d),label:V(l.append("text").attr("class","axis-label "+e).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text(""),i),tickAnchor:(e=s.tickAnchor)=>(c.tickAnchor=e,d),scale:e=>(c.scale=e,d),hideAxisLine:e=>(c.axisLine=!e,d),hideTicks:e=>(c.ticks=!e,d),format:(e=s.format)=>(c.format=e,d),values:(e=s.values)=>(c.values=e,d),tickColor:(e="currentColor")=>(c.tickColor=e,d)};return d},J=e=>(a,n)=>{let i=N("x",a,t.axisBottom,e,{"text-anchor":"end",dy:"2.5em"}),s=e=>{a._widget.getElem(i.axis,e).attr("transform",`translate(0, ${parseFloat(a._widget.size.innerHeight)})`),a._widget.getElem(i.label,e).attr("x",a._widget.size.innerWidth).attr("y",parseFloat(a._widget.size.innerHeight)+"px")};return(a=Object.assign(a||{},{_bottomAxis:i}))._widget.update=r(a._widget.update,s),n=Object.assign(n||{},{bottomAxis:{label:(e="")=>(i.label.text(e),n),format:e=>(i.format(e),n),values:e=>(i.values(e),n),hideTicks:e=>(i.hideTicks(e),n),hideAxisLine:e=>(i.hideAxisLine(e),n)}}),{self:a,api:n}},U=(e,a,r={blur:{opacity:.1}})=>(n,s)=>{function l(e){return Object.keys(e.focus||{}).concat(Object.keys(e.blur||{})).reduce((e,t)=>Object.assign(e,{[t]:null}),{})}const o={container:void 0,selectors:a,highlightStyle:r,removeStyle:l(r),highlight:(a,r,s)=>{if(n._widget.transition)return;const l=(o.container||(o.container=e())).selectAll(a).interrupt(),c=l.transition().duration(s||0);let d;if("string"==typeof r)d=[i(r)];else{if(!Array.isArray(r))return void L(l.transition(c),o.removeStyle);d=r.map(i)}L(l.filter((function(){const e=t.select(this);return d.reduce((t,a)=>t||e.classed(a),!1)})).transition(c),o.highlightStyle.focus||o.removeStyle),L(l.filter((function(){const e=t.select(this);return!d.reduce((t,a)=>t||e.classed(a),!1)})).transition(c),o.highlightStyle.blur||o.removeStyle)}};return n=Object.assign(n||{},{_highlight:{style(e){o.highlightStyle=e,o.removeStyle=l(e)},selectors:void 0}}),s=Object.assign(s||{},{highlight:(t,a=0)=>{if(void 0===e())throw Error("Highlight.container is not specified");return o.selectors.forEach(e=>o.highlight(e,t,a)),s}}),{self:n,api:s}},K=e=>(a,r)=>{let n=N("y",a,t.axisLeft,e,{"text-anchor":"begin",x:"5px",y:"-5px"});return{self:a=Object.assign(a||{},{_leftAxis:n}),api:r=Object.assign(r||{},{leftAxis:{label:(e="")=>(n.label.text(e),r),format:e=>(n.format(e),r),values:e=>(n.values(e),r),hideTicks:e=>(n.hideTicks(e),r),hideAxisLine:e=>(n.hideAxisLine(e),r)}})}},Q=e=>(t,a)=>{const r={mapping:()=>e+"px"};return{self:t=Object.assign(t||{},{_lineWidth:{mapping:e=>r.mapping(e)}}),api:a=Object.assign(a||{},{lineWidth:(t=e)=>(r.mapping="number"==typeof t?()=>t+"px":a=>(t[a]||e)+"px",a)})}},Z=e=>(t,a)=>{const n={containers:{background:void 0},objects:new Map,getContainer:(e="background")=>(void 0===n.containers[e]&&(n.containers[e]=t._chart.plots.append("g").attr("class","objects-container"),"background"===e?n.containers[e].lower():n.containers[e].raise()),n.containers[e])};return t._widget.update=r(t._widget.update,e=>{n.objects.forEach(t=>t.update(e))}),a=Object.assign(a||{},{objects:{add(t,r,i,s,l=0){const o=e.x.scale,c=e.y.scale,d=n.getContainer(s&&s.foreground?"foreground":"background").append("g").attr("transform",s&&s.floating?`translate(${o(i.x)}, ${c(i.y)})`:`translate(${i.x}, ${i.y})`).style("opacity",0);d.node().appendChild(r),n.objects.has(t)?(a.objects.remove(t,l),d.transition().duration(l).style("opacity",1)):d.transition().duration(l).style("opacity",1);const p={g:d,remove:e=>{d.transition().duration(e).style("opacity",0).on("end",()=>{d.remove()})},update:e=>{d.transition().duration(e).attr("transform",s&&s.floating?`translate(${o(i.x)}, ${c(i.y)})`:`translate(${i.x}, ${i.y})`)}};return n.objects.set(t,p),a},remove:(e,t=0)=>(null==e&&(n.objects.forEach(e=>e.remove(t)),n.objects.clear()),n.objects.has(e)&&(n.objects.get(e).remove(t),n.objects.delete(e)),a)}}),{self:t,api:a}},ee=e=>(t,a)=>{const r={value:e};return{self:t=Object.assign(t||{},{_opacity:{value:()=>r.value}}),api:a=Object.assign(a||{},{opacity:(t=e)=>(r.value=t||e,a)})}},te=(e,t)=>{const a={markers:new Map};return(e=Object.assign(e||{},{_plotMarker:{add(t,r,n,s,l){a.markers.set(n,a.markers.get(n)||e._chart.plots.append("circle")),V(a.markers.get(n),{class:"plot-marker "+i(s.name),cx:t,cy:r,r:l||4}),L(a.markers.get(n),{stroke:"white",fill:e._color.mapper(s),"pointer-events":"none"})},remove(e){void 0===e?a.markers.forEach((e,t)=>{e.remove(),a.markers.delete(t)}):a.markers.has(e)&&(a.markers.get(e).remove(),a.markers.delete(e))}}}))._widget.update=r(e._widget.update,()=>{e._widget.container.on("mouseout.plot-marker",e._plotMarker.remove)}),{self:e,api:t}};const ae="dalian-tooltip";var re=(e,a)=>{S.addClass(ae,{position:"absolute","background-color":"rgba(255, 255, 255, 0.95)","border-radius":"2px","box-shadow":"1px 1px 2px #888, 0 0 1px #aaa",color:"currentColor","pointer-events":"none","font-family":"inherit","font-size":"0.8em",width:"auto","min-width":"80px","line-height":"1","z-index":9999});const n=!1;let i={container:e._widget.container.append("div").attr("class","dalian-tooltip-container"),id:e._widget.id+"-tooltip",on:n,getTooltip:()=>void 0===i.elem||i.elem.empty()?i.container.append("div").attr("id",i.id).attr("class",ae).style("font-size",.85*parseFloat(e._font.size)+"px"):i.elem.style("font-size",.85*parseFloat(e._font.size)+"px"),hideTooltip(){void 0!==i.elem&&i.elem.style("opacity",0)},showTooltip(){const[a,r]=t.mouse(e._widget.container.node()),n=parseFloat(e._widget.size.width)-e._widget.margins.right,s=parseFloat(e._widget.size.height)-e._widget.margins.bottom;if(a<e._widget.margins.left||a>n||r<e._widget.margins.top||r>s)return e._tooltip.builder(),void i.hideTooltip();i.elem=i.getTooltip();let l=e._tooltip.builder(e._tooltip.content(e._widget.getMouse()));if(void 0===l){if(void 0!==i.elem)return void i.hideTooltip()}else i.elem.html(l);const o=i.elem.node().getBoundingClientRect(),c=o.width,d=o.height;let p=a+20,u=r+20;p+c>n-10&&(p-=c+30),u+d>s-10&&(u=s-10-d),i.elem.style("left",p+"px").style("top",u+"px").style("opacity",1)}};return e._widget.update=r(e._widget.update,()=>{e._widget.container.style("pointer-events",i.on?"all":null).on("mousemove.tooltip",()=>i.on&&!e._widget.disabled&&i.showTooltip()).on("mouseout.tooltip",i.hideTooltip)}),e=Object.assign(e||{},{_tooltip:{isOn:()=>i.on,content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented")}}),a.tooltip={on:(e=n)=>(i.on=e,a)},{self:e,api:a}};const ne="dalian-point-tooltip-",ie={content:ne+"content",entry:ne+"entry",container:ne+"container",inner:ne+"inner",marker:ne+"marker",label:ne+"label"};var se=(e,a)=>{S.addClass(ie.content,{display:"table",padding:"10px","min-width":"60px"}).addClass(ie.entry,{display:"table-row",position:"relative"}).addClass(ie.container,{display:"inline-block",position:"relative",height:"1em"}).addClass(ie.inner,{display:"flex",position:"relative",height:"1em","justify-content":"center","align-items":"center"}).addClass(ie.marker,{display:"inline-block",position:"relative",float:"left","margin-right":"6px","border-radius":"2px"}).addClass(ie.label,{display:"table-cell",position:"relative","max-width":"120px",float:"left",height:".9em"});const r={ignore:[],titleFormat:e=>e,valueFormat:e=>e.y};let n=re(e,a),i={titleFormat:r.titleFormat,valueFormat:r.valueFormat};return e._tooltip=Object.assign(n.self._tooltip,{ignore:[],builder:a=>{if(void 0===a)return void e._tooltip.content();let r=t.select(document.createElement("div")).attr("class",ie.content);return r.append("div").attr("class",ie.entry).text(i.titleFormat(a.title)),a.content.data.filter(e=>null!==i.valueFormat(e)).forEach((e,t)=>{let a=r.append("div").attr("class",ie.entry).append("div").attr("class",ie.container).style("margin-top",(0===t?6:3)+"px").append("div").attr("class",ie.inner);a.append("div").attr("class",ie.marker).style("width","1em").style("height","1em").style("background",e.background),a.append("div").attr("class",ie.label).html(i.valueFormat(e))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(e=r.titleFormat)=>(i.titleFormat=e,a),valueFormat:(e=r.valueFormat)=>(i.valueFormat=e,a)}),{self:e,api:a}},le=(e="linear")=>{const a={type:e,scale:(()=>{switch(e){default:case"linear":return t.scaleLinear();case"sqrt":return t.scalePow().exponent(.5);case"band":return t.scaleBand().padding(.1);case"point":return t.scalePoint().padding(.5)}})()},r={scale:a.scale,range:(e,t)=>(a.scale.range([e,t]),r),domain:e=>{switch(a.type){default:case"linear":case"sqrt":a.scale.domain([Math.min(...e),Math.max(...e)]);break;case"band":case"point":a.scale.domain(e)}return r},type:e=>{if(void 0===e)return a.type;switch(e){default:case"linear":a.scale=t.scaleLinear();break;case"sqrt":a.scale=t.scalePow().exponent(.5);break;case"band":a.scale=t.scaleBand().padding(.1);break;case"point":a.scale=t.scalePoint().padding(.5)}},measure:e=>Math.abs(a.scale.invert(e)-a.scale.invert(0))};return r},oe=(e,a)=>{const r=!1,n={on:r};return{self:e=Object.assign(e||{},{_smoothing:{curve:()=>n.on?t.curveMonotoneX:t.curveLinear}}),api:a=Object.assign(a||{},{smoothing:(e=r)=>(n.on=e,a)})}},ce=()=>{let e={min:void 0,max:void 0,compressMax:0,compressMin:0};return{min:t=>e.min=t,max:t=>e.max=t,compressMin:t=>e.compressMin=Math.abs(t||0),compressMax:t=>e.compressMax=Math.abs(t||0),range:t=>{let a=void 0!==e.min?e.min:Math.min(...t),r=void 0!==e.max?e.max:Math.max(...t),n=r-a;return a-=e.compressMin>0?e.compressMin*n:0,r+=e.compressMax>0?e.compressMax*n:0,[a,r]},contains:t=>(void 0===e.min||t>=e.min)&&(void 0===e.max||t<=e.max)}},de=(e,t)=>{let a=ce();return{self:e=Object.assign(e||{},{_yRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{yRange:{min:e=>(a.min(e),t),compressMin:(e=0)=>(a.compressMin(e),t),max:e=>(a.max(e),t),compressMax:(e=0)=>(a.compressMax(e),t)}})}};const pe=document.createElement("canvas").getContext("2d");function ue(e,t){return pe.font=t.fontSize+" "+t.fontFamily,{width:pe.measureText(e).width,height:parseFloat(t.fontSize)}}function ge(e,a=.4){const r=t.hsl(e);return r.l+=a*(1-r.l),r}function me(e){return function(e){const a=t.color(e);return.229*a.r+.587*a.g+.114*a.b}(e)>150?"#000":"#fff"}const he="dalian-element-tooltip-",ye={content:he+"content",title:he+"title",entry:he+"entry",label:he+"label",value:he+"value"};var xe=(e,a)=>{S.addClass(ye.content,{"border-radius":"2px","font-family":"inherit",padding:"0.7em"}).addClass(ye.title,{position:"relative",margin:"2px","margin-bottom":"10px","line-height":"1em"}).addClass(ye.entry,{position:"relative",margin:"2px",height:"1em","padding-right":"10px","line-height":"1em"}).addClass(ye.label,{position:"relative",float:"left","margin-right":"10px"}).addClass(ye.value,{position:"relative",float:"right"});const r={titleFormat:e=>e,labelFormat:e=>e+":",valueFormat:e=>e};let n=re(e,a),i={titleFormat:r.titleFormat,labelFormat:r.labelFormat,valueFormat:r.valueFormat};return e._tooltip=Object.assign(n.self._tooltip,{builder:a=>{if(void 0===a)return void e._tooltip.content();let r=t.select(document.createElement("div")).attr("class",ye.content).style("border-left",a.stripe?"solid 4px "+a.stripe:null);return r.append("div").attr("class",ye.title).html(i.titleFormat(a.title)),a.content.data.forEach(e=>{let t=r.append("div").attr("class",ye.entry);t.append("div").attr("class",ye.label).html(i.labelFormat(e.name)),t.append("span").attr("class",ye.value).html(i.valueFormat(e.value,e.name))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(e=r.titleFormat)=>(i.titleFormat=e,a),labelFormat:(e=r.labelFormat)=>(i.labelFormat=e,a),valueFormat:(e=r.valueFormat)=>(i.valueFormat=e,a)}),{self:e,api:a}},fe=e=>(t,a)=>{const r=!1,n={on:r,scales:{x:e.x,y:e.y}};return t=Object.assign(t||{},{_horizontal:{on:()=>n.on,scales:()=>n.scales}}),a=Object.assign(a||{},{horizontal:(i=r)=>(n.on=i,n.scales.x=i?e.y:e.x,n.scales.y=i?e.x:e.y,t._bottomAxis.scale(n.scales.x),t._leftAxis.scale(n.scales.y),void 0!==t._yGrid&&t._yGrid.type(i?"x":"y"),a)}),{self:t,api:a}},ve=(e,t)=>{const a={format:()=>""};return e=Object.assign(e||{},{_label:{show:!1,format:a.format}}),t=Object.assign(t||{},{label:r=>(e._label.show=null!=r,e._label.format=r||a.format,t)}),{self:e,api:t}},be=e=>(t,a)=>{let n={defaults:{opacity:.3,lineStyle:"4 8"},type:e,on:!1,grid:void 0,opacity:void 0,lineStyle:void 0,update:e=>{if(n.on){void 0===n.grid&&(n.grid=t._chart.plots.insert("g",":first-child").attr("class","grid").style("opacity",0).style("stroke","currentColor").style("stroke-width","1px"));const a="x"===n.type?t._bottomAxis.fn:t._leftAxis.fn,r="x"===n.type?parseFloat(t._widget.size.innerHeight):-parseFloat(t._widget.size.innerWidth);n.grid.transition().duration(e).call(a.tickSizeInner(r).tickFormat("")).style("stroke-opacity",n.opacity||n.defaults.opacity).style("stroke-dasharray",n.lineStyle||n.defaults.lineStyle).style("opacity",1),n.grid.select("path").remove()}else void 0!==n.grid&&(n.grid.transition().duration(e).style("opacity",0).remove(),n.grid=void 0)}};t._widget.update=r(t._widget.update,n.update);let i={type:e=>{n.type=e,n.grid&&(n.grid.remove(),n.grid=void 0)}};const s={on:e=>(n.on=e,a),opacity:e=>(n.opacity=e,a),lineStyle:e=>{switch(e){case"solid":n.lineStyle="1 0";break;case"dashed":default:n.lineStyle="4 8";break;case"dotted":n.lineStyle="2 5"}return a}};return a=Object.assign(a||{},"x"===e?{xGrid:s}:{yGrid:s}),{baseSelf:i,self:t,api:a}},_e=(e,t)=>{let a=be("y")(e,t);return{self:e=Object.assign(e||{},{_yGrid:a.baseSelf}),api:a.api}},we=(e,t)=>{let a=ce();return{self:e=Object.assign(e||{},{_xRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{xRange:{min:e=>(a.min(e),t),compressMin:(e=0)=>(a.compressMin(e),t),max:e=>(a.max(e),t),compressMax:(e=0)=>(a.compressMax(e),t)}})}};const ke=(e,t,a)=>new Date(Date.UTC(e,t,a)),ze=e=>{const t=e.split("-");return ke(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))};const Me=(e,a)=>{const r="_current"+(a||"");return function(a){const n=t.interpolate(this[r],a);return this[r]=n(0),t=>e(n(t),a)}};var Ce=(e,t)=>{const a={policy:void 0,getStrokeDashArray:e=>{switch(e){case"solid":default:return null;case"dashed":return"5 8";case"dotted":return"1 8"}}};return{self:e=Object.assign(e||{},{_lineStyle:{strokeDashArray:e=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[e]),style:e=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[e],background:(e,t)=>{switch(e){case"solid":default:return t;case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${t} 2px, ${t} 4px`;case"dotted":return`radial-gradient(${t} 30%, transparent 30%) 0.5px 0.5px/4px 4px, radial-gradient(${t} 30%, transparent 30%) 2.5px 2.5px/4px 4px transparent`}}}}),api:t=Object.assign(t||{},{lineStyle:e=>(a.policy=e,t)})}},je=be("x");const Ae="#888",Oe=0,$e="dalian-table-",Fe={container:$e+"container",table:$e+"table",head:$e+"head",headContainer:$e+"head-container",headLabel:$e+"ead-label",headSvg:$e+"head-svg",headMarker:$e+"head-marker",scrollbarTrack:$e+"container::-webkit-scrollbar-track",scrollbarThumb:e=>e+" .dalian-table-container::-webkit-scrollbar-thumb",scrollbarThumbHover:e=>e+" .dalian-table-container::-webkit-scrollbar-thumb:hover",paging:$e+"paging",pagingBlock:$e+"paging-block",pagingNumber:$e+"paging-number",pagingTotalBefore:$e+"paging-total:before",pagingButton:$e+"paging-button",pagingButtonHover:$e+"paging-button:hover"};e.AreaChart=(e,i="body")=>{const s={x:le("linear"),y:le("linear")};let{self:l,api:o}=n(G("area-chart",e,i),K(s.y),(c="transparent",(e,t)=>{const a={mapping:()=>c+"px"};return{self:e=Object.assign(e||{},{_lineColor:{mapping:e=>a.mapping(e)}}),api:t=Object.assign(t||{},{lineColor:(e=c)=>(a.mapping="string"==typeof e?()=>e:t=>e[t]||c,t)})}}),Q(1),J(s.x),te,Z(s),ee(.4),oe,se,U(()=>l._chart.plots,[".plot-group",".plot-marker"]),de);var c;const d={scales:s,update(e){const r=l._chart.data.map(e=>e.values).flat(),n=r.map(e=>e.y),i=t.extent(n),s=.01*(i[1]-i[0]);i[1]+=s,d.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(r.map(e=>e.x)),d.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(l._yRange.range(i));const o=t.area().x(e=>d.scales.x.scale(e.x)).y0(d.scales.y.scale(0)).y1(e=>d.scales.y.scale(e.y)).curve(l._smoothing.curve()),c=t.line().x(e=>d.scales.x.scale(e.x)).y(e=>d.scales.y.scale(e.y)).curve(l._smoothing.curve());l._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",l._color.mapper),e.append("path").attr("class","area").attr("d",e=>o(e.values)).attr("stroke","none").attr("fill","currentColor"),e.append("path").attr("class","line").attr("d",e=>c(e.values)).attr("fill","none"),e),update:e=>(e.style("opacity",1).style("color",l._color.mapper),e.select(".area").attrTween("d",(function(e){const r=t.select(this).attr("d"),n=o(e.values);return a.interpolatePath(r,n,null)})).attr("fill-opacity",l._opacity.value()),e.select(".line").attr("stroke",l._lineColor.mapping).attr("stroke-width",e=>l._lineWidth.mapping(e.name)).attrTween("d",(function(e){const r=t.select(this).attr("d"),n=c(e.values);return a.interpolatePath(r,n,null)})),e),exit:e=>e.style("opacity",0)},e)}};return l._tooltip.content=e=>{if(void 0===e)return void l._plotMarker.remove();const a=t.bisector(e=>d.scales.x.scale(e.x)).left,r=e?l._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===r)return void l._plotMarker.remove();let n=d.scales.x.scale.invert(e[0]);const i=l._chart.data.filter(e=>-1===l._tooltip.ignore.indexOf(e.name)).map((e,t)=>{const a=r[t],i=e.values,s=i[a-1]?i[a-1]:i[a],o=i[a]?i[a]:i[a-1],c=n-s.x>o.x-n?o:s;return n=c.x,l._plotMarker.add(d.scales.x.scale(n),d.scales.y.scale(c.y),e.name,e),{name:e.name,background:l._color.mapper(e),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:n,content:{data:i}}},l._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:+e.x,y:+e.y}))})),l._widget.update=r(l._widget.update,d.update,!0),o=Object.assign(o||{},{}),o},e.BarChart=(e,a="body")=>{const i={x:le("band"),y:le("linear")};let{self:s,api:l}=n(G("bar-chart",e,a),K(i.y),J(i.x),xe,U(()=>s._chart.plots,[".plot-group"]),fe(i),ve,_e);const o={current:void 0,scales:s._horizontal.scales(),horizontal:!1,measureX:(e,t,a)=>{const r=ue(s._label.format(e),a),n=Math.max((t-r.height)/2,5),i=o.scales.x.scale(e.value),l=i>2*n+r.width;return{inside:l,x:l?i-n:i+n+r.width,y:o.scales.y.scale(e.name)+t/2,color:l?me(s._color.mapper(e)):a.color}},measureY:(e,t,a)=>{const r=ue(s._label.format(e),a),n=Math.max((t-r.width)/2,5),i=o.scales.y.scale(e.value),l=parseFloat(s._widget.size.innerHeight)-i>2*n+r.height;return{inside:l,x:o.scales.x.scale(e.name)+t/2,y:l?i+n:i-n-r.height,color:l?me(s._color.mapper(e)):a.color}},update:e=>{o.scales=s._horizontal.scales();const a=s._horizontal.on(),r=s._widget.getStyle(),n=s._chart.data.map(e=>e.name),i=1.01*t.max(s._chart.data.map(e=>e.value))||1;o.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(a?[0,i]:n),o.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(a?n:[0,i]),s._chart.plotGroups({enter:e=>{const t=a?o.scales.y.scale.bandwidth():o.scales.x.scale.bandwidth();e.append("rect").attr("class","bar").on("mouseover.bar",e=>{o.current=e}).on("mouseleave.bar",()=>{o.current=void 0}).attr("x",e=>o.scales.x.scale(a?0:e.name)).attr("y",e=>o.scales.y.scale(a?e.name:0)).attr("width",a?0:t).attr("height",a?t:0).attr("fill",s._color.mapper);const n=a?o.measureX:o.measureY;return e.append("text").attr("class","bar-label").attr("stroke","none").style("display","none").style("pointer-events","none").text(s._label.format).each(e=>Object.assign(e,{_measures:n(e,t,r)})).attr("fill",e=>e._measures.color).attr("x",e=>a?o.scales.x.scale(0):e._measures.x).attr("y",e=>a?e._measures.y:o.scales.y.scale(0)),e},update:e=>{e.style("opacity",1);const t=a?o.scales.y.scale.bandwidth():o.scales.x.scale.bandwidth();e.select(".bar").attr("x",e=>o.scales.x.scale(a?0:e.name)).attr("y",e=>o.scales.y.scale(a?e.name:e.value)).attr("width",e=>a?o.scales.x.scale(e.value):t).attr("height",e=>a?t:parseInt(s._widget.size.innerHeight)-o.scales.y.scale(e.value)).attr("fill",s._color.mapper);const n=a?o.measureX:o.measureY;return e.select(".bar-label").each(e=>Object.assign(e,{_measures:n(e,t,r)})).attr("text-anchor",a?"end":"middle").attr("dominant-baseline",a?"central":"hanging").attr("font-size","inherit").attr("fill",s._font.color).attr("fill",e=>e._measures.color).attr("x",e=>e._measures.x).attr("y",e=>e._measures.y).text(s._label.format).style("display",s._label.show?null:"none"),e},exit:e=>e.style("opacity",0)},e)}};return s._tooltip.content=()=>void 0===o.current?void 0:{title:o.current.name,stripe:s._color.mapper(o.current),content:{data:[{name:"value",value:o.current.value}]}},s._widget.update=r(s._widget.update,o.update,!0),l},e.BoxPlot=(e,a="body")=>{const i={x:le("point"),y:le("linear")};let{self:s,api:l}=n(G("box-plot",e,a),J(i.x),xe,U(()=>s._chart.plots,[".plot-group"]),fe(i),K(i.y),Q(1),ee(.2));const o={current:void 0,scales:s._horizontal.scales(),boxWidth:20,horizontal:!1,whiskerPath(e){const t="lower"===e?"q1":"q3";return a=>`M${o.scales.x.scale(o.horizontal?a.value[t]:a.name)} ${o.scales.y.scale(o.horizontal?a.name:a.value[t])}\n      L${o.scales.x.scale(o.horizontal?a.value.whiskers[e]:a.name)} ${o.scales.y.scale(o.horizontal?a.name:a.value.whiskers[e])}\n      m${o.horizontal?0:-.4*o.boxWidth} ${o.horizontal?-.4*o.boxWidth:0}\n      l${o.horizontal?0:.8*o.boxWidth} ${o.horizontal?.8*o.boxWidth:0}`},outlierX:e=>o.scales.x.scale(o.horizontal?e:e.name),outlierY:e=>o.scales.y.scale(o.horizontal?e.name:e),update(e){const a=s._chart.data.map(e=>e.name);let r=t.min(s._chart.data,e=>t.min(e.value.outliers.extreme.concat(e.value.outliers.mild).concat([e.value.whiskers.lower]))),n=t.max(s._chart.data,e=>t.max(e.value.outliers.extreme.concat(e.value.outliers.mild).concat([e.value.whiskers.upper])));const i=n-r;r-=.05*i,n+=.05*i,o.horizontal=s._horizontal.on(),o.scales=s._horizontal.scales(),o.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(o.horizontal?[r,n]:a),o.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(o.horizontal?a:[r,n]);const l=o.horizontal?0:o.boxWidth/2,c=o.horizontal?o.boxWidth/2:0;s._chart.plotGroups({enter:e=>(e.style("opacity",0).on("mouseover.box",e=>{o.current=e}).on("mouseleave.box",()=>{o.current=void 0}).style("color",s._color.mapper),e.append("rect").attr("class","box-body").attr("rx","2px").attr("ry","2px").attr("stroke","currentColor").attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attr("fill","currentColor").attr("fill-opacity",s._opacity.value()).attr("x",e=>o.scales.x.scale(o.horizontal?e.value.q1:e.name)-l).attr("y",e=>o.scales.y.scale(o.horizontal?e.name:e.value.q3)-c).attr("width",e=>o.horizontal?o.scales.x.scale(e.value.q3)-o.scales.x.scale(e.value.q1):o.boxWidth).attr("height",e=>o.horizontal?o.boxWidth:o.scales.y.scale(e.value.q1)-o.scales.y.scale(e.value.q3)),e.append("line").attr("class","box-median").attr("x1",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)-l).attr("y1",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)-c).attr("x2",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)+l).attr("y2",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)+c).attr("stroke","currentColor").attr("stroke-width","2px"),e.append("path").attr("class","box-whisker-lower").attr("d",o.whiskerPath("lower")).attr("stroke","currentColor").attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attr("fill","none"),e.append("path").attr("class","box-whisker-upper").attr("d",o.whiskerPath("upper")).attr("stroke","currentColor").attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attr("fill","none"),e.selectAll(".box-mild-outlier").data(e=>e.value.outliers.mild.map(t=>Object.assign(t,{name:e.name}))).enter().append("circle").attr("class","box-mild-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor"),e.selectAll(".box-extreme-outlier").data(e=>e.value.outliers.extreme.map(t=>Object.assign(t,{name:e.name}))).enter().append("circle").attr("class","box-extreme-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor").style("opacity",.3),e),updateBefore:t=>(t.selectAll(".box-mild-outlier").data(e=>e.value.outliers.mild.map(t=>Object.assign(t,{name:e.name}))).join(e=>e.append("circle").attr("class","box-mild-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",o.outlierX).attr("cy",o.outlierY).style("opacity",1),t.selectAll(".box-extreme-outlier").data(e=>e.value.outliers.extreme.map(t=>Object.assign(t,{name:e.name}))).join(e=>e.append("circle").attr("class","box-extreme-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",o.outlierX).attr("cy",o.outlierY).style("opacity",s._opacity.value()),t),update:e=>(e.style("opacity",1).style("color",s._color.mapper),e.select(".box-body").attr("x",e=>o.scales.x.scale(o.horizontal?e.value.q1:e.name)-l).attr("y",e=>o.scales.y.scale(o.horizontal?e.name:e.value.q3)-c).attr("width",e=>o.horizontal?o.scales.x.scale(e.value.q3)-o.scales.x.scale(e.value.q1):o.boxWidth).attr("height",e=>o.horizontal?o.boxWidth:o.scales.y.scale(e.value.q1)-o.scales.y.scale(e.value.q3)).attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attr("fill-opacity",s._opacity.value()),e.select(".box-median").attr("x1",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)-l).attr("y1",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)-c).attr("x2",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)+l).attr("y2",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)+c),e.select(".box-whisker-lower").attr("d",o.whiskerPath("lower")).attr("stroke-width",e=>s._lineWidth.mapping(e.name)),e.select(".box-whisker-upper").attr("d",o.whiskerPath("upper")).attr("stroke-width",e=>s._lineWidth.mapping(e.name)),e),exit:e=>e.style("opacity",0)},e)}};return s._tooltip.content=()=>void 0===o.current?void 0:{title:o.current.name,stripe:s._color.mapper(o.current),content:{data:[{name:"median",value:o.current.value.median},{name:"q1",value:o.current.value.q1},{name:"q3",value:o.current.value.q3},{name:"low",value:o.current.value.whiskers.lower},{name:"high",value:o.current.value.whiskers.upper},{name:"mild outliers",value:o.current.value.outliers.mild.length},{name:"extreme outliers",value:o.current.value.outliers.extreme.length}]}},s._widget.update=r(s._widget.update,o.update,!0),l=Object.assign(l||{},{boxWidth:(e=20)=>(o.boxWidth=e,l)}),l},e.BubbleChart=(e,a="body")=>{const i={x:le("linear"),y:le("linear"),size:le("sqrt")};let{self:s,api:l}=n(G("bubble-chart",e,a),K(i.y),J(i.x),xe,U(()=>s._chart.plots,[".plot-group"]),ee(.6),we,de);const o={scales:i,current:{hovered:void 0,closest:void 0},diagram:void 0,radius:30,computeDiagram:e=>t.voronoi().x(e=>o.scales.x.scale(e.value.x)).y(e=>o.scales.y.scale(e.value.y)).extent([[0,0],[parseInt(s._widget.size.innerWidth),parseInt(s._widget.size.innerHeight)]])(e),update(e){const a=s._chart.data.map(e=>e.value).flat(),r=t.max(a.map(e=>e.size));o.scales.size.range(0,o.radius).domain([0,r]);let n=t.extent(a.map(e=>e.x));o.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(n);let i=t.extent(a.map(e=>e.y));o.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(i),n=a.map(e=>{const t=o.scales.x.measure(1.5*o.scales.size.scale(e.size));return[e.x-t,e.x+t]}).flat(),o.scales.x.domain(s._xRange.range(n)),i=a.map(e=>{const t=o.scales.y.measure(1.5*o.scales.size.scale(e.size));return[e.y-t,e.y+t]}).flat(),o.scales.y.domain(s._yRange.range(i)),s._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",s._color.mapper).on("mouseover.bubble",e=>{o.current.hovered=e}).on("mouseleave.bubble",()=>{o.current.hovered=void 0}),e.append("circle").attr("class","bubble").attr("cx",e=>o.scales.x.scale(e.value.x)).attr("cy",e=>o.scales.y.scale(e.value.y)).attr("r",e=>o.scales.size.scale(e.value.size)).attr("stroke","currentColor").attr("fill","currentColor").raise(),e),update:e=>(e.style("opacity",1).style("color",s._color.mapper),e.select(".bubble").attr("cx",e=>o.scales.x.scale(e.value.x)).attr("cy",e=>o.scales.y.scale(e.value.y)).attr("r",e=>o.scales.size.scale(e.value.size)).attr("fill-opacity",s._opacity.value()),e),exit:e=>e.style("opacity",0)},e),o.diagram=o.computeDiagram(s._chart.data),s._widget.container.on("mousemove.scatter",()=>{const e=o.diagram.find(...s._widget.getMouse(),10)||void 0;void 0!==e&&e!==o.current.closest?s._mouse.over(e.data):void 0===o.current.hovered&&void 0!==o.current.closest&&s._mouse.leave(o.current.closest),o.current.closest=e&&e.data||void 0}).on("click.scatter",()=>{void 0!==o.current.closest&&s._mouse.click(o.current.closest)})}};return s._tooltip.content=e=>{if(void 0===e)return;const t=o.current.hovered||o.current.closest;return t?{title:t.name,stripe:s._color.mapper(t),content:{data:[{name:s._bottomAxis.label.text(),value:t.value.x},{name:s._leftAxis.label.text(),value:t.value.y},{name:"size",value:t.value.size}]}}:void 0},s._chart.transformData=e=>e.sort((e,t)=>t.value.size-e.value.size),s._widget.update=r(s._widget.update,o.update,!0),l=Object.assign(l||{},{radius:(e=30)=>(o.radius=e,l)}),l},e.BulletChart=(e,a="body")=>{const i={value:0,forecast:1,ranges:[0,50,80,100],thickness:30,valueColor:"#000",rangeColor:"#888"},s=le("linear");let{self:l,api:o}=n(Y("bullet-chart",e,a,"svg"),J(s),D,P,R);const c={scale:s,ui:{thickness:i.thickness,valueColor:i.valueColor,rangeColor:i.rangeColor},data:{label:"",unit:"",min:0,max:100,ranges:i.ranges,target:95,value:i.value,forecast:i.forecast},dom:(()=>{const e=l._widget.content.append("g").attr("class","dalian-plot-container"),t=e.append("g").attr("class","bullet-range"),a=e.append("g").attr("class","bullet-value"),r=e.append("g").attr("class","bullet-title");return{plot:e,range:{g:t,high:t.append("rect").attr("stroke","none").attr("fill-opacity",.2).attr("fill","currentColor"),mid:t.append("rect").attr("stroke","none").attr("fill-opacity",.4).attr("fill","currentColor"),low:t.append("rect").attr("stroke","none").attr("fill-opacity",.6).attr("fill","currentColor")},value:{g:a,forecast:a.append("rect").attr("stroke","none"),bar:a.append("rect").attr("stroke","none").attr("fill","currentColor"),target:a.append("line").attr("stroke","currentColor").attr("stroke-width","3px")},title:{label:r.append("text").attr("dx",-10).attr("text-anchor","end").attr("dominant-baseline","baseline"),unit:r.append("text").attr("dx",-10).attr("font-size","0.75em").attr("text-anchor","end").attr("dominant-baseline","hanging")}}})(),update(e){c.scale.range(0,parseInt(l._widget.size.innerWidth)).domain([c.data.ranges[0],c.data.ranges[3]]);const a=(parseFloat(l._widget.size.innerHeight)-c.ui.thickness)/2;l._widget.getElem(c.dom.plot,e).attr("transform",`translate(${l._widget.margins.left}, ${a+l._widget.margins.top})`),l._bottomAxis.margin({bottom:a}).tickColor(c.ui.rangeColor);const r=l._widget.container.transition().duration(e);c.dom.range.g.transition(r).attr("color",c.ui.rangeColor),c.dom.value.g.transition(r).attr("color",c.ui.valueColor),c.dom.range.high.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[3])+1).attr("height",c.ui.thickness),c.dom.range.mid.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[2])+1).attr("height",c.ui.thickness),c.dom.range.low.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[1])+1).attr("height",c.ui.thickness),c.dom.value.bar.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",c.ui.thickness/3).attr("width",c.scale.scale(c.data.value)).attr("height",c.ui.thickness/3),c.dom.value.forecast.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",c.ui.thickness/3).attr("width",c.scale.scale(Math.min(c.data.value*c.data.forecast,c.data.ranges[3]))).attr("height",c.ui.thickness/3).attr("fill",(e=>{const a=t.hsl(e);return a.l+=.4*(1-a.l),a})(c.ui.valueColor)),c.dom.value.target.transition(r).attr("x1",c.scale.scale(c.data.target)).attr("y1",c.ui.thickness/6).attr("x2",c.scale.scale(c.data.target)).attr("y2",5*c.ui.thickness/6),c.dom.title.label.transition(r).attr("y",c.ui.thickness/2).text(c.data.label),c.dom.title.unit.transition(r).attr("y",2*c.ui.thickness/3).text(c.data.unit)}};return l._widget.update=r(l._widget.update,c.update,!0),o=Object.assign(o,{value:(e=i.value)=>(c.data.value=e,o),forecast:(e=i.forecast)=>(c.data.forecast=e,o),target:e=>(c.data.target=e,o),ranges:(e=[0,50,80,100])=>(c.data.ranges=e,o),thickness:(e=i.thickness)=>(c.ui.thickness=e,o),valueColor:(e=i.valueColor)=>(c.ui.valueColor=e,o),rangeColor:(e=i.rangeColor)=>(c.ui.rangeColor=e,o),label:e=>(c.data.label=e,o),unit:e=>(c.data.unit=e,o)}),l._bottomAxis.hideAxisLine(!0),o},e.CalendarPlot=(e,a="body")=>{const i={blocks:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],margin:0,align:"start"},tiles:{names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekStart:0}},s={x:le("linear"),y:le("band")};let{self:l,api:o}=n(G("pie-chart",e,a),xe,U(()=>l._chart.plots,[".plot-group"]),ve,K(s.y),(c=s.x,(e,a)=>{let n=N("x",e,t.axisTop,c,{"text-anchor":"end",dy:"2.5em"}),i=t=>{e._widget.getElem(n.label,t).attr("x",e._widget.size.innerWidth)};return(e=Object.assign(e||{},{_topAxis:n}))._widget.update=r(e._widget.update,i),a=Object.assign(a||{},{topAxis:{label:(e="")=>(n.label.text(e),a),format:e=>(n.format(e),a),values:e=>(n.values(e),a),hideTicks:e=>(n.self.hideTicks(e),a),hideAxisLine:e=>(n.hideAxisLine(e),a)}}),{self:e,api:a}}));var c;const d={scales:s,current:void 0,metrics:{},blocks:{names:i.blocks.names,margin:i.blocks.margin,align:i.blocks.align},tiles:{names:i.tiles.names,weekStart:0},fm:l._widget.getFontMetrics(),shiftDay:(e,t)=>(e-t+7)%7,tileX(e){const t=Math.ceil((e.date-d.metrics.firstDay)/864e5);return Math.floor((t+d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart))/7)},labelFill:e=>me(l._color.mapper(e)),addTiles(e,t,a,r){const n=e.append("g").attr("class",e=>"tile date-"+e.date.getDate()).attr("transform",e=>`translate(${d.tileX(e)*t}, ${d.shiftDay(e.date.getDay(),d.tiles.weekStart)*t})`).on("mouseover.calendar",e=>{d.current=e}).on("mouseleave.calendar",()=>{d.current=void 0});return n.append("rect").attr("x",1).attr("y",1).attr("width",t-2).attr("height",t-2).attr("rx",.1*t).attr("ry",.1*t).attr("stroke","transparent").attr("stroke-width",2).attr("fill",l._color.mapper),n.append("text").attr("x",0).attr("y",0).attr("dx",.5*t).attr("dy",a).attr("text-anchor","middle").attr("font-size",r).attr("fill",d.labelFill).style("display",l._label.show?null:"none").style("user-select","none").text(l._label.format),n},update(e){const a=7-d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart),r=Math.ceil((d.metrics.numDays-a)/7)+1;l._chart.data.forEach(e=>{e.x=Math.floor((e.daysOffset-a)/7)+1,e.length=Math.ceil((e.daysOffset+e.numDays-a)/7)+1-e.x});const n=parseFloat(l._widget.size.innerWidth)/(r+d.blocks.margin*(d.metrics.numMonths-1)),i=parseFloat(l._widget.size.innerHeight)/7,s=Math.min(n,i);l._color.scale(t.scaleLinear().domain(t.extent(l._chart.data.map(e=>e.tiles).flat(),e=>e.value)).range([0,1]));const o=(parseFloat(l._widget.size.innerWidth)-s*(r+d.blocks.margin*(d.metrics.numMonths-1)))/2,c=(parseFloat(l._widget.size.innerHeight)-7*s)/2,p=Math.min(.6*s,parseFloat(l._font.size))+"px",u=(s+d.fm.capHeight*parseFloat(p))/2;var g,m;d.scales.x.range(o,parseInt(l._widget.size.innerWidth)-o).domain([0,r+d.blocks.margin*(d.metrics.numMonths-1)]),d.scales.y.range(c,parseInt(l._widget.size.innerHeight)-c).domain((g=d.tiles.names,m=d.tiles.weekStart,g.slice(m).concat(g.slice(0,m)))),l._leftAxis.hideAxisLine(!0).hideTicks(!0).margin({left:o}),l._topAxis.tickAnchor(d.blocks.align).hideAxisLine(!0).hideTicks(!0).margin({top:c}).values(l._chart.data.map(e=>e.x+("middle"===d.blocks.align?.5*e.length:0)+d.blocks.margin*e.index)).format((e,t)=>d.blocks.names[l._chart.data[t].month]),l._chart.plotGroups({enter:e=>(e.style("opacity",0).classed("year-"+d.metrics.firstDay.getFullYear(),!0).attr("transform",e=>`translate(${o+d.blocks.margin*e.index*s}, ${c})`),d.addTiles(e.selectAll(".tile").data(e=>e.tiles).enter(),s,u,p),e),updateBefore:t=>{const a=t.selectAll(".tile").data(e=>e.tiles).join(e=>d.addTiles(e,s,u,p).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("transform",e=>`translate(${d.tileX(e)*s}, ${d.shiftDay(e.date.getDay(),d.tiles.weekStart)*s})`).style("opacity",1);return a.select("rect").attr("width",s-2).attr("height",s-2).attr("rx",.1*s).attr("ry",.1*s).attr("fill",l._color.mapper),a.select("text").attr("dx",.5*s).attr("dy",u).attr("font-size",p).attr("fill",d.labelFill).style("display",l._label.show?null:"none").text(l._label.format),t},update:e=>e.style("opacity",1).attr("transform",e=>`translate(${o+d.blocks.margin*e.index*s}, ${c})`),exit:e=>e.style("opacity",0)},e)}};return l._chart.transformData=e=>{const a=e.map(e=>({date:ze(e.date),value:+e.value})),r=t.min(a.map(e=>e.date)).getMonth(),n=t.max(a.map(e=>e.date)).getMonth(),i=a[0].date.getFullYear();let s=0;const l=Array.from({length:n-r+1},(e,t)=>{const a=(r+t)%12,n=ke(i,a+1,0).getDate(),l=ke(i,a,1),o={month:a,numDays:n,daysOffset:s,index:t,name:"month-"+a,tiles:Array.from({length:n},(e,t)=>{const r=new Date(l);return r.setDate(l.getDate()+t),{name:"month-"+a,date:r,value:null}})};return s+=n,o});return a.forEach(e=>{const t="month-"+e.date.getMonth();l.find(e=>e.name===t).tiles.find(t=>t.date.getDate()===e.date.getDate()).value=e.value}),d.metrics={year:l[0].tiles[0].date.getFullYear(),firstDay:l[0].tiles[0].date,numDays:t.sum(l,e=>e.tiles.length),numMonths:l.length},l},l._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.date.toISOString().substr(0,10),stripe:l._color.mapper(d.current),content:{type:"plots",data:[{name:"value",value:d.current.value}]}},l._widget.update=r(l._widget.update,d.update,!0),o=Object.assign(o||{},{months:(e=i.blocks.names)=>(d.blocks.names=e,o),blockAlign:(e=i.blocks.align)=>(d.blocks.align=e,o),blockMargin:(e=i.blocks.margin)=>(d.blocks.margin=e,o),days:(e=i.tiles.names)=>(d.tiles.names=e,o),weekStart:(e=i.tiles.weekStart)=>(d.tiles.weekStart=e,o)}),delete o.leftAxis,delete o.topAxis,l._color.init("sequential",e=>e.value),o},e.CoxcombChart=(e,a="body")=>{const s=100,l=0;let{self:o,api:c}=n(Y("coxcomb-chart",e,a,"svg"),F,D,R,U(()=>d.plots,[".wedge"]),ve,H,P,se);const d={scale:le("sqrt"),arc:t.arc(),radius:s,angle:l,data:[],current:void 0,plots:o._widget.content.append("g").attr("class","dalian-plot-container"),labelArc:e=>`M${e.outerRadius*Math.sin(e.startAngle)},${-e.outerRadius*Math.cos(e.startAngle)}A${e.outerRadius},${e.outerRadius},0,0,1,${e.outerRadius*Math.sin(e.endAngle)},${-e.outerRadius*Math.cos(e.endAngle)}`,updateWedges:(e,t)=>e.attr("class",e=>"wedge "+i(e.name)).order().on("mouseover.chart",e=>o._mouse.over({name:e.name,y:e.y})).on("mouseleave.chart",e=>o._mouse.leave({name:e.name,y:e.y})).on("click.chart",e=>o._mouse.click({name:e.name,y:e.y})).transition(t).attr("fill",o._color.mapper).attrTween("d",Me(e=>d.arc(e))),update(e){const a=t.max(d.data.map(e=>e.data).flat().map(e=>e.y));d.scale.range(0,d.radius).domain([0,a]),d.data.map(e=>{e.data.map(e=>Object.assign(e,{outerRadius:d.scale.scale(e.y||0)})),e.outerRadius=Math.max(.6*d.radius,d.scale.scale(t.max(e.data,e=>e.y||0)))+.5*parseFloat(o._font.size)});const r=d.plots.transition().duration(e);o._widget.getDefs().selectAll(".wedge-label-path").data(d.data,e=>e.index).join(e=>e.append("path").attr("class","wedge-label-path").attr("id",e=>`${o._widget.id}-wedge-${e.index}`).attr("stroke","red").attr("d",d.labelArc),e=>e,t=>t.transition().duration(e).remove()).transition().duration(e).attrTween("d",Me(e=>d.labelArc(e))),d.plots.selectAll(".wedge-group").data(d.data,e=>e.index).join(e=>e.append("g").attr("class","wedge-group").attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2}) rotate(${d.angle})`).style("opacity",0).call(e=>{let t=e.selectAll("path").data(e=>e.data).enter().append("path").attr("stroke","white");d.updateWedges(t,r),e.append("text").attr("text-anchor","middle").append("textPath").attr("href",e=>`#${o._widget.id}-wedge-${e.index}`).attr("method","stretch").attr("startOffset","50%")}),e=>e.call(e=>{let t=e.selectAll("path").data(e=>e.data).join(e=>e.append("path").attr("stroke","white").style("opacity",0),e=>e,e=>e.transition(r).style("opacity",0).remove());d.updateWedges(t,r).style("opacity",1)}),e=>e.transition(r).style("opacity",0).remove()).on("mouseover.coxcomb",e=>{d.current=e}).on("mouseleave.coxcomb",()=>{d.current=void 0}).transition(r).style("opacity",1).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2}) rotate(${d.angle})`).select("text").style("display",o._label.show?null:"none").select("textPath").text(o._label.format),d.plots.style("pointer-events",o._tooltip&&o._tooltip.isOn()||o._mouse.hasAny()?"all":"none")}};return o._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.label,content:{data:d.current.data.map(e=>({name:e.name,background:o._color.mapper(e),y:e.y}))}},o._widget.update=r(o._widget.update,d.update),c=Object.assign(c||{},{data(e){const t=Array.from(e.reduce((e,t)=>new Set([...e,...t.values.map(e=>e.x)]),new Set)).sort((e,t)=>e-t),a=t.length;return d.data=t.map((t,r)=>{const n=2*r*Math.PI/a,i=2*(r+1)*Math.PI/a;return{index:r,label:t,padAngle:0,startAngle:n,endAngle:i,innerRadius:0,data:e.map(e=>{let a=e.values.find(e=>e.x===t);return{label:t,name:e.name,padAngle:0,startAngle:n,endAngle:i,innerRadius:0,y:a&&a.y||null}}).sort((e,t)=>t.y-e.y)}}),c},radius:(e=s)=>(d.radius=e,c),angle:(e=l)=>(d.angle=e,c)}),c},e.Legend=(e,t="body")=>{const a={colors:(()=>{const e=[];return t=>{const a=e.indexOf(t);return m[a>-1?a:e.push(t)-1]}})(),styles:null,markers:"square",columns:1};let{self:s,api:l}=n(Y("legend",e,t,"svg"),R,U(()=>o.container,[".legend-entry"]),H);const o={entries:[],colors:a.colors,styles:a.styles,markers:a.markers,container:s._widget.content.append("g").attr("class","legend-container"),entryTransform:(e,t)=>`translate(0, ${parseFloat(s._font.size)*(.7+1.4*t)})`,makeMarker(e){let t;switch(e.select(".legend-entry-marker-shape").remove(),o.markers){case"square":t=e.append("rect").attr("x",0).attr("y","-.5em").attr("width","1em").attr("height","1em");break;case"circle":t=e.append("circle").attr("cx",".5em").attr("cy",0).attr("r",".5em");break;default:t=e.append("path").attr("d",o.markers).attr("transform",`translate(${parseFloat(s._font.size)/2}, 0)`)}t.attr("class","legend-entry-marker-shape")},update(e){const t=s._widget.getFontMetrics(),a=o.container.transition().duration(e);o.container.selectAll(".legend-entry").data(o.entries,e=>e.key).join(e=>{const r=e.append("g").attr("class",e=>"legend-entry "+i(e.key)).attr("transform",o.entryTransform).style("shape-rendering","geometricPrecision").style("opacity",0).style("pointer-events",s._mouse.hasAny()?"all":"none").style("cursor",s._mouse.hasAny()?"pointer":"default").on("mouseover",e=>s._mouse.over(e.key)).on("mouseleave",e=>s._mouse.leave(e.key));return r.transition(a).style("opacity",1),r.append("g").attr("class","legend-entry-marker").attr("fill",o.colors).call(o.makeMarker,t).attr("font-size",s._font.size),r.append("text").attr("class","legend-entry-label").attr("text-anchor","start").attr("dominant-baseline","central").attr("font-size",s._font.size).attr("dx",1.3*parseFloat(s._font.size)).text(e=>e.label),r},e=>(e.style("cursor",s._mouse.hasAny()?"pointer":"default").style("pointer-events",s._mouse.hasAny()?"all":"none").transition(a).attr("transform",o.entryTransform).style("opacity",1),e.select(".legend-entry-marker").attr("font-size",s._font.size).call(o.makeMarker,t).transition(a).attr("fill",o.colors),e.select(".legend-entry-label").text(e=>e.label),e),e=>e.transition(a).style("opacity",0).remove())}};return s._widget.update=r(s._widget.update,o.update,!0),l=Object.assign(l,{entries:e=>(o.entries=e,l),colors:(e=a.colors)=>(o.colors="object"==typeof e?t=>e[t.key]:t=>e(t.key),l),styles:(e=a.styles)=>(o.styles=e,l),markers:(e=a.markers)=>(o.markers=e,l),columns:(e=a.columns)=>(o.columns=e,l),insert:(e,t)=>(void 0!==e&&void 0!==e.objects?(e.objects.add(e.id()+"-legend",o.container.node(),t,{foreground:!0}),s._widget.container.style("display","none")):(s._widget.content.append(()=>o.container.node()),s._widget.container.style("display",null)),l)}),l},e.LineChart=(e,s="body")=>{const l={x:le("linear"),y:le("linear")},{self:o,api:c}=n(G("line-chart",e,s),K(l.y),J(l.x),Z(l),U(()=>o._chart.plots,[".plot-group",".plot-marker",".trends-marker"]),Ce,Q(2),(e=>(t,a)=>{const n={container:void 0,pins:new Map,getContainer:()=>(void 0===n.container&&(n.container=t._chart.plots.append("g").attr("class","pins-container")),n.container)};return t._widget.update=r(t._widget.update,e=>{n.pins.forEach(t=>t.update(e))}),a=Object.assign(a||{},{pins:{add:(r,i,s={},l=0)=>{if(n.pins.has(r))return a;const o=e.x.scale,c=e.y.scale,d=s.color||t._font.color,p=(1-(s.height||.8))*c.range()[0],u=s.text||"",g=n.getContainer().append("g").attr("class","pin").style("color",d).style("opacity",0),m=g.append("g").attr("class","pin-label").style("opacity",s.fixed?1:0).style("pointer-events","none"),h=V(m.append("text"),{class:"pin-label-text",y:p-(s.size||6)-10,"text-anchor":"start",stroke:"none",fill:me(d)}).text(u),y=1.05*h.node().getComputedTextLength();h.attr("x",Math.min(o(i),o.range()[1]-y-10)).attr("textLength",y);let x=h.node().getBBox();const f=V(m.append("rect"),{class:"pin-label-box",x:x.x-5,y:x.y-5,width:x.width+10,height:x.height+10,rx:2,stroke:"none",fill:""===u?"none":d});m.node().insertBefore(f.node(),h.node());const v=()=>{m.transition().duration(300).style("opacity",1)},b=()=>{m.transition().duration(300).style("opacity",s.fixed?1:0)},_=V(g.append("line"),{class:"pin-needle",x1:o(i)+1,y1:c.range()[0],x2:o(i)+1,y2:p,stroke:"currentColor","stroke-width":"2px"}).style("pointer-events","all").on("mouseover.pins",v).on("mouseleave.pins",b),w=V(g.append("circle"),{class:"pin-head",cx:o(i)+1,cy:p,r:(s.size||6)+"px",stroke:"white","stroke-width":"1px",fill:"currentColor"}).style("pointer-events","all").on("mouseover.pins",v).on("mouseleave.pins",b);g.transition().duration(l).style("opacity",1);const k={g:g,remove:e=>{g.transition().duration(e).style("opacity",0).on("end",()=>{g.remove()})},update:e=>{_.transition().duration(e).attr("x1",o(i)+1).attr("y1",c.range()[0]).attr("x2",o(i)+1).attr("y2",p),w.transition().duration(e).attr("cx",o(i)+1).attr("cy",p),h.attr("x",Math.min(o(i),o.range()[1]-y-10)).attr("y",p-(s.size||6)-10),x=h.node().getBBox(),f.attr("x",x.x-5).attr("y",x.y-5).attr("width",x.width+10).attr("height",x.height+10)}};return n.pins.set(r,k),a},remove:(e,t=0)=>(void 0===e&&(n.pins.forEach(e=>e.remove()),n.pins.clear()),n.pins.has(e)&&(n.pins.get(e).remove(t),n.pins.delete(e)),a)}}),{self:t,api:a}})(l),te,se,oe,(e=>(a,n)=>{const s={container:void 0,trends:new Map,getContainer:()=>(void 0===s.container&&(s.container=a._chart.plots.append("g").attr("class","trends-container")),s.container),adjustTrend:(e,r,n)=>{const i=a._chart.data.find(t=>t.name===e);if(void 0===i)return;const s=t.bisector(e=>e.x).left,l=s(i.values,r),o=s(i.values,n);if(null===l||null===o)return;const c=i.values[l].x,d=i.values[l].y,p=i.values[o].x,u=i.values[o].y;return{start:{x:c,y:d},end:{x:p,y:u},plateau:d<u?u:d}}};return a._widget.update=r(a._widget.update,e=>{s.trends.forEach(t=>t.update(e))}),n=Object.assign(n||{},{trends:{add:(t,r,l,o,c,d,p=0)=>{if(s.trends.has(t))return n;const u=e.x.scale,g=e.y.scale,m=s.adjustTrend(r,l,o),h=s.getContainer().append("g").attr("class","trend trend-"+i(r)).style("color",d||"#000").style("opacity",0),y=V(h.append("path"),{fill:"none",stroke:"currentColor","stroke-dasharray":"3 3","stroke-width":1,d:`M${u(m.start.x)},${g(m.start.y)}V${g(m.plateau)}H${u(m.end.x)}V${g(m.end.y)}`}),x=V(h.append("circle"),{cx:u(m.start.x),cy:g(m.start.y),r:4,stroke:"none",fill:"currentColor"}),f=V(h.append("circle"),{cx:u(m.end.x),cy:g(m.end.y),r:4,stroke:"none",fill:"currentColor"}),v=V(h.append("text"),{x:u(m.start.x),y:g(m.plateau),dy:-5,"text-anchor":"start",fill:a._font.color}).style("font-family","inherit").style("font-size",a._font.size).text(c);h.transition().duration(p).style("opacity",1);const b={g:h,remove:e=>{h.transition().duration(e).style("opacity",0).on("end",()=>{h.remove()})},update:e=>{h.transition().duration(e).style("color",d||"#000");const t=s.adjustTrend(r,l,o);y.transition().duration(e).attr("d",`M${u(t.start.x)},${g(t.start.y)}V${g(t.plateau)}H${u(t.end.x)}V${g(t.end.y)}`),x.transition().duration(e).attr("cx",u(t.start.x)).attr("cy",g(t.start.y)),f.transition().duration(e).attr("cx",u(t.end.x)).attr("cy",g(t.end.y)),v.attr("font-size",a._font.size).attr("fill",a._font.color).transition().duration(e).attr("x",u(t.start.x)).attr("y",g(t.plateau))}};return s.trends.set(t,b),n},remove:(e,t=0)=>{void 0===e&&(s.trends.forEach(e=>e.remove()),s.trends.clear()),s.trends.has(e)&&(s.trends.get(e).remove(t),s.trends.delete(e))}}}),{self:a,api:n}})(l),je,we,_e,de),d={scales:l,update:e=>{const r=o._chart.data.reduce((e,t)=>e.concat(t.values),[]).filter(e=>null!==e.y),n=r.filter(e=>e.lo+e.hi>0).length>0,i=r.map(e=>e.y-e.lo).concat(r.map(e=>e.y+e.hi)),s=t.extent(i),l=.01*(s[1]-s[0]);s[1]+=l,s[0]-=l,d.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(o._xRange.range(r.map(e=>e.x))),d.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(o._yRange.range(s));const c=t.line().defined(e=>null!==e.y).x(e=>d.scales.x.scale(e.x)).y(e=>d.scales.y.scale(e.y)).curve(o._smoothing.curve()),p=t.area().defined(e=>null!==e.y).x(e=>d.scales.x.scale(e.x)).y0(e=>d.scales.y.scale(e.y-e.lo)).y1(e=>d.scales.y.scale(e.y+e.hi)).curve(o._smoothing.curve());o._chart.plotGroups({enter:e=>(e.style("opacity",0),e.append("path").attr("class","error-band").attr("d",e=>p(e.values)).attr("stroke","none").attr("fill","currentColor").attr("fill-opacity",0),e.append("path").attr("class","line").attr("d",e=>c(e.values)).attr("stroke","currentColor").attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round"),e),update:e=>(e.style("opacity",1).style("color",o._color.mapper),e.select(".error-band").attr("fill-opacity",n?.2:0).attrTween("d",(function(e){const r=t.select(this).attr("d"),n=p(e.values);return a.interpolatePath(r,n,null)})),e.select(".line").attrTween("d",(function(e){const r=t.select(this).attr("d"),n=c(e.values);return a.interpolatePath(r,n,null)})).attr("stroke-width",e=>o._lineWidth.mapping(e.name)).attr("stroke-dasharray",e=>o._lineStyle.strokeDashArray(e.name)),e),exit:e=>e.style("opacity",0)},e)}};return o._tooltip.content=e=>{if(void 0===e)return void o._plotMarker.remove();const a=t.bisector(e=>d.scales.x.scale(e.x)).left,r=e?o._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===r)return void o._plotMarker.remove();let n=d.scales.x.scale.invert(e[0]);const i=o._chart.data.filter(e=>-1===o._tooltip.ignore.indexOf(e.name)).map((e,t)=>{const a=r[t],i=e.values,s=i[a-1]?i[a-1]:i[a],l=i[a]?i[a]:i[a-1],c=n-s.x>l.x-n?l:s;return n=c.x,null!==c.y&&o._yRange.contains(c.y)?o._plotMarker.add(d.scales.x.scale(n),d.scales.y.scale(c.y),e.name,e):o._plotMarker.remove(e.name),{name:e.name,background:o._lineStyle.background(o._lineStyle.style(e.name),o._color.mapper(e)),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:n,content:{data:i}}},o._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:+e.x,y:null===e.y?e.y:+e.y,lo:+e.lo||0,hi:+e.hi||0}))})),o._widget.update=r(o._widget.update,d.update,!0),c},e.PieChart=(e,a="body")=>{const i=0,s=100;let{self:l,api:o}=n(G("pie-chart",e,a),xe,U(()=>l._chart.plots,[".plot-group"]),ve);const c={innerRadius:i,outerRadius:s,current:void 0,arc:null,labels:{format:()=>"",left:e=>.5*(e.startAngle+e.endAngle)>Math.PI,arcs:{inner:null,outer:null}},numSlices:0,measure:(e,t,a)=>{const r=ue(l._label.format(e),a);return{outside:1.1*Math.sqrt(r.width*r.width+r.height*r.height)>Math.min(.5*(c.innerRadius+c.outerRadius)*(e.endAngle-e.startAngle),c.outerRadius-c.innerRadius),x:-.25*c.outerRadius*(c.numSlices-t),y:-1.25*c.outerRadius+1.1*r.height*(c.numSlices-1-t)}},labelLinePath:e=>{let t=c.labels.arcs.inner.centroid(e);const a=c.labels.arcs.outer.centroid(e),r=Math.max(a[1],e._measures.y),n=[a[1]!==t[1]?a[0]-(a[0]-t[0])*(a[1]-r)/(a[1]-t[1]):a[0],r],i=.25*c.outerRadius,s=[c.labels.left(e)?Math.min(n[0]-i,e._measures.x):n[0]+i,n[1]];return n[1]>t[1]&&(t=n),`M${t[0]} ${t[1]} L${n[0]} ${n[1]} L${s[0]} ${s[1]}`},labelTextAnchor:e=>c.labels.left(e)?"end":"start",labelTextX:e=>{const t=.25*c.outerRadius;return c.labels.left(e)?Math.min(c.labels.arcs.outer.centroid(e)[0]-t,e._measures.x)-5:c.labels.arcs.outer.centroid(e)[0]+t+5},labelTextY:e=>Math.max(c.labels.arcs.outer.centroid(e)[1],e._measures.y),update:e=>{const a=l._widget.getStyle();c.arc=t.arc().innerRadius(c.innerRadius).outerRadius(c.outerRadius),c.labels.arcs.inner=t.arc().innerRadius(c.outerRadius+5).outerRadius(c.outerRadius+5),c.labels.arcs.outer=t.arc().innerRadius(1.25*c.outerRadius).outerRadius(1.25*c.outerRadius),c.numSlices=l._chart.data.filter(e=>e.value>0).length,l._chart.plotGroups({enter:e=>{e.style("opacity",0).style("color",l._color.mapper).each((e,t)=>Object.assign(e,{_measures:c.measure(e,t,a)}));const t=e.append("g").attr("class","slice").attr("transform",`translate(${parseFloat(l._widget.size.innerWidth)/2}, ${parseFloat(l._widget.size.innerHeight)/2})`).on("mouseover.pie",e=>{c.current=e}).on("mouseleave.pie",()=>{c.current=void 0});t.append("path").attr("class","slice-wedge").attr("d",c.arc).attr("stroke-linejoin","round").attr("stroke","white").attr("fill","currentColor");const r=t.append("g").attr("class","slice-label").style("display",l._label.show?null:"none");r.append("text").attr("class","inner-label").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",e=>c.arc.centroid(e)[0]).attr("y",e=>c.arc.centroid(e)[1]).style("cursor","default").style("opacity",e=>e._measures.outside?0:1).text(e=>e.value.toFixed(1));const n=r.append("g").attr("class","outer-label").style("opacity",e=>e._measures.outside?1:0);return n.append("path").attr("class","outer-label-line").attr("stroke-linejoin","round").attr("fill","none").attr("d",c.labelLinePath),n.append("text").attr("class","outer-label-text").attr("dominant-baseline","middle").attr("text-anchor",c.labelTextAnchor).attr("x",c.labelTextX).attr("y",c.labelTextY).style("cursor","default").text(e=>e.value.toFixed(1)),e},update:e=>{e.style("opacity",1).style("color",l._color.mapper).each((e,t)=>Object.assign(e,{_measures:c.measure(e,t,a)}));const t=e.select(".slice").attr("transform",`translate(${parseFloat(l._widget.size.innerWidth)/2}, ${parseFloat(l._widget.size.innerHeight)/2})`);t.select(".slice-wedge").attrTween("d",Me(e=>c.arc(e)));const r=t.select(".slice-label").style("display",l._label.show?null:"none");r.select(".inner-label").style("opacity",e=>e._measures.outside?0:1).attr("fill",e=>me(l._color.mapper(e))).attrTween("x",Me(e=>c.arc.centroid(e)[0],"x")).attrTween("y",Me(e=>c.arc.centroid(e)[1],"y")).text(l._label.format);const n=r.select(".outer-label").style("opacity",e=>e._measures.outside?1:0);return n.select(".outer-label-line").attr("stroke",l._font.color).attrTween("d",Me(c.labelLinePath,"r")),n.select(".outer-label-text").attr("fill",l._font.color).attrTween("text-anchor",Me(c.labelTextAnchor,"align")).attrTween("x",Me(c.labelTextX,"x")).attrTween("y",Me(c.labelTextY,"y")).text(l._label.format),e},exit:e=>e.style("opacity",0)},e)}};return l._chart.transformData=e=>t.pie().value(e=>e.value).sort(null)(e.sort((e,t)=>t.value-e.value)).map(e=>Object.assign(e,{name:e.data.name})),l._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:l._color.mapper(c.current),content:{type:"plots",data:[{name:"value",value:c.current.value}]}},l._widget.update=r(l._widget.update,c.update),o=Object.assign(o,{innerRadius:(e=i)=>(c.innerRadius=e,o),outerRadius:(e=s)=>(c.outerRadius=e,o)}),o},e.ScatterPlot=(e,a="body")=>{const i=4,s={x:le("linear"),y:le("linear")};let{self:l,api:o}=n(G("scatter-plot",e,a),J(s.x),xe,U(()=>l._chart.plots,[".plot-group"]),K(s.y),Z(s),ee(.6),te,we,de);const c={scales:s,current:void 0,diagram:void 0,size:i,computeDiagram:e=>{const a=e.map(e=>e.values.map(t=>({name:e.name,x:t.x,y:t.y}))).flat();return t.voronoi().x(e=>c.scales.x.scale(e.x)).y(e=>c.scales.y.scale(e.y)).extent([[0,0],[parseInt(l._widget.size.innerWidth),parseInt(l._widget.size.innerHeight)]])(a)},update:e=>{const a=l._chart.data.map(e=>e.values).flat(),r=t.extent(a.map(e=>e.x));c.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(r);const n=t.extent(a.map(e=>e.y));c.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(n);const i=c.scales.x.measure(c.size);c.scales.x.domain(l._xRange.range([r[0]-i,r[1]+i]));const s=c.scales.y.measure(c.size);c.scales.y.domain(l._yRange.range([n[1]+s,n[0]-s])),l._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",l._color.mapper).attr("stroke","none").attr("fill","currentColor"),e.selectAll("circle").data(e=>e.values).enter().append("circle").attr("class","dot").attr("cx",e=>c.scales.x.scale(e.x)).attr("cy",e=>c.scales.y.scale(e.y)).attr("r",c.size/2).style("opacity",0),e),updateBefore:t=>(t.style("opacity",1).style("color",l._color.mapper),t.selectAll("circle").data(e=>e.values).join(e=>e.append("circle").attr("class","dot").attr("cx",e=>c.scales.x.scale(e.x)).attr("cy",e=>c.scales.y.scale(e.y)).attr("r",c.size/2).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",e=>c.scales.x.scale(e.x)).attr("cy",e=>c.scales.y.scale(e.y)).attr("r",c.size/2).style("opacity",l._opacity.value()),t),exit:e=>e.style("opacity",0)}),c.diagram=c.computeDiagram(l._chart.data),l._widget.container.on("mousemove.scatter",()=>{const e=c.diagram.find(...l._widget.getMouse(),Math.max(20,c.size/2))||void 0;void 0!==e&&e!==c.current?l._mouse.over(e.data):void 0!==c.current&&l._mouse.leave(c.current),c.current=e&&e.data||void 0}).on("click.scatter",()=>{void 0!==c.current&&l._mouse.click(c.current)})}};return l._tooltip.content=e=>{if(void 0!==e){if(c.current)return l._plotMarker.add(c.scales.x.scale(c.current.x),c.scales.y.scale(c.current.y),"marker",c.current,Math.max(5,.75*c.size)),{title:c.current.name,stripe:l._color.mapper(c.current),content:{type:"plots",data:[{name:l._bottomAxis.label.text(),value:c.current.x},{name:l._leftAxis.label.text(),value:c.current.y}]}};l._plotMarker.remove()}else l._plotMarker.remove()},l._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.map(e=>({x:+e.x,y:+e.y}))})),l._widget.update=r(l._widget.update,c.update,!0),o=Object.assign(o,{size:(e=i)=>(c.size=e,o)}),o},e.Table=(e,t="body")=>{S.addClass(Fe.container,{position:"relative",overflow:"auto","pointer-events":"all"}).addClass(Fe.scrollbarTrack,{background:"transparent"}).addClass(Fe.table,{width:"100%","border-collapse":"collapse","user-select":"none"}).addClass(Fe.head,{position:"sticky",top:0,padding:"5px 10px",cursor:"pointer","white-space":"nowrap","font-weight":"normal","font-variant":"all-small-caps"}).addClass(Fe.headContainer,{position:"relative",display:"inline-block"}).addClass(Fe.headLabel,{"margin-right":"12px"}).addClass(Fe.headSvg,{position:"absolute",right:0,top:"calc(50% - 4px)"}).addClass(Fe.paging,{position:"relative",float:"right",width:"100px",height:"25px","pointer-events":"all","user-select":"none"}).addClass(Fe.pagingBlock,{position:"relative",float:"left",width:"25px",height:"25px"}).addClass(Fe.pagingNumber,{"text-align":"center","line-height":"25px"}).addClass(Fe.pagingTotalBefore,{content:'"/"',position:"absolute",left:"-2px"}).addClass(Fe.pagingButton,{cursor:"pointer",opacity:.2}).addClass(Fe.pagingButtonHover,{opacity:1});let{self:a,api:i}=n(Y("table",e,t,"div"),D,U(()=>s.dom.table,["td"],(()=>{const e=ge(Ae,.8);return{focus:{color:me(e),background:e}}})()),H,R,P);S.addId(Fe.scrollbarThumb(a._widget.id),{background:ge(Ae,.8)}).addId(Fe.scrollbarThumbHover(a._widget.id),{background:Ae});const s={fm:a._widget.getFontMetrics(),colors:{main:Ae,light:ge(Ae,.8)},data:{cols:[],schema:[],values:[]},dom:(()=>{const e=a._widget.content.append("div").attr("class",Fe.container),t=e.append("table").attr("class",Fe.table);return{container:e,table:t,header:t.append("thead").append("tr"),body:t.append("tbody")}})(),sorting:{key:null,ascending:!0,arrow:e=>void 0===e?"":"up"===e?"m 1 8 l 4 -6.92 l 4 6.92 z":"m 1 2 l 4 6.92 l 4 -6.92 z",update(e,t){s.sorting.key=e,s.sorting.ascending=t},sorter(e,t="string",a=!1){const r=a?-1:1;switch(t){default:case"string":return(t,a)=>r*t[e].localeCompare(a[e]);case"number":return(t,a)=>r*(t[e]-a[e]);case"date":return(t,a)=>r*(ze(t[e])-ze(a[e]))}},sort(e){switch(s.sorting.key){default:case null:s.data.values.sort(s.sorting.sorter(e.key,e.type)),s.sorting.update(e.key,!0);break;case e.key:s.sorting.ascending?(s.data.values.sort(s.sorting.sorter(e.key,e.type,!0)),s.sorting.update(e.key,!1)):(s.data.values.sort((e,t)=>e._id-t._id),s.sorting.update(null,!0))}s.updateBody(),s.dom.header.selectAll("."+Fe.headMarker).attr("d",e=>s.sorting.arrow(e.key===s.sorting.key?s.sorting.ascending?"up":"down":void 0))}},paging:(()=>{let e=Oe,t=0;const r=(()=>{const n=a._widget.content.append("div").attr("class",Fe.paging);n.append("div").attr("class",`${Fe.pagingBlock} ${Fe.pagingButton}`).on("click",()=>{e>0&&t>0&&(t--,s.updateBody(),r.current.text(t+1))}).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 10 4 l -6.92 4 l 6.92 4 z");const i=n.append("div").attr("class",`${Fe.pagingBlock} ${Fe.pagingNumber}`),l=n.append("div").attr("class",`${Fe.pagingBlock} ${Fe.pagingNumber} ${$e}paging-total`);return n.append("div").attr("class",`${Fe.pagingBlock} ${Fe.pagingButton}`).on("click",()=>{e>0&&t<Math.ceil(s.data.values.length/e)-1&&(t++,s.updateBody(),r.current.text(t+1))}).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 2 4 l 6.92 4 l -6.92 4 z"),{g:n,current:i,total:l}})();return{update(n){r.g.style("display",e>0?null:"none"),e>0&&(r.g.transition().duration(n).style("margin-right",a._widget.margins.right+"px"),r.current.text(t+1),r.total.text(Math.ceil(s.data.values.length/e)))},filter(a){if(e>0){let r=t*e,n=r+e;return a.filter((e,t)=>t>=r&&t<n)}return a},reset(a){void 0!==a&&(e=a),t=0},size:()=>e}})(),align(e){switch(e.type){default:case"string":case"date":return"left";case"number":return"right"}},updateBody(){const e=s.data.schema.filter(e=>s.data.cols.indexOf(e.key)>-1);let t=s.paging.filter(s.data.values);s.dom.body.selectAll("tr").data(t,()=>Date.now()+""+Math.random()).join(t=>{const r=t.append("tr").style("height","2em").style("line-height","2em");return r.selectAll("td").data(t=>e.map(e=>({row:t._id,column:e.key,value:t[e.key],type:e.type,displayValue:void 0===e.format?t[e.key]:e.format(t[e.key])}))).enter().append("td").attr("class",e=>`row-${e.row} column-${e.column} cell-${e.row}-${e.column}`).style("padding","0.25em 0.5em").style("white-space","nowrap").style("text-align",s.align).on("mouseover.table",a._mouse.over).on("mouseleave.table",a._mouse.leave).on("click.table",a._mouse.click).text(e=>e.displayValue),r},e=>e,e=>{let a=s.paging.size()-t.length;e.filter((e,t)=>t<a).raise().selectAll("td").remove(),e.filter((e,t)=>t>=a).remove()})},update(e){s.dom.container.transition().duration(e).style("width",a._widget.size.innerWidth).style("height",a._widget.size.innerHeight).style("margin-left",a._widget.margins.left+"px").style("margin-top",a._widget.margins.top+"px"),s.dom.table.style("height",a._widget.size.innerHeight);const t=s.data.schema.filter(e=>s.data.cols.indexOf(e.key)>-1);s.dom.header.selectAll("th").data(t,e=>e.key).join(e=>{const t=e.append("th").style("user-select","none"),a=t.append("div").attr("class",Fe.headContainer).style("float",s.align);return a.append("span").attr("class",Fe.headLabel),a.append("svg").attr("class",Fe.headSvg).attr("viewBox","0 0 10 10").style("width",s.fm.capHeight+"em").style("height",s.fm.capHeight+"em").append("path").attr("class",Fe.headMarker).attr("fill","currentColor").attr("d",s.sorting.arrow()),t},e=>e,e=>e.remove()).on("click",s.sorting.sort).attr("class",Fe.head).style("background",s.colors.main).style("color",me(s.colors.main)).select("."+Fe.headLabel).html(e=>e.name),s.updateBody(),s.paging.update(e)}};return a._widget.update=r(a._widget.update,s.update,!0),i=Object.assign(i,{data:e=>(s.data.values=e.map((e,t)=>Object.assign(e,{_id:t})),s.paging.reset(),s.data.cols=Object.keys(e[0]||{}),s.sorting.update(null,!0),s.dom.header.selectAll(".table-head-sorting").text(""),i),schema:e=>(s.data.schema=e,i),color:(e=Ae)=>(s.colors={main:e,light:ge(e,.8)},S.updateId(Fe.scrollbarThumb(a._widget.id),{background:s.colors.light}).updateId(Fe.scrollbarThumbHover(a._widget.id),{background:e}),a._highlight.style({focus:{color:me(s.colors.light),background:s.colors.light}}),i),paging:(e=Oe)=>(s.paging.reset(e),i)}),i},e.ViolinPlot=(e,i="body")=>{const s={x:le("point"),y:le("linear")};let{self:l,api:o}=n(G("violin-plot",e,i),J(s.x),xe,U(()=>l._chart.plots,[".plot-group"]),fe(s),K(s.y),Q(1),ee(.2),de);const c={data:[],current:void 0,scales:l._horizontal.scales(),violinWidth:30,horizontal:!1,bandwidth:1,kde:(e,a)=>r=>a.map(a=>({x:a,y:t.mean(r,t=>e(a-t))})),epanechnikovKernel:e=>t=>Math.abs(t/=e)<=1?.75*(1-t*t)/e:0,makeViolin(e){const a=t.min(e),r=t.max(e),n=r-a,i=c.kde(c.epanechnikovKernel(c.bandwidth),t.range(Math.floor(n/c.bandwidth)+1).map(e=>a+c.bandwidth*e))(e);return{yMin:a,yMax:r,values:i,scale:t.scaleLinear().range([c.violinWidth/2-1,0]).domain([0,t.max(i,e=>e.y)])}},bimodality(e){const a=e.length,r=t.mean(e),n=t.sum(e,e=>(e-r)*(e-r))/a,i=t.sum(e,e=>Math.pow(e-r,3))/a,s=t.sum(e,e=>Math.pow(e-r,4))/a,l=Math.sqrt(a*(a-1))*i/((a-2)*Math.pow(n,1.5));return(l*l+1)/(s/(n*n)-3+3*(a-1)*(a-1)/((a-2)*(a-3)))},update(e){const r=l._chart.data.map(e=>e.name);const n=[t.min(l._chart.data.map(e=>e.min)),t.max(l._chart.data.map(e=>e.max))],i=.05*(n[1]-n[0]);n[1]+=i,n[0]-=i,c.horizontal=l._horizontal.on(),c.scales=l._horizontal.scales(),c.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(c.horizontal?l._yRange.range(n):r),c.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(c.horizontal?r:l._yRange.range(n));const s=c.violinWidth/2-.5,o=c.horizontal?"":"rotate(90)";l._chart.plotGroups({enter:e=>(e.style("opacity",0).on("mouseover.violin",e=>{c.current=e}).on("mouseleave.violin",()=>{c.current=void 0}).style("color",l._color.mapper),e.append("path").attr("class","violin").attr("transform",e=>`translate(${c.horizontal?0:c.scales.x.scale(e.name)+s}, ${c.horizontal?c.scales.y.scale(e.name)-s:0}) ${o}`).attr("d",e=>e.area.x(e=>c.horizontal?c.scales.x.scale(e.x):c.scales.y.scale(e.x))(e.values)).attr("stroke","currentColor").attr("fill","currentColor").style("fill-opacity",0),e),update:e=>(e.style("opacity",1).style("color",l._color.mapper),e.select(".violin").attr("transform",e=>`translate(${c.horizontal?0:c.scales.x.scale(e.name)+s}, ${c.horizontal?c.scales.y.scale(e.name)-s:0}) ${o}`).attrTween("d",(function(e){const r=t.select(this).attr("d"),n=e.area.x(e=>c.horizontal?c.scales.x.scale(e.x):c.scales.y.scale(e.x))(e.values);return a.interpolatePath(r,n,null)})).attr("stroke-width",e=>l._lineWidth.mapping(e.name)).style("fill-opacity",l._opacity.value()),e),exit:e=>e.style("opacity",0)},e)}};return l._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:l._color.mapper(c.current),content:{data:[{name:"mean",value:c.current.stats.mean},{name:"median",value:c.current.stats.median},{name:"bimodality",value:c.current.stats.bimodality}]}},l._chart.transformData=e=>(c.data=e,e.map(e=>{const{yMin:a,yMax:r,values:n,scale:i}=c.makeViolin(e.values);return{name:e.name,min:a,max:r,stats:{mean:t.mean(e.values),median:t.median(e.values.sort((e,t)=>e-t)),bimodality:c.bimodality(e.values)},values:n,scale:i,area:t.area().curve(t.curveBasis).y0(e=>i(-e.y)).y1(e=>i(e.y))}})),l._widget.update=r(l._widget.update,c.update,!0),o=Object.assign(o||{},{violinWidth:(e=30)=>(c.violinWidth=e,l._chart.data.map(e=>Object.assign(e,{scale:e.scale&&e.scale.range([c.violinWidth/2-1,0]),area:e.area&&e.area.y0(t=>e.scale(-t.y)).y1(t=>e.scale(t.y))})),o),bandwidth:(e=1)=>(c.bandwidth=e,l._chart.data.map((e,t)=>{const{values:a,scale:r}=c.makeViolin(c.data[t].values);Object.assign(e,{values:a,scale:r,area:e.area&&e.area.y0(e=>r(-e.y)).y1(e=>r(e.y))})}),o)}),o},Object.defineProperty(e,"__esModule",{value:!0})}));
