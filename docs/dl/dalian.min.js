// https://www.npmjs.com/package/dalian v0.4.15 Copyright 2022 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).dalian={},t.d3,t.d3)}(this,(function(t,e,a){"use strict";var r=(t,...e)=>e.reduce(((t,e)=>e(t.self,t.api)),t);function i(t){return""===t?"da":"da-"+Array.from(t).map((t=>{const e=t.toLowerCase();return"0123456789abcdefghijklmnopqrstuvwxyz".indexOf(e)>-1?e:" "===e?"_":"U"+e.charCodeAt(0).toString(32)+"-"})).join("")}var n=(t,e,a=!1)=>{const r=t;return(...t)=>{a?(e(...t),r(...t)):(r(...t),e(...t))}};function o(t,e){return Object.entries(e).forEach((([e,a])=>{t.attr(e,a)})),t}const s={format:t=>t,values:null,tickAnchor:null,tickColor:"currentColor"};var l=(t,e,a,r,i)=>{const l=e._widget.content.append("g").attr("class",`dalian-axis-container ${t}`).style("font-family","inherit").style("font-size","inherit"),c=l.append("g").attr("class",`axis ${t}`).style("font-family","inherit").style("font-size","inherit");c.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");const d={margin:{left:0,top:0,right:0,bottom:0},format:s.format,values:s.values,scale:r,container:l,tickColor:s.tickColor,ticks:!0,tickAnchor:s.tickAnchor,axisLine:!0};e._widget.update=n(e._widget.update,(t=>{e._widget.getElem(d.container,t).attr("transform","translate("+(e._widget.margins.left+d.margin.left-d.margin.right)+","+(e._widget.margins.top+d.margin.top-d.margin.bottom)+")").style("width",e._widget.size.innerWidth).style("height",e._widget.size.innerHeight),p.fn.scale(d.scale.scale).tickFormat(d.format).tickSize(d.ticks?6:0).tickPadding(d.ticks?3:9).tickValues(d.values||null),e._widget.getElem(p.axis,t).call(p.fn).selectAll("path").style("opacity",d.axisLine?1:0),c.selectAll(".tick > text").attr("text-anchor",d.tickAnchor),c.selectAll(".tick > line").attr("stroke",d.tickColor)}));const p={fn:a().ticks(5),axis:c,margin:t=>(d.margin=Object.assign(d.margin,t),p),label:o(l.append("text").attr("class",`axis-label ${t}`).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text(""),i),tickAnchor:(t=s.tickAnchor)=>(d.tickAnchor=t,p),scale:t=>(d.scale=t,p),hideAxisLine:t=>(d.axisLine=!t,p),hideTicks:t=>(d.ticks=!t,p),format:(t=s.format)=>(d.format=t,p),values:(t=s.values)=>(d.values=t,p),tickColor:(t="currentColor")=>(d.tickColor=t,p)};return p},c=t=>(a,r)=>{let i=l("x",a,e.axisBottom,t,{"text-anchor":"end",dy:"2.5em"});return(a=Object.assign(a||{},{_bottomAxis:i}))._widget.update=n(a._widget.update,(t=>{a._widget.getElem(i.axis,t).attr("transform",`translate(0, ${parseFloat(a._widget.size.innerHeight)})`),a._widget.getElem(i.label,t).attr("x",a._widget.size.innerWidth).attr("y",parseFloat(a._widget.size.innerHeight)+"px")})),r=Object.assign(r||{},{bottomAxis:{label:(t="")=>(i.label.text(t),r),format:t=>(i.format(t),r),values:t=>(i.values(t),r),hideTicks:t=>(i.hideTicks(t),r),hideAxisLine:t=>(i.hideAxisLine(t),r)}}),{self:a,api:r}},d=t=>(a,r)=>{let i=l("y",a,e.axisLeft,t,{"text-anchor":"begin",x:"5px",y:"-5px"});return{self:a=Object.assign(a||{},{_leftAxis:i}),api:r=Object.assign(r||{},{leftAxis:{label:(t="")=>(i.label.text(t),r),format:t=>(i.format(t),r),values:t=>(i.values(t),r),hideTicks:t=>(i.hideTicks(t),r),hideAxisLine:t=>(i.hideAxisLine(t),r)}})}};const p={format:t=>t,values:null};var u=(t,a)=>(r,i)=>{const o=r._widget.content.insert("g",":first-child").attr("class","dalian-axis-container radial").style("font-family","inherit").style("font-size","inherit"),s=o.append("g").attr("class","axis radial").style("font-family","inherit").style("font-size","inherit");let l=e.axisRight(t.copy().range([0,-t.scale.range()[1]]));function c(e,a){return t.scale.range()[1]*Math.sin(2*e*Math.PI/a)}function d(e,a){return-t.scale.range()[1]*Math.cos(2*e*Math.PI/a)}function u(t,e){return 0===t||t===e/2?"middle":t<e/2?"start":"end"}function g(t,e){if(e%4==0){const a=Math.round(e/4);if(t===a||t===e-a)return"middle"}return t>e/4&&t<3*e/4?"hanging":"auto"}const m=Object.assign({labels:[]},p);return(r=Object.assign(r,{_radialAxis:{labels:t=>void 0===t?m.labels:(m.labels=t,r),ticks:()=>null===m.values?l.scale().ticks():m.values,radialScale:()=>t,angularScale:()=>a}}))._widget.update=n(r._widget.update,(a=>{l=e.axisRight(t.copy().range([0,-t.scale.range()[1]])).tickFormat(m.format).tickValues(m.values).tickSize(0),r._widget.getElem(o,a).attr("transform",`translate(${parseFloat(r._widget.size.width)/2}, ${parseFloat(r._widget.size.height)/2})`).call(l),o.selectAll(".tick > text").style("font-size",".8em"),o.select(".domain").remove(),s.selectAll("line").data(m.labels,(t=>t)).join((t=>t.append("line").attr("stroke","black").attr("x1",0).attr("y1",0).attr("x2",((t,e)=>1.05*c(e,m.labels.length))).attr("y2",((t,e)=>1.05*d(e,m.labels.length))).style("stroke-width","1px").style("shape-rendering","geometricPrecision").style("stroke","currentColor")),(t=>t.transition().duration(a).attr("x2",((t,e)=>1.05*c(e,m.labels.length))).attr("y2",((t,e)=>1.05*d(e,m.labels.length)))),(t=>t.remove())),s.selectAll(".axis-label").data(m.labels,(t=>t)).join((t=>t.append("text").attr("class","axis-label radial").attr("x",((t,e)=>1.15*c(e,m.labels.length))).attr("y",((t,e)=>1.15*d(e,m.labels.length))).attr("fill","currentColor").attr("stroke","none").attr("text-anchor",((t,e)=>u(e,m.labels.length))).attr("dominant-baseline",((t,e)=>g(e,m.labels.length))).style("font-family","inherit").style("font-size","inherit").style("font-size","1em").text((t=>t))),(t=>t.transition().duration(a).attr("x",((t,e)=>1.15*c(e,m.labels.length))).attr("y",((t,e)=>1.15*d(e,m.labels.length))).attr("text-anchor",((t,e)=>u(e,m.labels.length))).attr("dominant-baseline",((t,e)=>g(e,m.labels.length))).text((t=>t))),(t=>t.remove()))})),i=Object.assign(i||{},{radialAxis:{values:(t=p.values)=>(m.values=t,i),format:(t=p.format)=>(m.format=t,i)}}),{self:r,api:i}};const g={on:!1,opacity:.3,curved:!1};var m=(t,a)=>{let r=t._widget.content.insert("g",":first-child").attr("class","grid");const i=Object.assign({},g);return t._widget.update=n(t._widget.update,(a=>{if(i.on)if(void 0===r&&(r=t._widget.content.insert("g",":first-child").attr("class","grid")),i.curved)r.attr("transform",`translate(${parseFloat(t._widget.size.width)/2}, ${parseFloat(t._widget.size.height)/2})`).selectAll("circle").data(t._radialAxis.ticks()).join((e=>e.append("circle").attr("cx",0).attr("cy",0).attr("r",t._radialAxis.radialScale()).attr("fill","none").attr("stroke","currentColor").style("stroke-width","1px").style("stroke-opacity",i.opacity)),(e=>e.transition().duration(a).attr("r",t._radialAxis.radialScale())),(t=>t.remove()));else{const n=t._radialAxis.angularScale(),o=e.lineRadial().angle(((t,e)=>n(e))).radius(t._radialAxis.radialScale()).curve(e.curveLinearClosed);r.attr("transform",`translate(${parseFloat(t._widget.size.width)/2}, ${parseFloat(t._widget.size.height)/2})`).selectAll("path").data(t._radialAxis.ticks().map((e=>Array(t._radialAxis.labels().length).fill(e)))).join((t=>t.append("path").attr("d",o).attr("fill","none").attr("stroke","currentColor").style("stroke-width","1px").style("stroke-opacity",i.opacity)),(t=>t.transition().duration(a).attr("d",o)),(t=>t.remove()))}else void 0!==r&&(r.transition().duration(a).style("opacity",0).remove(),r=void 0)})),a=Object.assign(a||{},{radialGrid:{opacity:(t=g.opacity)=>(i.opacity=t,a),on:(t=g.on)=>(i.on=t,a),curved:(t=g.curved)=>(i.curved=t,a)}}),{self:t,api:a}},h=t=>(e,a)=>{let r={defaults:{opacity:.3,lineStyle:"4 8"},type:t,on:!1,grid:void 0,opacity:void 0,lineStyle:void 0};e._widget.update=n(e._widget.update,(t=>{if(r.on){void 0===r.grid&&(r.grid=e._chart.plots.insert("g",":first-child").attr("class","grid").style("opacity",0).style("stroke","currentColor").style("stroke-width","1px"));const a="x"===r.type?e._bottomAxis.fn:e._leftAxis.fn,i="x"===r.type?parseFloat(e._widget.size.innerHeight):-parseFloat(e._widget.size.innerWidth);r.grid.transition().duration(t).call(a.tickSizeInner(i).tickFormat("")).style("stroke-opacity",r.opacity||r.defaults.opacity).style("stroke-dasharray",r.lineStyle||r.defaults.lineStyle).style("opacity",1),r.grid.select("path").remove()}else void 0!==r.grid&&(r.grid.transition().duration(t).style("opacity",0).remove(),r.grid=void 0)}));let i={type:t=>{r.type=t,r.grid&&(r.grid.remove(),r.grid=void 0)}};const o={on:t=>(r.on=t,a),opacity:t=>(r.opacity=t,a),lineStyle:t=>{switch(t){case"solid":r.lineStyle="1 0";break;case"dashed":default:r.lineStyle="4 8";break;case"dotted":r.lineStyle="2 5"}return a}};return a=Object.assign(a||{},"x"===t?{xGrid:o}:{yGrid:o}),{baseSelf:i,self:e,api:a}},y=h("x"),x=(t,e)=>{let a=h("y")(t,e);return{self:t=Object.assign(t||{},{_yGrid:a.baseSelf}),api:a.api}},f=()=>{const t={min:void 0,max:void 0,compressMax:0,compressMin:0};return{min(e){t.min=e},max(e){t.max=e},compressMin(e){t.compressMin=Math.abs(e||0)},compressMax(e){t.compressMax=Math.abs(e||0)},range:e=>{let a=void 0!==t.min?t.min:Math.min(...e),r=void 0!==t.max?t.max:Math.max(...e);const i=r-a;return a-=t.compressMin>0?t.compressMin*i:0,r+=t.compressMax>0?t.compressMax*i:0,[a,r]},contains:e=>(void 0===t.min||e>=t.min)&&(void 0===t.max||e<=t.max)}},b=(t,e)=>{let a=f();return{self:t=Object.assign(t||{},{_xRange:{range:a.range,contains:a.contains}}),api:e=Object.assign(e||{},{xRange:{min:t=>(a.min(t),e),compressMin:(t=0)=>(a.compressMin(t),e),max:t=>(a.max(t),e),compressMax:(t=0)=>(a.compressMax(t),e)}})}},v=(t,e)=>{let a=f();return{self:t=Object.assign(t||{},{_yRange:{range:a.range,contains:a.contains}}),api:e=Object.assign(e||{},{yRange:{min:t=>(a.min(t),e),compressMin:(t=0)=>(a.compressMin(t),e),max:t=>(a.max(t),e),compressMax:(t=0)=>(a.compressMax(t),e)}})}};let _;const w=[];function k(){return void 0===_&&(_=e.select("head").append("style").attr("id","dalian-style-container")),_}function z(t,e){return`${t}{${Object.entries(e).map((([t,e])=>`${t}:${e}`)).join(";")}}`}function M(t,e,a="."){const r=a+t;if(void 0===w.find((t=>t.selector===r))){const t=z(r,e),a=k();a.text(a.text()+t),w.push({selector:r,entry:t})}}function j(t,e){M(t,e)}function $(t,e){M(t,e,"#")}function A(t,e){!function(t,e,a){const r=a+t,i=w.find((t=>t.selector===r));void 0!==i&&(i.entry=z(r,e),k().text(w.map((t=>t.entry)).join("")))}(t,e,"#")}const O="dalian-tooltip",C=!1;var F=(t,a)=>{j(O,{position:"absolute","background-color":"rgba(255, 255, 255, 0.95)","border-radius":"2px","box-shadow":"1px 1px 2px #888, 0 0 1px #aaa",color:"currentColor","pointer-events":"none","font-family":"inherit","font-size":"0.8em",width:"auto","min-width":"80px","line-height":"1","z-index":9999});let r={container:t._widget.container.append("div").attr("class","dalian-tooltip-container"),id:`${t._widget.id}-tooltip`,on:C};function i(){void 0!==r.elem&&r.elem.style("opacity",0)}function o(){const[a,n]=e.mouse(t._widget.container.node()),o=parseFloat(t._widget.size.width)-t._widget.margins.right,s=parseFloat(t._widget.size.height)-t._widget.margins.bottom;if(a<t._widget.margins.left||a>o||n<t._widget.margins.top||n>s)return t._tooltip.builder(),void i();r.elem=void 0===r.elem||r.elem.empty()?r.container.append("div").attr("id",r.id).attr("class",O).style("font-size",.85*parseFloat(t._font.size)+"px"):r.elem.style("font-size",.85*parseFloat(t._font.size)+"px");let l=t._tooltip.builder(t._tooltip.content(t._widget.getMouse()));if(void 0===l){if(void 0!==r.elem)return void i()}else r.elem.html(l);const c=r.elem.node().getBoundingClientRect(),d=c.width,p=c.height;let u=a+20,g=n+20;u+d>o-10&&(u-=d+30),g+p>s-10&&(g=s-10-p),r.elem.style("left",u+"px").style("top",g+"px").style("opacity",1)}return t._widget.update=n(t._widget.update,(()=>{t._widget.container.style("pointer-events",r.on?"all":"none").on("mousemove.tooltip",(()=>r.on&&!t._widget.disabled&&o())).on("touchmove.tooltip",(()=>r.on&&!t._widget.disabled&&o()),{passive:!0}).on("mouseout.tooltip",i)})),t=Object.assign(t||{},{_tooltip:{isOn:()=>r.on,content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented")}}),a.tooltip={on:(t=C)=>(r.on=t,a)},{self:t,api:a}};const S="dalian-element-tooltip-",R={content:S+"content",title:S+"title",entry:S+"entry",label:S+"label",value:S+"value"},W={titleFormat:t=>t,labelFormat:t=>t+":",valueFormat:t=>t};var H=(t,a)=>{j(R.content,{"border-radius":"2px","font-family":"inherit",padding:"0.7em"}),j(R.title,{position:"relative",margin:"2px","margin-bottom":"10px","line-height":"1em"}),j(R.entry,{position:"relative",margin:"2px",height:"1em","padding-right":"10px","line-height":"1em"}),j(R.label,{position:"relative",float:"left","margin-right":"10px"}),j(R.value,{position:"relative",float:"right"});let r=F(t,a),i={titleFormat:W.titleFormat,labelFormat:W.labelFormat,valueFormat:W.valueFormat};return t._tooltip=Object.assign(r.self._tooltip,{builder:a=>{if(void 0===a)return void t._tooltip.content();let r=e.select(document.createElement("div")).attr("class",R.content).style("border-left",a.stripe?"solid 4px "+a.stripe:null);return r.append("div").attr("class",R.title).html(i.titleFormat(a.title)),a.content.data.forEach((t=>{let e=r.append("div").attr("class",R.entry);e.append("div").attr("class",R.label).html(i.labelFormat(t.name)),e.append("span").attr("class",R.value).html(i.valueFormat(t.value,t.name))})),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(t=W.titleFormat)=>(i.titleFormat=t,a),labelFormat:(t=W.labelFormat)=>(i.labelFormat=t,a),valueFormat:(t=W.valueFormat)=>(i.valueFormat=t,a)}),{self:t,api:a}};const D="dalian-point-tooltip-",E={content:D+"content",entry:D+"entry",container:D+"container",inner:D+"inner",marker:D+"marker",label:D+"label"},I={ignore:[],titleFormat:t=>t,valueFormat:t=>t.y};var B=(t,a)=>{j(E.content,{display:"table",padding:"10px","min-width":"60px"}),j(E.entry,{display:"table-row",position:"relative"}),j(E.container,{display:"inline-block",position:"relative",height:"1em"}),j(E.inner,{display:"flex",position:"relative",height:"1em","justify-content":"center","align-items":"center"}),j(E.marker,{display:"inline-block",position:"relative",float:"left","margin-right":"6px","border-radius":"2px"}),j(E.label,{display:"table-cell",position:"relative","max-width":"120px",float:"left",height:".9em"});let r=F(t,a),i={titleFormat:I.titleFormat,valueFormat:I.valueFormat};return t._tooltip=Object.assign(r.self._tooltip,{ignore:[],builder:a=>{if(void 0===a)return void t._tooltip.content();let r=e.select(document.createElement("div")).attr("class",E.content);return r.append("div").attr("class",E.entry).text(i.titleFormat(a.title)),a.content.data.filter((t=>null!==i.valueFormat(t))).forEach(((t,e)=>{let a=r.append("div").attr("class",E.entry).append("div").attr("class",E.container).style("margin-top",(0===e?6:3)+"px").append("div").attr("class",E.inner);a.append("div").attr("class",E.marker).style("width","1em").style("height","1em").style("background",t.background),a.append("div").attr("class",E.label).html(i.valueFormat(t))})),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(t=I.titleFormat)=>(i.titleFormat=t,a),valueFormat:(t=I.valueFormat)=>(i.valueFormat=t,a)}),{self:t,api:a}};function T(t){const e=window.getComputedStyle(t),a={};for(let t=0;t<e.length;t++)a[e[t]]=e.getPropertyValue(e[t]);return a}function L(t,e){for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t.style[a]=e[a])}function P(){const t=new Map,e={add:(a,r)=>{const i=void 0===r?a:r;return e[i]=()=>(t.has(i)||t.set(i,document.createElement(a)),t.get(i)),e}};return e}const q=P().add("canvas").add("div","hidden").add("img");var G=async(t,e=3,a="png",r=.92)=>{const i=q.canvas(),n=i.getContext("2d"),o=q.img(),s=(new window.XMLSerializer).serializeToString(t),l=function(t){const e=q.hidden();e.style.opacty=0,e.appendChild(t),document.body.appendChild(e);const a=t.getBoundingClientRect();return document.body.removeChild(e),a}(t);return i.width=l.width*e,i.height=l.height*e,i.style.width=l.width+"px",i.style.height=l.height+"px",n.scale(e,e),o.setAttribute("src","data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(s)))),new Promise((t=>{o.onload=()=>{n.drawImage(o,0,0),t(i.toDataURL("image/"+a,r))}}))};const N=P().add("a");var V=["#333333","#0072b2","#56b4e9","#009e73","#f0e442","#e69f00","#d55e00","#cc79a7"],U=["#4477aa","#ee6677","#228833","#ccbb44","#66ccee","#aa3377","#bbbbbb"],K=["#332288","#88ccee","#44aa99","#117733","#999933","#ddcc77","#cc6677","#882255","#aa4499","#dddddd"],Y=["#77aadd","#ee8866","#eedd88","#44bb99","#99ddff","#ffaabb","#bbcc33","#aaaa00","#dddddd"],J=["#ee7733","#0077bb","#33bbee","#ee3377","#cc3311","#009988","#bbbbbb"],X="#eee",Q=["#364b9a","#4a7bb7","#6ea6cd","#98cae1","#c2e4ef","#eaeccc","#feda8b","#fdb366","#f67e4b","#dd3d2d","#a50026"],Z="#eee",tt=["#fefbe9","#fcf7d5","#f5f3c1","#eaf0b5","#ddecbf","#d0e7ca","#c2e3d2","#b5ddd8","#a8d8dc","#9bd2e1","#8dcbe4","#81c4e7","#7bbce7","#7eb2e4","#88a5dd","#9398d2","#9b8ac4","#9d7db2","#9a709e","#906388","#805770","#684957","#46353a"];const et={protan:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deutan:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritan:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}};function at(t){return{r:3.063218*t.x-1.393325*t.y-.475802*t.z,g:-.969243*t.x+1.875966*t.y+.041555*t.z,b:.067871*t.x-.228834*t.y+1.069251*t.z}}function rt(t,a){let r=1.75,i=r+1;return e.rgb((r*a.r+t.r)/i,(r*a.g+t.g)/i,(r*a.b+t.b)/i)}function it(t){let a=Math.round(.299*t.r+.587*t.g+.114*t.b);return e.rgb(a,a,a)}function nt(t,a){let r=2.2,i=.329016,n={r:Math.pow(t.r/255,r),g:Math.pow(t.g/255,r),b:Math.pow(t.b/255,r)};var o;n={x:.430574*(o=n).r+.34155*o.g+.178325*o.b,y:.222015*o.r+.706655*o.g+.07133*o.b,z:.020183*o.r+.129553*o.g+.93918*o.b};const s=n.x+n.y+n.z;n.u=0,n.v=0,0!==s&&(n.u=n.x/s,n.v=n.y/s);let l,c=.312713*n.y/i,d=.358271*n.y/i,p={y:0};l=n.u<et[a].cpu?(et[a].cpv-n.v)/(et[a].cpu-n.u):(n.v-et[a].cpv)/(n.u-et[a].cpu);let u=n.v-n.u*l;p.u=(et[a].ayi-u)/(l-et[a].am),p.v=l*p.u+u;let g={x:p.u*n.y/p.v,y:n.y,z:(1-(p.u+p.v))*n.y/p.v};p.x=c-g.x,p.z=d-g.z,p=at(p),g=at(g);const m={r:p.r?((g.r<0?0:1)-g.r)/p.r:0,g:p.g?((g.g<0?0:1)-g.g)/p.g:0,b:p.b?((g.b<0?0:1)-g.b)/p.b:0},h=Math.max(m.r>1||m.r<0?0:m.r,m.g>1||m.g<0?0:m.g,m.b>1||m.b<0?0:m.b);g.r=g.r+h*p.r,g.g=g.g+h*p.g,g.b=g.b+h*p.b;const y=t=>255*(t<=0?0:t>=1?1:Math.pow(t,1/r));return e.rgb(y(g.r),y(g.g),y(g.b))}const ot={protanopia:t=>nt(t,"protan"),protanomaly:t=>rt(t,nt(t,"protan")),deuteranopia:t=>nt(t,"deutan"),deuteranomaly:t=>rt(t,nt(t,"deutan")),tritanopia:t=>nt(t,"tritan"),tritanomaly:t=>rt(t,nt(t,"tritan")),achromatopsia:t=>it(t),achromatomaly:t=>rt(t,it(t))};const st="categorical",lt="sequential",ct="diverging";function dt(t){switch(t){case lt:return tt;case ct:return Q;default:return V}}function pt(t){switch(t){case lt:return Z;case ct:return X;default:return"#fff"}}var ut=(t,a)=>{const r={policy:st,on:t=>t.name},i={policy:r.policy,palette:dt(r.policy),missing:pt(r.policy),deficiency:void 0,on:r.on,scale:t=>t,buildMapper(){const t=function(t,e){if("string"==typeof t)return e(t)+"";if(Array.isArray(t))return t.map(e);{const a={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=e(t[r]));return a}}(i.palette||dt(i.policy),(a=i.deficiency,void 0===ot[a]?t=>t:t=>ot[a](e.rgb(t))));var a;const r=t=>{const e=i.on(t);return null===e?null:i.scale(e)};switch(i.policy){case lt:return function(t,a,r){if("string"==typeof t||Array.isArray(t)||(console.warn(`Palette type (${typeof t}) is incompatible with ${lt} color policy, fallback to default color palette.`),t=dt(lt)),"string"==typeof t){const i=e.interpolateRgb("#fff",t);return t=>{const e=r(t);return null===e?a:i(e)}}if(Array.isArray(t)){const i=e.piecewise(e.interpolateRgb.gamma(2.2),t);return t=>{const e=r(t);return null===e?a:i(e)}}}(t,i.missing,r);case ct:return function(t,a,r){Array.isArray(t)||(console.warn(`Palette type (${typeof t}) is incompatible with ${ct} color policy, fallback to default color palette.`),t=dt(ct));const i=e.piecewise(e.interpolateRgb.gamma(2.2),t);return t=>{const e=r(t);return i((e+1)/2)}}(t,i.missing,r);default:return n=t,o=i.missing,s=r,"string"==typeof n?()=>n:Array.isArray(n)?(()=>{const t=[];return e=>{const a=s(e);if(null===a)return o;{const e=t.indexOf(a);return n[e>-1?e:t.push(a)-1]}}})():"object"==typeof n?t=>{const e=s(t);return null===e?o:n[e]}:void 0}var n,o,s}};return t=Object.assign(t||{},{_color:{init(e,a){i.policy=e,i.on=a,i.palette=dt(e),i.missing=pt(e),t._color.mapper=i.buildMapper()},scale(e){i.scale=e,t._color.mapper=i.buildMapper()},mapper:i.buildMapper()}}),a=Object.assign(a||{},{color:{policy:(e=r.policy)=>(i.policy=e,t._color.mapper=i.buildMapper(),a),palette(e,r){if("string"==typeof e&&e.startsWith("palette-"))switch(e){case"palette-bright":i.palette=U;break;case"palette-vibrant":i.palette=J;break;case"palette-wong":i.palette=V;break;case"palette-light":i.palette=Y;break;case"palette-muted":i.palette=K;break;case"palette-sunset":i.palette=Q;break;case"palette-iridescent":i.palette=tt}else i.palette=e;return i.missing=r||"#fff",t._color.mapper=i.buildMapper(),a},deficiency:e=>(i.deficiency=e,t._color.mapper=i.buildMapper(),a),on:(e=r.on)=>(i.on=e,t._color.mapper=i.buildMapper(),a),getMapper:()=>i.buildMapper()}}),{self:t,api:a}};const gt="dalian-description";var mt=(t,a)=>{j(gt,{position:"absolute",width:"auto","max-width":"500px",padding:"10px",background:"#fff","box-shadow":"0 0 3px #000","border-radius":"3px",color:"#000","font-size":".8em","font-family":"inherit","line-height":"1.35em","pointer-events":"none"});const r={id:`${t._widget.id}-description`,getDescription:()=>void 0===r.elem||r.elem.empty()?e.select("body").append("div").attr("id",r.id).attr("class",gt).style("left",e.event.pageX+20+"px").style("top",e.event.pageY-20+"px"):r.elem,removeDescription:()=>{void 0===r.elem||r.elem.empty()||(r.elem.remove(),delete r.elem)}};return a=Object.assign(a||{},{description:i=>(void 0===i?t._widget.container.on("contextmenu.description",null):t._widget.container.on("contextmenu.description",(()=>{e.event.preventDefault(),r.elem=r.getDescription().html(i)})).on("mouseleave.description",(()=>{r.removeDescription()})),a)}),{self:t,api:a}};const ht=12,yt="black";var xt=(t,e)=>((t=Object.assign(t||{},{_font:{size:ht+"px",color:yt}}))._widget.update=n(t._widget.update,(()=>{t._widget.container.style("font-size",t._font.size).style("color",t._font.color)}),!0),e=Object.assign(e||{},{font:{size:(a=ht)=>(t._font.size=a+"px",e),color:(a=yt)=>(t._font.color=a,e)}}),{self:t,api:e}),ft=(t,e)=>{const a={callbacks:{}};return{self:t=Object.assign(t||{},{_mouse:{over:(...t)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...t)},leave:(...t)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...t)},click:(...t)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...t)},isEnabled:t=>"function"==typeof a.callbacks[t],hasAny:()=>Object.values(a.callbacks).reduce(((t,e)=>t||"function"==typeof e),!1)}}),api:e=Object.assign(e||{},{mouse:{over:t=>(a.callbacks.over=t,e),leave:t=>(a.callbacks.leave=t,e),click:t=>(a.callbacks.click=t,e)}})}};const bt="dalian-placeholder",vt="dalian-placeholder-message";var _t=(t,e)=>{j(bt,{display:"table",position:"absolute",left:0,top:0,color:"inherit","font-family":"inherit","font-size":"inherit","pointer-events":"none"}),j(vt,{display:"table-cell","vertical-align":"middle","line-height":"normal","text-align":"center",color:"inherit","font-family":"inherit","font-size":"inherit"});const a={id:`${t._widget.id}-placeholder`};return t._widget.update=n(t._widget.update,(e=>{t._widget.content.transition().duration(e).style("opacity",void 0===a.placeholder?1:0),t._widget.disable(void 0!==a.placeholder),void 0===a.placeholder?void 0===a.container||a.container.empty()||(a.container.transition().duration(e).style("opacity",0).remove(),delete a.container):((void 0===a.container||a.container.empty())&&(a.container=t._widget.container.append("div").attr("id",a.id).attr("class",bt).style("width",t._widget.size.width).style("height",t._widget.size.height).style("opacity",0),a.content=a.container.append("span").attr("class",vt).html(a.placeholder)),a.container.style("font-size","inherit").style("color","inherit").transition().duration(e).style("width",t._widget.size.width).style("height",t._widget.size.height).style("opacity",1),a.content.html(a.placeholder))})),e=Object.assign(e||{},{placeholder:t=>(a.placeholder=t,e)}),{self:t,api:e}},wt=(t,e)=>(Object.entries(e).forEach((([e,a])=>{t.style(e,a)})),t);const kt=P().add("canvas");function zt(t,e,a){const r=kt.canvas().getContext("2d"),i=a,n=100,o=200+r.measureText(t).width,s=200+i;!function(t,e){const a=kt.canvas();a.style.width=t+"px",a.width=t,a.style.height=e+"px",a.height=e}(o,s),r.font=a+"px "+e,r.fillStyle="#fff",r.fillRect(0,0,o,s),r.fillStyle="#000",r.fillText(t,n,n+i);const l=r.getImageData(0,0,o,s).data.filter(((t,e)=>e%4==0)),c=Math.floor(l.findIndex((t=>t<255))/o);l.reverse();return{min:c,max:s-Math.floor(l.findIndex((t=>t<255))/o)}}const Mt={x:0,y:0},jt={width:300,height:200},$t=0;var At=(t,a,r,i)=>{const n={parent:"string"==typeof r||r instanceof window.HTMLElement?e.select(r):r,initialized:!1,pos:{x:{attr:"left",ignore:"right",value:Mt.x+"px"},y:{attr:"top",ignore:"bottom",value:Mt.y+"px"}}},o={};o._widget={id:`dalian-widget-${t}-${a}`,container:void 0,size:{width:jt.width+"px",height:jt.height+"px",innerWidth:jt.width+"px",innerHeight:jt.height+"px"},margins:{left:$t,right:$t,top:$t,bottom:$t},transition:!1,disabled:!1,getMouse:()=>{const t=e.mouse(o._widget.container.node());return[t[0]-o._widget.margins.left,t[1]-o._widget.margins.top]},getElem:(t,e)=>n.initialized?t.transition().duration(e):(setTimeout((()=>{n.initialized=!0}),e),t),getDefs:()=>(void 0===n.defs&&(n.defs=o._widget.content.append("defs")),n.defs),getStyle:()=>window.getComputedStyle(o._widget.container.node()),getFontMetrics:()=>function(t){const e=100,a=zt("x",t,e),r=zt("y",t,e),i=zt("h",t,e),n=zt("H",t,e),o=a.max-a.min;return{xHeight:o/e,capHeight:(n.max-n.min)/e,descender:(r.max-r.min-o)/e,ascender:(i.max-i.min)/e}}(window.getComputedStyle(o._widget.container.node()).fontFamily),update:t=>{o._widget.getElem(o._widget.container,t).style(n.pos.x.ignore,null).style(n.pos.x.attr,n.pos.x.value).style(n.pos.y.ignore,null).style(n.pos.y.attr,n.pos.y.value).style("width",o._widget.size.width).style("height",o._widget.size.height)},disable:t=>{o._widget.disabled=t}};try{o._widget.container=n.parent.append("div").attr("id",o._widget.id).attr("class",`dalian-widget dalian-widget-${t}`),wt(o._widget.container,{position:"absolute",width:o._widget.size.width,height:o._widget.size.height,left:n.pos.x+"px",top:n.pos.y+"px","font-family":"inherit","font-size":"inherit","font-color":"inherit"}),o._widget.content=o._widget.container.append(i).attr("class","dalian-widget-content"),wt(o._widget.content,{position:"absolute",width:"100%",height:"100%",left:0,top:0,"font-family":"inherit","font-size":"inherit","font-color":"inherit","pointer-events":"none"})}catch(t){throw Error("MissingDOMException: DOM is not present.")}const s={id:()=>o._widget.id,x:(t=Mt.x)=>(n.pos.x.attr=t>=0?"left":"right",n.pos.x.ignore=t>=0?"right":"left",n.pos.x.value=Math.abs(t)+"px",s),y:(t=Mt.y)=>(n.pos.y.attr=t>=0?"top":"bottom",n.pos.y.ignore=t>=0?"bottom":"top",n.pos.y.value=Math.abs(t)+"px",s),width:(t=jt.width)=>(o._widget.size.width=t+"px",o._widget.size.innerWidth=t-o._widget.margins.left-o._widget.margins.right+"px",s),height:(t=jt.height)=>(o._widget.size.height=t+"px",o._widget.size.innerHeight=t-o._widget.margins.top-o._widget.margins.bottom+"px",s),margins:(t=$t)=>{switch(typeof t){case"number":o._widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":o._widget.margins=Object.assign(o._widget.margins,t);break;default:o._widget.margins={left:0,right:0,top:0,bottom:0}}return o._widget.size.innerWidth=parseInt(o._widget.size.width)-o._widget.margins.left-o._widget.margins.right+"px",o._widget.size.innerHeight=parseInt(o._widget.size.height)-o._widget.margins.top-o._widget.margins.bottom+"px",s},render:t=>(o._widget.update(t),s)};return{self:o,api:s}},Ot=(t,e,a,o="svg")=>{let{self:s,api:l}=r(At(t,e,a,o),ut,mt,xt,ft,_t);const c=(()=>{const t=`${e}-dalian-plots-clipper`;return{clipId:t,clip:s._widget.getDefs().append("clipPath").attr("id",t).append("rect").attr("x",0).attr("y",0).attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight),update(t){s._widget.getElem(c.clip,t).attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight),s._widget.getElem(s._chart.plots,t).attr("width",s._widget.size.innerWidth+"px").attr("height",s._widget.size.innerHeight+"px").attr("transform",`translate(${s._widget.margins.left}, ${s._widget.margins.top})`)}}})();return s=Object.assign(s||{},{_chart:{data:[],plots:s._widget.content.append("g").attr("class","dalian-plots-container"),clipId:c.clipId,transformData:t=>t,plotGroups(t,e){const a=s._chart.plots.attr("clip-path",`url(#${c.clipId})`).transition().duration(e);s._chart.plots.selectAll(".plot-group").data(s._chart.data,(t=>t.name)).join((e=>e.append("g").attr("class",(t=>`plot-group ${i(t.name)}`)).style("shape-rendering","geometricPrecision").on("mouseover.chart",s._mouse.over).on("mouseleave.chart",s._mouse.leave).on("click.chart",s._mouse.click).call(t.enter||(t=>t))),(t=>t),(e=>e.transition(a).call(t.exit||(t=>t)).remove())).each((()=>{s._chart.plots.style("pointer-events","none"),s._widget.transition=!0})).call(t.updateBefore||(t=>t)).transition(a).call(t.update||(t=>t)).on("end",(()=>{s._chart.plots.style("pointer-events",s._tooltip&&s._tooltip.isOn()||s._mouse.hasAny()?"all":"none"),s._widget.transition=!1}))}}}),s._widget.update=n(s._widget.update,c.update),l=Object.assign(l,{data:t=>(s._chart.data=s._chart.transformData(t),l),download:async t=>{const e=(t=>{const e=Array.from(t.querySelectorAll("*")).map(T),a=t.cloneNode(!0);return L(a,T(t)),a.querySelectorAll("*").forEach(((t,a)=>L(t,e[a]))),a.style.backgroundColor=t.parentNode.style.backgroundColor||"#fff",a})(s._widget.content.node());((t,e,a)=>{const r=N.a();r.download=`${e}.${a}`,r.href=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)})(await G(e),t,"png")}}),{self:s,api:l}},Ct=(t,a,r={blur:{opacity:.1}})=>(n,o)=>{function s(t){return Object.keys(t.focus||{}).concat(Object.keys(t.blur||{})).reduce(((t,e)=>Object.assign(t,{[e]:null})),{})}const l={container:void 0,highlightStyle:r,removeStyle:s(r),currentKeys:null};return n=Object.assign(n||{},{_highlight:{apply(t,a){t.each((function(t){wt(e.select(this),(n._highlight.isHighlighted(t[a])?l.highlightStyle.focus:l.highlightStyle.blur)||l.removeStyle)}))},style(t){l.highlightStyle=t,l.removeStyle=s(t)},isHighlighted:t=>null===l.currentKeys||l.currentKeys.indexOf(t)>-1}}),o=Object.assign(o||{},{highlight:(r,s=0)=>{if(void 0===t())throw Error("Highlight.container is not specified");return a.forEach((a=>function(a,r,o){if(n._widget.transition)return;l.currentKeys=null===r?null:Array.isArray(r)?r:[r];const s=(l.container||(l.container=t())).selectAll(a).interrupt(),c=s.transition().duration(o||0);let d;if("string"==typeof r)d=[i(r)];else{if(!Array.isArray(r))return void wt(s.transition(c),l.removeStyle);d=r.map(i)}wt(s.filter((function(){const t=e.select(this);return d.reduce(((e,a)=>e||t.classed(a)),!1)})).transition(c),l.highlightStyle.focus||l.removeStyle),wt(s.filter((function(){const t=e.select(this);return!d.reduce(((e,a)=>e||t.classed(a)),!1)})).transition(c),l.highlightStyle.blur||l.removeStyle)}(a,r,s))),o}}),{self:n,api:o}};const Ft=!1;var St=t=>(e,a)=>{const r={on:Ft,scales:{x:t.x,y:t.y}};return e=Object.assign(e||{},{_horizontal:{on:()=>r.on,scales:()=>r.scales}}),a=Object.assign(a||{},{horizontal:(i=Ft)=>(r.on=i,r.scales.x=i?t.y:t.x,r.scales.y=i?t.x:t.y,e._bottomAxis.scale(r.scales.x),e._leftAxis.scale(r.scales.y),void 0!==e._yGrid&&e._yGrid.type(i?"x":"y"),a)}),{self:e,api:a}};const Rt={format:()=>""};var Wt=(t,e)=>(t=Object.assign(t||{},{_label:{show:!1,format:Rt.format}}),e=Object.assign(e||{},{label:a=>(t._label.show=null!=a,t._label.format=a||Rt.format,e)}),{self:t,api:e}),Ht=(t,e)=>{const a={policy:void 0,getStrokeDashArray:t=>{switch(t){case"dashed":return"5 8";case"dotted":return"1 8";default:return null}}};return{self:t=Object.assign(t||{},{_lineStyle:{strokeDashArray:t=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[t]),style:t=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[t],background(t,e){switch(t){case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${e} 2px, ${e} 4px`;case"dotted":return`radial-gradient(${e} 37%, transparent 37%) 0px 0px/6px 6px, radial-gradient(${e} 37%, transparent 37%) 3px 3px/6px 6px transparent`;default:return e}}}}),api:e=Object.assign(e||{},{lineStyle:t=>(a.policy=t,e)})}},Dt=t=>(e,a)=>{const r={mapping:()=>t+"px"};return{self:e=Object.assign(e||{},{_lineWidth:{mapping:t=>r.mapping(t)}}),api:a=Object.assign(a||{},{lineWidth:(e=t)=>(r.mapping="number"==typeof e?()=>e+"px":a=>(e[a]||t)+"px",a)})}},Et=t=>(a,r)=>{const i={containers:{},objects:new Map,getContainer:(t="outside")=>(void 0===i.containers[t]&&(i.containers[t]="outside"===t?a._widget.content.append("g").attr("class","objects-container"):a._chart.plots.append("g").attr("class","objects-container"),"background"===t?i.containers[t].lower():i.containers[t].raise()),i.containers[t])};return a._widget.update=n(a._widget.update,(t=>{i.objects.forEach((e=>e.update(t)))})),r=Object.assign(r||{},{objects:{add(e,a,n,o,s=0){const l=i.getContainer(o&&o.layer).append("g").attr("transform",o&&o.floating?`translate(${t.x(n.x)}, ${t.y(n.y)})`:`translate(${n.x}, ${n.y})`).style("opacity",0);l.node().appendChild(a),i.objects.has(e)?(r.objects.remove(e,s),l.transition().duration(s).style("opacity",1)):l.transition().duration(s).style("opacity",1);const c={g:l,remove:t=>{l.transition().duration(t).style("opacity",0).on("end",(()=>{l.remove()}))},update:e=>{l.transition().duration(e).attr("transform",o&&o.floating?`translate(${t.x(n.x)}, ${t.y(n.y)})`:`translate(${n.x}, ${n.y})`)}};return i.objects.set(e,c),r},remove:(t,e=0)=>(null==t&&(i.objects.forEach((t=>t.remove(e))),i.objects.clear()),i.objects.has(t)&&(i.objects.get(t).remove(e),i.objects.delete(t)),r),svg:()=>(void 0===i.svg&&(i.svg=e.select("body").append("svg").style("display","none").style("opacity",0).style("position","fixed")),i.svg)}}),{self:a,api:r}},It=t=>(e,a)=>{const r={value:t};return{self:e=Object.assign(e||{},{_opacity:{value:()=>r.value}}),api:a=Object.assign(a||{},{opacity:(e=t)=>(r.value=e||t,a)})}};function Bt(t,a=.4){const r=e.hsl(t);return r.l+=a*(1-r.l),r}function Tt(t){return function(t){const a=e.color(t);return.229*a.r+.587*a.g+.114*a.b}(t)>150?"#000":"#fff"}var Lt=t=>(e,a)=>{const r={container:void 0,pins:new Map,getContainer:()=>(void 0===r.container&&(r.container=e._chart.plots.append("g").attr("class","pins-container")),r.container)};return e._widget.update=n(e._widget.update,(t=>{r.pins.forEach((e=>e.update(t)))})),a=Object.assign(a||{},{pins:{add:(i,n,s={},l=0)=>{if(r.pins.has(i))return a;const c=t.x.scale,d=t.y.scale,p=s.color||e._font.color,u=(1-(s.height||.8))*d.range()[0],g=s.text||"",m=r.getContainer().append("g").attr("class","pin").style("color",p).style("opacity",0),h=m.append("g").attr("class","pin-label").style("opacity",s.fixed?1:0).style("pointer-events","none"),y=o(h.append("text"),{class:"pin-label-text",y:u-(s.size||6)-10,"text-anchor":"start",stroke:"none",fill:Tt(p)}).text(g),x=1.05*y.node().getComputedTextLength();y.attr("x",Math.min(c(n),c.range()[1]-x-10)).attr("textLength",x);let f=y.node().getBBox();const b=o(h.append("rect"),{class:"pin-label-box",x:f.x-5,y:f.y-5,width:f.width+10,height:f.height+10,rx:2,stroke:"none",fill:""===g?"none":p});h.node().insertBefore(b.node(),y.node());const v=()=>{h.transition().duration(300).style("opacity",1)},_=()=>{h.transition().duration(300).style("opacity",s.fixed?1:0)},w=o(m.append("line"),{class:"pin-needle",x1:c(n)+1,y1:d.range()[0],x2:c(n)+1,y2:u,stroke:"currentColor","stroke-width":"2px"}).style("pointer-events","all").on("mouseover.pins",v).on("mouseleave.pins",_),k=o(m.append("circle"),{class:"pin-head",cx:c(n)+1,cy:u,r:(s.size||6)+"px",stroke:"white","stroke-width":"1px",fill:"currentColor"}).style("pointer-events","all").on("mouseover.pins",v).on("mouseleave.pins",_);m.transition().duration(l).style("opacity",1);const z={g:m,remove:t=>{m.transition().duration(t).style("opacity",0).on("end",(()=>{m.remove()}))},update:t=>{w.transition().duration(t).attr("x1",c(n)+1).attr("y1",d.range()[0]).attr("x2",c(n)+1).attr("y2",u),k.transition().duration(t).attr("cx",c(n)+1).attr("cy",u),y.attr("x",Math.min(c(n),c.range()[1]-x-10)).attr("y",u-(s.size||6)-10),f=y.node().getBBox(),b.attr("x",f.x-5).attr("y",f.y-5).attr("width",f.width+10).attr("height",f.height+10)}};return r.pins.set(i,z),a},remove:(t,e=0)=>(void 0===t&&(r.pins.forEach((t=>t.remove())),r.pins.clear()),r.pins.has(t)&&(r.pins.get(t).remove(e),r.pins.delete(t)),a)}}),{self:e,api:a}},Pt=(t,e)=>{const a={line:void 0,markers:new Map};return(t=Object.assign(t||{},{_plotMarker:{add(e,r,n,s,l){void 0===a.line&&(a.line=t._chart.plots.append("line")),o(a.line,{x1:e,y1:0,x2:e,y2:t._widget.size.innerHeight}),wt(a.line,{opacity:.5,stroke:t._font.color,"stroke-width":1,"stroke-dasharray":"4 4","pointer-events":"none"}),a.markers.set(n,a.markers.get(n)||t._chart.plots.append("circle")),o(a.markers.get(n),{class:`plot-marker ${i(s.name)}`,cx:e,cy:r,r:l||4}),wt(a.markers.get(n),{stroke:"white",fill:t._color.mapper(s),"pointer-events":"none"})},remove(t){void 0===t?a.markers.forEach(((t,e)=>{t.remove(),a.markers.delete(e)})):a.markers.has(t)&&(a.markers.get(t).remove(),a.markers.delete(t)),0===a.markers.size&&void 0!==a.line&&(a.line.remove(),a.line=void 0)}}}))._widget.update=n(t._widget.update,(()=>{t._widget.container.on("mouseout.plot-marker",t._plotMarker.remove)})),{self:t,api:e}},qt=(t="linear")=>{const a={type:t,scale:(()=>{switch(t){case"sqrt":return e.scalePow().exponent(.5);case"log":return e.scaleLog();case"band":return e.scaleBand().padding(.1);case"point":return e.scalePoint().padding(.5);default:return e.scaleLinear()}})()},r=t=>a.scale(t);return Object.defineProperty(r,"scale",{get:()=>a.scale}),r.copy=()=>a.scale.copy(),r.range=t=>(a.scale.range(t),r),r.domain=t=>(a.scale.domain(t),r),r.type=t=>{if(void 0===t)return a.type;switch(t){case"sqrt":a.scale=e.scalePow().exponent(.5);break;case"log":a.scale=e.scaleLog();break;case"band":a.scale=e.scaleBand().padding(.1);break;case"point":a.scale=e.scalePoint().padding(.5);break;default:a.scale=e.scaleLinear()}return r},r.invert=a.scale.invert,r.measure=t=>Math.abs(a.scale.invert(t)-a.scale.invert(0)),r};const Gt=!1;var Nt=(t,a)=>{const r={on:Gt};return{self:t=Object.assign(t||{},{_smoothing:{open:()=>r.on?e.curveMonotoneX:e.curveLinear,closed:()=>r.on?e.curveCardinalClosed:e.curveLinearClosed,isOn:()=>r.on}}),api:a=Object.assign(a||{},{smoothing:(t=Gt)=>(r.on=t,a)})}},Vt=t=>(a,r)=>{const s={container:void 0,trends:new Map};function l(t,r,i){const n=a._chart.data.find((e=>e.name===t));if(void 0===n)return;const o=e.bisector((t=>t.x)).left,s=o(n.values,r),l=o(n.values,i);if(null===s||null===l)return;const c=n.values[s].x,d=n.values[s].y,p=n.values[l].x,u=n.values[l].y;return{start:{x:c,y:d},end:{x:p,y:u},plateau:d<u?u:d}}return a._widget.update=n(a._widget.update,(t=>{s.trends.forEach((e=>e.update(t)))})),r=Object.assign(r||{},{trends:{add:(e,n,c,d,p,u,g=0)=>{if(s.trends.has(e))return r;const m=t.x.scale,h=t.y.scale,y=l(n,c,d),x=(void 0===s.container&&(s.container=a._chart.plots.append("g").attr("class","trends-container")),s.container).append("g").attr("class","trend trend-"+i(n)).style("color",u||"#000").style("opacity",0),f=o(x.append("path"),{fill:"none",stroke:"currentColor","stroke-dasharray":"3 3","stroke-width":1,d:`M${m(y.start.x)},${h(y.start.y)}V${h(y.plateau)}H${m(y.end.x)}V${h(y.end.y)}`}),b=o(x.append("circle"),{cx:m(y.start.x),cy:h(y.start.y),r:4,stroke:"none",fill:"currentColor"}),v=o(x.append("circle"),{cx:m(y.end.x),cy:h(y.end.y),r:4,stroke:"none",fill:"currentColor"}),_=o(x.append("text"),{x:m(y.start.x),y:h(y.plateau),dy:-5,"text-anchor":"start",fill:a._font.color}).style("font-family","inherit").style("font-size",a._font.size).text(p);x.transition().duration(g).style("opacity",1);const w={g:x,remove:t=>{x.transition().duration(t).style("opacity",0).on("end",(()=>{x.remove()}))},update:t=>{x.transition().duration(t).style("color",u||"#000");const e=l(n,c,d);f.transition().duration(t).attr("d",`M${m(e.start.x)},${h(e.start.y)}V${h(e.plateau)}H${m(e.end.x)}V${h(e.end.y)}`),b.transition().duration(t).attr("cx",m(e.start.x)).attr("cy",h(e.start.y)),v.transition().duration(t).attr("cx",m(e.end.x)).attr("cy",h(e.end.y)),_.attr("font-size",a._font.size).attr("fill",a._font.color).transition().duration(t).attr("x",m(e.start.x)).attr("y",h(e.plateau))}};return s.trends.set(e,w),r},remove:(t,e=0)=>{void 0===t&&(s.trends.forEach((t=>t.remove())),s.trends.clear()),s.trends.has(t)&&(s.trends.get(t).remove(e),s.trends.delete(t))}}}),{self:a,api:r}};const Ut=P().add("canvas");function Kt(t,e){const a=Ut.canvas().getContext("2d");return a.font=e.fontSize+" "+e.fontFamily,{width:a.measureText(t).width,height:parseFloat(e.fontSize)}}const Yt={value:0,forecast:1,ranges:[0,50,80,100],thickness:30,valueColor:"#000",rangeColor:"#888"};function Jt(t,e,a){return new Date(Date.UTC(t,e,a))}function Xt(t){const e=t.split("-");return Jt(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]))}const Qt={blocks:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],margin:0,align:"start"},tiles:{names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekStart:0}};const Zt="dalian-checkbox-",te={wrapper:Zt+"wrapper",label:Zt+"label",box:Zt+"box",mark:Zt+"mark"},ee={checked:!1,color:"grey",disabled:!1,label:""};const ae=(t,a="")=>{const r="_current"+a;return function(a){const i=e.interpolate(this[r],a);return this[r]=i(0),e=>t(i(e))}},re=100,ie=10;const ne=100,oe=0;const se={grid:[100,100]};let le;function ce(){return void 0===le&&(le=e.select("body").append("svg").attr("id","dalian-defs").append("defs")),le}const de={pattern:"dalian-pattern-dashed",mask:"dalian-mask-dashed"},pe={pattern:"dalian-pattern-dotted",mask:"dalian-mask-dotted"};let ue,ge;function me(t){return function(t,e,a){return ce().append("pattern").attr("id",t).attr("x",e.x).attr("y",e.y).attr("width",a.width).attr("height",a.height).attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(-45)")}(t,{x:0,y:0},{width:4,height:4})}function he(t,e){return(a=t,r={x:0,y:0},i={width:4,height:4},ce().append("mask").attr("id",a).attr("x",r.x).attr("y",r.y).attr("width",i.width).attr("height",i.height)).append("rect").attr("x","-50%").attr("y","-50%").attr("width","100%").attr("height","100%").attr("fill",`url(#${e})`);var a,r,i}const ye={styles:()=>"solid",markers:"square",vSep:1.4,hSep:6,columns:1};const xe=0,fe=100;const be={radius:100,dimensions:null,min:0,max:1};const ve="dalian-radio-button-",_e={entry:ve+"entry",label:ve+"label",marker:ve+"marker"},we={checked:!1,color:"grey",columns:1,disabled:!1,hSep:null,vSep:2};const ke={size:()=>3};const ze={color:"grey",max:1,min:0,step:0,thickness:8,trackColor:"#ccc",value:0};const Me={radius:100,inner:.05,dimensions:null,min:0,max:1};const je="dalian-switch-",$e={wrapper:je+"wrapper",label:je+"label",box:je+"box",slider:je+"slider"},Ae={on:!1,color:"grey",disabled:!1,label:""};const Oe="#888",Ce=0,Fe="dalian-table-",Se={container:Fe+"container",table:Fe+"table",head:Fe+"head",headContainer:Fe+"head-container",headLabel:Fe+"ead-label",headSvg:Fe+"head-svg",headMarker:Fe+"head-marker",scrollbarTrack:Fe+"container::-webkit-scrollbar-track",scrollbarThumb:t=>t+" .dalian-table-container::-webkit-scrollbar-thumb",scrollbarThumbHover:t=>t+" .dalian-table-container::-webkit-scrollbar-thumb:hover",paging:Fe+"paging",pagingBlock:Fe+"paging-block",pagingNumber:Fe+"paging-number",pagingTotalBefore:Fe+"paging-total:before",pagingButton:Fe+"paging-button",pagingButtonHover:Fe+"paging-button:hover"};const Re={color:"grey",guide:!1,xRange:[0,1],yRange:[0,1],type:"cartesian",values:[0,0]};t.AreaChart=(t,i="body")=>{const o={x:qt(),y:qt()};let{self:s,api:l}=r(Ot("area-chart",t,i),d(o.y),(p="transparent",(t,e)=>{const a={mapping:()=>p};return{self:t=Object.assign(t||{},{_lineColor:{mapping:t=>a.mapping(t)}}),api:e=Object.assign(e||{},{lineColor:(t=p)=>(a.mapping="string"==typeof t?()=>t:e=>t[e]||p,e)})}}),Dt(1),c(o.x),Lt(o),Pt,Et(o),It(.4),Nt,B,Ct((()=>s._chart.plots),[".plot-group",".plot-marker"]),v);var p;return s._tooltip.content=t=>{if(void 0===t)return void s._plotMarker.remove();const a=e.bisector((t=>o.x(t.x))).left,r=t?s._chart.data.map((e=>a(e.values,t[0]))):void 0;if(void 0===r)return void s._plotMarker.remove();let i=o.x.scale.invert(t[0]);const n=s._chart.data.filter((t=>-1===s._tooltip.ignore.indexOf(t.name))).map(((t,e)=>{const a=r[e],n=t.values,l=n[a-1]?n[a-1]:n[a],c=n[a]?n[a]:n[a-1],d=i-l.x>c.x-i?c:l;return i=d.x,s._plotMarker.add(o.x(i),o.y(d.y),t.name,t),{name:t.name,background:s._color.mapper(t),x:d.x,y:d.y,lo:d.lo,hi:d.hi}}));return{title:i,content:{data:n}}},s._chart.transformData=t=>t.map((t=>({name:t.name,values:t.values.sort(((t,e)=>t.x-e.x)).map((t=>({x:+t.x,y:+t.y})))}))),s._widget.update=n(s._widget.update,(t=>{const r=s._chart.data.map((t=>t.values)).flat(),i=r.map((t=>t.y)),n=e.extent(i),l=.01*(n[1]-n[0]);n[1]+=l,o.x.range([0,parseInt(s._widget.size.innerWidth)]).domain(e.extent(r.map((t=>t.x)))),o.y.range([parseInt(s._widget.size.innerHeight),0]).domain(s._yRange.range(n));const c=e.area().x((t=>o.x(t.x))).y0(o.y(0)).y1((t=>o.y(t.y))).curve(s._smoothing.open()),d=e.line().x((t=>o.x(t.x))).y((t=>o.y(t.y))).curve(s._smoothing.open());s._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",s._color.mapper),t.append("path").attr("class","area").attr("d",(t=>c(t.values))).attr("stroke","none").attr("fill","currentColor"),t.append("path").attr("class","line").attr("d",(t=>d(t.values))).attr("fill","none"),t),update:t=>(t.style("opacity",1).style("color",s._color.mapper),t.select(".area").attrTween("d",(function(t){const r=e.select(this).attr("d"),i=c(t.values);return a.interpolatePath(r,i,null)})).attr("fill-opacity",s._opacity.value()),t.select(".line").attr("stroke",s._lineColor.mapping).attr("stroke-width",(t=>s._lineWidth.mapping(t.name))).attrTween("d",(function(t){const r=e.select(this).attr("d"),i=d(t.values);return a.interpolatePath(r,i,null)})),t),exit:t=>t.style("opacity",0)},t)}),!0),l=Object.assign(l||{},{}),l},t.BarChart=(t,a="body")=>{const i={x:qt("band"),y:qt()},{self:o,api:s}=r(Ot("bar-chart",t,a),d(i.y),c(i.x),H,Ct((()=>o._chart.plots),[".plot-group"]),St(i),Wt,Et(i),x,v);function l(t,e,a){const r=Kt(o._label.format(t),a),i=Math.max((e-r.height)/2,5),n=u.scales.x(Math.max(0,t.value)),s=Math.abs(n-u.scales.x(0))>2*i+r.width;return{inside:s,x:s?n-i:n+i+r.width,y:u.scales.y(t.name)+e/2,color:s?Tt(o._color.mapper(t)):a.color}}function p(t,e,a){const r=Kt(o._label.format(t),a),i=Math.max((e-r.width)/2,5),n=u.scales.y(Math.max(0,t.value)),s=Math.abs(n-u.scales.y(0))>2*i+r.height;return{inside:s,x:u.scales.x(t.name)+e/2,y:s?n+i:n-i-r.height,color:s?Tt(o._color.mapper(t)):a.color}}const u={current:void 0,horizontal:!1,scales:o._horizontal.scales()};return o._tooltip.content=()=>void 0===u.current?void 0:{title:u.current.name,stripe:o._color.mapper(u.current),content:{data:[{name:"value",value:u.current.value}]}},o._widget.update=n(o._widget.update,(t=>{u.scales=o._horizontal.scales();const a=o._horizontal.on(),r=o._widget.getStyle(),i=o._chart.data.map((t=>t.name));let n=Math.min(0,e.min(o._chart.data.map((t=>t.value)))),s=e.max(o._chart.data.map((t=>t.value)))||1;const c=s-n;s+=.01*c,n<0&&(n-=.01*c),u.scales.x.range([0,parseInt(o._widget.size.innerWidth)]).domain(a?o._yRange.range([n,s]):i),u.scales.y.range([parseInt(o._widget.size.innerHeight),0]).domain(a?i:o._yRange.range([n,s])),o._chart.plotGroups({enter:t=>(function(t,e){const a=e?u.scales.y.scale.bandwidth():u.scales.x.scale.bandwidth();t.append("rect").attr("class","bar").on("mouseover.bar",(t=>{u.current=t})).on("mouseleave.bar",(()=>{u.current=void 0})).attr("x",(t=>u.scales.x(e?0:t.name))).attr("y",(t=>u.scales.y(e?t.name:0))).attr("width",e?0:a).attr("height",e?a:0).attr("fill",o._color.mapper)}(t,a),function(t,e,a){const r=e?u.scales.y.scale.bandwidth():u.scales.x.scale.bandwidth(),i=e?l:p;t.append("text").attr("class","bar-label").attr("stroke","none").style("display","none").style("pointer-events","none").text(o._label.format).each((t=>Object.assign(t,{_measures:i(t,r,a)}))).attr("fill",(t=>t._measures.color)).attr("x",(t=>e?u.scales.x(0):t._measures.x)).attr("y",(t=>e?t._measures.y:u.scales.y(0)))}(t,a,r),t),update:t=>(o._highlight.apply(t,"name"),function(t,e){const a=e?u.scales.y.scale.bandwidth():u.scales.x.scale.bandwidth();t.select(".bar").attr("x",(t=>u.scales.x(e?Math.min(0,t.value):t.name))).attr("y",(t=>u.scales.y(e?t.name:Math.max(t.value,0)))).attr("width",(t=>e?Math.abs(u.scales.x(t.value)-u.scales.x(0)):a)).attr("height",(t=>e?a:Math.abs(u.scales.y(t.value)-u.scales.y(0)))).attr("fill",o._color.mapper)}(t,a),function(t,e,a){const r=e?u.scales.y.scale.bandwidth():u.scales.x.scale.bandwidth(),i=e?l:p;t.select(".bar-label").each((t=>Object.assign(t,{_measures:i(t,r,a)}))).attr("text-anchor",e?"end":"middle").attr("dominant-baseline",e?"central":"hanging").attr("font-size","inherit").attr("fill",o._font.color).attr("fill",(t=>t._measures.color)).attr("x",(t=>t._measures.x)).attr("y",(t=>t._measures.y)).text(o._label.format).style("display",o._label.show?null:"none")}(t,a,r),t),exit:t=>t.style("opacity",0)},t)}),!0),s},t.BoxPlot=(t,a="body")=>{const i={x:qt("point"),y:qt()};let{self:o,api:s}=r(Ot("box-plot",t,a),c(i.x),H,Ct((()=>o._chart.plots),[".plot-group"]),St(i),d(i.y),Dt(1),Et(i),It(.2));function l(t){const e="lower"===t?"q1":"q3";return a=>`M${g.scales.x(g.horizontal?a.value[e]:a.name)} ${g.scales.y(g.horizontal?a.name:a.value[e])}\n      L${g.scales.x(g.horizontal?a.value.whiskers[t]:a.name)} ${g.scales.y(g.horizontal?a.name:a.value.whiskers[t])}\n      m${g.horizontal?0:-.4*g.boxWidth} ${g.horizontal?-.4*g.boxWidth:0}\n      l${g.horizontal?0:.8*g.boxWidth} ${g.horizontal?.8*g.boxWidth:0}`}const p=t=>g.scales.x(g.horizontal?t:t.name),u=t=>g.scales.y(g.horizontal?t.name:t),g={current:void 0,boxWidth:20,horizontal:!1,scales:o._horizontal.scales()};return o._tooltip.content=()=>void 0===g.current?void 0:{title:g.current.name,stripe:o._color.mapper(g.current),content:{data:[{name:"median",value:g.current.value.median},{name:"q1",value:g.current.value.q1},{name:"q3",value:g.current.value.q3},{name:"low",value:g.current.value.whiskers.lower},{name:"high",value:g.current.value.whiskers.upper},{name:"mild outliers",value:g.current.value.outliers.mild.length},{name:"extreme outliers",value:g.current.value.outliers.extreme.length}]}},o._widget.update=n(o._widget.update,(t=>{const a=o._chart.data.map((t=>t.name));let r=e.min(o._chart.data,(t=>e.min(t.value.outliers.extreme.concat(t.value.outliers.mild).concat([t.value.whiskers.lower])))),i=e.max(o._chart.data,(t=>e.max(t.value.outliers.extreme.concat(t.value.outliers.mild).concat([t.value.whiskers.upper]))));const n=i-r;r-=.05*n,i+=.05*n,g.horizontal=o._horizontal.on(),g.scales=o._horizontal.scales(),g.scales.x.range([0,parseInt(o._widget.size.innerWidth)]).domain(g.horizontal?[r,i]:a),g.scales.y.range([parseInt(o._widget.size.innerHeight),0]).domain(g.horizontal?a:[r,i]);const s=g.horizontal?0:g.boxWidth/2,c=g.horizontal?g.boxWidth/2:0;o._chart.plotGroups({enter:t=>(t.style("opacity",0).on("mouseover.box",(t=>{g.current=t})).on("mouseleave.box",(()=>{g.current=void 0})).style("color",o._color.mapper),t.append("rect").attr("class","box-body").attr("rx","2px").attr("ry","2px").attr("stroke","currentColor").attr("stroke-width",(t=>o._lineWidth.mapping(t.name))).attr("fill","currentColor").attr("fill-opacity",o._opacity.value()).attr("x",(t=>g.scales.x(g.horizontal?t.value.q1:t.name)-s)).attr("y",(t=>g.scales.y(g.horizontal?t.name:t.value.q3)-c)).attr("width",(t=>g.horizontal?g.scales.x(t.value.q3)-g.scales.x(t.value.q1):g.boxWidth)).attr("height",(t=>g.horizontal?g.boxWidth:g.scales.y(t.value.q1)-g.scales.y(t.value.q3))),t.append("line").attr("class","box-median").attr("x1",(t=>g.scales.x(g.horizontal?t.value.median:t.name)-s)).attr("y1",(t=>g.scales.y(g.horizontal?t.name:t.value.median)-c)).attr("x2",(t=>g.scales.x(g.horizontal?t.value.median:t.name)+s)).attr("y2",(t=>g.scales.y(g.horizontal?t.name:t.value.median)+c)).attr("stroke","currentColor").attr("stroke-width","2px"),t.append("path").attr("class","box-whisker-lower").attr("d",l("lower")).attr("stroke","currentColor").attr("stroke-width",(t=>o._lineWidth.mapping(t.name))).attr("fill","none"),t.append("path").attr("class","box-whisker-upper").attr("d",l("upper")).attr("stroke","currentColor").attr("stroke-width",(t=>o._lineWidth.mapping(t.name))).attr("fill","none"),t.selectAll(".box-mild-outlier").data((t=>t.value.outliers.mild.map((e=>Object.assign(e,{name:t.name}))))).enter().append("circle").attr("class","box-mild-outlier").attr("cx",p).attr("cy",u).attr("r",3).attr("stroke","none").attr("fill","currentColor"),t.selectAll(".box-extreme-outlier").data((t=>t.value.outliers.extreme.map((e=>Object.assign(e,{name:t.name}))))).enter().append("circle").attr("class","box-extreme-outlier").attr("cx",p).attr("cy",u).attr("r",3).attr("stroke","none").attr("fill","currentColor").style("opacity",.3),t),updateBefore:e=>(e.selectAll(".box-mild-outlier").data((t=>t.value.outliers.mild.map((e=>Object.assign(e,{name:t.name}))))).join((t=>t.append("circle").attr("class","box-mild-outlier").attr("cx",p).attr("cy",u).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0)),(t=>t),(e=>e.transition().duration(t).style("opacity",0).remove())).transition().duration(t).attr("cx",p).attr("cy",u).style("opacity",1),e.selectAll(".box-extreme-outlier").data((t=>t.value.outliers.extreme.map((e=>Object.assign(e,{name:t.name}))))).join((t=>t.append("circle").attr("class","box-extreme-outlier").attr("cx",p).attr("cy",u).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0)),(t=>t),(e=>e.transition().duration(t).style("opacity",0).remove())).transition().duration(t).attr("cx",p).attr("cy",u).style("opacity",o._opacity.value()),e),update:t=>(t.style("opacity",1).style("color",o._color.mapper),t.select(".box-body").attr("x",(t=>g.scales.x(g.horizontal?t.value.q1:t.name)-s)).attr("y",(t=>g.scales.y(g.horizontal?t.name:t.value.q3)-c)).attr("width",(t=>g.horizontal?g.scales.x(t.value.q3)-g.scales.x(t.value.q1):g.boxWidth)).attr("height",(t=>g.horizontal?g.boxWidth:g.scales.y(t.value.q1)-g.scales.y(t.value.q3))).attr("stroke-width",(t=>o._lineWidth.mapping(t.name))).attr("fill-opacity",o._opacity.value()),t.select(".box-median").attr("x1",(t=>g.scales.x(g.horizontal?t.value.median:t.name)-s)).attr("y1",(t=>g.scales.y(g.horizontal?t.name:t.value.median)-c)).attr("x2",(t=>g.scales.x(g.horizontal?t.value.median:t.name)+s)).attr("y2",(t=>g.scales.y(g.horizontal?t.name:t.value.median)+c)),t.select(".box-whisker-lower").attr("d",l("lower")).attr("stroke-width",(t=>o._lineWidth.mapping(t.name))),t.select(".box-whisker-upper").attr("d",l("upper")).attr("stroke-width",(t=>o._lineWidth.mapping(t.name))),t),exit:t=>t.style("opacity",0)},t)}),!0),s=Object.assign(s||{},{boxWidth:(t=20)=>(g.boxWidth=t,s)}),s},t.BubbleChart=(t,a="body")=>{const i={x:qt(),y:qt(),size:qt("sqrt")};let{self:o,api:s}=r(Ot("bubble-chart",t,a),d(i.y),c(i.x),H,Ct((()=>o._chart.plots),[".plot-group"]),Et(i),It(.6),b,v);const l={current:{hovered:void 0,closest:void 0},diagram:void 0,radius:30};return o._tooltip.content=t=>{if(void 0===t)return;const e=l.current.closest||l.current.hovered;return e?{title:e.name,stripe:o._color.mapper(e),content:{data:[{name:o._bottomAxis.label.text(),value:e.value.x},{name:o._leftAxis.label.text(),value:e.value.y},{name:"size",value:e.value.size}]}}:void 0},o._chart.transformData=t=>t.sort(((t,e)=>e.value.size-t.value.size)),o._widget.update=n(o._widget.update,(t=>{const a=o._chart.data.map((t=>t.value)).flat(),r=e.max(a.map((t=>t.size)));i.size.range([0,l.radius]).domain([0,r]);let n=e.extent(a.map((t=>t.x)));i.x.range([0,parseInt(o._widget.size.innerWidth)]).domain(n);let s=e.extent(a.map((t=>t.y)));var c;i.y.range([parseInt(o._widget.size.innerHeight),0]).domain(s),n=a.map((t=>{const e=i.x.measure(1.5*i.size(t.size));return[t.x-e,t.x+e]})).flat(),i.x.domain(o._xRange.range(n)),s=a.map((t=>{const e=i.y.measure(1.5*i.size(t.size));return[t.y-e,t.y+e]})).flat(),i.y.domain(o._yRange.range(s)),o._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",o._color.mapper).on("mouseover.bubble",(t=>{l.current.hovered=t,void 0===l.current.closest&&o._mouse.over(l.current.hovered)})).on("mouseleave.bubble",(()=>{void 0===l.current.closest&&o._mouse.leave(l.current.hovered),l.current.hovered=void 0})).on("mouseover.chart",null).on("mouseleave.chart",null),t.append("circle").attr("class","bubble").attr("cx",(t=>i.x(t.value.x))).attr("cy",(t=>i.y(t.value.y))).attr("r",(t=>Math.max(i.size(t.value.size),1))).attr("stroke","currentColor").attr("fill","currentColor").raise(),t),update:t=>(t.style("opacity",1).style("color",o._color.mapper),t.select(".bubble").attr("cx",(t=>i.x(t.value.x))).attr("cy",(t=>i.y(t.value.y))).attr("r",(t=>Math.max(i.size(t.value.size),1))).attr("fill-opacity",o._opacity.value()),t),exit:t=>t.style("opacity",0)},t),l.diagram=(c=o._chart.data,e.voronoi().x((t=>i.x(t.value.x))).y((t=>i.y(t.value.y))).extent([[0,0],[parseInt(o._widget.size.innerWidth),parseInt(o._widget.size.innerHeight)]])(c)),o._widget.container.on("mousemove.bubble",(()=>{const t=l.diagram.find(...o._widget.getMouse(),20),e=t&&t.data||void 0;e!==l.current.closest&&(void 0===e?(o._mouse.leave(l.current.closest),l.current.closest=void 0,void 0!==l.current.hovered&&o._mouse.over(l.current.hovered)):(void 0!==l.current.hovered&&o._mouse.leave(l.current.hovered),l.current.closest=e,o._mouse.over(l.current.closest)))})).on("click.bubble",(()=>{void 0!==l.current.closest&&o._mouse.click(l.current.closest)}))}),!0),s=Object.assign(s||{},{radius:(t=30)=>(l.radius=t,s)}),s},t.BulletChart=(t,a="body")=>{const i=qt();let{self:o,api:s}=r(At("bullet-chart",t,a,"svg"),c(i),mt,_t,xt);const l={ui:{thickness:Yt.thickness,valueColor:Yt.valueColor,rangeColor:Yt.rangeColor},data:{label:"",unit:"",min:0,max:100,ranges:Yt.ranges,target:95,value:Yt.value,forecast:Yt.forecast},dom:(()=>{const t=o._widget.content.append("g").attr("class","dalian-plot-container"),e=t.append("g").attr("class","bullet-range"),a=t.append("g").attr("class","bullet-value"),r=t.append("g").attr("class","bullet-title");return{plot:t,range:{g:e,high:e.append("rect").attr("stroke","none").attr("fill-opacity",.2).attr("fill","currentColor"),mid:e.append("rect").attr("stroke","none").attr("fill-opacity",.4).attr("fill","currentColor"),low:e.append("rect").attr("stroke","none").attr("fill-opacity",.6).attr("fill","currentColor")},value:{g:a,forecast:a.append("rect").attr("stroke","none"),bar:a.append("rect").attr("stroke","none").attr("fill","currentColor"),target:a.append("line").attr("stroke","currentColor").attr("stroke-width","3px")},title:{label:r.append("text").attr("dx",-10).attr("text-anchor","end").attr("dominant-baseline","baseline"),unit:r.append("text").attr("dx",-10).attr("font-size","0.75em").attr("text-anchor","end").attr("dominant-baseline","hanging")}}})()};return o._widget.update=n(o._widget.update,(t=>{i.range([0,parseInt(o._widget.size.innerWidth)]).domain([l.data.ranges[0],l.data.ranges[3]]);const a=(parseFloat(o._widget.size.innerHeight)-l.ui.thickness)/2;o._widget.getElem(l.dom.plot,t).attr("transform",`translate(${o._widget.margins.left}, ${a+o._widget.margins.top})`),o._bottomAxis.margin({bottom:a}).tickColor(l.ui.rangeColor);const r=o._widget.container.transition().duration(t);l.dom.range.g.transition(r).attr("color",l.ui.rangeColor),l.dom.value.g.transition(r).attr("color",l.ui.valueColor),l.dom.range.high.transition(r).attr("x",i(l.data.ranges[0])).attr("y",0).attr("width",i(l.data.ranges[3])+1).attr("height",l.ui.thickness),l.dom.range.mid.transition(r).attr("x",i(l.data.ranges[0])).attr("y",0).attr("width",i(l.data.ranges[2])+1).attr("height",l.ui.thickness),l.dom.range.low.transition(r).attr("x",i(l.data.ranges[0])).attr("y",0).attr("width",i(l.data.ranges[1])+1).attr("height",l.ui.thickness),l.dom.value.bar.transition(r).attr("x",i(l.data.ranges[0])).attr("y",l.ui.thickness/3).attr("width",i(l.data.value)).attr("height",l.ui.thickness/3),l.dom.value.forecast.transition(r).attr("x",i(l.data.ranges[0])).attr("y",l.ui.thickness/3).attr("width",i(Math.min(l.data.value*l.data.forecast,l.data.ranges[3]))).attr("height",l.ui.thickness/3).attr("fill",(t=>{const a=e.hsl(t);return a.l+=.4*(1-a.l),a})(l.ui.valueColor)),l.dom.value.target.transition(r).attr("x1",i(l.data.target)).attr("y1",l.ui.thickness/6).attr("x2",i(l.data.target)).attr("y2",5*l.ui.thickness/6),l.dom.title.label.transition(r).attr("y",l.ui.thickness/2).text(l.data.label),l.dom.title.unit.transition(r).attr("y",2*l.ui.thickness/3).text(l.data.unit)}),!0),s=Object.assign(s,{value:(t=Yt.value)=>(l.data.value=t,s),forecast:(t=Yt.forecast)=>(l.data.forecast=t,s),target:t=>(l.data.target=t,s),ranges:(t=[0,50,80,100])=>(l.data.ranges=t,s),thickness:(t=Yt.thickness)=>(l.ui.thickness=t,s),valueColor:(t=Yt.valueColor)=>(l.ui.valueColor=t,s),rangeColor:(t=Yt.rangeColor)=>(l.ui.rangeColor=t,s),label:t=>(l.data.label=t,s),unit:t=>(l.data.unit=t,s)}),o._bottomAxis.hideAxisLine(!0),s},t.CalendarPlot=(t,a="body")=>{const i={x:qt(),y:qt("band")};let{self:o,api:s}=r(Ot("calendar-plot",t,a),H,Ct((()=>o._chart.plots),[".plot-group"]),Wt,d(i.y),(c=i.x,(t,a)=>{let r=l("x",t,e.axisTop,c,{"text-anchor":"end",dy:"2.5em"});return(t=Object.assign(t||{},{_topAxis:r}))._widget.update=n(t._widget.update,(e=>{t._widget.getElem(r.label,e).attr("x",t._widget.size.innerWidth)})),a=Object.assign(a||{},{topAxis:{label:(t="")=>(r.label.text(t),a),format:t=>(r.format(t),a),values:t=>(r.values(t),a),hideTicks:t=>(r.self.hideTicks(t),a),hideAxisLine:t=>(r.hideAxisLine(t),a)}}),{self:t,api:a}}));var c;const p=(t,e)=>(t-e+7)%7;function u(t){const e=Math.ceil((t.date-h.metrics.firstDay)/864e5);return Math.floor((e+p(h.metrics.firstDay.getDay(),h.tiles.weekStart))/7)}const g=t=>Tt(o._color.mapper(t));function m(t,e,a,r){const i=t.append("g").attr("class",(t=>`tile date-${t.date.getDate()}`)).attr("transform",(t=>`translate(${u(t)*e}, ${p(t.date.getDay(),h.tiles.weekStart)*e})`)).on("mouseover.calendar",(t=>{h.current=t})).on("mouseleave.calendar",(()=>{h.current=void 0}));return i.append("rect").attr("x",1).attr("y",1).attr("width",e-2).attr("height",e-2).attr("rx",.1*e).attr("ry",.1*e).attr("stroke","transparent").attr("stroke-width",2).attr("fill",o._color.mapper),i.append("text").attr("x",0).attr("y",0).attr("dx",.5*e).attr("dy",a).attr("text-anchor","middle").attr("font-size",r).attr("fill",g).style("display",o._label.show?null:"none").style("user-select","none").text(o._label.format),i}const h={current:void 0,metrics:{},blocks:{names:Qt.blocks.names,margin:Qt.blocks.margin,align:Qt.blocks.align},tiles:{names:Qt.tiles.names,weekStart:0},fm:o._widget.getFontMetrics()};return o._chart.transformData=t=>{const a=t.map((t=>({date:Xt(t.date),value:+t.value}))),r=e.min(a.map((t=>t.date))).getMonth(),i=e.max(a.map((t=>t.date))).getMonth(),n=a[0].date.getFullYear();let o=0;const s=Array.from({length:i-r+1},((t,e)=>{const a=(r+e)%12,i=Jt(n,a+1,0).getDate(),s=Jt(n,a,1),l={month:a,numDays:i,daysOffset:o,index:e,name:`month-${a}`,tiles:Array.from({length:i},((t,e)=>{const r=new Date(s);return r.setDate(s.getDate()+e),{name:`month-${a}`,date:r,value:null}}))};return o+=i,l}));return a.forEach((t=>{const e=`month-${t.date.getMonth()}`;s.find((t=>t.name===e)).tiles.find((e=>e.date.getDate()===t.date.getDate())).value=t.value})),h.metrics={year:s[0].tiles[0].date.getFullYear(),firstDay:s[0].tiles[0].date,numDays:e.sum(s,(t=>t.tiles.length)),numMonths:s.length},s},o._tooltip.content=()=>void 0===h.current?void 0:{title:h.current.date.toISOString().substr(0,10),stripe:o._color.mapper(h.current),content:{type:"plots",data:[{name:"value",value:h.current.value}]}},o._widget.update=n(o._widget.update,(t=>{const a=7-p(h.metrics.firstDay.getDay(),h.tiles.weekStart),r=Math.ceil((h.metrics.numDays-a)/7)+1;o._chart.data.forEach((t=>{t.x=Math.floor((t.daysOffset-a)/7)+1,t.length=Math.ceil((t.daysOffset+t.numDays-a)/7)+1-t.x}));const n=parseFloat(o._widget.size.innerWidth)/(r+h.blocks.margin*(h.metrics.numMonths-1)),s=parseFloat(o._widget.size.innerHeight)/7,l=Math.min(n,s);o._color.scale(e.scaleLinear().domain(e.extent(o._chart.data.map((t=>t.tiles)).flat(),(t=>t.value))).range([0,1]));const c=(parseFloat(o._widget.size.innerWidth)-l*(r+h.blocks.margin*(h.metrics.numMonths-1)))/2,d=(parseFloat(o._widget.size.innerHeight)-7*l)/2,y=Math.min(.6*l,parseFloat(o._font.size))+"px",x=(l+h.fm.capHeight*parseFloat(y))/2;var f,b;i.x.range([c,parseInt(o._widget.size.innerWidth)-c]).domain([0,r+h.blocks.margin*(h.metrics.numMonths-1)]),i.y.range([d,parseInt(o._widget.size.innerHeight)-d]).domain((f=h.tiles.names,b=h.tiles.weekStart,f.slice(b).concat(f.slice(0,b)))),o._leftAxis.hideAxisLine(!0).hideTicks(!0).margin({left:c}),o._topAxis.tickAnchor(h.blocks.align).hideAxisLine(!0).hideTicks(!0).margin({top:d}).values(o._chart.data.map((t=>t.x+("middle"===h.blocks.align?.5*t.length:0)+h.blocks.margin*t.index))).format(((t,e)=>h.blocks.names[o._chart.data[e].month])),o._chart.plotGroups({enter:t=>(t.style("opacity",0).classed(`year-${h.metrics.firstDay.getFullYear()}`,!0).attr("transform",(t=>`translate(${c+h.blocks.margin*t.index*l}, ${d})`)),m(t.selectAll(".tile").data((t=>t.tiles)).enter(),l,x,y),t),updateBefore:e=>{const a=e.selectAll(".tile").data((t=>t.tiles)).join((t=>m(t,l,x,y).style("opacity",0)),(t=>t),(e=>e.transition().duration(t).style("opacity",0).remove())).transition().duration(t).attr("transform",(t=>`translate(${u(t)*l}, ${p(t.date.getDay(),h.tiles.weekStart)*l})`)).style("opacity",1);return a.select("rect").attr("width",l-2).attr("height",l-2).attr("rx",.1*l).attr("ry",.1*l).attr("fill",o._color.mapper),a.select("text").attr("dx",.5*l).attr("dy",x).attr("font-size",y).attr("fill",g).style("display",o._label.show?null:"none").text(o._label.format),e},update:t=>t.style("opacity",1).attr("transform",(t=>`translate(${c+h.blocks.margin*t.index*l}, ${d})`)),exit:t=>t.style("opacity",0)},t)}),!0),s=Object.assign(s||{},{months:(t=Qt.blocks.names)=>(h.blocks.names=t,s),blockAlign:(t=Qt.blocks.align)=>(h.blocks.align=t,s),blockMargin:(t=Qt.blocks.margin)=>(h.blocks.margin=t,s),days:(t=Qt.tiles.names)=>(h.tiles.names=t,s),weekStart:(t=Qt.tiles.weekStart)=>(h.tiles.weekStart=t,s)}),delete s.leftAxis,delete s.topAxis,o._color.init("sequential",(t=>t.value)),s},t.Checkbox=(t,e="body")=>{j(te.wrapper,{display:"inline-block",position:"relative","user-select":"none"}),j(te.label,{position:"absolute",top:"0.1em","margin-left":"2em","line-height":"1.35em"}),j(te.box,{width:"1.35em",height:"1.35em"}),j(te.mark,{position:"absolute",left:".45em",top:".15em",width:".3em",height:".7em",border:"solid white",transform:"rotate(45deg)","border-width":"0 .15em .15em 0"});let{self:a,api:i}=r(At("checkbox",t,e,"div"),xt);const o=a._widget.content.append("div").attr("class","container"),s=o.append("div").attr("class",te.wrapper),l=s.append("div").attr("class",te.label).on("click",u),c=s.append("div").attr("class",te.box).on("click",u),d=c.append("div").attr("class",te.mark),p=Object.assign({},ee);function u(){p.checked=!p.checked,c.style("background",p.checked?p.color:Bt(p.color,.6)),d.style("display",p.checked?null:"none"),p.callback&&p.callback(p.checked)}return a._widget.update=n(a._widget.update,(t=>{a._widget.getElem(o,t).style("width",a._widget.size.width).style("height",a._widget.size.height),a._widget.getElem(s,t).style("margin-left",a._widget.margins.left+"px").style("margin-top",a._widget.margins.top+"px").style("width",a._widget.size.innerWidth).style("opacity",p.disabled?.4:1).style("cursor",p.disabled?"default":"pointer").style("pointer-events",p.disabled?"none":"all"),l.text(p.label),a._widget.getElem(c,t).style("background",p.checked?p.color:Bt(p.color,.6)),d.style("display",p.checked?null:"none")}),!0),i=Object.assign(i,{callback:t=>(p.callback=t,i),check:(t=ee.checked)=>(p.checked=t,i),color:(t=ee.color)=>(p.color=t,i),disable:(t=ee.disabled)=>(p.disabled=t,i),label:(t=ee.label)=>(p.label=t,i)}),i},t.ChordDiagram=(t,a="body")=>{let{self:o,api:s}=r(Ot("chord-diagram",t,a),Ct((()=>o._chart.plots),[".chord-ribbon"]),Wt);function l(t,e){return t.append("path").attr("class",(t=>`chord-ribbon ${i(t.name)} ${i(t.name2)}`)).attr("fill","currentColor").attr("fill-opacity",.6).attr("stroke","#fff").attr("d",e)}function c(t){return t.angle=(t.startAngle+t.endAngle)/2,`rotate(${180*t.angle/Math.PI-90}) translate(${p.radius-o._widget.margins.left+5}) ${t.angle>Math.PI?" rotate(180)":""}`}function d(t){return(t.startAngle+t.endAngle)/2>Math.PI?"end":"start"}const p={radius:re,thickness:ie,indexByName:new Map,nameByIndex:new Map,arc:null};return o._chart.transformData=t=>{p.indexByName.clear(),p.nameByIndex.clear();let a=0,r=0;t.forEach((t=>{p.indexByName.has(r=t.source)||(p.nameByIndex.set(a,r),p.indexByName.set(r,a++)),p.indexByName.has(r=t.target)||(p.nameByIndex.set(a,r),p.indexByName.set(r,a++))}));const i=[];t.forEach((t=>{const e=p.indexByName.get(t.source),r=p.indexByName.get(t.target);void 0===i[e]&&(i[e]=Array(a).fill(0)),i[e][r]=t.value,void 0===i[r]&&(i[r]=Array(a).fill(0))}));const n=e.chord().padAngle(.05).sortGroups(e.descending).sortSubgroups(e.descending)(i),o=n.groups.sort(((t,e)=>e.value-t.value)).map((t=>Object.assign(t,{name:p.nameByIndex.get(t.index),ribbons:[]})));for(const t of n){o.find((e=>e.index===t.source.index)).ribbons.push(Object.assign(t,{id:(s=t.source.index,l=t.target.index,s<l?s+"-"+l:l+"-"+s),name:p.nameByIndex.get(t.source.index),name2:p.nameByIndex.get(t.target.index)}))}var s,l;return o},o._widget.update=n(o._widget.update,(t=>{const a=p.radius-p.thickness-o._widget.margins.left,r=p.radius-o._widget.margins.left;p.arc=e.arc().innerRadius(a).outerRadius(r);const i=e.ribbon().radius(a-1),n=o._chart.plots.transition().duration(t);o._chart.plotGroups({enter:t=>(t.style("color",o._color.mapper).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2})`).style("opacity",0),t.append("text").attr("class","chord-label").attr("dy",".35em").attr("transform",c).attr("text-anchor",p.textAnchor).style("display",o._label.show?null:"none").text((t=>t.name)),t.append("path").attr("class","chord-arc").attr("d",p.arc).attr("fill","currentColor"),l(t.selectAll(".chord-ribbon").data((t=>t.ribbons),(t=>t.id)).enter(),i),t),updateBefore:t=>{t.selectAll(".chord-ribbon").data((t=>t.ribbons),(t=>t.id)).join((t=>l(t,i).style("opacity",0)),(t=>t),(t=>t.transition(n).style("opacity",0).remove())).transition(n).style("opacity",1).attrTween("d",ae(i,"ribbon"))},update:t=>(t.style("color",o._color.mapper).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2})`).style("opacity",1),t.select(".chord-arc").attrTween("d",ae(p.arc,"arc")),t.select(".chord-label").style("display",o._label.show?null:"none").attrTween("transform",ae(c,"transform")).attrTween("text-anchor",ae(d,"textAnchor")),t),exit:t=>t.style("opacity",0)},t)})),s=Object.assign(s,{radius:(t=re)=>(p.radius=t,s),thickness:(t=ie)=>(p.thickness=t,s)}),s},t.CoxcombChart=(t,a="body")=>{let{self:o,api:s}=r(At("coxcomb-chart",t,a,"svg"),ut,mt,xt,Ct((()=>d.plots),[".wedge"]),Wt,ft,_t,B);const l=t=>`M${t.outerRadius*Math.sin(t.startAngle)},${-t.outerRadius*Math.cos(t.startAngle)}A${t.outerRadius},${t.outerRadius},0,0,1,${t.outerRadius*Math.sin(t.endAngle)},${-t.outerRadius*Math.cos(t.endAngle)}`,c=(t,e)=>t.attr("class",(t=>`wedge ${i(t.name)}`)).order().on("mouseover.chart",(t=>o._mouse.over({name:t.name,y:t.y}))).on("mouseleave.chart",(t=>o._mouse.leave({name:t.name,y:t.y}))).on("click.chart",(t=>o._mouse.click({name:t.name,y:t.y}))).transition(e).attr("fill",o._color.mapper).attrTween("d",ae((t=>d.arc(t)))),d={scale:qt("sqrt"),arc:e.arc(),radius:ne,angle:oe,data:[],current:void 0,plots:o._widget.content.append("g").attr("class","dalian-plot-container")};return o._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.label,content:{data:d.current.data.map((t=>({name:t.name,background:o._color.mapper(t),y:t.y})))}},o._widget.update=n(o._widget.update,(t=>{const a=e.max(d.data.map((t=>t.data)).flat().map((t=>t.y)));d.scale.range([0,d.radius]).domain([0,a]),d.data.forEach((t=>{t.data.map((t=>Object.assign(t,{outerRadius:d.scale.scale(t.y||0)}))),t.outerRadius=Math.max(.6*d.radius,d.scale.scale(e.max(t.data,(t=>t.y||0))))+.5*parseFloat(o._font.size)}));const r=d.plots.transition().duration(t);o._widget.getDefs().selectAll(".wedge-label-path").data(d.data,(t=>t.index)).join((t=>t.append("path").attr("class","wedge-label-path").attr("id",(t=>`${o._widget.id}-wedge-${t.index}`)).attr("stroke","red").attr("d",l)),(t=>t),(e=>e.transition().duration(t).remove())).transition().duration(t).attrTween("d",ae((t=>l(t))));d.plots.selectAll(".wedge-group").data(d.data,(t=>t.index)).join((t=>t.append("g").attr("class","wedge-group").attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2}) rotate(${d.angle})`).style("opacity",0).call((t=>{const e=t.selectAll("path").data((t=>t.data)).enter().append("path").attr("stroke","white");c(e,r),t.append("text").attr("text-anchor","middle").append("textPath").attr("href",(t=>`#${o._widget.id}-wedge-${t.index}`)).attr("method","stretch").attr("startOffset","50%")}))),(t=>t.call((t=>{const e=t.selectAll("path").data((t=>t.data)).join((t=>t.append("path").attr("stroke","white").style("opacity",0)),(t=>t),(t=>t.transition(r).style("opacity",0).remove()));c(e,r).style("opacity",1)}))),(t=>t.transition(r).style("opacity",0).remove())).on("mouseover.coxcomb",(t=>{d.current=t})).on("mouseleave.coxcomb",(()=>{d.current=void 0})).transition(r).style("opacity",1).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2}) rotate(${d.angle})`).select("text").style("display",o._label.show?null:"none").select("textPath").text(o._label.format),d.plots.style("pointer-events",o._tooltip&&o._tooltip.isOn()||o._mouse.hasAny()?"all":"none")})),s=Object.assign(s||{},{data(t){const e=Array.from(t.reduce(((t,e)=>new Set([...t,...e.values.map((t=>t.x))])),new Set)).sort(((t,e)=>t-e)),a=e.length;return d.data=e.map(((e,r)=>{const i=2*r*Math.PI/a,n=2*(r+1)*Math.PI/a;return{index:r,label:e,padAngle:0,startAngle:i,endAngle:n,innerRadius:0,data:t.map((t=>{const a=t.values.find((t=>t.x===e));return{label:e,name:t.name,padAngle:0,startAngle:i,endAngle:n,innerRadius:0,y:a&&a.y||null}})).sort(((t,e)=>e.y-t.y))}})),s},radius:(t=ne)=>(d.radius=t,s),angle:(t=oe)=>(d.angle=t,s)}),s},t.Heatmap=(t,a="body")=>{const i={x:qt("linear"),y:qt("linear")};let{self:o,api:s}=r(Ot("heatmap",t,a),d(i.y),c(i.x),b,v);function l(t,a,r){const i=p.dom.context.createImageData(...p.i.grid);for(let n=0,s=0,l=0;n<p.i.grid[1];n++)for(let n=0;n<p.i.grid[0];n++,s++,l+=4){const n=e.rgb(t[l],t[l+1],t[l+2],t[l+3]/255),c=o._color.mapper(a.values[s]/a.max),d=e.rgb(e.interpolateLab(n,c)(r));i.data[l]=d.r,i.data[l+1]=d.g,i.data[l+2]=d.b,i.data[l+3]=255*d.opacity}return p.dom.context.putImageData(i,0,0),i}const p={scales:i,i:Object.assign({domain:[]},se),dom:(()=>{const t=o._widget.content.append("foreignObject"),e=t.append("xhtml:body").style("width","100%").style("height","100%").append("canvas").attr("x",0).attr("y",0).attr("width",se.grid[0]).attr("height",se.grid[1]).style("position","absolute").style("width","100%").style("height","100%").style("image-rendering","pixelated"),a=e.node().getContext("2d"),r=a.createImageData(...se.grid).data;for(let t=0,e=0;t<se.grid[1];t++)for(let t=0;t<se.grid[0];t++,e+=4)r[e]=255,r[e+1]=255,r[e+2]=255,r[e+3]=0;return{container:t,canvas:e,context:a,img:r}})()};return o._chart.transformData=t=>{const a=e.extent(t.map((t=>t.x))),r=e.extent(t.map((t=>t.y))),i=Math.ceil((a[1]-a[0])/p.i.grid[0]),n=Math.ceil((r[1]-r[0])/p.i.grid[1]),o=new Array(p.i.grid[0]*p.i.grid[1]).fill(null);return t.forEach((t=>{const e=Math.floor((t.x-a[0])/i),s=Math.floor((r[1]-(t.y-r[0]))/n);null===o[e+s*p.i.grid[0]]?o[e+s*p.i.grid[0]]=t.value:null!==t.value&&(o[e+s*p.i.grid[0]]+=t.value)})),{data:t,xRange:a,yRange:r,max:e.max(o,(t=>Math.abs(t))),values:o}},o._widget.update=n(o._widget.update,(t=>{p.scales.x.range([0,parseInt(o._widget.size.innerWidth)]).domain(o._xRange.range(o._chart.data.xRange)),p.scales.y.range([parseInt(o._widget.size.innerHeight),0]).domain(o._yRange.range(o._chart.data.yRange)),o._widget.transition=!0;const a=e.timer((function(e){const r=t>0?e/t:1;if(l(p.dom.img,o._chart.data,r),r>=1){const t=l(p.dom.img,o._chart.data,1);p.dom.img=t.data.slice(),o._widget.transition=!1,a.stop()}}));o._widget.container.on("mousemove.heatmap",(()=>{})).on("click.heatmap",(()=>{})),p.dom.container.attr("x",.5+o._widget.margins.left+"px").attr("y",o._widget.margins.top+"px").attr("width",o._widget.size.innerWidth).attr("height",o._widget.size.innerHeight)}),!0),s=Object.assign(s||{},{grid:t=>(p.i.grid=t,p.dom.canvas.attr("width",p.i.grid[0]).attr("height",p.i.grid[1]),p.dom.img=p.dom.context.createImageData(...p.i.grid).data,o._chart.data=o._chart.transformData(o._chart.data.data),s)}),s.color.policy("sequential").color.palette("palette-iridescent").color.on((t=>t)),s},t.Legend=(t,e="body")=>{let{self:a,api:o}=r(At("legend",t,e,"svg"),ut,xt,Ct((()=>s.container),[".legend-entry"]),ft);const s={entries:[],styles:ye.styles,markers:ye.markers,vSep:ye.vSep,hSep:ye.hSep,columns:ye.columns,inserted:!1,container:a._widget.content.append("g").attr("class","legend-container")};function l(t,e){const r=parseFloat(a._font.size);return`translate(${r*s.hSep*(e%s.columns)}, ${r*(.7+s.vSep*Math.floor(e/s.columns))})`}function c(t){let e;switch(t.select(".legend-entry-marker-shape").remove(),s.markers){case"square":e=t.append("rect").attr("x",0).attr("y","-.5em").attr("width","1em").attr("height","1em").attr("rx",2).attr("ry",2);break;case"circle":e=t.append("circle").attr("cx",".5em").attr("cy",0).attr("r",".5em");break;default:e=t.append("path").attr("d",s.markers).attr("transform",`translate(${parseFloat(a._font.size)/2}, 0)`)}e.attr("class","legend-entry-marker-shape").attr("mask",s.styles)}return a._widget.update=n(a._widget.update,(t=>{const e=a._widget.getFontMetrics(),r=s.container.transition().duration(t);s.inserted||r.attr("transform",`translate(${parseFloat(a._widget.margins.left)}, ${parseFloat(a._widget.margins.top)})`),s.container.selectAll(".legend-entry").data(s.entries,(t=>t.name)).join((t=>{const n=t.append("g").attr("class",(t=>`legend-entry ${i(t.name)}`)).attr("transform",l).style("shape-rendering","geometricPrecision").style("opacity",0).style("pointer-events",a._mouse.hasAny()?"all":"none").style("cursor",a._mouse.hasAny()?"pointer":"default").on("mouseover",(t=>a._mouse.over(t.name))).on("mouseleave",(t=>a._mouse.leave(t.name))).on("click",(t=>a._mouse.click(t.name)));n.transition(r).style("opacity",1);return n.append("g").attr("class","legend-entry-marker").attr("fill",a._color.mapper).call(c,e).attr("font-size",a._font.size),n.append("text").attr("class","legend-entry-label").attr("text-anchor","start").attr("dominant-baseline","central").attr("font-size",a._font.size).attr("dx",1.3*parseFloat(a._font.size)).text((t=>t.name)),n}),(t=>(t.style("cursor",a._mouse.hasAny()?"pointer":"default").style("pointer-events",a._mouse.hasAny()?"all":"none").transition(r).attr("transform",l).style("opacity",(t=>a._highlight.isHighlighted(t.name)?1:.1)),t.select(".legend-entry-marker").attr("font-size",a._font.size).call(c,e).transition(r).attr("fill",a._color.mapper),t.select(".legend-entry-label").text((t=>t.name)),t)),(t=>t.transition(r).style("opacity",0).remove()))}),!0),o=Object.assign(o,{entries:t=>(s.entries=t.map((t=>({name:t}))),o),styles:(t=ye.styles)=>(s.styles=e=>function(t){switch(t){case"dashed":if(void 0===ue){const t=de.pattern;me(t).append("path").attr("d","m 0 0 h 4").attr("stroke","#fff").attr("stroke-width",4),ue=de.mask,he(ue,t)}return`url(#${ue})`;case"dotted":if(void 0===ge){const t=pe.pattern;me(t).append("circle").attr("cx",2).attr("cy",2).attr("r",1.5).attr("fill","#fff"),ge=pe.mask,he(ge,t)}return`url(#${ge})`;default:return null}}(t[e.name]),o),markers:(t=ye.markers)=>(s.markers=t,o),columns:(t=ye.columns)=>(s.columns=t,o),vSep:(t=ye.vSep)=>(s.vSep=t,o),hSep:(t=ye.hSep)=>(s.hSep=t,o),insert:(t,e)=>(void 0!==t&&"object"==typeof t.objects?(t.objects.add(`${t.id()}-legend`,s.container.attr("transform",null).node(),e,{layer:"outside"}),a._widget.container.style("display","none"),s.inserted=!0):(a._widget.content.append((()=>s.container.attr("transform",`translate(${parseFloat(a._widget.margins.left)}, ${parseFloat(a._widget.margins.top)})`).node())),a._widget.container.style("display",null),s.inserted=!1),o)}),o},t.LineChart=(t,i="body")=>{const o={x:qt("linear"),y:qt("linear")},{self:s,api:l}=r(Ot("line-chart",t,i),d(o.y),c(o.x),Et(o),Ct((()=>s._chart.plots),[".plot-group",".plot-marker",".trends-marker"]),Ht,Dt(2),Lt(o),Pt,B,Nt,Vt(o),y,b,x,v);return s._tooltip.content=t=>{if(void 0===t)return void s._plotMarker.remove();const a=e.bisector((t=>o.x(t.x))).left,r=t?s._chart.data.map((e=>a(e.values,t[0]))):void 0;if(void 0===r)return void s._plotMarker.remove();let i=o.x.scale.invert(t[0]);const n=s._chart.data.filter((t=>-1===s._tooltip.ignore.indexOf(t.name))).map(((t,e)=>{const a=r[e],n=t.values[a];return i=n.x,null!==n.y&&s._yRange.contains(n.y)?s._plotMarker.add(o.x(i),o.y(n.y),t.name,t,2*parseFloat(s._lineWidth.mapping(t.name))):s._plotMarker.remove(t.name),{name:t.name,background:s._lineStyle.background(s._lineStyle.style(t.name),s._color.mapper(t)),x:n.x,y:n.y,lo:n.lo,hi:n.hi}}));return{title:i,content:{data:n}}},s._chart.transformData=t=>t.map((t=>({name:t.name,values:t.values.sort(((t,e)=>t.x-e.x)).map((t=>({x:+t.x,y:null===t.y?t.y:+t.y,lo:+t.lo||0,hi:+t.hi||0})))}))),s._widget.update=n(s._widget.update,(t=>{const r=s._chart.data.reduce(((t,e)=>t.concat(e.values)),[]).filter((t=>null!==t.y)),i=r.filter((t=>t.lo+t.hi>0)).length>0,n=r.map((t=>t.y-t.lo)).concat(r.map((t=>t.y+t.hi))),l=e.extent(n),c=.01*(l[1]-l[0]);l[1]+=c,l[0]-=c,o.x.range([0,parseInt(s._widget.size.innerWidth)]).domain(s._xRange.range(r.map((t=>t.x)))),o.y.range([parseInt(s._widget.size.innerHeight),0]).domain(s._yRange.range(l));const d=e.line().defined((t=>null!==t.y)).x((t=>o.x(t.x))).y((t=>o.y(t.y))).curve(s._smoothing.open()),p=e.area().defined((t=>null!==t.y)).x((t=>o.x(t.x))).y0((t=>o.y(t.y-t.lo))).y1((t=>o.y(t.y+t.hi))).curve(s._smoothing.open());s._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",s._color.mapper),t.append("path").attr("class","error-band").attr("d",(t=>p(t.values))).attr("stroke","none").attr("fill","currentColor").attr("fill-opacity",0),t.append("path").attr("class","line").attr("d",(t=>d(t.values))).attr("stroke","currentColor").attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round"),t),update:t=>(t.style("opacity",(t=>s._highlight.isHighlighted(t.name)?1:.1)).style("color",s._color.mapper),t.select(".error-band").attr("fill-opacity",i?.2:0).attrTween("d",(function(t){const r=e.select(this).attr("d"),i=p(t.values);return a.interpolatePath(r,i,null)})),t.select(".line").attrTween("d",(function(t){const r=e.select(this).attr("d"),i=d(t.values);return a.interpolatePath(r,i,null)})).attr("stroke-width",(t=>s._lineWidth.mapping(t.name))).attr("stroke-dasharray",(t=>s._lineStyle.strokeDashArray(t.name))),t),exit:t=>t.style("opacity",0)},t)}),!0),l},t.PieChart=(t,a="body")=>{let{self:i,api:o}=r(Ot("pie-chart",t,a),H,Ct((()=>i._chart.plots),[".plot-group"]),Wt,Et({}));function s(t,e,a){const r=Kt(i._label.format(t),a);return{outside:1.1*Math.sqrt(r.width*r.width+r.height*r.height)>Math.min(.5*(u.innerRadius+u.outerRadius)*(t.endAngle-t.startAngle),u.outerRadius-u.innerRadius),x:-.25*u.outerRadius*(u.numSlices-e),y:-1.25*u.outerRadius+1.1*r.height*(u.numSlices-1-e)}}function l(t){let e=u.labels.arcs.inner.centroid(t);const a=u.labels.arcs.outer.centroid(t),r=Math.max(a[1],t._measures.y),i=[a[1]!==e[1]?a[0]-(a[0]-e[0])*(a[1]-r)/(a[1]-e[1]):a[0],r],n=.25*u.outerRadius,o=[u.labels.left(t)?Math.min(i[0]-n,t._measures.x):i[0]+n,i[1]];return i[1]>e[1]&&(e=i),`M${e[0]} ${e[1]} L${i[0]} ${i[1]} L${o[0]} ${o[1]}`}const c=t=>u.labels.left(t)?"end":"start";function d(t){const e=.25*u.outerRadius;return u.labels.left(t)?Math.min(u.labels.arcs.outer.centroid(t)[0]-e,t._measures.x)-5:u.labels.arcs.outer.centroid(t)[0]+e+5}const p=t=>Math.max(u.labels.arcs.outer.centroid(t)[1],t._measures.y),u={innerRadius:xe,outerRadius:fe,current:void 0,arc:null,labels:{format:()=>"",left:t=>.5*(t.startAngle+t.endAngle)>Math.PI,arcs:{inner:null,outer:null}},numSlices:0};return i._chart.transformData=t=>e.pie().value((t=>t.value)).sort(null)(t.sort(((t,e)=>e.value-t.value))).map((t=>Object.assign(t,{name:t.data.name}))),i._tooltip.content=()=>void 0===u.current?void 0:{title:u.current.name,stripe:i._color.mapper(u.current),content:{type:"plots",data:[{name:"value",value:u.current.value}]}},i._widget.update=n(i._widget.update,(t=>{const a=i._widget.getStyle();u.arc=e.arc().innerRadius(u.innerRadius).outerRadius(u.outerRadius),u.labels.arcs.inner=e.arc().innerRadius(u.outerRadius+5).outerRadius(u.outerRadius+5),u.labels.arcs.outer=e.arc().innerRadius(1.25*u.outerRadius).outerRadius(1.25*u.outerRadius),u.numSlices=i._chart.data.filter((t=>t.value>0)).length,i._chart.plotGroups({enter:t=>{t.style("opacity",0).style("color",i._color.mapper).each(((t,e)=>Object.assign(t,{_measures:s(t,e,a)})));const e=t.append("g").attr("class","slice").attr("transform",`translate(${parseFloat(i._widget.size.innerWidth)/2}, ${parseFloat(i._widget.size.innerHeight)/2})`).on("mouseover.pie",(t=>{u.current=t})).on("mouseleave.pie",(()=>{u.current=void 0}));e.append("path").attr("class","slice-wedge").attr("d",u.arc).attr("stroke-linejoin","round").attr("stroke","white").attr("fill","currentColor");const r=e.append("g").attr("class","slice-label").style("display",i._label.show?null:"none");r.append("text").attr("class","inner-label").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",(t=>u.arc.centroid(t)[0])).attr("y",(t=>u.arc.centroid(t)[1])).style("cursor","default").style("opacity",(t=>t._measures.outside?0:1)).text((t=>t.value.toFixed(1)));const n=r.append("g").attr("class","outer-label").style("opacity",(t=>t._measures.outside?1:0));return n.append("path").attr("class","outer-label-line").attr("stroke-linejoin","round").attr("fill","none").attr("d",l),n.append("text").attr("class","outer-label-text").attr("dominant-baseline","middle").attr("text-anchor",c).attr("x",d).attr("y",p).style("cursor","default").text((t=>t.value.toFixed(1))),t},update:t=>{t.style("opacity",1).style("color",i._color.mapper).each(((t,e)=>Object.assign(t,{_measures:s(t,e,a)})));const e=t.select(".slice").attr("transform",`translate(${parseFloat(i._widget.size.innerWidth)/2}, ${parseFloat(i._widget.size.innerHeight)/2})`);e.select(".slice-wedge").attrTween("d",ae((t=>u.arc(t))));const r=e.select(".slice-label").style("display",i._label.show?null:"none");r.select(".inner-label").style("opacity",(t=>t._measures.outside?0:1)).attr("fill",(t=>Tt(i._color.mapper(t)))).attrTween("x",ae((t=>u.arc.centroid(t)[0]),"x")).attrTween("y",ae((t=>u.arc.centroid(t)[1]),"y")).text(i._label.format);const n=r.select(".outer-label").style("opacity",(t=>t._measures.outside?1:0));return n.select(".outer-label-line").attr("stroke",i._font.color).attrTween("d",ae(l,"r")),n.select(".outer-label-text").attr("fill",i._font.color).attrTween("text-anchor",ae(c,"align")).attrTween("x",ae(d,"x")).attrTween("y",ae(p,"y")).text(i._label.format),t},exit:t=>t.style("opacity",0)},t)})),o=Object.assign(o,{innerRadius:(t=xe)=>(u.innerRadius=t,o),outerRadius:(t=fe)=>(u.outerRadius=t,o)}),o},t.RadarChart=(t,a="body")=>{const i=Object.assign({},be),o={angle:qt(),radius:qt()};let{self:s,api:l}=r(Ot("radar-chart",t,a),H,Ct((()=>s._chart.plots),[".plot-group"]),Ht,Dt(1),Et(o),It(0),u(o.radius,o.angle),m,Nt);function c(t){return(i.dimensions||Object.keys(s._chart.data[0].values).sort()).map((e=>{const a=t.values[e];return{y:+a.y,lo:+a.lo,hi:+a.hi}}))}return s._tooltip.content=()=>{if(void 0===i.current)return;const t=i.dimensions||Object.keys(s._chart.data[0].values).sort();return{title:i.current.name,stripe:s._color.mapper(i.current),content:{data:t.map((t=>({name:t,value:i.current.values[t].y})))}}},s._chart.transformData=t=>t.map((({name:t,values:e})=>({name:t,values:Object.entries(e).reduce(((t,[e,a])=>Object.assign(t,{[e]:{y:"number"==typeof a[0]?a[0]:a,lo:"number"==typeof a[1]?a[1]:0,hi:"number"==typeof a[2]?a[2]:0}})),{})}))),s._widget.update=n(s._widget.update,(t=>{const a=i.dimensions||Object.keys(s._chart.data[0].values).sort();o.radius.range([0,i.radius]).domain([i.min,i.max]),o.angle.range([0,2*(a.length-1)*Math.PI/a.length]).domain([0,a.length-1]),s._radialAxis.labels(a);const r=e.lineRadial().angle(((t,e)=>o.angle(e))).radius((t=>o.radius(t.y))).curve(s._smoothing.closed()),n=e.areaRadial().angle(((t,e)=>o.angle(e))).innerRadius((t=>o.radius(t.y-t.lo))).outerRadius((t=>o.radius(t.y+t.hi))).curve(s._smoothing.closed());s._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",s._color.mapper).attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`).attr("pointer-events","visiblePainted").on("mouseover.radar",(t=>{i.current=t})).on("mouseleave.radar",(()=>{i.current=void 0})),t.append("path").attr("class","error-band").attr("d",(t=>n(c(t)))).attr("stroke","none").attr("fill","currentColor").attr("fill-opacity",0),t.append("path").attr("class","line").attr("d",(t=>r(c(t)))).attr("fill-opacity",s._opacity.value()).attr("stroke","currentColor").attr("stroke-linejoin","round").attr("stroke-linecap","round"),t),update:t=>(t.style("opacity",1).style("color",s._color.mapper).attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`),t.select(".error-band").attr("fill-opacity",.2).attr("d",(t=>n(c(t)))),t.select(".line").attr("d",(t=>r(c(t)))).attr("fill",s._opacity.value()>0?"currentColor":"none").attr("fill-opacity",s._opacity.value()).attr("stroke-width",(t=>s._lineWidth.mapping(t.name))).attr("stroke-dasharray",(t=>s._lineStyle.strokeDashArray(t.name))),t),exit:t=>t.style("opacity",0)},t)}),!0),l=Object.assign(l||{},{dimensions:(t=be.dimensions)=>(i.dimensions=t,l),radius:(t=be.radius)=>(i.radius=t,l),min:(t=be.min)=>(i.min=t,l),max:(t=be.max)=>(i.max=t,l),scale:(t="linear")=>(o.radius.type(t),l)}),l},t.RadioButton=(t,e="body")=>{j(_e.entry,{position:"absolute",display:"block"}),j(_e.marker,{position:"relative",float:"left",display:"inline-block",width:".5em",height:".5em",border:".4em solid transparent","border-radius":"50%",background:"#fff"}),j(_e.label,{display:"inline-block",float:"right",width:"calc(100% - 1.75em)",height:"100%","line-height":"1.35em"});let{self:a,api:i}=r(At("checkbox",t,e,"div"),xt);const o={i:Object.assign({entries:[],rows:1},we),dom:{container:a._widget.content.append("div")}};function s(t){o.i.selected!==t&&(o.i.selected=t,o.dom.container.selectAll("."+_e.entry).select("."+_e.marker).style("border-color",(t=>t===o.i.selected?o.i.color:"transparent")).style("background",(t=>t===o.i.selected?"#fff":Bt(o.i.color,.6))),o.i.callback&&o.i.callback(o.i.selected))}function l(){return null===o.i.hSep||1===o.i.columns?parseFloat(a._widget.size.innerWidth)/o.i.columns+"px":parseFloat(a._font.size)*o.i.hSep+"px"}const c=()=>parseFloat(a._font.size)*o.i.vSep+"px";function d(t,e){const r=e%o.i.columns;return null===o.i.hSep?`${parseFloat(a._widget.margins.left)+r*parseFloat(a._widget.size.innerWidth)/o.i.columns}px`:`${parseFloat(a._widget.margins.left)+r*parseFloat(a._font.size)*o.i.hSep}px`}const p=(t,e)=>`${parseFloat(a._widget.margins.top)+Math.floor(e/o.i.columns)*parseFloat(a._font.size)*o.i.vSep}px`;return a._widget.update=n(a._widget.update,(t=>{a._widget.getElem(o.dom.container,t).style("width",a._widget.size.width).style("height",a._widget.size.height);const e=o.dom.container.transition().duration(t);o.dom.container.selectAll("."+_e.entry).data(o.i.entries,(t=>t)).join((t=>{const e=t.append("div").attr("class",_e.entry).style("width",l).style("height",c).style("left",d).style("top",p).style("cursor",o.i.disabled?"default":"pointer").style("pointer-events",o.i.disabled?"none":"all").style("opacity",o.i.disabled?.4:1).on("click",s);return e.append("div").attr("class",_e.marker).style("border-color",(t=>t===o.i.selected?o.i.color:"transparent")).style("background",(t=>t===o.i.selected?"#fff":Bt(o.i.color,.6))),e.append("div").attr("class",_e.label).text((t=>t)),e}),(t=>(t.style("cursor",o.i.disabled?"default":"pointer").style("pointer-events",o.i.disabled?"none":"all").style("opacity",o.i.disabled?.4:1).call((t=>t.transition(e).style("width",l).style("height",c).style("left",d).style("top",p))),t.transition(e).select("."+_e.marker).style("border-color",(t=>t===o.i.selected?o.i.color:"transparent")).style("background",(t=>t===o.i.selected?"#fff":Bt(o.i.color,.6))),t)),(t=>t.transition(e).style("opacity",0).remove()))}),!0),i=Object.assign(i,{callback:t=>(o.i.callback=t,i),color:(t=we.color)=>(o.i.color=t,i),columns:(t=we.columns)=>(o.i.columns=t,o.i.rows=Math.ceil(o.i.entries.length/t),i),disable:(t=we.disabled)=>(o.i.disabled=t,i),entries:(t=[])=>(o.i.entries=t,o.i.rows=Math.ceil(t.length/o.i.columns),i),hSep:(t=we.hSep)=>(o.i.hSep="number"==typeof t?t:null,i),select:t=>(o.i.entries.indexOf(t)>-1?o.i.selected=t:o.i.selected=void 0,i),vSep:(t=we.vSep)=>(o.i.vSep=t,i)}),i},t.ScatterPlot=(t,a="body")=>{const i={x:qt("linear"),y:qt("linear")};let{self:o,api:s}=r(Ot("scatter-plot",t,a),c(i.x),H,Ct((()=>o._chart.plots),[".plot-group"]),d(i.y),Et(i),It(.6),Pt,b,v);const l={scales:i,current:void 0,diagram:void 0,size:ke.size};return o._tooltip.content=t=>{if(void 0!==t){if(l.current)return o._plotMarker.add(l.scales.x(l.current.x),l.scales.y(l.current.y),"marker",l.current,Math.max(5,1.5*l.size(l.current))),{title:l.current.name,stripe:o._color.mapper(l.current),content:{type:"plots",data:[{name:o._bottomAxis.label.text(),value:l.current.x},{name:o._leftAxis.label.text(),value:l.current.y}]}};o._plotMarker.remove()}else o._plotMarker.remove()},o._chart.transformData=t=>t.map((t=>({name:t.name,values:t.values.map((e=>Object.assign(e,{name:t.name,x:+e.x,y:+e.y})))}))),o._widget.update=n(o._widget.update,(t=>{const a=o._chart.data.map((t=>t.values)).flat(),r=e.max(a.map(l.size));l.scales.x.range([0,parseInt(o._widget.size.innerWidth)]).domain(e.extent(a.map((t=>t.x)).flat())),l.scales.y.range([parseInt(o._widget.size.innerHeight),0]).domain(e.extent(a.map((t=>t.y)).flat()));const i=e.extent(a.map((t=>{const e=l.scales.x.measure(l.size(t));return[t.x-e,t.x+e]})).flat());l.scales.x.domain(o._xRange.range(i));const n=e.extent(a.map((t=>{const e=l.scales.y.measure(l.size(t));return[t.y-e,t.y+e]})).flat());l.scales.y.domain(o._yRange.range(n)),o._chart.plotGroups({enter:t=>(t.style("opacity",0),t.selectAll("circle").data((t=>t.values)).enter().append("circle").attr("class","dot").attr("cx",(t=>l.scales.x(t.x))).attr("cy",(t=>l.scales.y(t.y))).attr("r",l.size).style("opacity",0).style("fill",o._color.mapper).attr("stroke","none"),t),updateBefore:e=>(e.style("opacity",1),e.selectAll("circle").data((t=>t.values)).join((t=>t.append("circle").attr("class","dot").attr("cx",(t=>l.scales.x(t.x))).attr("cy",(t=>l.scales.y(t.y))).attr("r",l.size).style("opacity",0)),(t=>t),(e=>e.transition().duration(t).style("opacity",0).remove())).transition().duration(t).attr("cx",(t=>l.scales.x(t.x))).attr("cy",(t=>l.scales.y(t.y))).attr("r",l.size).style("opacity",o._opacity.value()).style("fill",o._color.mapper),e),exit:t=>t.style("opacity",0)}),l.diagram=function(t){const a=t.map((t=>t.values.map((e=>({name:t.name,x:e.x,y:e.y}))))).flat();return e.voronoi().x((t=>l.scales.x(t.x))).y((t=>l.scales.y(t.y))).extent([[0,0],[parseInt(o._widget.size.innerWidth),parseInt(o._widget.size.innerHeight)]])(a)}(o._chart.data),o._widget.container.on("mousemove.scatter",(()=>{const t=l.diagram.find(...o._widget.getMouse(),Math.max(20,r))||void 0;void 0!==t&&t!==l.current?o._mouse.over(t.data):void 0!==l.current&&o._mouse.leave(l.current),l.current=t&&t.data||void 0})).on("click.scatter",(()=>{void 0!==l.current&&o._mouse.click(l.current)}))}),!0),s=Object.assign(s,{size:(t=ke.size)=>(l.size="number"==typeof t?()=>t:t,s)}),s},t.Slider=(t,a="body")=>{const i=qt("linear");let{self:o,api:s}=r(At("slider",t,a,"svg"),c(i),xt);const l={i:Object.assign({domain:[]},ze),dom:(()=>{const t=o._widget.content.append("g").attr("class","dalian-slider-container"),a=t.append("line").attr("class","slider-track").attr("y1",0).attr("y2",0).attr("stroke-linecap","round"),r=t.append("line").attr("class","slider-track").attr("y1",0).attr("y2",0).attr("stroke-linecap","round"),n=t.append("line").attr("class","slider-overlay").attr("y1",0).attr("y2",0).attr("stroke","none").style("cursor","pointer").style("pointer-events","all").call(e.drag().on("start drag",(()=>{s.attr("fill",l.i.color).attr("stroke","#fff").attr("stroke-width",2),d(),l.dom.handle.attr("cx",i.scale(l.i.value)+.5),l.dom.value.attr("x2",i.scale(l.i.value)+.5),l.i.callback&&l.i.callback(l.i.value)})).on("end",(()=>{s.attr("fill","#fff").attr("stroke",l.i.trackColor).attr("stroke-width",1)}))),s=t.append("circle").attr("class","slider-handle").attr("cy",0).attr("fill","#fff");return{container:t,track:a,value:r,overlay:n,handle:s}})()};function d(t){const a=void 0===t?e.event.x:i.scale(t);l.i.step>0?l.i.value=l.i.domain.reduce(((t,e)=>Math.abs(i.scale(e)-a)<Math.abs(i.scale(t)-a)?e:t)):l.i.value=Math.max(l.i.min,Math.min(l.i.max,i.scale.invert(a)))}return o._widget.update=n(o._widget.update,(t=>{i.range([0,parseFloat(o._widget.size.innerWidth)]).domain([l.i.min,l.i.max]),function(){if(0===l.i.step)return[];l.i.domain=[];for(let t=l.i.min;t<=l.i.max;t+=l.i.step)l.i.domain.push(t)}(),d(l.i.value);const e=parseFloat(o._widget.size.height)/2;o._widget.getElem(l.dom.container,t).attr("transform",`translate(${o._widget.margins.left}, ${e})`),o._widget.getElem(l.dom.track,t).attr("x2",o._widget.size.innerWidth).attr("stroke",l.i.trackColor).attr("stroke-width",l.i.thickness),o._widget.getElem(l.dom.overlay,t).attr("x1",-l.i.thickness).attr("x2",parseFloat(o._widget.size.innerWidth)+l.i.thickness).attr("stroke-width",2*l.i.thickness),o._widget.getElem(l.dom.value,t).attr("x2",i.scale(l.i.value)+.5).attr("stroke",l.i.color).attr("stroke-width",l.i.thickness),o._widget.getElem(l.dom.handle,t).attr("cx",i.scale(l.i.value)+.5).attr("r",1.1*l.i.thickness).attr("stroke",l.i.trackColor),o._bottomAxis.margin({bottom:e-o._widget.margins.bottom-l.i.thickness/2})}),!0),s=Object.assign(s,{callback:t=>(l.i.callback=t,s),color:(t=ze.color)=>(l.i.color=t,s),max:(t=ze.max)=>(l.i.max=t,s),min:(t=ze.min)=>(l.i.min=t,s),step:(t=ze.step)=>(l.i.step=Math.abs(t),s),thickness:(t=ze.thickness)=>(l.i.thickness=t,s),trackColor:(t=ze.trackColor)=>(l.i.trackColor=t,s),value:t=>(void 0!==t&&(l.i.value=t),s)}),o._bottomAxis.hideAxisLine(!0).hideTicks(!0),s},t.StellarChart=(t,a="body")=>{const i=Object.assign({},Me),o={angle:qt(),radius:qt()};let{self:s,api:l}=r(Ot("radar-chart",t,a),H,Ct((()=>s._chart.plots),[".plot-group"]),u(o.radius,o.angle),m,Nt);function c(t){const e=s._radialAxis.radialScale().invert(i.inner*i.radius),a=i.dimensions||Object.keys(s._chart.data[0].values).sort(),r=[];for(let i=0;i<a.length;i++)r.push(t.values[a[i]]),r.push(e);return r}return s._tooltip.content=()=>{if(void 0===i.current)return;const t=i.dimensions||Object.keys(s._chart.data[0].values).sort();return{title:i.current.name,stripe:s._color.mapper(i.current),content:{data:t.map((t=>({name:t,value:i.current.values[t]})))}}},s._chart.transformData=t=>t.map((({name:t,values:e})=>({name:t,values:Object.entries(e).reduce(((t,[e,a])=>Object.assign(t,{[e]:a})),{})}))),s._widget.update=n(s._widget.update,(t=>{const a=i.dimensions||Object.keys(s._chart.data[0].values).sort();o.radius.range([0,i.radius]).domain([i.min,i.max]),o.angle.range([0,2*(a.length-1)*Math.PI/a.length]).domain([0,a.length-1]),s._radialAxis.labels(a);const r=e.lineRadial().angle(((t,e)=>o.angle(e/2))).radius(o.radius).curve(s._smoothing.closed());s._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",s._color.mapper).attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`).attr("pointer-events","visiblePainted").on("mouseover.stellar",(t=>{i.current=t})).on("mouseleave.stellar",(()=>{i.current=void 0})),t.append("path").attr("class","line").attr("d",(t=>r(c(t)))).attr("stroke","currentColor").attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round"),t),update:t=>(t.style("opacity",1).style("color",s._color.mapper).attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`),t.select(".line").attr("d",(t=>r(c(t)))).attr("fill","currentColor"),t),exit:t=>t.style("opacity",0)},t),s._chart.plots.select("circle").empty()&&s._chart.plots.append("circle").attr("cx",parseFloat(s._widget.size.innerWidth)/2).attr("cy",parseFloat(s._widget.size.innerHeight)/2).attr("r",3).attr("fill","white").raise()}),!0),l=Object.assign(l||{},{dimensions:(t=Me.dimensions)=>(i.dimensions=t,l),radius:(t=Me.radius)=>(i.radius=t,l),inner:(t=Me.inner)=>(i.inner=t,l),min:(t=Me.min)=>(i.min=t,l),max:(t=Me.max)=>(i.max=t,l),scale:(t="linear")=>(o.radius.type(t),l)}),l},t.Switch=(t,e="body")=>{j($e.wrapper,{display:"inline-block",position:"relative","user-select":"none"}),j($e.label,{position:"absolute",top:".1em","margin-left":"3.2em","line-height":"17px"}),j($e.box,{width:"32px",height:"20px","border-radius":"32px"}),j($e.slider,{position:"absolute",width:"16px",height:"16px",top:"2px",left:"2px","border-radius":"50%",background:"#fff"});let{self:a,api:i}=r(At("switch",t,e,"div"),xt);const o={i:Object.assign({},Ae),dom:(()=>{const t=a._widget.content.append("div").attr("class","container"),e=t.append("div").attr("class",$e.wrapper),r=e.append("div").attr("class",$e.label).on("click",s),i=e.append("div").attr("class",$e.box).on("click",s),n=i.append("div").attr("class",$e.slider);return{container:t,wrapper:e,label:r,box:i,slider:n}})()};function s(){o.i.on=!o.i.on,o.dom.box.transition().duration(300).style("background",o.i.on?o.i.color:Bt(o.i.color,.6)),o.dom.slider.transition().duration(300).style("left",o.i.on?"14px":"2px"),o.i.callback&&o.i.callback(o.i.on)}return a._widget.update=n(a._widget.update,(t=>{a._widget.getElem(o.dom.container,t).style("width",a._widget.size.width).style("height",a._widget.size.height),a._widget.getElem(o.dom.wrapper,t).style("margin-left",a._widget.margins.left+"px").style("margin-top",a._widget.margins.top+"px").style("width",a._widget.size.innerWidth).style("opacity",o.i.disabled?.4:1).style("cursor",o.i.disabled?"default":"pointer").style("pointer-events",o.i.disabled?"none":"all"),o.dom.label.text(o.i.label),a._widget.getElem(o.dom.box,t).style("background",o.i.on?o.i.color:Bt(o.i.color,.6)),a._widget.getElem(o.dom.slider,t).style("left",o.i.on?"14px":"2px")}),!0),i=Object.assign(i,{callback:t=>(o.i.callback=t,i),toggle:(t=Ae.on)=>(o.i.on=t,i),color:(t=Ae.color)=>(o.i.color=t,i),disable:(t=Ae.disabled)=>(o.i.disabled=t,i),label:(t=Ae.label)=>(o.i.label=t,i)}),i},t.Table=(t,e="body")=>{j(Se.container,{position:"relative",overflow:"auto","pointer-events":"all"}),j(Se.scrollbarTrack,{background:"transparent"}),j(Se.table,{width:"100%","border-collapse":"collapse","user-select":"none"}),j(Se.head,{position:"sticky",top:0,padding:"5px 10px",cursor:"pointer","white-space":"nowrap","font-weight":"normal","font-variant":"all-small-caps"}),j(Se.headContainer,{position:"relative",display:"inline-block"}),j(Se.headLabel,{"margin-right":"12px"}),j(Se.headSvg,{position:"absolute",right:0,top:"calc(50% - 4px)"}),j(Se.paging,{position:"relative",float:"right",width:"100px",height:"25px","pointer-events":"all","user-select":"none"}),j(Se.pagingBlock,{position:"relative",float:"left",width:"25px",height:"25px"}),j(Se.pagingNumber,{"text-align":"center","line-height":"25px"}),j(Se.pagingTotalBefore,{content:'"/"',position:"absolute",left:"-2px"}),j(Se.pagingButton,{cursor:"pointer",opacity:.2}),j(Se.pagingButtonHover,{opacity:1});let{self:a,api:i}=r(At("table",t,e,"div"),mt,Ct((()=>s.dom.table),["td"],(()=>{const t=Bt(Oe,.8);return{focus:{color:Tt(t),background:t}}})()),ft,xt,_t);function o(t){return"number"===t.type?"right":"left"}$(Se.scrollbarThumb(a._widget.id),{background:Bt(Oe,.8)}),$(Se.scrollbarThumbHover(a._widget.id),{background:Oe});const s={fm:a._widget.getFontMetrics(),colors:{main:Oe,light:Bt(Oe,.8)},data:{cols:[],schema:[],values:[]},dom:(()=>{const t=a._widget.content.append("div").attr("class",Se.container),e=t.append("table").attr("class",Se.table);return{container:t,table:e,header:e.append("thead").append("tr"),body:e.append("tbody")}})(),sorting:{key:null,ascending:!0,arrow:t=>void 0===t?"":"up"===t?"m 1 8 l 4 -6.92 l 4 6.92 z":"m 1 2 l 4 6.92 l 4 -6.92 z",update(t,e){s.sorting.key=t,s.sorting.ascending=e},sorter(t,e="string",a=!1){const r=a?-1:1;switch(e){case"number":return(e,a)=>r*(e[t]-a[t]);case"date":return(e,a)=>r*(Xt(e[t])-Xt(a[t]));default:return(e,a)=>r*e[t].localeCompare(a[t])}},sort(t){if(s.sorting.key===t.key)s.sorting.ascending?(s.data.values.sort(s.sorting.sorter(t.key,t.type,!0)),s.sorting.update(t.key,!1)):(s.data.values.sort(((t,e)=>t._id-e._id)),s.sorting.update(null,!0));else s.data.values.sort(s.sorting.sorter(t.key,t.type)),s.sorting.update(t.key,!0);s.updateBody(),s.dom.header.selectAll("."+Se.headMarker).attr("d",(t=>s.sorting.arrow(t.key===s.sorting.key?s.sorting.ascending?"up":"down":void 0)))}},paging:(()=>{let t=Ce,e=0;const r=(()=>{const i=a._widget.content.append("div").attr("class",Se.paging);i.append("div").attr("class",`${Se.pagingBlock} ${Se.pagingButton}`).on("click",(()=>{t>0&&e>0&&(e--,s.updateBody(),r.current.text(e+1))})).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 10 4 l -6.92 4 l 6.92 4 z");const n=i.append("div").attr("class",`${Se.pagingBlock} ${Se.pagingNumber}`),o=i.append("div").attr("class",`${Se.pagingBlock} ${Se.pagingNumber} ${Fe}paging-total`);return i.append("div").attr("class",`${Se.pagingBlock} ${Se.pagingButton}`).on("click",(()=>{t>0&&e<Math.ceil(s.data.values.length/t)-1&&(e++,s.updateBody(),r.current.text(e+1))})).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 2 4 l 6.92 4 l -6.92 4 z"),{g:i,current:n,total:o}})();return{update(i){r.g.style("display",t>0?null:"none"),t>0&&(r.g.transition().duration(i).style("margin-right",a._widget.margins.right+"px"),r.current.text(e+1),r.total.text(Math.ceil(s.data.values.length/t)))},filter(a){if(t>0){const r=e*t,i=r+t;return a.filter(((t,e)=>e>=r&&e<i))}return a},reset(a){void 0!==a&&(t=a),e=0},size:()=>t}})(),updateBody(){const t=s.data.schema.filter((t=>s.data.cols.indexOf(t.key)>-1)),e=s.paging.filter(s.data.values);s.dom.body.selectAll("tr").data(e,(()=>Date.now()+""+Math.random())).join((e=>{const r=e.append("tr").style("height","2em").style("line-height","2em");return r.selectAll("td").data((e=>t.map((t=>({row:e._id,column:t.key,value:e[t.key],type:t.type,displayValue:void 0===t.format?e[t.key]:t.format(e[t.key])}))))).enter().append("td").attr("class",(t=>`row-${t.row} column-${t.column} cell-${t.row}-${t.column}`)).style("padding","0.25em 0.5em").style("white-space","nowrap").style("text-align",o).on("mouseover.table",a._mouse.over).on("mouseleave.table",a._mouse.leave).on("click.table",a._mouse.click).text((t=>t.displayValue)),r}),(t=>t),(t=>{const a=s.paging.size()-e.length;t.filter(((t,e)=>e<a)).raise().selectAll("td").remove(),t.filter(((t,e)=>e>=a)).remove()}))}};return a._widget.update=n(a._widget.update,(t=>{s.dom.container.transition().duration(t).style("width",a._widget.size.innerWidth).style("height",a._widget.size.innerHeight).style("margin-left",a._widget.margins.left+"px").style("margin-top",a._widget.margins.top+"px"),s.dom.table.style("height",a._widget.size.innerHeight);const e=s.data.schema.filter((t=>s.data.cols.indexOf(t.key)>-1));s.dom.header.selectAll("th").data(e,(t=>t.key)).join((t=>{const e=t.append("th").style("user-select","none"),a=e.append("div").attr("class",Se.headContainer).style("float",o);return a.append("span").attr("class",Se.headLabel),a.append("svg").attr("class",Se.headSvg).attr("viewBox","0 0 10 10").style("width",`${s.fm.capHeight}em`).style("height",`${s.fm.capHeight}em`).append("path").attr("class",Se.headMarker).attr("fill","currentColor").attr("d",s.sorting.arrow()),e}),(t=>t),(t=>t.remove())).on("click",s.sorting.sort).attr("class",Se.head).style("background",s.colors.main).style("color",Tt(s.colors.main)).select("."+Se.headLabel).html((t=>t.name)),s.updateBody(),s.paging.update(t)}),!0),i=Object.assign(i,{data:t=>(s.data.values=t.map(((t,e)=>Object.assign(t,{_id:e}))),s.paging.reset(),s.data.cols=Object.keys(t[0]||{}),s.sorting.update(null,!0),s.dom.header.selectAll(".table-head-sorting").text(""),i),schema:t=>(s.data.schema=t,i),color:(t=Oe)=>(s.colors={main:t,light:Bt(t,.8)},A(Se.scrollbarThumb(a._widget.id),{background:s.colors.light}),A(Se.scrollbarThumbHover(a._widget.id),{background:t}),a._highlight.style({focus:{color:Tt(s.colors.light),background:s.colors.light}}),i),paging:(t=Ce)=>(s.paging.reset(t),i)}),i},t.Trackpad=(t,a="body")=>{const i={x:qt(),y:qt()};let{self:o,api:s}=r(At("trackpad",t,a,"svg"),c(i.x),d(i.y),xt);function l(t){const a=void 0===t?e.event.x:i.x.scale(t[0]),r=void 0===t?e.event.y:i.y.scale(t[1]);u.i.values=[Math.max(u.i.xRange[0],Math.min(u.i.xRange[1],i.x.scale.invert(a))),Math.max(u.i.yRange[0],Math.min(u.i.yRange[1],i.y.scale.invert(r)))]}function p(t,e){const a=i.x.scale(u.i.values[0])+.5,r=i.y.scale(u.i.values[1])+.5;t.attr("cx",a).attr("cy",r).attr("stroke",u.i.color),e.clip.attr("width",o._widget.size.innerWidth).attr("height",o._widget.size.innerHeight),e.x.attr("x2",o._widget.size.innerWidth).attr("y1",r).attr("y2",r).attr("stroke",u.i.color),e.y.attr("x1",a).attr("x2",a).attr("y2",o._widget.size.innerHeight).attr("stroke",u.i.color)}const u={i:Object.assign({},Re),dom:(()=>{const t=o._widget.content.append("g").attr("class","dalian-trackpad-container"),a=t.append("rect").attr("class","trackpad-track").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3),r=(()=>{const e=`${o._widget.id}-guides-clipper`,a=o._widget.getDefs().append("clipPath").attr("id",e).append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",o._widget.size.innerWidth).attr("height",o._widget.size.innerHeight),r=t.append("g").attr("class","trackpad-guides").attr("clip-path",`url(#${e})`);return{clip:a,x:r.append("line").attr("class","trackpad-guide-x").attr("x1",0).attr("stroke-dasharray","2 4"),y:r.append("line").attr("class","trackpad-guide-y").attr("y1",0).attr("stroke-dasharray","2 4")}})(),i=t.append("circle").attr("class","trackpad-handle").attr("r",8).attr("fill","#fff"),n=t.append("rect").attr("class","trackpad-overlay").attr("x",-10).attr("y",-10).attr("fill","none").attr("stroke","none").style("cursor","pointer").style("pointer-events","all").call(e.drag().on("start drag",(()=>{i.attr("fill",u.i.color).attr("stroke","#fff").attr("stroke-width",2),l(),p(u.dom.handle,u.dom.guide),u.i.callback&&u.i.callback(u.i.values)})).on("end",(()=>{i.attr("fill","#fff").attr("stroke",u.i.color).attr("stroke-width",1)})));return{container:t,track:a,guide:r,handle:i,overlay:n}})()};return o._widget.update=n(o._widget.update,(t=>{i.x.range([0,parseFloat(o._widget.size.innerWidth)]).domain(u.i.xRange),i.y.range([parseFloat(o._widget.size.innerHeight),0]).domain(u.i.yRange),l(u.i.values),o._widget.getElem(u.dom.container,t).attr("transform",`translate(${o._widget.margins.left}, ${o._widget.margins.top})`),o._widget.getElem(u.dom.track,t).attr("width",o._widget.size.innerWidth).attr("height",o._widget.size.innerHeight).attr("fill",Bt(u.i.color,.8)).attr("stroke",u.i.color),o._widget.getElem(u.dom.overlay,t).attr("width",parseFloat(o._widget.size.innerWidth)+20).attr("height",parseFloat(o._widget.size.innerHeight)+20),p(o._widget.getElem(u.dom.handle,t),{clip:o._widget.getElem(u.dom.guide.clip,t),x:o._widget.getElem(u.dom.guide.x,t).style("opacity",u.i.guide?1:0),y:o._widget.getElem(u.dom.guide.y,t).style("opacity",u.i.guide?1:0)})}),!0),s=Object.assign(s,{callback:t=>(u.i.callback=t,s),color:(t=Re.color)=>(u.i.color=t,s),guide:(t=Re.guide)=>(u.i.guide=t,s),xRange:t=>(u.i.xRange=Array.isArray(t)?t:u.i.xRange,s),yRange:t=>(u.i.yRange=Array.isArray(t)?t:u.i.yRange,s),values:t=>(u.i.values=t||u.i.values,s)}),o._bottomAxis.hideAxisLine(!0).hideTicks(!0),o._leftAxis.hideAxisLine(!0).hideTicks(!0),s},t.ViolinPlot=(t,i="body")=>{const o={x:qt("point"),y:qt()};let{self:s,api:l}=r(Ot("violin-plot",t,i),c(o.x),H,Ct((()=>s._chart.plots),[".plot-group"]),St(o),d(o.y),Dt(1),Et(o),It(.2),v);function p(t){const a=e.min(t),r=e.max(t),i=r-a;var n,o,s;const l=(s=g.bandwidth,n=t=>Math.abs(t/=s)<=1?.75*(1-t*t)/s:0,o=e.range(Math.floor(i/g.bandwidth)+1).map((t=>a+g.bandwidth*t)),t=>o.map((a=>({x:a,y:e.mean(t,(t=>n(a-t)))}))))(t);return{yMin:a,yMax:r,values:l,scale:e.scaleLinear().range([g.violinWidth/2-1,0]).domain([0,e.max(l,(t=>t.y))])}}function u(t){const a=t.length,r=e.mean(t),i=e.sum(t,(t=>(t-r)*(t-r)))/a,n=e.sum(t,(t=>Math.pow(t-r,3)))/a,o=e.sum(t,(t=>Math.pow(t-r,4)))/a,s=Math.sqrt(a*(a-1))*n/((a-2)*Math.pow(i,1.5));return(s*s+1)/(o/(i*i)-3+3*(a-1)*(a-1)/((a-2)*(a-3)))}const g={data:[],current:void 0,scales:s._horizontal.scales(),violinWidth:30,horizontal:!1,bandwidth:1};return s._tooltip.content=()=>void 0===g.current?void 0:{title:g.current.name,stripe:s._color.mapper(g.current),content:{data:[{name:"mean",value:g.current.stats.mean},{name:"median",value:g.current.stats.median},{name:"bimodality",value:g.current.stats.bimodality}]}},s._chart.transformData=t=>(g.data=t,t.map((t=>{const{yMin:a,yMax:r,values:i,scale:n}=p(t.values);return{name:t.name,min:a,max:r,stats:{mean:e.mean(t.values),median:e.median(t.values.sort(((t,e)=>t-e))),bimodality:u(t.values)},values:i,scale:n,area:e.area().curve(e.curveBasis).y0((t=>n(-t.y))).y1((t=>n(t.y)))}}))),s._widget.update=n(s._widget.update,(t=>{const r=s._chart.data.map((t=>t.name)),i=[e.min(s._chart.data.map((t=>t.min))),e.max(s._chart.data.map((t=>t.max)))],n=.05*(i[1]-i[0]);i[1]+=n,i[0]-=n,g.horizontal=s._horizontal.on(),g.scales=s._horizontal.scales(),g.scales.x.range([0,parseInt(s._widget.size.innerWidth)]).domain(g.horizontal?s._yRange.range(i):r),g.scales.y.range([parseInt(s._widget.size.innerHeight),0]).domain(g.horizontal?r:s._yRange.range(i));const o=g.violinWidth/2-.5,l=g.horizontal?"":"rotate(90)";s._chart.plotGroups({enter:t=>(t.style("opacity",0).on("mouseover.violin",(t=>{g.current=t})).on("mouseleave.violin",(()=>{g.current=void 0})).style("color",s._color.mapper),t.append("path").attr("class","violin").attr("transform",(t=>`translate(${g.horizontal?0:g.scales.x(t.name)+o}, ${g.horizontal?g.scales.y(t.name)-o:0}) ${l}`)).attr("d",(t=>t.area.x((t=>g.horizontal?g.scales.x(t.x):g.scales.y(t.x)))(t.values))).attr("stroke","currentColor").attr("fill","currentColor").style("fill-opacity",0),t),update:t=>(t.style("opacity",1).style("color",s._color.mapper),t.select(".violin").attr("transform",(t=>`translate(${g.horizontal?0:g.scales.x(t.name)+o}, ${g.horizontal?g.scales.y(t.name)-o:0}) ${l}`)).attrTween("d",(function(t){const r=e.select(this).attr("d"),i=t.area.x((t=>g.horizontal?g.scales.x(t.x):g.scales.y(t.x)))(t.values);return a.interpolatePath(r,i,null)})).attr("stroke-width",(t=>s._lineWidth.mapping(t.name))).style("fill-opacity",s._opacity.value()),t),exit:t=>t.style("opacity",0)},t)}),!0),l=Object.assign(l||{},{violinWidth:(t=30)=>(g.violinWidth=t,s._chart.data.map((t=>Object.assign(t,{scale:t.scale&&t.scale.range([g.violinWidth/2-1,0]),area:t.area&&t.area.y0((e=>t.scale(-e.y))).y1((e=>t.scale(e.y)))}))),l),bandwidth:(t=1)=>(g.bandwidth=t,s._chart.data.forEach(((t,e)=>{const{values:a,scale:r}=p(g.data[e].values);Object.assign(t,{values:a,scale:r,area:t.area&&t.area.y0((t=>r(-t.y))).y1((t=>r(t.y)))})})),l)}),l},Object.defineProperty(t,"__esModule",{value:!0})}));
