// https://www.npmjs.com/package/dalian v0.3.0 Copyright 2020 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],t):t((e=e||self).dalian={},e.d3,e.d3)}(this,(function(e,t,a){"use strict";var r=(e,t,a=!1)=>{const r=e;return(...e)=>{a?(t(...e),r(...e)):(r(...e),t(...e))}},i=(e,...t)=>{const{self:a,api:r}=e;return t.reduce((e,t)=>{const i=t(e.self,e.api);return{self:Object.assign(a,i.self),api:Object.assign(r,i.api)}},{self:a,api:r})},n=e=>(""+e).replace(/ /g,"__");function o(e){const t=window.getComputedStyle(e),a={};for(let e=0;e<t.length;e++)a[t[e]]=t.getPropertyValue(t[e]);return a}function l(e,t){for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e.style[a]=t[a])}const s=document.createElement("canvas"),c=s.getContext("2d"),d=document.createElement("div");d.style.opacty=0;const p=document.createElement("img");var u=async(e,t=3,a="png",r=.92)=>{const i=(new window.XMLSerializer).serializeToString(e),n=function(e){d.appendChild(e),document.body.appendChild(d);const t=e.getBoundingClientRect();return document.body.removeChild(d),t}(e);return s.width=n.width*t,s.height=n.height*t,s.style.width=n.width+"px",s.style.height=n.height+"px",c.scale(t,t),p.setAttribute("src","data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(i)))),new Promise(e=>{p.onload=()=>{c.drawImage(p,0,0),e(s.toDataURL("image/"+a,r))}})};const m=document.createElement("a");var h=["#333333","#0072b2","#56b4e9","#009e73","#f0e442","#e69f00","#d55e00","#cc79a7"],g=["#77aadd","#99ddff","#44bb99","#bbcc33","#aaaa00","#eedd88","#ee8866","#ffaabb","#dddddd"],y="#eee",x=["#364b9a","#4a7bb7","#6ea6cd","#98cae1","#c2e4ef","#eaeccc","#feda8b","#fdb366","#f67e4b","#dd3d2d","#a50026"],f="#eee",v=["#fefbe9","#fcf7d5","#f5f3c1","#eaf0b5","#ddecbf","#d0e7ca","#c2e3d2","#b5ddd8","#a8d8dc","#9bd2e1","#8dcbe4","#81c4e7","#7bbce7","#7eb2e4","#88a5dd","#9398d2","#9b8ac4","#9d7db2","#9a709e","#906388","#805770","#684957","#46353a"];const b={protan:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deutan:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritan:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}};function _(e){return{r:3.063218*e.x-1.393325*e.y-.475802*e.z,g:-.969243*e.x+1.875966*e.y+.041555*e.z,b:.067871*e.x-.228834*e.y+1.069251*e.z}}function w(e,a){let r=1.75,i=2.75;return t.rgb((r*a.r+e.r)/i,(r*a.g+e.g)/i,(r*a.b+e.b)/i)}function k(e){let a=Math.round(.299*e.r+.587*e.g+.114*e.b);return t.rgb(a,a,a)}function z(e,a){let r={r:Math.pow(e.r/255,2.2),g:Math.pow(e.g/255,2.2),b:Math.pow(e.b/255,2.2)};var i;r={x:.430574*(i=r).r+.34155*i.g+.178325*i.b,y:.222015*i.r+.706655*i.g+.07133*i.b,z:.020183*i.r+.129553*i.g+.93918*i.b};const n=r.x+r.y+r.z;r.u=0,r.v=0,0!==n&&(r.u=r.x/n,r.v=r.y/n);let o,l=.312713*r.y/.329016,s=.358271*r.y/.329016,c={y:0};o=r.u<b[a].cpu?(b[a].cpv-r.v)/(b[a].cpu-r.u):(r.v-b[a].cpv)/(r.u-b[a].cpu);let d=r.v-r.u*o;c.u=(b[a].ayi-d)/(o-b[a].am),c.v=o*c.u+d;let p={x:c.u*r.y/c.v,y:r.y,z:(1-(c.u+c.v))*r.y/c.v};c.x=l-p.x,c.z=s-p.z,c=_(c),p=_(p);const u={r:c.r?((p.r<0?0:1)-p.r)/c.r:0,g:c.g?((p.g<0?0:1)-p.g)/c.g:0,b:c.b?((p.b<0?0:1)-p.b)/c.b:0},m=Math.max(u.r>1||u.r<0?0:u.r,u.g>1||u.g<0?0:u.g,u.b>1||u.b<0?0:u.b);p.r=p.r+m*c.r,p.g=p.g+m*c.g,p.b=p.b+m*c.b;const h=e=>255*(e<=0?0:e>=1?1:Math.pow(e,1/2.2));return t.rgb(h(p.r),h(p.g),h(p.b))}const M={protanopia:e=>z(e,"protan"),protanomaly:e=>w(e,z(e,"protan")),deuteranopia:e=>z(e,"deutan"),deuteranomaly:e=>w(e,z(e,"deutan")),tritanopia:e=>z(e,"tritan"),tritanomaly:e=>w(e,z(e,"tritan")),achromatopsia:e=>k(e),achromatomaly:e=>w(e,k(e))};const j="categorical",O="sequential",A="diverging";function F(e){switch(e){default:case j:return h;case O:return v;case A:return x}}function C(e){switch(e){default:case j:return"#fff";case O:return f;case A:return y}}var $=(e,a)=>{const r={policy:j,on:e=>e.name},i={policy:r.policy,palette:F(r.policy),missing:C(r.policy),deficiency:void 0,on:r.on,scale:e=>e,buildMapper(){const e=function(e,t){if("string"==typeof e)return t(e)+"";if(Array.isArray(e))return e.map(t);{const a={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=t(e[r]));return a}}(i.palette||F(i.policy),(a=i.deficiency,void 0===M[a]?e=>e:e=>M[a](t.rgb(e))));var a;const r=e=>{const t=i.on(e);return null===t?null:i.scale(t)};switch(i.policy){default:case j:return n=e,o=i.missing,l=r,"string"==typeof n?()=>n:Array.isArray(n)?(()=>{const e=[];return t=>{const a=l(t);if(null===a)return o;{const t=e.indexOf(a);return n[t>-1?t:e.push(a)-1]}}})():"object"==typeof n?e=>{const t=l(e);return null===t?o:n[t]}:void 0;case O:return function(e,a,r){if("string"==typeof e||Array.isArray(e)||(console.warn(`Palette type (${typeof e}) is incompatible with ${O} color policy, fallback to default color palette.`),e=F(O)),"string"==typeof e){const i=t.interpolateRgb("#fff",e);return e=>{const t=r(e);return null===t?a:i(t)}}if(Array.isArray(e)){const i=t.piecewise(t.interpolateRgb.gamma(2.2),e);return e=>{const t=r(e);return null===t?a:i(t)}}}(e,i.missing,r);case A:return function(e,a,r){Array.isArray(e)||(console.warn(`Palette type (${typeof e}) is incompatible with ${A} color policy, fallback to default color palette.`),e=F(A));const i=t.piecewise(t.interpolateRgb.gamma(2.2),e);return e=>{const t=r(e);return i((t+1)/2)}}(e,i.missing,r)}var n,o,l}};return e=Object.assign(e||{},{_color:{init(t,a){i.policy=t,i.on=a,i.palette=F(t),i.missing=C(t),e._color.mapper=i.buildMapper()},scale(t){i.scale=t,e._color.mapper=i.buildMapper()},mapper:i.buildMapper()}}),a=Object.assign(a||{},{color:{policy:(t=r.policy)=>(i.policy=t,e._color.mapper=i.buildMapper(),a),palette(t,r){if("string"==typeof t&&t.startsWith("palette-"))switch(t){case"palette-wong":i.palette=h;break;case"palette-light":i.palette=g;break;case"palette-sunset":i.palette=x;break;case"palette-iridescent":i.palette=v}else i.palette=t;return i.missing=r||"#fff",e._color.mapper=i.buildMapper(),a},deficiency:t=>(i.deficiency=t,e._color.mapper=i.buildMapper(),a),on:(t=r.on)=>(i.on=t,e._color.mapper=i.buildMapper(),a)}}),{self:e,api:a}},S=(e,t)=>{for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.style(a,t[a]);return e},T=(e,a)=>{const r={id:e._widget.id+"-description",getDescription:()=>void 0===r.elem||r.elem.empty()?S(t.select("body").append("div").attr("id",r.id),{position:"absolute",left:t.event.pageX+20+"px",top:t.event.pageY-20+"px",width:"auto","max-width":"500px",padding:"10px",background:"#fff","box-shadow":"0 0 3px #000","border-radius":"3px",color:"#000","font-size":".8em","font-family":"inherit","line-height":"1.35em","pointer-events":"none"}):r.elem,removeDescription:()=>{void 0===r.elem||r.elem.empty()||(r.elem.remove(),delete r.elem)}};return a=Object.assign(a||{},{description:i=>(void 0===i?e._widget.container.on("contextmenu.description",null):e._widget.container.on("contextmenu.description",()=>{t.event.preventDefault(),r.elem=r.getDescription().html(i)}).on("mouseleave.description",()=>{r.removeDescription()}),a)}),{self:e,api:a}},D=(e,t)=>{const a=12,i="black";return(e=Object.assign(e||{},{_font:{size:a+"px",color:i}}))._widget.update=r(e._widget.update,()=>{e._widget.container.style("font-size",e._font.size).style("color",e._font.color)},!0),t=Object.assign(t||{},{font:{size:(r=a)=>(e._font.size=r+"px",t),color:(a=i)=>(e._font.color=a,t)}}),{self:e,api:t}},W=(e,t)=>{const a={callbacks:{}};return{self:e=Object.assign(e||{},{_mouse:{over:(...e)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...e)},leave:(...e)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...e)},click:(...e)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...e)},isEnabled:e=>"function"==typeof a.callbacks[e],hasAny:()=>Object.values(a.callbacks).reduce((e,t)=>e||"function"==typeof t,!1)}}),api:t=Object.assign(t||{},{mouse:{over:e=>(a.callbacks.over=e,t),leave:e=>(a.callbacks.leave=e,t),click:e=>(a.callbacks.click=e,t)}})}},R=(e,t)=>{const a={id:e._widget.id+"-placeholder"};return e._widget.update=r(e._widget.update,t=>{void 0!==a.elem&&a.elem.style("font-size","inherit").transition().duration(t).style("width",e._widget.size.width).style("height",e._widget.size.height).style("color","inherit")}),t=Object.assign(t||{},{placeholder:(r,i=0)=>(void 0===r?(e._widget.content.style("display","block").transition().duration(i).style("opacity",1),e._widget.disable(!1),void 0===a.elem||a.elem.empty()||(a.elem.transition().duration(i).style("opacity",0).remove(),delete a.elem)):(e._widget.content.transition().duration(i).style("opacity",0).on("end",()=>{e._widget.content.style("display","none")}),e._widget.disable(!0),(void 0===a.elem||a.elem.empty())&&(a.elem=e._widget.container.append("div").attr("id",a.id).attr("class","dalian-placeholder"),S(a.elem,{display:"table",position:"absolute",width:e._widget.size.width,height:e._widget.size.height,left:0,top:0,color:"inherit","font-family":"inherit","font-size":"inherit","pointer-events":"none"}),S(a.elem.append("span"),{display:"table-cell","vertical-align":"middle","line-height":"normal","text-align":"center",color:"inherit","font-family":"inherit","font-size":"inherit",opacity:0}).html(r).transition().duration(i).style("opacity",1))),t)}),{self:e,api:t}};const I=document.createElement("canvas"),E=I.getContext("2d");function H(e,t,a){const r=a,i=200+E.measureText(e).width,n=200+r;!function(e,t){I.style.width=e+"px",I.width=e,I.style.height=t+"px",I.height=t}(i,n),E.font=a+"px "+t,E.fillStyle="#fff",E.fillRect(0,0,i,n),E.fillStyle="#000",E.fillText(e,100,100+r);const o=E.getImageData(0,0,i,n).data.filter((e,t)=>t%4==0),l=Math.floor(o.findIndex(e=>e<255)/i);return o.reverse(),{min:l,max:n-Math.floor(o.findIndex(e=>e<255)/i)}}var P=(e,a,r,i)=>{const n={x:0,y:0},o={width:300,height:200},l=0,s={parent:t.select(r),initialized:!1,pos:{x:{attr:"left",ignore:"right",value:n.x+"px"},y:{attr:"top",ignore:"bottom",value:n.y+"px"}}},c={};c._widget={id:`dalian-widget-${e}-${a}`,container:void 0,size:{width:o.width+"px",height:o.height+"px",innerWidth:o.width+"px",innerHeight:o.height+"px"},margins:{left:l,right:l,top:l,bottom:l},transition:!1,disabled:!1,getMouse:()=>{const e=t.mouse(c._widget.container.node());return[e[0]-c._widget.margins.left,e[1]-c._widget.margins.top]},getElem:(e,t)=>s.initialized?e.transition().duration(t):(setTimeout(()=>{s.initialized=!0},t),e),getStyle:()=>window.getComputedStyle(c._widget.container.node()),getFontMetrics:()=>(e=>{const t=H("x",e,100),a=H("y",e,100),r=H("h",e,100),i=H("H",e,100),n=t.max-t.min;return{xHeight:n/100,capHeight:(i.max-i.min)/100,descender:(a.max-a.min-n)/100,ascender:(r.max-r.min)/100}})(window.getComputedStyle(c._widget.container.node()).fontFamily),update:e=>{c._widget.getElem(c._widget.container,e).style(s.pos.x.ignore,null).style(s.pos.x.attr,s.pos.x.value).style(s.pos.y.ignore,null).style(s.pos.y.attr,s.pos.y.value).style("width",c._widget.size.width).style("height",c._widget.size.height)},disable:e=>{c._widget.disabled=e}};try{c._widget.container=s.parent.append("div").attr("id",c._widget.id).attr("class","dalian-widget dalian-widget-"+e),S(c._widget.container,{position:"absolute",width:c._widget.size.width,height:c._widget.size.height,left:s.pos.x+"px",top:s.pos.y+"px","font-family":"inherit","font-size":"inherit","font-color":"inherit"}),c._widget.content=c._widget.container.append(i).attr("class","dalian-widget-content"),S(c._widget.content,{position:"absolute",width:"100%",height:"100%",left:0,top:0,"font-family":"inherit","font-size":"inherit","font-color":"inherit","pointer-events":"none"})}catch(e){throw Error("MissingDOMException: DOM is not present.")}const d={x:(e=n.x)=>(s.pos.x.attr=e>=0?"left":"right",s.pos.x.ignore=e>=0?"right":"left",s.pos.x.value=Math.abs(e)+"px",d),y:(e=n.y)=>(s.pos.y.attr=e>=0?"top":"bottom",s.pos.y.ignore=e>=0?"bottom":"top",s.pos.y.value=Math.abs(e)+"px",d),width:(e=o.width)=>(c._widget.size.width=e+"px",c._widget.size.innerWidth=e-c._widget.margins.left-c._widget.margins.right+"px",d),height:(e=o.height)=>(c._widget.size.height=e+"px",c._widget.size.innerHeight=e-c._widget.margins.top-c._widget.margins.bottom+"px",d),margins:(e=l)=>{switch(typeof e){case"undefined":default:c._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":c._widget.margins={left:e,right:e,top:e,bottom:e};break;case"object":c._widget.margins=Object.assign(c._widget.margins,e)}return c._widget.size.innerWidth=parseInt(c._widget.size.width)-c._widget.margins.left-c._widget.margins.right+"px",c._widget.size.innerHeight=parseInt(c._widget.size.height)-c._widget.margins.top-c._widget.margins.bottom+"px",d},render:e=>(c._widget.update(e),d)};return{self:c,api:d}},L=(e,t,a,s="svg")=>{let{self:c,api:d}=i(P(e,t,a,s),$,T,R,D,W);const p=(()=>{const e=t+"-dalian-plots-clipper";return{clipId:e,clip:c._widget.content.append("defs").append("clipPath").attr("id",e).append("rect").attr("x",0).attr("y",0).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),update:e=>{c._widget.getElem(p.clip,e).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),c._widget.getElem(c._chart.plots,e).attr("width",c._widget.size.innerWidth+"px").attr("height",c._widget.size.innerHeight+"px").attr("transform","translate("+c._widget.margins.left+","+c._widget.margins.top+")")}}})();return c=Object.assign(c||{},{_chart:{data:[],plots:c._widget.content.append("g").attr("class","dalian-plots-container"),plotSelectors:[],clipId:p.clipId,transformData:e=>e,plotGroups:(e,t)=>{let a=c._chart.plots.selectAll(".plot-group").data(c._chart.data,e=>e.name).join(t=>{const a=t.append("g").attr("class",e=>"plot-group "+n(e.name)).attr("clip-path",`url(#${p.clipId})`).style("shape-rendering","geometricPrecision");return e.enter?e.enter(a):a},e=>e,a=>{let r=a.transition().duration(t);r=e.exit?e.exit(r):r,r.remove()}).on("mouseover.chart",c._mouse.over).on("mouseleave.chart",c._mouse.leave).on("click.chart",c._mouse.click).each(()=>{c._chart.plots.style("pointer-events","none"),c._widget.transition=!0});a=e.updateBefore?e.updateBefore(a):a,a=a.transition().duration(t),a=e.update?e.update(a):a,a.on("end",()=>{c._chart.plots.style("pointer-events",c._tooltip&&c._tooltip.isOn()||c._mouse.hasAny()?"all":"none"),c._widget.transition=!1})}}}),c._widget.update=r(c._widget.update,p.update),d=Object.assign(d,{data:e=>(c._chart.data=c._chart.transformData(e),d),download:async e=>{const t=(e=>{const t=Array.from(e.querySelectorAll("*")).map(o),a=e.cloneNode(!0);return l(a,o(e)),a.querySelectorAll("*").forEach((e,a)=>l(e,t[a])),a.style.backgroundColor=e.parentNode.style.backgroundColor||"#fff",a})(c._widget.content.node());((e,t,a)=>{m.download=`${t}.${a}`,m.href=e,document.body.appendChild(m),m.click(),document.body.removeChild(m)})(await u(t),e,"png")}}),{self:c,api:d}},q=(e,t)=>{for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.attr(a,t[a]);return e},X=(e,t,a,i,n)=>{let o=t._widget.content.append("g").attr("class","dalian-axis-container "+e).style("font-family","inherit").style("font-size","inherit"),l=o.append("g").attr("class","axis "+e).style("font-family","inherit").style("font-size","inherit");l.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");let s={margin:{left:0,top:0,right:0,bottom:0},format:e=>e,values:null,scale:i,container:o,ticks:!0,tickAnchor:null,axisLine:!0,update:e=>{t._widget.getElem(s.container,e).attr("transform","translate("+(t._widget.margins.left+s.margin.left-s.margin.right)+","+(t._widget.margins.top+s.margin.top-s.margin.bottom)+")").style("width",t._widget.size.innerWidth).style("height",t._widget.size.innerHeight),c.fn.scale(s.scale.scale).tickFormat(s.format).tickSize(s.ticks?6:0).tickPadding(s.ticks?3:9).tickValues(s.values||null),t._widget.getElem(c.axis,e).call(c.fn).selectAll("path").style("opacity",s.axisLine?1:0),l.selectAll(".tick > text").attr("text-anchor",s.tickAnchor)}};t._widget.update=r(t._widget.update,s.update);let c={fn:a().ticks(5),axis:l,margin:e=>(s.margin=Object.assign(s.margin,e),c),label:q(o.append("text").attr("class","axis-label "+e).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text(""),n),tickAnchor:e=>(s.tickAnchor=e||null,c),scale:e=>(s.scale=e,c),hideAxisLine:e=>(s.axisLine=!e,c),hideTicks:e=>(s.ticks=!e,c),format:(e=(e=>e))=>(s.format=e,c),values:(e=null)=>(s.values=e,c)};return c},B=e=>(a,i)=>{let n=X("x",a,t.axisBottom,e,{"text-anchor":"end",dy:"2.5em"}),o=e=>{a._widget.getElem(n.axis,e).attr("transform",`translate(0, ${parseFloat(a._widget.size.innerHeight)})`),a._widget.getElem(n.label,e).attr("x",a._widget.size.innerWidth).attr("y",parseFloat(a._widget.size.innerHeight)+"px")};return(a=Object.assign(a||{},{_bottomAxis:n}))._widget.update=r(a._widget.update,o),i=Object.assign(i||{},{bottomAxis:{label:(e="")=>(n.label.text(e),i),format:e=>(n.format(e),i),values:e=>(n.values(e),i),hideTicks:e=>(n.hideTicks(e),i),hideAxisLine:e=>(n.hideAxisLine(e),i)}}),{self:a,api:i}},Y=e=>(a,r)=>{const i={selectors:e,highlightSelection:(e,r,i)=>{if(a._widget.transition)return;const o=a._highlight.container.selectAll(e).interrupt();if("string"==typeof r)o.transition().duration(i).style("opacity",(function(){return t.select(this).classed(n(r))?1:.1}));else if(Array.isArray(r)){const e=r.map(n);o.transition().duration(i).style("opacity",(function(){const a=t.select(this);return e.reduce((e,t)=>e||a.classed(t),!1)?1:.1}))}else o.transition().duration(i||0).style("opacity",1)}};return a=Object.assign(a||{},{_highlight:{container:void 0,selectors:void 0}}),r=Object.assign(r||{},{highlight:(e,t=0)=>{if(void 0===a._highlight.container)throw Error("Highlight.container is not specified");return i.selectors.forEach(a=>i.highlightSelection(a,e,t)),r}}),{self:a,api:r}},G=e=>(a,r)=>{let i=X("y",a,t.axisLeft,e,{"text-anchor":"begin",x:"5px",y:"-5px"});return{self:a=Object.assign(a||{},{_leftAxis:i}),api:r=Object.assign(r||{},{leftAxis:{label:(e="")=>(i.label.text(e),r),format:e=>(i.format(e),r),values:e=>(i.values(e),r),hideTicks:e=>(i.hideTicks(e),r),hideAxisLine:e=>(i.hideAxisLine(e),r)}})}},V=e=>(t,a)=>{const i={containers:{background:void 0},objects:new Map,getContainer:(e="background")=>(void 0===i.containers[e]&&(i.containers[e]=t._chart.plots.append("g").attr("class","objects-container").attr("clip-path",`url(#${t._chart.clipId})`),"background"===e?i.containers[e].lower():i.containers[e].raise()),i.containers[e])};return t._widget.update=r(t._widget.update,e=>{i.objects.forEach(t=>t.update(e))}),a=Object.assign(a||{},{objects:{add:(t,r,n,o={},l=0)=>{const s=e.x.scale,c=e.y.scale,d=i.getContainer(o.foreground?"foreground":"background").append("g").attr("transform",`translate(${s(n.x)}, ${c(n.y)})`).style("opacity",0);d.node().appendChild(r),i.objects.has(t)?(a.objects.remove(t,l),d.transition().duration(l).style("opacity",1)):d.transition().duration(l).style("opacity",1);const p={g:d,remove:e=>{d.transition().duration(e).style("opacity",0).on("end",()=>{d.remove()})},update:e=>{d.transition().duration(e).attr("transform",`translate(${s(n.x)}, ${c(n.y)})`)}};return i.objects.set(t,p),a},remove:(e,t=0)=>(null==e&&(i.objects.forEach(e=>e.remove(t)),i.objects.clear()),i.objects.has(e)&&(i.objects.get(e).remove(t),i.objects.delete(e)),a)}}),{self:t,api:a}},J=e=>(t,a)=>{const r={value:e};return{self:t=Object.assign(t||{},{_opacity:{value:()=>r.value}}),api:a=Object.assign(a||{},{opacity:(t=e)=>(r.value=t||e,a)})}},N=(e,t)=>{const a={markers:new Map};return(e=Object.assign(e||{},{_plotMarker:{add(t,r,i,o,l){a.markers.set(i,a.markers.get(i)||e._chart.plots.append("circle")),q(a.markers.get(i),{class:"plot-marker "+n(o.name),cx:t,cy:r,r:l||4}),S(a.markers.get(i),{stroke:"white",fill:e._color.mapper(o),"pointer-events":"none"})},remove(e){void 0===e?a.markers.forEach((e,t)=>{e.remove(),a.markers.delete(t)}):a.markers.has(e)&&(a.markers.get(e).remove(),a.markers.delete(e))}}}))._widget.update=r(e._widget.update,()=>{e._widget.container.on("mouseout.plot-marker",e._plotMarker.remove)}),{self:e,api:t}},U=(e,a)=>{const i=!1;let n={container:{id:"dalian-tooltip-container"},id:e._widget.id+"-tooltip",on:i,getContainer:()=>{let a=t.select("#"+n.container.id);return a.empty()&&(a=t.select("body").append("div").attr("id",n.container.id)),a.style("color",e._font.color),a},getTooltip:(t,a)=>void 0===n.elem||n.elem.empty()?S(n.container.elem.append("div").attr("id",n.id),{position:"absolute","background-color":"rgba(255, 255, 255, 0.95)","border-radius":"2px","box-shadow":"1px 1px 2px #888, 0 0 1px #aaa",color:"currentColor","pointer-events":"none","font-family":"inherit","font-size":.9*parseFloat(e._font.size)+"px",width:"auto","min-width":"80px","line-height":"1",left:(t.left+t.right)/2+a.left+"px",top:(t.top+t.bottom)/2+a.top+"px","z-index":9999}):n.elem.style("font-size",.9*parseFloat(e._font.size)+"px"),hideTooltip:()=>{void 0!==n.elem&&n.elem.style("opacity",0)},showTooltip:()=>{let a=t.event.pageX,r=t.event.pageY,i=e._widget.container.node().getBoundingClientRect(),o={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(a<i.left+e._widget.margins.left-o.left||a>i.right-e._widget.margins.right+o.left||r<i.top+e._widget.margins.top-o.top||r>i.bottom-e._widget.margins.bottom+o.top)return e._tooltip.builder(),void n.hideTooltip();n.container.elem=n.getContainer(),n.elem=n.getTooltip(i,o);let l=e._tooltip.builder(e._tooltip.content(e._widget.getMouse()));if(void 0===l){if(void 0!==n.elem)return void n.hideTooltip()}else n.elem.html(l);let s=n.elem.node().getBoundingClientRect(),c=s.width,d=s.height,p=a+20,u=r+20;p+c>i.right-e._widget.margins.right+o.left-10&&(p-=c+o.left+40),u+d>i.bottom-e._widget.margins.bottom+o.top-10&&(u=i.bottom-e._widget.margins.bottom+o.top-10-d),n.elem.style("left",p+"px").style("top",u+"px").style("opacity",1)}};return e._widget.update=r(e._widget.update,()=>{e._widget.container.style("pointer-events",n.on?"all":null).on("mousemove.tooltip",()=>n.on&&!e._widget.disabled&&n.showTooltip()).on("mouseout.tooltip",n.hideTooltip)}),e=Object.assign(e||{},{_tooltip:{isOn:()=>n.on,content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented")}}),a.tooltip={on:(e=i)=>(n.on=e,a)},{self:e,api:a}},K=(e,a)=>{const r={ignore:[],titleFormat:e=>e,valueFormat:e=>e.y};let i=U(e,a),n={titleFormat:r.titleFormat,valueFormat:r.valueFormat};return e._tooltip=Object.assign(i.self._tooltip,{ignore:[],builder:a=>{if(void 0===a)return void e._tooltip.content();let r=S(t.select(document.createElement("div")),{display:"table",padding:"10px","min-width":"60px"});S(r.append("div"),{display:"table-row",position:"relative"}).text(n.titleFormat(a.title));const i=.8*parseFloat(e._font.size);return a.content.data.forEach((t,a)=>{let o=S(r.append("div"),{display:"table-row",position:"relative"}),l=S(o.append("div"),{display:"inline-block",position:"relative",height:e._font.size,"margin-top":(0===a?6:3)+"px"}),s=S(l.append("div"),{display:"flex",position:"relative","justify-content":"center","align-items":"center",height:e._font.size});S(s.append("div"),{display:"inline-block",position:"relative",float:"left",width:i+"px",height:i+"px","margin-right":"6px","border-radius":"2px",background:t.background}),S(s.append("div"),{display:"table-cell",position:"relative","max-width":"120px",float:"left","line-height":i+"px"}).html(n.valueFormat(t))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{ignore:(t=r.ignore)=>(e._tooltip.ignore=t,a),titleFormat:(e=r.titleFormat)=>(n.titleFormat=e,a),valueFormat:(e=r.valueFormat)=>(n.valueFormat=e,a)}),{self:e,api:a}},Q=(e="linear")=>{const a={type:e,scale:(()=>{switch(e){default:case"linear":return t.scaleLinear();case"sqrt":return t.scalePow().exponent(.5);case"band":return t.scaleBand().padding(.1);case"point":return t.scalePoint().padding(.5)}})()},r={scale:a.scale,range:(e,t)=>(a.scale.range([e,t]),r),domain:e=>{switch(a.type){default:case"linear":case"sqrt":a.scale.domain([Math.min(...e),Math.max(...e)]);break;case"band":case"point":a.scale.domain(e)}return r},type:e=>{if(void 0===e)return a.type;switch(e){default:case"linear":a.scale=t.scaleLinear();break;case"sqrt":a.scale=t.scalePow().exponent(.5);break;case"band":a.scale=t.scaleBand().padding(.1);break;case"point":a.scale=t.scalePoint().padding(.5)}},measure:e=>Math.abs(a.scale.invert(e)-a.scale.invert(0))};return r},Z=(e,a)=>{const r=!1,i={on:r};return{self:e=Object.assign(e||{},{_smoothing:{curve:()=>i.on?t.curveMonotoneX:t.curveLinear}}),api:a=Object.assign(a||{},{smoothing:(e=r)=>(i.on=e,a)})}},ee=()=>{let e={min:void 0,max:void 0,compressMax:0,compressMin:0};return{min:t=>e.min=t,max:t=>e.max=t,compressMin:t=>e.compressMin=Math.abs(t||0),compressMax:t=>e.compressMax=Math.abs(t||0),range:t=>{let a=void 0!==e.min?e.min:Math.min(...t),r=void 0!==e.max?e.max:Math.max(...t),i=r-a;return a-=e.compressMin>0?e.compressMin*i:0,r+=e.compressMax>0?e.compressMax*i:0,[a,r]},contains:t=>(void 0===e.min||t>=e.min)&&(void 0===e.max||t<=e.max)}},te=(e,t)=>{let a=ee();return{self:e=Object.assign(e||{},{_yRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{yRange:{min:e=>(a.min(e),t),compressMin:(e=0)=>(a.compressMin(e),t),max:e=>(a.max(e),t),compressMax:(e=0)=>(a.compressMax(e),t)}})}};const ae=document.createElement("canvas").getContext("2d");function re(e,t){return ae.font=t.fontSize+" "+t.fontFamily,{width:ae.measureText(e).width,height:parseFloat(t.fontSize)}}var ie=e=>(e=>{const a=t.color(e);return.229*a.r+.587*a.g+.114*a.b})(e)>150?"#000":"#fff",ne=(e,a)=>{const r={titleFormat:e=>e,labelFormat:e=>e+":",valueFormat:e=>e};let i=U(e,a),n={titleFormat:r.titleFormat,labelFormat:r.labelFormat,valueFormat:r.valueFormat};return e._tooltip=Object.assign(i.self._tooltip,{builder:a=>{if(void 0===a)return void e._tooltip.content();let r=S(t.select(document.createElement("div")),{"border-radius":"2px",padding:.7*parseFloat(e._font.size)+"px","font-family":"inherit","border-left":a.stripe?"solid 4px "+a.stripe:null});return S(r.append("div"),{position:"relative","line-height":parseFloat(e._font.size)+"px",margin:"2px","margin-bottom":"10px"}).html(n.titleFormat(a.title)),a.content.data.forEach(t=>{let a=S(r.append("div"),{position:"relative",height:.9*parseFloat(e._font.size)+"px",margin:"2px","padding-right":"10px","line-height":e._font.size});S(a.append("div"),{position:"relative",float:"left","margin-right":"10px"}).html(n.labelFormat(t.name)),S(a.append("span"),{position:"relative",float:"right"}).html(n.valueFormat(t.value,t.name))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(e=r.titleFormat)=>(n.titleFormat=e,a),labelFormat:(e=r.labelFormat)=>(n.labelFormat=e,a),valueFormat:(e=r.valueFormat)=>(n.valueFormat=e,a)}),{self:e,api:a}},oe=e=>(t,a)=>{const r=!1,i={on:r,scales:{x:e.x,y:e.y}};return t=Object.assign(t||{},{_horizontal:{on:()=>i.on,scales:()=>i.scales}}),a=Object.assign(a||{},{horizontal:(n=r)=>(i.on=n,i.scales.x=n?e.y:e.x,i.scales.y=n?e.x:e.y,t._bottomAxis.scale(i.scales.x),t._leftAxis.scale(i.scales.y),void 0!==t._yGrid&&t._yGrid.type(n?"x":"y"),a)}),{self:t,api:a}},le=(e,t)=>{const a={format:()=>""};return e=Object.assign(e||{},{_label:{show:!1,format:a.format}}),t=Object.assign(t||{},{label:r=>(e._label.show=null!=r,e._label.format=r||a.format,t)}),{self:e,api:t}},se=e=>(t,a)=>{let i={defaults:{opacity:.3,lineStyle:"4 8"},type:e,on:!1,grid:void 0,opacity:void 0,lineStyle:void 0,update:e=>{if(i.on){void 0===i.grid&&(i.grid=t._chart.plots.insert("g",":first-child").attr("class","grid").style("opacity",0).style("stroke","currentColor").style("stroke-width","1px"));const a="x"===i.type?t._bottomAxis.fn:t._leftAxis.fn,r="x"===i.type?parseFloat(t._widget.size.innerHeight):-parseFloat(t._widget.size.innerWidth);i.grid.transition().duration(e).call(a.tickSizeInner(r).tickFormat("")).style("stroke-opacity",i.opacity||i.defaults.opacity).style("stroke-dasharray",i.lineStyle||i.defaults.lineStyle).style("opacity",1),i.grid.select("path").remove()}else void 0!==i.grid&&(i.grid.transition().duration(e).style("opacity",0).remove(),i.grid=void 0)}};t._widget.update=r(t._widget.update,i.update);let n={type:e=>{i.type=e,i.grid&&(i.grid.remove(),i.grid=void 0)}};const o={on:e=>(i.on=e,a),opacity:e=>(i.opacity=e,a),lineStyle:e=>{switch(e){case"solid":i.lineStyle="1 0";break;case"dashed":default:i.lineStyle="4 8";break;case"dotted":i.lineStyle="2 5"}return a}};return a=Object.assign(a||{},"x"===e?{xGrid:o}:{yGrid:o}),{baseSelf:n,self:t,api:a}},ce=(e,t)=>{let a=se("y")(e,t);return{self:e=Object.assign(e||{},{_yGrid:a.baseSelf}),api:a.api}},de=e=>(t,a)=>{const r={mapping:()=>e+"px"};return{self:t=Object.assign(t||{},{_lineWidth:{mapping:e=>r.mapping(e)}}),api:a=Object.assign(a||{},{lineWidth:(t=e)=>(r.mapping="number"==typeof t?()=>t+"px":a=>(t[a]||e)+"px",a)})}},pe=(e,t)=>{let a=ee();return{self:e=Object.assign(e||{},{_xRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{xRange:{min:e=>(a.min(e),t),compressMin:(e=0)=>(a.compressMin(e),t),max:e=>(a.max(e),t),compressMax:(e=0)=>(a.compressMax(e),t)}})}};const ue=(e,t,a)=>new Date(Date.UTC(e,t,a)),me=e=>{const t=e.split("-");return ue(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))};var he=(e,t)=>{const a={policy:void 0,getStrokeDashArray:e=>{switch(e){case"solid":default:return null;case"dashed":return"4 8";case"dotted":return"2 5"}}};return{self:e=Object.assign(e||{},{_lineStyles:{strokeDashArray:e=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[e]),style:e=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[e],background:(e,t)=>{switch(e){case"solid":default:return t;case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${t} 2px, ${t} 4px`;case"dotted":return`radial-gradient(${t} 30%, transparent 30%) 0.5px 0.5px/4px 4px, radial-gradient(${t} 30%, transparent 30%) 2.5px 2.5px/4px 4px transparent`}}}}),api:t=Object.assign(t||{},{lineStyle:e=>(a.policy=e,t)})}},ge=se("x");const ye=(e,a)=>{const r="_current"+(a||"");return function(a){const i=t.interpolate(this[r],a);return this[r]=i(0),t=>e(i(t),a)}};e.AreaChart=(e,n="body")=>{const o={x:Q("linear"),y:Q("linear")};let{self:l,api:s}=i(L("area-chart",e,n),G(o.y),B(o.x),N,V(o),J(.4),Z,K,Y([".plot-group",".plot-marker"]),te);const c={scales:o,lineColor:null,update(e){const r=l._chart.data.map(e=>e.values).flat(),i=r.map(e=>e.y),n=t.extent(i),o=.01*(n[1]-n[0]);n[1]+=o,c.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(r.map(e=>e.x)),c.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(l._yRange.range(n));const s=t.area().x(e=>c.scales.x.scale(e.x)).y0(c.scales.y.scale(0)).y1(e=>c.scales.y.scale(e.y)).curve(l._smoothing.curve()),d=t.line().x(e=>c.scales.x.scale(e.x)).y(e=>c.scales.y.scale(e.y)).curve(l._smoothing.curve());l._chart.plotGroups({enter:e=>(e.style("opacity",0),e.append("path").attr("class","area").attr("d",e=>s(e.values)).attr("stroke","none").attr("fill",l._color.mapper),e.append("path").attr("class","line").attr("d",e=>d(e.values)).attr("fill","none").attr("stroke",c.lineColor||l._color.mapper),e),update:e=>(e.style("opacity",1),e.select(".area").attrTween("d",(function(e){const r=t.select(this).attr("d"),i=s(e.values);return a.interpolatePath(r,i,null)})).attr("fill-opacity",l._opacity.value()),e.select(".line").attr("stroke",c.lineColor).attrTween("d",(function(e){const r=t.select(this).attr("d"),i=d(e.values);return a.interpolatePath(r,i,null)})),e),exit:e=>e.style("opacity",0)},e)}};return l._highlight.container=l._chart.plots,l._tooltip.content=e=>{if(void 0===e)return void l._plotMarker.remove();const a=t.bisector(e=>c.scales.x.scale(e.x)).left,r=e?l._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===r)return void l._plotMarker.remove();let i=c.scales.x.scale.invert(e[0]);const n=l._chart.data.filter(e=>-1===l._tooltip.ignore.indexOf(e.name)).map((e,t)=>{const a=r[t],n=e.values,o=n[a-1]?n[a-1]:n[a],s=n[a]?n[a]:n[a-1],d=i-o.x>s.x-i?s:o;return i=d.x,l._plotMarker.add(c.scales.x.scale(i),c.scales.y.scale(d.y),e.name,e),{name:e.name,background:l._color.mapper(e),x:d.x,y:d.y,lo:d.lo,hi:d.hi}});return{title:i,content:{type:"plots",data:n}}},l._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:+e.x,y:+e.y}))})),l._widget.update=r(l._widget.update,c.update,!0),s=Object.assign(s||{},{lineColor:e=>(c.lineColor=e||null,s)}),s},e.BarChart=(e,a="body")=>{const n={x:Q("band"),y:Q("linear")};let{self:o,api:l}=i(L("bar-chart",e,a),G(n.y),B(n.x),ne,Y([".plot-group"]),oe(n),le,ce);const s={current:void 0,scales:o._horizontal.scales(),horizontal:!1,measureX:(e,t,a)=>{const r=re(o._label.format(e),a),i=Math.max((t-r.height)/2,5),n=s.scales.x.scale(e.value),l=n>2*i+r.width;return{inside:l,x:l?n-i:n+i+r.width,y:s.scales.y.scale(e.name)+t/2,color:l?ie(o._color.mapper(e)):a.color}},measureY:(e,t,a)=>{const r=re(o._label.format(e),a),i=Math.max((t-r.width)/2,5),n=s.scales.y.scale(e.value),l=parseFloat(o._widget.size.innerHeight)-n>2*i+r.height;return{inside:l,x:s.scales.x.scale(e.name)+t/2,y:l?n+i:n-i-r.height,color:l?ie(o._color.mapper(e)):a.color}},update:e=>{s.scales=o._horizontal.scales();const a=o._horizontal.on(),r=o._widget.getStyle(),i=o._chart.data.map(e=>e.name),n=1.01*t.max(o._chart.data.map(e=>e.value))||1;s.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(a?[0,n]:i),s.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(a?i:[0,n]),o._chart.plotGroups({enter:e=>{const t=a?s.scales.y.scale.bandwidth():s.scales.x.scale.bandwidth();e.append("rect").attr("class","bar").on("mouseover.bar",e=>{s.current=e}).on("mouseleave.bar",()=>{s.current=void 0}).attr("x",e=>s.scales.x.scale(a?0:e.name)).attr("y",e=>s.scales.y.scale(a?e.name:0)).attr("width",a?0:t).attr("height",a?t:0).attr("fill",o._color.mapper);const i=a?s.measureX:s.measureY;return e.append("text").style("display","none").attr("class","bar-label").attr("stroke","none").style("pointer-events","none").text(o._label.format).each(e=>Object.assign(e,{_measures:i(e,t,r)})).attr("fill",e=>e._measures.color).attr("x",e=>a?s.scales.x.scale(0):e._measures.x).attr("y",e=>a?e._measures.y:s.scales.y.scale(0)),e},update:e=>{e.style("opacity",1);const t=a?s.scales.y.scale.bandwidth():s.scales.x.scale.bandwidth();e.select(".bar").attr("x",e=>s.scales.x.scale(a?0:e.name)).attr("y",e=>s.scales.y.scale(a?e.name:e.value)).attr("width",e=>a?s.scales.x.scale(e.value):t).attr("height",e=>a?t:parseInt(o._widget.size.innerHeight)-s.scales.y.scale(e.value)).attr("fill",o._color.mapper);const i=a?s.measureX:s.measureY;return e.select(".bar-label").each(e=>Object.assign(e,{_measures:i(e,t,r)})).attr("text-anchor",a?"end":"middle").attr("dominant-baseline",a?"central":"hanging").attr("font-size",o._font.size).attr("fill",o._font.color).attr("fill",e=>e._measures.color).attr("x",e=>e._measures.x).attr("y",e=>e._measures.y).text(o._label.format).style("display",o._label.show?null:"none"),e},exit:e=>e.style("opacity",0)},e)}};return o._highlight.container=o._chart.plots,o._tooltip.content=()=>void 0===s.current?void 0:{title:s.current.name,stripe:o._color.mapper(s.current),content:{data:[{name:"value",value:s.current.value}]}},o._widget.update=r(o._widget.update,s.update,!0),l},e.BoxPlot=(e,a="body")=>{const n={x:Q("point"),y:Q("linear")};let{self:o,api:l}=i(L("box-plot",e,a),B(n.x),ne,Y([".plot-group"]),oe(n),G(n.y),de(1),J(.2));const s={current:void 0,scales:o._horizontal.scales(),boxWidth:20,horizontal:!1,whiskerPath(e){const t="lower"===e?"q1":"q3";return a=>`M${s.scales.x.scale(s.horizontal?a.value[t]:a.name)} ${s.scales.y.scale(s.horizontal?a.name:a.value[t])}\n      L${s.scales.x.scale(s.horizontal?a.value.whiskers[e]:a.name)} ${s.scales.y.scale(s.horizontal?a.name:a.value.whiskers[e])}\n      m${s.horizontal?0:-.4*s.boxWidth} ${s.horizontal?-.4*s.boxWidth:0}\n      l${s.horizontal?0:.8*s.boxWidth} ${s.horizontal?.8*s.boxWidth:0}`},outlierX:e=>s.scales.x.scale(s.horizontal?e:e.name),outlierY:e=>s.scales.y.scale(s.horizontal?e.name:e),update(e){const a=o._chart.data.map(e=>e.name);let r=t.min(o._chart.data,e=>t.min(e.value.outliers.extreme.concat(e.value.outliers.mild).concat([e.value.whiskers.lower]))),i=t.max(o._chart.data,e=>t.max(e.value.outliers.extreme.concat(e.value.outliers.mild).concat([e.value.whiskers.upper])));const n=i-r;r-=.05*n,i+=.05*n,s.horizontal=o._horizontal.on(),s.scales=o._horizontal.scales(),s.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(s.horizontal?[r,i]:a),s.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(s.horizontal?a:[r,i]);const l=s.horizontal?0:s.boxWidth/2,c=s.horizontal?s.boxWidth/2:0;o._chart.plotGroups({enter:e=>(e.style("opacity",0).on("mouseover.box",e=>{s.current=e}).on("mouseleave.box",()=>{s.current=void 0}).style("color",o._color.mapper),e.append("rect").attr("class","box-body").attr("rx","2px").attr("ry","2px").attr("stroke","currentColor").attr("stroke-width",e=>o._lineWidth.mapping(e.name)).attr("fill","currentColor").attr("fill-opacity",o._opacity.value()).attr("x",e=>s.scales.x.scale(s.horizontal?e.value.q1:e.name)-l).attr("y",e=>s.scales.y.scale(s.horizontal?e.name:e.value.q3)-c).attr("width",e=>s.horizontal?s.scales.x.scale(e.value.q3)-s.scales.x.scale(e.value.q1):s.boxWidth).attr("height",e=>s.horizontal?s.boxWidth:s.scales.y.scale(e.value.q1)-s.scales.y.scale(e.value.q3)),e.append("line").attr("class","box-median").attr("x1",e=>s.scales.x.scale(s.horizontal?e.value.median:e.name)-l).attr("y1",e=>s.scales.y.scale(s.horizontal?e.name:e.value.median)-c).attr("x2",e=>s.scales.x.scale(s.horizontal?e.value.median:e.name)+l).attr("y2",e=>s.scales.y.scale(s.horizontal?e.name:e.value.median)+c).attr("stroke","currentColor").attr("stroke-width","2px"),e.append("path").attr("class","box-whisker-lower").attr("d",s.whiskerPath("lower")).attr("stroke","currentColor").attr("stroke-width",e=>o._lineWidth.mapping(e.name)).attr("fill","none"),e.append("path").attr("class","box-whisker-upper").attr("d",s.whiskerPath("upper")).attr("stroke","currentColor").attr("stroke-width",e=>o._lineWidth.mapping(e.name)).attr("fill","none"),e.selectAll(".box-mild-outlier").data(e=>e.value.outliers.mild.map(t=>Object.assign(t,{name:e.name}))).enter().append("circle").attr("class","box-mild-outlier").attr("cx",s.outlierX).attr("cy",s.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor"),e.selectAll(".box-extreme-outlier").data(e=>e.value.outliers.extreme.map(t=>Object.assign(t,{name:e.name}))).enter().append("circle").attr("class","box-extreme-outlier").attr("cx",s.outlierX).attr("cy",s.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor").style("opacity",.3),e),updateBefore:t=>(t.selectAll(".box-mild-outlier").data(e=>e.value.outliers.mild.map(t=>Object.assign(t,{name:e.name}))).join(e=>e.append("circle").attr("class","box-mild-outlier").attr("cx",s.outlierX).attr("cy",s.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",s.outlierX).attr("cy",s.outlierY).style("opacity",1),t.selectAll(".box-extreme-outlier").data(e=>e.value.outliers.extreme.map(t=>Object.assign(t,{name:e.name}))).join(e=>e.append("circle").attr("class","box-extreme-outlier").attr("cx",s.outlierX).attr("cy",s.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",s.outlierX).attr("cy",s.outlierY).style("opacity",o._opacity.value()),t),update:e=>(e.style("opacity",1).style("color",o._color.mapper),e.select(".box-body").attr("x",e=>s.scales.x.scale(s.horizontal?e.value.q1:e.name)-l).attr("y",e=>s.scales.y.scale(s.horizontal?e.name:e.value.q3)-c).attr("width",e=>s.horizontal?s.scales.x.scale(e.value.q3)-s.scales.x.scale(e.value.q1):s.boxWidth).attr("height",e=>s.horizontal?s.boxWidth:s.scales.y.scale(e.value.q1)-s.scales.y.scale(e.value.q3)).attr("stroke-width",e=>o._lineWidth.mapping(e.name)).attr("fill-opacity",o._opacity.value()),e.select(".box-median").attr("x1",e=>s.scales.x.scale(s.horizontal?e.value.median:e.name)-l).attr("y1",e=>s.scales.y.scale(s.horizontal?e.name:e.value.median)-c).attr("x2",e=>s.scales.x.scale(s.horizontal?e.value.median:e.name)+l).attr("y2",e=>s.scales.y.scale(s.horizontal?e.name:e.value.median)+c),e.select(".box-whisker-lower").attr("d",s.whiskerPath("lower")).attr("stroke-width",e=>o._lineWidth.mapping(e.name)),e.select(".box-whisker-upper").attr("d",s.whiskerPath("upper")).attr("stroke-width",e=>o._lineWidth.mapping(e.name)),e),exit:e=>e.style("opacity",0)},e)}};return o._highlight.container=o._chart.plots,o._tooltip.content=()=>void 0===s.current?void 0:{title:s.current.name,stripe:o._color.mapper(s.current),content:{data:[{name:"median",value:s.current.value.median},{name:"q1",value:s.current.value.q1},{name:"q3",value:s.current.value.q3},{name:"low",value:s.current.value.whiskers.lower},{name:"high",value:s.current.value.whiskers.upper},{name:"mild outliers",value:s.current.value.outliers.mild.length},{name:"extreme outliers",value:s.current.value.outliers.extreme.length}]}},o._widget.update=r(o._widget.update,s.update,!0),l=Object.assign(l||{},{boxWidth:(e=20)=>(s.boxWidth=e,l)}),l},e.BubbleChart=(e,a="body")=>{const n={x:Q("linear"),y:Q("linear"),size:Q("sqrt")};let{self:o,api:l}=i(L("bubble-chart",e,a),G(n.y),B(n.x),ne,Y([".plot-group"]),J(.6),pe,te);const s={scales:n,current:{hovered:void 0,closest:void 0},diagram:void 0,radius:30,computeDiagram:e=>t.voronoi().x(e=>s.scales.x.scale(e.value.x)).y(e=>s.scales.y.scale(e.value.y)).extent([[0,0],[parseInt(o._widget.size.innerWidth),parseInt(o._widget.size.innerHeight)]])(e),update(e){const a=o._chart.data.map(e=>e.value).flat(),r=t.max(a.map(e=>e.size));s.scales.size.range(0,s.radius).domain([0,r]);let i=t.extent(a.map(e=>e.x));s.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(i);let n=t.extent(a.map(e=>e.y));s.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(n),i=a.map(e=>{const t=s.scales.x.measure(1.5*s.scales.size.scale(e.size));return[e.x-t,e.x+t]}).flat(),s.scales.x.domain(o._xRange.range(i)),n=a.map(e=>{const t=s.scales.y.measure(1.5*s.scales.size.scale(e.size));return[e.y-t,e.y+t]}).flat(),s.scales.y.domain(o._yRange.range(n)),o._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",o._color.mapper).on("mouseover.bubble",e=>{s.current.hovered=e}).on("mouseleave.bubble",()=>{s.current.hovered=void 0}),e.append("circle").attr("class","bubble").attr("cx",e=>s.scales.x.scale(e.value.x)).attr("cy",e=>s.scales.y.scale(e.value.y)).attr("r",e=>s.scales.size.scale(e.value.size)).attr("stroke","currentColor").attr("fill","currentColor").raise(),e),update:e=>(e.style("opacity",1).style("color",o._color.mapper),e.select(".bubble").attr("cx",e=>s.scales.x.scale(e.value.x)).attr("cy",e=>s.scales.y.scale(e.value.y)).attr("r",e=>s.scales.size.scale(e.value.size)).attr("fill-opacity",o._opacity.value()),e),exit:e=>e.style("opacity",0)},e),s.diagram=s.computeDiagram(o._chart.data),o._widget.container.on("mousemove.scatter",()=>{const e=s.diagram.find(...o._widget.getMouse(),10)||void 0;void 0!==e&&e!==s.current.closest?o._mouse.over(e.data):void 0===s.current.hovered&&void 0!==s.current.closest&&o._mouse.leave(s.current.closest),s.current.closest=e&&e.data||void 0}).on("click.scatter",()=>{void 0!==s.current.closest&&o._mouse.click(s.current.closest)})}};return o._highlight.container=o._chart.plots,o._tooltip.content=e=>{if(void 0===e)return;const t=s.current.hovered||s.current.closest;return t?{title:t.name,stripe:o._color.mapper(t),content:{data:[{name:o._bottomAxis.label.text(),value:t.value.x},{name:o._leftAxis.label.text(),value:t.value.y},{name:"size",value:t.value.size}]}}:void 0},o._chart.transformData=e=>e.sort((e,t)=>t.value.size-e.value.size),o._widget.update=r(o._widget.update,s.update,!0),l=Object.assign(l||{},{radius:(e=30)=>(s.radius=e,l)}),l},e.CalendarPlot=(e,a="body")=>{const n={blocks:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],margin:0,align:"start"},tiles:{names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekStart:0}},o={x:Q("linear"),y:Q("band")};let{self:l,api:s}=i(L("pie-chart",e,a),ne,Y([".plot-group"]),le,G(o.y),(c=o.x,(e,a)=>{let i=X("x",e,t.axisTop,c,{"text-anchor":"end",dy:"2.5em"}),n=t=>{e._widget.getElem(i.label,t).attr("x",e._widget.size.innerWidth)};return(e=Object.assign(e||{},{_topAxis:i}))._widget.update=r(e._widget.update,n),a=Object.assign(a||{},{topAxis:{label:(e="")=>(i.label.text(e),a),format:e=>(i.format(e),a),values:e=>(i.values(e),a),hideTicks:e=>(i.self.hideTicks(e),a),hideAxisLine:e=>(i.hideAxisLine(e),a)}}),{self:e,api:a}}));var c;const d={scales:o,current:void 0,metrics:{},blocks:{names:n.blocks.names,margin:n.blocks.margin,align:n.blocks.align},tiles:{names:n.tiles.names,weekStart:0},fm:l._widget.getFontMetrics(),shiftDay:(e,t)=>(e-t+7)%7,tileX(e){const t=Math.ceil((e.date-d.metrics.firstDay)/864e5);return Math.floor((t+d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart))/7)},labelFill:e=>ie(l._color.mapper(e)),addTiles(e,t,a,r){const i=e.append("g").attr("class",e=>"tile date-"+e.date.getDate()).attr("transform",e=>`translate(${d.tileX(e)*t}, ${d.shiftDay(e.date.getDay(),d.tiles.weekStart)*t})`).on("mouseover.calendar",e=>{d.current=e}).on("mouseleave.calendar",()=>{d.current=void 0});return i.append("rect").attr("x",1).attr("y",1).attr("width",t-2).attr("height",t-2).attr("rx",.1*t).attr("ry",.1*t).attr("stroke","transparent").attr("stroke-width",2).attr("fill",l._color.mapper),i.append("text").attr("x",0).attr("y",0).attr("dx",.5*t).attr("dy",a).attr("text-anchor","middle").attr("font-size",r).attr("fill",d.labelFill).style("display",l._label.show?null:"none").style("user-select","none").text(l._label.format),i},update(e){const a=7-d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart),r=Math.ceil((d.metrics.numDays-a)/7)+1;l._chart.data.forEach(e=>{e.x=Math.floor((e.daysOffset-a)/7)+1,e.length=Math.ceil((e.daysOffset+e.numDays-a)/7)+1-e.x});const i=parseFloat(l._widget.size.innerWidth)/(r+d.blocks.margin*(d.metrics.numMonths-1)),n=parseFloat(l._widget.size.innerHeight)/7,o=Math.min(i,n);l._color.scale(t.scaleLinear().domain(t.extent(l._chart.data.map(e=>e.tiles).flat(),e=>e.value)).range([0,1]));const s=(parseFloat(l._widget.size.innerWidth)-o*(r+d.blocks.margin*(d.metrics.numMonths-1)))/2,c=(parseFloat(l._widget.size.innerHeight)-7*o)/2,p=Math.min(.6*o,parseFloat(l._font.size))+"px",u=(o+d.fm.capHeight*parseFloat(p))/2;var m,h;d.scales.x.range(s,parseInt(l._widget.size.innerWidth)-s).domain([0,r+d.blocks.margin*(d.metrics.numMonths-1)]),d.scales.y.range(c,parseInt(l._widget.size.innerHeight)-c).domain((m=d.tiles.names,h=d.tiles.weekStart,m.slice(h).concat(m.slice(0,h)))),l._leftAxis.hideAxisLine(!0).hideTicks(!0).margin({left:s}),l._topAxis.tickAnchor(d.blocks.align).hideAxisLine(!0).hideTicks(!0).margin({top:c}).values(l._chart.data.map(e=>e.x+("middle"===d.blocks.align?.5*e.length:0)+d.blocks.margin*e.index)).format((e,t)=>d.blocks.names[l._chart.data[t].month]),l._chart.plotGroups({enter:e=>(e.style("opacity",0).classed("year-"+d.metrics.firstDay.getFullYear(),!0).attr("transform",e=>`translate(${s+d.blocks.margin*e.index*o}, ${c})`),d.addTiles(e.selectAll(".tile").data(e=>e.tiles).enter(),o,u,p),e),updateBefore:t=>{const a=t.selectAll(".tile").data(e=>e.tiles).join(e=>d.addTiles(e,o,u,p).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("transform",e=>`translate(${d.tileX(e)*o}, ${d.shiftDay(e.date.getDay(),d.tiles.weekStart)*o})`).style("opacity",1);return a.select("rect").attr("width",o-2).attr("height",o-2).attr("rx",.1*o).attr("ry",.1*o).attr("fill",l._color.mapper),a.select("text").attr("dx",.5*o).attr("dy",u).attr("font-size",p).attr("fill",d.labelFill).style("display",l._label.show?null:"none").text(l._label.format),t},update:e=>e.style("opacity",1).attr("transform",e=>`translate(${s+d.blocks.margin*e.index*o}, ${c})`),exit:e=>e.style("opacity",0)},e)}};return l._chart.transformData=e=>{const a=e.map(e=>({date:me(e.date),value:+e.value})),r=t.min(a.map(e=>e.date)).getMonth(),i=t.max(a.map(e=>e.date)).getMonth(),n=a[0].date.getFullYear();let o=0;const l=Array.from({length:i-r+1},(e,t)=>{const a=(r+t)%12,i=ue(n,a+1,0).getDate(),l=ue(n,a,1),s={month:a,numDays:i,daysOffset:o,index:t,name:"month-"+a,tiles:Array.from({length:i},(e,t)=>{const r=new Date(l);return r.setDate(l.getDate()+t),{name:"month-"+a,date:r,value:null}})};return o+=i,s});return a.forEach(e=>{const t="month-"+e.date.getMonth();l.find(e=>e.name===t).tiles.find(t=>t.date.getDate()===e.date.getDate()).value=e.value}),d.metrics={year:l[0].tiles[0].date.getFullYear(),firstDay:l[0].tiles[0].date,numDays:t.sum(l,e=>e.tiles.length),numMonths:l.length},l},l._highlight.container=l._chart.plots,l._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.date.toISOString().substr(0,10),stripe:l._color.mapper(d.current),content:{type:"plots",data:[{name:"value",value:d.current.value}]}},l._widget.update=r(l._widget.update,d.update,!0),s=Object.assign(s||{},{months:(e=n.blocks.names)=>(d.blocks.names=e,s),blockAlign:(e=n.blocks.align)=>(d.blocks.align=e,s),blockMargin:(e=n.blocks.margin)=>(d.blocks.margin=e,s),days:(e=n.tiles.names)=>(d.tiles.names=e,s),weekStart:(e=n.tiles.weekStart)=>(d.tiles.weekStart=e,s)}),delete s.leftAxis,delete s.topAxis,l._color.init("sequential",e=>e.value),s},e.LineChart=(e,o="body")=>{const l={x:Q("linear"),y:Q("linear")},{self:s,api:c}=i(L("line-chart",e,o),G(l.y),B(l.x),V(l),Y([".plot-group",".plot-marker",".trends-marker"]),he,de(2),(e=>(t,a)=>{const i={container:void 0,pins:new Map,getContainer:()=>(void 0===i.container&&(i.container=t._chart.plots.append("g").attr("class","pins-container").attr("clip-path",`url(#${t._chart.clipId})`)),i.container)};return t._widget.update=r(t._widget.update,e=>{i.pins.forEach(t=>t.update(e))}),a=Object.assign(a||{},{pins:{add:(r,n,o={},l=0)=>{if(i.pins.has(r))return a;const s=e.x.scale,c=e.y.scale,d=o.color||t._font.color,p=(1-(o.height||.8))*c.range()[0],u=o.text||"",m=i.getContainer().append("g").attr("class","pin").style("color",d).style("opacity",0),h=m.append("g").attr("class","pin-label").style("opacity",o.fixed?1:0).style("pointer-events","none"),g=q(h.append("text"),{class:"pin-label-text",y:p-(o.size||6)-10,"text-anchor":"start",stroke:"none",fill:ie(d)}).text(u),y=1.05*g.node().getComputedTextLength();g.attr("x",Math.min(s(n),s.range()[1]-y-10)).attr("textLength",y);let x=g.node().getBBox();const f=q(h.append("rect"),{class:"pin-label-box",x:x.x-5,y:x.y-5,width:x.width+10,height:x.height+10,rx:2,stroke:"none",fill:""===u?"none":d});h.node().insertBefore(f.node(),g.node());const v=()=>{h.transition().duration(300).style("opacity",1)},b=()=>{h.transition().duration(300).style("opacity",o.fixed?1:0)},_=q(m.append("line"),{class:"pin-needle",x1:s(n)+1,y1:c.range()[0],x2:s(n)+1,y2:p,stroke:"currentColor","stroke-width":"2px"}).style("pointer-events","all").on("mouseover.pins",v).on("mouseleave.pins",b),w=q(m.append("circle"),{class:"pin-head",cx:s(n)+1,cy:p,r:(o.size||6)+"px",stroke:"white","stroke-width":"1px",fill:"currentColor"}).style("pointer-events","all").on("mouseover.pins",v).on("mouseleave.pins",b);m.transition().duration(l).style("opacity",1);const k={g:m,remove:e=>{m.transition().duration(e).style("opacity",0).on("end",()=>{m.remove()})},update:e=>{_.transition().duration(e).attr("x1",s(n)+1).attr("y1",c.range()[0]).attr("x2",s(n)+1).attr("y2",p),w.transition().duration(e).attr("cx",s(n)+1).attr("cy",p),g.attr("x",Math.min(s(n),s.range()[1]-y-10)).attr("y",p-(o.size||6)-10),x=g.node().getBBox(),f.attr("x",x.x-5).attr("y",x.y-5).attr("width",x.width+10).attr("height",x.height+10)}};return i.pins.set(r,k),a},remove:(e,t=0)=>(void 0===e&&(i.pins.forEach(e=>e.remove()),i.pins.clear()),i.pins.has(e)&&(i.pins.get(e).remove(t),i.pins.delete(e)),a)}}),{self:t,api:a}})(l),N,K,Z,(e=>(a,i)=>{const o={container:void 0,trends:new Map,getContainer:()=>(void 0===o.container&&(o.container=a._chart.plots.append("g").attr("class","trends-container").attr("clip-path",`url(#${a._chart.clipId})`)),o.container),adjustTrend:(e,r,i)=>{const n=a._chart.data.find(t=>t.name===e);if(void 0===n)return;const o=t.bisector(e=>e.x).left,l=o(n.values,r),s=o(n.values,i);if(null===l||null===s)return;const c=n.values[l].x,d=n.values[l].y,p=n.values[s].x,u=n.values[s].y;return{start:{x:c,y:d},end:{x:p,y:u},plateau:d<u?u:d}}};return a._widget.update=r(a._widget.update,e=>{o.trends.forEach(t=>t.update(e))}),i=Object.assign(i||{},{trends:{add:(t,r,l,s,c,d,p=0)=>{if(o.trends.has(t))return i;const u=e.x.scale,m=e.y.scale,h=o.adjustTrend(r,l,s),g=o.getContainer().append("g").attr("class","trend trend-"+n(r)).style("color",d||"#000").style("opacity",0),y=q(g.append("path"),{fill:"none",stroke:"currentColor","stroke-dasharray":"3 3","stroke-width":1,d:`M${u(h.start.x)},${m(h.start.y)}V${m(h.plateau)}H${u(h.end.x)}V${m(h.end.y)}`}),x=q(g.append("circle"),{cx:u(h.start.x),cy:m(h.start.y),r:4,stroke:"none",fill:"currentColor"}),f=q(g.append("circle"),{cx:u(h.end.x),cy:m(h.end.y),r:4,stroke:"none",fill:"currentColor"}),v=q(g.append("text"),{x:u(h.start.x),y:m(h.plateau),dy:-5,"text-anchor":"start",fill:a._font.color}).style("font-family","inherit").style("font-size",a._font.size).text(c);g.transition().duration(p).style("opacity",1);const b={g:g,remove:e=>{g.transition().duration(e).style("opacity",0).on("end",()=>{g.remove()})},update:e=>{g.transition().duration(e).style("color",d||"#000");const t=o.adjustTrend(r,l,s);y.transition().duration(e).attr("d",`M${u(t.start.x)},${m(t.start.y)}V${m(t.plateau)}H${u(t.end.x)}V${m(t.end.y)}`),x.transition().duration(e).attr("cx",u(t.start.x)).attr("cy",m(t.start.y)),f.transition().duration(e).attr("cx",u(t.end.x)).attr("cy",m(t.end.y)),v.attr("font-size",a._font.size).attr("fill",a._font.color).transition().duration(e).attr("x",u(t.start.x)).attr("y",m(t.plateau))}};return o.trends.set(t,b),i},remove:(e,t=0)=>{void 0===e&&(o.trends.forEach(e=>e.remove()),o.trends.clear()),o.trends.has(e)&&(o.trends.get(e).remove(t),o.trends.delete(e))}}}),{self:a,api:i}})(l),ge,pe,ce,te),d={scales:l,update:e=>{const r=s._chart.data.reduce((e,t)=>e.concat(t.values),[]).filter(e=>null!==e.y),i=r.filter(e=>e.lo+e.hi>0).length>0,n=r.map(e=>e.y-e.lo).concat(r.map(e=>e.y+e.hi)),o=t.extent(n),l=.01*(o[1]-o[0]);o[1]+=l,o[0]-=l,d.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(s._xRange.range(r.map(e=>e.x))),d.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(s._yRange.range(o));const c=t.line().defined(e=>null!==e.y).x(e=>d.scales.x.scale(e.x)).y(e=>d.scales.y.scale(e.y)).curve(s._smoothing.curve()),p=t.area().defined(e=>null!==e.y).x(e=>d.scales.x.scale(e.x)).y0(e=>d.scales.y.scale(e.y-e.lo)).y1(e=>d.scales.y.scale(e.y+e.hi)).curve(s._smoothing.curve());s._chart.plotGroups({enter:e=>(e.style("opacity",0),e.append("path").attr("class","error-band").attr("d",e=>p(e.values)).attr("stroke","none").attr("fill","currentColor").attr("fill-opacity",0),e.append("path").attr("class","line").attr("d",e=>c(e.values)).attr("stroke","currentColor").attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round"),e),update:e=>(e.style("opacity",1).style("color",s._color.mapper),e.select(".error-band").attr("fill-opacity",i?.2:0).attrTween("d",(function(e){const r=t.select(this).attr("d"),i=p(e.values);return a.interpolatePath(r,i,null)})),e.select(".line").attrTween("d",(function(e){const r=t.select(this).attr("d"),i=c(e.values);return a.interpolatePath(r,i,null)})).style("stroke-dasharray",e=>s._lineStyles.strokeDashArray(e.name)),e),exit:e=>e.style("opacity",0)},e)}};return s._highlight.container=s._chart.plots,s._tooltip.content=e=>{if(void 0===e)return void s._plotMarker.remove();const a=t.bisector(e=>d.scales.x.scale(e.x)).left,r=e?s._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===r)return void s._plotMarker.remove();let i=d.scales.x.scale.invert(e[0]);const n=s._chart.data.filter(e=>-1===s._tooltip.ignore.indexOf(e.name)).map((e,t)=>{const a=r[t],n=e.values,o=n[a-1]?n[a-1]:n[a],l=n[a]?n[a]:n[a-1],c=i-o.x>l.x-i?l:o;return i=c.x,null!==c.y&&s._yRange.contains(c.y)?s._plotMarker.add(d.scales.x.scale(i),d.scales.y.scale(c.y),e.name,e):s._plotMarker.remove(e.name),{name:e.name,background:s._lineStyles.background(s._lineStyles.style(e.name),s._color.mapper(e)),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:i,content:{type:"plots",data:n}}},s._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:+e.x,y:null===e.y?e.y:+e.y,lo:+e.lo||0,hi:+e.hi||0}))})),s._widget.update=r(s._widget.update,d.update,!0),c},e.PieChart=(e,a="body")=>{let{self:n,api:o}=i(L("pie-chart",e,a),ne,Y([".plot-group"]),le);const l={innerRadius:0,outerRadius:100,current:void 0,arc:null,labels:{format:()=>"",left:e=>.5*(e.startAngle+e.endAngle)>Math.PI,arcs:{inner:null,outer:null}},numSlices:0,measure:(e,t,a)=>{const r=re(n._label.format(e),a);return{outside:1.1*Math.sqrt(r.width*r.width+r.height*r.height)>Math.min(.5*(l.innerRadius+l.outerRadius)*(e.endAngle-e.startAngle),l.outerRadius-l.innerRadius),x:-.25*l.outerRadius*(l.numSlices-t),y:-1.25*l.outerRadius+1.1*r.height*(l.numSlices-1-t)}},labelLinePath:e=>{let t=l.labels.arcs.inner.centroid(e);const a=l.labels.arcs.outer.centroid(e),r=Math.max(a[1],e._measures.y),i=[a[1]!==t[1]?a[0]-(a[0]-t[0])*(a[1]-r)/(a[1]-t[1]):a[0],r],n=.25*l.outerRadius,o=[l.labels.left(e)?Math.min(i[0]-n,e._measures.x):i[0]+n,i[1]];return i[1]>t[1]&&(t=i),`M${t[0]} ${t[1]} L${i[0]} ${i[1]} L${o[0]} ${o[1]}`},labelTextAnchor:e=>l.labels.left(e)?"end":"start",labelTextX:e=>{const t=.25*l.outerRadius;return l.labels.left(e)?Math.min(l.labels.arcs.outer.centroid(e)[0]-t,e._measures.x)-5:l.labels.arcs.outer.centroid(e)[0]+t+5},labelTextY:e=>Math.max(l.labels.arcs.outer.centroid(e)[1],e._measures.y),update:e=>{const a=n._widget.getStyle();l.arc=t.arc().innerRadius(l.innerRadius).outerRadius(l.outerRadius),l.labels.arcs.inner=t.arc().innerRadius(l.outerRadius+5).outerRadius(l.outerRadius+5),l.labels.arcs.outer=t.arc().innerRadius(1.25*l.outerRadius).outerRadius(1.25*l.outerRadius),l.numSlices=n._chart.data.filter(e=>e.value>0).length,n._chart.plotGroups({enter:e=>{e.style("opacity",0).style("color",n._color.mapper).each((e,t)=>Object.assign(e,{_measures:l.measure(e,t,a)}));const t=e.append("g").attr("class","slice").attr("transform",`translate(${parseFloat(n._widget.size.innerWidth)/2}, ${parseFloat(n._widget.size.innerHeight)/2})`).on("mouseover.pie",e=>{l.current=e}).on("mouseleave.pie",()=>{l.current=void 0});t.append("path").attr("class","slice-wedge").attr("d",l.arc).attr("stroke-linejoin","round").attr("stroke","white").attr("fill","currentColor");const r=t.append("g").attr("class","slice-label").style("display",n._label.show?null:"none");r.append("text").attr("class","inner-label").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",e=>l.arc.centroid(e)[0]).attr("y",e=>l.arc.centroid(e)[1]).style("cursor","default").style("opacity",e=>e._measures.outside?0:1).text(e=>e.value.toFixed(1));const i=r.append("g").attr("class","outer-label").style("opacity",e=>e._measures.outside?1:0);return i.append("path").attr("class","outer-label-line").attr("stroke-linejoin","round").attr("fill","none").attr("d",l.labelLinePath),i.append("text").attr("class","outer-label-text").attr("dominant-baseline","middle").attr("text-anchor",l.labelTextAnchor).attr("x",l.labelTextX).attr("y",l.labelTextY).style("cursor","default").text(e=>e.value.toFixed(1)),e},update:e=>{e.style("opacity",1).style("color",n._color.mapper).each((e,t)=>Object.assign(e,{_measures:l.measure(e,t,a)}));const t=e.select(".slice").attr("transform",`translate(${parseFloat(n._widget.size.innerWidth)/2}, ${parseFloat(n._widget.size.innerHeight)/2})`);t.select(".slice-wedge").attrTween("d",ye(e=>l.arc(e)));const r=t.select(".slice-label").style("display",n._label.show?null:"none");r.select(".inner-label").style("opacity",e=>e._measures.outside?0:1).attr("fill",e=>ie(n._color.mapper(e))).attrTween("x",ye(e=>l.arc.centroid(e)[0],"x")).attrTween("y",ye(e=>l.arc.centroid(e)[1],"y")).text(n._label.format);const i=r.select(".outer-label").style("opacity",e=>e._measures.outside?1:0);return i.select(".outer-label-line").attr("stroke",n._font.color).attrTween("d",ye(l.labelLinePath,"r")),i.select(".outer-label-text").attr("fill",n._font.color).attrTween("text-anchor",ye(l.labelTextAnchor,"align")).attrTween("x",ye(l.labelTextX,"x")).attrTween("y",ye(l.labelTextY,"y")).text(n._label.format),e},exit:e=>e.style("opacity",0)},e)}};return n._chart.transformData=e=>t.pie().value(e=>e.value).sort(null)(e.sort((e,t)=>t.value-e.value)).map(e=>Object.assign(e,{name:e.data.name})),n._highlight.container=n._chart.plots,n._tooltip.content=()=>void 0===l.current?void 0:{title:l.current.name,stripe:n._color.mapper(l.current),content:{type:"plots",data:[{name:"value",value:l.current.value}]}},n._widget.update=r(n._widget.update,l.update),o=Object.assign(o,{innerRadius:(e=0)=>(l.innerRadius=e,o),outerRadius:(e=100)=>(l.outerRadius=e,o)}),o},e.ScatterPlot=(e,a="body")=>{const n={x:Q("linear"),y:Q("linear")};let{self:o,api:l}=i(L("scatter-plot",e,a),B(n.x),ne,Y([".plot-group"]),G(n.y),J(.6),N,pe,te);const s={scales:n,current:void 0,diagram:void 0,size:4,computeDiagram:e=>{const a=e.map(e=>e.values.map(t=>({name:e.name,x:t.x,y:t.y}))).flat();return t.voronoi().x(e=>s.scales.x.scale(e.x)).y(e=>s.scales.y.scale(e.y)).extent([[0,0],[parseInt(o._widget.size.innerWidth),parseInt(o._widget.size.innerHeight)]])(a)},update:e=>{const a=o._chart.data.map(e=>e.values).flat(),r=t.extent(a.map(e=>e.x));s.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(r);const i=t.extent(a.map(e=>e.y));s.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(i);const n=s.scales.x.measure(2*s.size);s.scales.x.domain(o._xRange.range([r[0]-n,r[1]+n]));const l=s.scales.y.measure(2*s.size);s.scales.y.domain(o._yRange.range([i[1]+l,i[0]-l])),o._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",o._color.mapper).attr("stroke","none").attr("fill","currentColor"),e.selectAll("circle").data(e=>e.values).enter().append("circle").attr("class","dot").attr("cx",e=>s.scales.x.scale(e.x)).attr("cy",e=>s.scales.y.scale(e.y)).attr("r",s.size).style("opacity",0),e),updateBefore:t=>(t.style("opacity",1).style("color",o._color.mapper),t.selectAll("circle").data(e=>e.values).join(e=>e.append("circle").attr("class","dot").attr("cx",e=>s.scales.x.scale(e.x)).attr("cy",e=>s.scales.y.scale(e.y)).attr("r",s.size).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",e=>s.scales.x.scale(e.x)).attr("cy",e=>s.scales.y.scale(e.y)).attr("r",s.size).style("opacity",o._opacity.value()),t),exit:e=>e.style("opacity",0)}),s.diagram=s.computeDiagram(o._chart.data),o._widget.container.on("mousemove.scatter",()=>{const e=s.diagram.find(...o._widget.getMouse(),Math.max(20,s.size))||void 0;void 0!==e&&e!==s.current?o._mouse.over(e.data):void 0!==s.current&&o._mouse.leave(s.current),s.current=e&&e.data||void 0}).on("click.scatter",()=>{void 0!==s.current&&o._mouse.click(s.current)})}};return o._highlight.container=o._chart.plots,o._tooltip.content=e=>{if(void 0!==e){if(s.current)return o._plotMarker.add(s.scales.x.scale(s.current.x),s.scales.y.scale(s.current.y),"marker",s.current,Math.max(5,1.5*s.size)),{title:s.current.name,stripe:o._color.mapper(s.current),content:{type:"plots",data:[{name:o._bottomAxis.label.text(),value:s.current.x},{name:o._leftAxis.label.text(),value:s.current.y}]}};o._plotMarker.remove()}else o._plotMarker.remove()},o._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.map(e=>({x:+e.x,y:+e.y}))})),o._widget.update=r(o._widget.update,s.update,!0),l=Object.assign(l,{size:e=>(s.size=e||4,l)}),l},e.ViolinPlot=(e,n="body")=>{const o={x:Q("point"),y:Q("linear")};let{self:l,api:s}=i(L("violin-plot",e,n),B(o.x),ne,Y([".plot-group"]),oe(o),G(o.y),de(1),J(.2));const c={data:[],current:void 0,scales:l._horizontal.scales(),violinWidth:30,horizontal:!1,bandwidth:1,kde:(e,a)=>r=>a.map(a=>({x:a,y:t.mean(r,t=>e(a-t))})),epanechnikovKernel:e=>t=>Math.abs(t/=e)<=1?.75*(1-t*t)/e:0,makeViolin(e){const a=t.min(e),r=t.max(e),i=r-a,n=c.kde(c.epanechnikovKernel(c.bandwidth),t.range(Math.floor(i/c.bandwidth)+1).map(e=>a+c.bandwidth*e))(e);return{yMin:a,yMax:r,values:n,scale:t.scaleLinear().range([c.violinWidth/2-1,0]).domain([0,t.max(n,e=>e.y)])}},bimodality(e){const a=e.length,r=t.mean(e),i=t.sum(e,e=>(e-r)*(e-r))/a,n=t.sum(e,e=>Math.pow(e-r,3))/a,o=t.sum(e,e=>Math.pow(e-r,4))/a,l=Math.sqrt(a*(a-1))*n/((a-2)*Math.pow(i,1.5));return(l*l+1)/(o/(i*i)-3+3*(a-1)*(a-1)/((a-2)*(a-3)))},update(e){const r=l._chart.data.map(e=>e.name);let i=t.min(l._chart.data.map(e=>e.min)),n=t.max(l._chart.data.map(e=>e.max));const o=n-i;i-=.05*o,n+=.05*o,c.horizontal=l._horizontal.on(),c.scales=l._horizontal.scales(),c.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(c.horizontal?[i,n]:r),c.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(c.horizontal?r:[i,n]);const s=c.violinWidth/2-.5,d=c.horizontal?"":"rotate(90)";l._chart.plotGroups({enter:e=>(e.style("opacity",0).on("mouseover.violin",e=>{c.current=e}).on("mouseleave.violin",()=>{c.current=void 0}).style("color",l._color.mapper),e.append("path").attr("class","violin").attr("transform",e=>`translate(${c.horizontal?0:c.scales.x.scale(e.name)+s}, ${c.horizontal?c.scales.y.scale(e.name)-s:0}) ${d}`).attr("d",e=>e.area.x(e=>c.horizontal?c.scales.x.scale(e.x):c.scales.y.scale(e.x))(e.values)).attr("stroke","currentColor").attr("fill","currentColor").style("fill-opacity",0),e),update:e=>(e.style("opacity",1).style("color",l._color.mapper),e.select(".violin").attr("transform",e=>`translate(${c.horizontal?0:c.scales.x.scale(e.name)+s}, ${c.horizontal?c.scales.y.scale(e.name)-s:0}) ${d}`).attrTween("d",(function(e){const r=t.select(this).attr("d"),i=e.area.x(e=>c.horizontal?c.scales.x.scale(e.x):c.scales.y.scale(e.x))(e.values);return a.interpolatePath(r,i,null)})).attr("stroke-width",e=>l._lineWidth.mapping(e.name)).style("fill-opacity",l._opacity.value()),e),exit:e=>e.style("opacity",0)},e)}};return l._highlight.container=l._chart.plots,l._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:l._color.mapper(c.current),content:{data:[{name:"mean",value:c.current.stats.mean},{name:"median",value:c.current.stats.median},{name:"bimodality",value:c.current.stats.bimodality}]}},l._chart.transformData=e=>(c.data=e,e.map(e=>{const{yMin:a,yMax:r,values:i,scale:n}=c.makeViolin(e.values);return{name:e.name,min:a,max:r,stats:{mean:t.mean(e.values),median:t.median(e.values.sort((e,t)=>e-t)),bimodality:c.bimodality(e.values)},values:i,scale:n,area:t.area().curve(t.curveBasis).y0(e=>n(-e.y)).y1(e=>n(e.y))}})),l._widget.update=r(l._widget.update,c.update,!0),s=Object.assign(s||{},{violinWidth:(e=30)=>(c.violinWidth=e,l._chart.data.map(e=>Object.assign(e,{scale:e.scale&&e.scale.range([c.violinWidth/2-1,0]),area:e.area&&e.area.y0(t=>e.scale(-t.y)).y1(t=>e.scale(t.y))})),s),bandwidth:(e=1)=>(c.bandwidth=e,l._chart.data.map((e,t)=>{const{values:a,scale:r}=c.makeViolin(c.data[t].values);Object.assign(e,{values:a,scale:r,area:e.area&&e.area.y0(e=>r(-e.y)).y1(e=>r(e.y))})}),s)}),s},Object.defineProperty(e,"__esModule",{value:!0})}));
