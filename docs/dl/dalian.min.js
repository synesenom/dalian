// https://www.npmjs.com/package/dalian v0.0.1 Copyright 2020 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],e):e((t=t||self).dalian={},t.d3,t.d3)}(this,function(t,e,a){"use strict";var i=(t,...e)=>{let{self:a,api:i}=t;return e.reduce((t,e)=>{let r=e(t.self,t.api);return{self:Object.assign(a,r.self),api:Object.assign(i,r.api)}},{self:a,api:i})},r=t=>(""+t).replace(/ /g,"__"),l=(t,e,a=!1)=>{let i=t;return(...t)=>{a?(e(...t),i(...t)):(i(...t),e(...t))}};const s=["royalblue","#e41a1c","yellowgreen","gold","orchid","darkgrey","darkorange","sienna","lightskyblue","salmon","palegreen","palegoldenrod","thistle","gainsboro","peachpuff","tan","midnightblue","darkred","forestgreen","darkgoldenrod","indigo","dimgrey"],n=t=>{let e=[];return a=>{let i=e.indexOf(a);return t[i>-1?i:e.push(a)-1]}};var o=(t,a)=>{let i={policy:void 0,mapping:n(s)};return{self:t=Object.assign(t||{},{_colors:{mapping:t=>i.mapping(t)}}),api:a=Object.assign(a||{},{colors:(t,r)=>{if(i.policy=t,void 0===t)i.mapping=n(s);else if("string"==typeof t)if(void 0===r)i.mapping=(()=>t);else{const a=e.hsl(t),l=2*Math.min(a.l,1-a.l)/(r+1),s=Array.from({length:r},(t,i)=>{let s=e.hsl(a);return s.l+=(i-.5*(r-1))*l,s});i.mapping=n(s)}else i.mapping=(e=>t[e]);return a}})}},d=(t,a)=>{let i={id:`${t._widget.id}-description`,getDescription:()=>void 0===i.elem||i.elem.empty()?e.select("body").append("div").attr("id",i.id).style("position","absolute").style("left",e.event.pageX+20+"px").style("top",e.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 3px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("font-family","inherit").style("line-height","1.35em").style("pointer-events","none"):i.elem,removeDescription:()=>{void 0===i.elem||i.elem.empty()||(i.elem.remove(),delete i.elem)}};return a=Object.assign(a||{},{description:r=>(void 0===r?t._widget.container.on("contextmenu",null):t._widget.container.on("contextmenu",()=>{e.event.preventDefault(),i.elem=i.getDescription().html(r)}).on("mouseleave",()=>{i.removeDescription()}),a)}),{self:t,api:a}},p=(t,e)=>((t=Object.assign(t||{},{_font:{size:"12px",color:"black"}}))._widget.update=l(t._widget.update,()=>{t._widget.container.style("font-size",t._font.size).style("color",t._font.color)},!0),e=Object.assign(e||{},{fontSize:(a=12)=>(t._font.size=a+"px",e),fontColor:a=>(t._font.color=a,e)}),{self:t,api:e}),c=(t,e)=>{let a={callbacks:{}};return{self:t=Object.assign(t||{},{_mouse:{mouseover:(...t)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...t)},mouseleave:(...t)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...t)},click:(...t)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...t)},isEnabled:t=>"function"==typeof a.callbacks[t]}}),api:e=Object.assign(e||{},{mouseover:t=>(a.callbacks.over=t,e),mouseleave:t=>(a.callbacks.leave=t,e),click:t=>(a.callbacks.click=t,e)})}},y=(t,e)=>{let a={id:`${t._widget.id}-placeholder`};return t._widget.update=l(t._widget.update,e=>{void 0!==a.elem&&a.elem.style("font-size","inherit").transition().duration(e).style("width",t._widget.size.width).style("height",t._widget.size.height).style("color","inherit")}),e=Object.assign(e||{},{placeholder:(i,r=400)=>(void 0===i?(t._widget.content.style("display","block").transition().duration(r).style("opacity",1),t._widget.disable(!1),void 0===a.elem||a.elem.empty()||(a.elem.transition().duration(r).style("opacity",0).remove(),delete a.elem)):(t._widget.content.transition().duration(r).style("opacity",0).on("end",()=>{t._widget.content.style("display","none")}),t._widget.disable(!0),(void 0===a.elem||a.elem.empty())&&(a.elem=t._widget.container.append("div").attr("id",a.id).attr("class","dalian-placeholder").style("display","table").style("position","absolute").style("width",t._widget.size.width).style("height",t._widget.size.height).style("left",0).style("top",0).style("color","inherit").style("font-family","inherit").style("font-size","inherit").style("pointer-events","none"),a.elem.append("span").style("display","table-cell").style("vertical-align","middle").style("line-height","normal").style("text-align","center").style("color","inherit").style("font-family","inherit").style("font-size","inherit").style("opacity",0).html(i).transition().duration(r).style("opacity",1))),e)}),{self:t,api:e}},g=(t,a,s,n)=>{let{self:g,api:h}=i(((t,a,i,r)=>{let l={parent:e.select(i),pos:{x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}}},s={};s._widget={id:`dalian-widget-${t}-${a}`,container:void 0,size:{width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},margins:{left:0,right:0,top:0,bottom:0},transition:!1,disabled:!1,update:t=>{s._widget.container.transition().duration(t).style(l.pos.x.ignore,null).style(l.pos.x.attr,l.pos.x.value).style(l.pos.y.ignore,null).style(l.pos.y.attr,l.pos.y.value).style("width",s._widget.size.width).style("height",s._widget.size.height),s._widget.container.style("display","block")},disable:t=>s._widget.disabled=t};try{s._widget.container=l.parent.append("div").attr("id",s._widget.id).attr("class",`dalian-widget dalian-widget-${t}`).style("display","none").style("position","absolute").style("width",s._widget.size.width).style("height",s._widget.size.height).style("left",l.pos.x+"px").style("top",l.pos.y+"px").style("font-family","inherit").style("font-size","inherit").style("font-color","inherit"),s._widget.content=s._widget.container.append(r).attr("id",`${s._widget.id}-content`).attr("class","dalian-widget-content").style("position","absolute").style("width","100%").style("height","100%").style("left",0).style("top",0).style("font-family","inherit").style("font-size","inherit").style("font-color","inherit")}catch(t){throw Error("MissingDOMException: DOM is not present.")}let n={x:(t=0)=>(l.pos.x.attr=t>=0?"left":"right",l.pos.x.ignore=t>=0?"right":"left",l.pos.x.value=Math.abs(t)+"px",n),y:(t=0)=>(l.pos.y.attr=t>=0?"top":"bottom",l.pos.y.ignore=t>=0?"bottom":"top",l.pos.y.value=Math.abs(t)+"px",n),width:(t=300)=>(s._widget.size.width=t+"px",s._widget.size.innerWidth=t-s._widget.margins.left-s._widget.margins.right+"px",n),height:(t=200)=>(s._widget.size.height=t+"px",s._widget.size.innerHeight=t-s._widget.margins.top-s._widget.margins.bottom+"px",n),margins:t=>{switch(typeof t){case"undefined":default:s._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":s._widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":s._widget.margins=Object.assign(s._widget.margins,t)}return s._widget.size.innerWidth=parseInt(s._widget.size.width)-s._widget.margins.left-s._widget.margins.right+"px",s._widget.size.innerHeight=parseInt(s._widget.size.height)-s._widget.margins.top-s._widget.margins.bottom+"px",n},render:t=>(s._widget.update(t),n)};return{self:s,api:n}})(t,a,s,n),o,d,y,p,c),u=()=>{g._chart.plots.attr("width",g._widget.size.innerWidth+"px").attr("height",g._widget.size.innerHeight+"px").attr("transform","translate("+g._widget.margins.left+","+g._widget.margins.top+")")};return(g=Object.assign(g,{_chart:{plots:g._widget.content.append("g").attr("class","dalian-plots-container"),plotSelectors:[],transformData:t=>t,plotGroups:(t,e=400)=>{let a=g._chart.plots.selectAll(".plot-group").data(g._chart.data,t=>t.name).join(e=>{let a=e.append("g").attr("class",t=>`plot-group ${r(t.name)}`).style("shape-rendering","geometricPrecision").style("fill",t=>g._colors.mapping(t.name)).style("stroke",t=>g._colors.mapping(t.name));return t.enter?t.enter(a):a},t=>t,a=>a.call(a=>{let i=a.transition().duration(e);(i=t.exit?t.exit(i):i).remove()})).on("mouseover",g._mouse.mouseover).on("mouseleave",g._mouse.mouseleave).on("click",g._mouse.click).each(()=>{g._chart.plots.style("pointer-events","none"),g._widget.transition=!0}).transition().duration(e);(a=t.update?t.update(a):a).on("end",()=>{g._chart.plots.style("pointer-events","all"),g._widget.transition=!1})}}}))._widget.update=l(g._widget.update,u),h=Object.assign(h,{data:t=>(g._chart.data=g._chart.transformData(t),h)}),{self:g,api:h}},h=(t="linear",a="linear")=>{let i={kind:t,type:a,scale:(()=>{switch(t){default:case"linear":return e.scaleLinear();case"band":return e.scaleBand().padding(.1);case"point":return e.scalePoint().padding(.5)}})()},r={scale:i.scale,range:(t,e)=>(i.scale.range([t,e]),r),domain:t=>{switch(i.kind){default:case"linear":i.scale.domain([Math.min(...t),Math.max(...t)]);break;case"band":case"point":i.scale.domain(t)}return r},kind:t=>{switch(t){default:case"linear":i.scale=e.scaleLinear();break;case"band":i.scale=e.scaleBand().padding(.1);break;case"point":i.scale=e.scalePoint().padding(.5)}}};return r},u=(t,e,a,i)=>{let r=e.append("g").attr("class",`dalian-axis-container ${t}`).style("font-family","inherit").style("font-size","inherit"),l=r.append("g").attr("class",`${t} axis`).style("font-family","inherit").style("font-size","inherit");l.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");let s={label:"",format:t=>t,scale:i,container:r,fn:a().ticks(5)},n={axis:l,label:r.append("text").attr("class",`axis-label ${t}`).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text("")},o={tickFormat:(t=(t=>t))=>(s.format=t,o),label:t=>(s.label=t,o),adjustLabel:t=>(Object.entries(t).forEach(t=>{n.label.attr(t[0],t[1])}),o),update:(t,e,a)=>{s.container.attr("transform","translate("+a.left+","+a.top+")").style("width",e.innerWidth).style("height",e.innerHeight),s.fn.scale(s.scale.scale).tickFormat(s.format),n.axis.transition().duration(t).call(s.fn),n.label.text(s.label)},scale:t=>(s.scale=t,o)};return{self:n,api:o}},m=(t,a,i,r)=>{let s=u(i,t._widget.content,e.axisLeft,r);return s.api.adjustLabel({"text-anchor":"begin",x:"5px",y:"-5px"}),(t=Object.assign(t||{},{_axisLeft:{update:s.api.update,scale:s.api.scale}}))._widget.update=l(t._widget.update,e=>s.api.update(e,t._widget.size,t._widget.margins)),a=Object.assign(a||{},{yLabel:t=>(s.api.label(t),a),yTickFormat:t=>(s.api.tickFormat(t),a)}),{self:t,api:a}},_=(t,a,i,r)=>{let s=u(i,t._widget.content,e.axisBottom,r);return s.api.adjustLabel({"text-anchor":"end",dy:"2.4em"}),s.api.update=l(s.api.update,e=>{s.self.axis.transition().duration(e).attr("transform","translate(0,"+parseFloat(t._widget.size.innerHeight)+")"),s.self.label.transition().duration(e).attr("x",t._widget.size.innerWidth).attr("y",parseFloat(t._widget.size.innerHeight)+"px")}),t._widget.update=l(t._widget.update,e=>s.api.update(e,t._widget.size,t._widget.margins)),t=Object.assign(t||{},{_axisBottom:{update:s.api.update,scale:s.api.scale}}),a=Object.assign(a||{},{xLabel:(t="")=>(s.api.label(t),a),xTickFormat:t=>(s.api.tickFormat(t),a)}),{self:t,api:a}},x=(t,a)=>{let i={on:!1};return{self:t=Object.assign(t||{},{_smoothing:{curve:()=>i.on?e.curveMonotoneX:e.curveLinear}}),api:a=Object.assign(a||{},{smoothing:(t=!1)=>(i.on=t,a)})}},f=(t,a)=>{let i={container:{id:"dalian-tooltip-container"},id:`${t._widget.id}-tooltip`,on:!1,getContainer:()=>{if(e.select("#"+i.container.id).empty())return e.select("body").append("div").attr("id",i.container.id)},getTooltip:(t,e)=>void 0===i.elem||i.elem.empty()?i.container.elem.append("div").attr("id",i.id).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("box-shadow","0 0 2px #aaa").style("font-size","0.7em").style("color","black").style("pointer-events","none").style("left",(t.left+t.right)/2+e.left+"px").style("top",(t.top+t.bottom)/2+e.top+"px"):i.elem,hideTooltip:()=>{void 0!==i.elem&&i.elem.transition().duration(200).style("opacity",0).on("end",function(){e.select(this).style("display","none")})},showTooltip:()=>{let a=e.event.pageX,r=e.event.pageY,l=t._widget.container.node().getBoundingClientRect(),s={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(a<l.left+t._widget.margins.left-s.left||a>l.right-t._widget.margins.right+s.left||r<l.top+t._widget.margins.top-s.top||r>l.bottom-t._widget.margins.bottom+s.top)return t._tooltip.builder(),void i.hideTooltip();i.container.elem=i.getContainer(),i.elem=i.getTooltip(l,s);let n=e.mouse(t._widget.container.node()),o=t._tooltip.builder(t._tooltip.content([n[0]-t._widget.margins.left,n[1]-t._widget.margins.top]));if(void 0===o){if(void 0!==i.elem)return void i.hideTooltip()}else i.elem.html(o);let d=i.elem.node().getBoundingClientRect(),p=d.width,c=d.height,y=a+20,g=r+20;y+p>l.right-t._widget.margins.right+s.left-10&&(y-=p+s.left+40),g+c>l.bottom-t._widget.margins.bottom+s.top-10&&(g=l.bottom-t._widget.margins.bottom+s.top-10-c),i.elem.style("display","block").transition().duration(0).style("opacity",1).transition(),i.elem.transition().duration(200).ease(e.easeLinear).style("left",y+"px").style("top",g+"px")}};return t._widget.update=l(t._widget.update,()=>{t._widget.container.style("pointer-events",i.on?"all":null).on("mousemove",()=>i.on&&!t._widget.disabled&&i.showTooltip()).on("mouseout",i.hideTooltip)}),t=Object.assign(t||{},{_tooltip:{content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented"),titleFormat:t=>t}}),a=Object.assign(a||{},{tooltip:(t=!1)=>(i.on=t,a),tooltipTitleFormat:(e=(t=>t))=>(t._tooltip.titleFormat=e,a)}),{self:t,api:a}},v=(t,a)=>{let i=f(t,a);return t._tooltip=Object.assign(i.self._tooltip,{builder:a=>{if(void 0===a)return void t._tooltip.content();let i=e.select(document.createElement("div")).style("border-radius","2px").style("padding","5px").style("font-family","inherit");return i.append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(t._tooltip.xFormat(a.title)),a.content.data.sort((t,e)=>t.name.localeCompare(e.name)).forEach(e=>{let a=i.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");a.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background",e.background),a.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t._tooltip.yFormat(e.value))}),i.node().outerHTML},xFormat:t=>t,yFormat:t=>t}),a=Object.assign(i.api,{tooltipXFormat:(e=(t=>t))=>(t._tooltip.xFormat=e,a),tooltipYFormat:(e=(t=>t))=>(t._tooltip.yFormat=e,a)}),{self:t,api:a}},b=(t,a)=>{let i=(a,i,l)=>{if(t._widget.transition)return;let s=t._highlight.container.selectAll(a);if(s.transition(),"string"==typeof i)s.transition().duration(l).style("opacity",function(){return e.select(this).classed(r(i))?1:.1});else if(Array.isArray(i)){let t=t.map(t=>r(t));s.transition().duration(l).style("opacity",function(){let a=e.select(this);return t.reduce((t,e)=>t||a.classed(e),!1)?1:.1})}else s.transition().duration(l||0).style("opacity",1)};return t=Object.assign(t||{},{_highlight:{container:void 0,selectors:void 0}}),a=Object.assign(a||{},{highlight:(e,r=400)=>{if(void 0===t._highlight.container)throw Error("Highlight.container is not specified");if(void 0===t._highlight.selectors)throw Error("Highlight.selectors is not specified");return t._highlight.selectors.forEach(t=>i(t,e,r)),a}}),{self:t,api:a}},w=(t,e)=>{let a={value:.5};return{self:t=Object.assign(t||{},{_opacity:{value:()=>a.value}}),api:e=Object.assign(e||{},{opacity:t=>(a.value=t,e)})}},k=(t,e)=>((t=Object.assign(t||{},{_plotMarker:{markers:new Map}}))._plotMarker.add=((e,a,i)=>{if("number"==typeof e){let l=t._plotMarker.markers.get(i);t._plotMarker.markers.set(i,l||t._chart.plots.append("circle")),t._plotMarker.markers.get(i).attr("class",`plot-marker ${r(i)}`).attr("cx",e).attr("cy",a).attr("r",4).style("stroke","white").style("fill",t._colors.mapping(i)).style("pointer-events","none")}}),t._plotMarker.remove=(e=>{t._plotMarker.markers.forEach((e,a)=>{e.remove(),t._plotMarker.markers.delete(a)})}),{self:t,api:e});const z=document.createElement("canvas");z.style.fontFamily="inherit";const j=z.getContext("2d");function M(t,e){return j.font=e.size+" "+e.family,j.measureText(t).width}function O(t){let e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function F(t){let a=e.color(t);return.2126*O(a.r)+.7152*O(a.g)+.0722*O(a.b)}var C=(t,a)=>{let i=f(t,a);return t._tooltip=Object.assign(i.self._tooltip,{builder:a=>{if(void 0===a)return void t._tooltip.content();let i=e.select(document.createElement("div")).style("border-radius","2px").style("padding","5px").style("font-family","inherit").style("border-left",a.stripe?"solid 4px "+a.stripe:null);return i.append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(t._tooltip.xFormat(a.title)),a.content.data.forEach(e=>{let a=i.append("div").style("position","relative").style("height","10px").style("margin","5px").style("padding-right","10px").style("line-height","11px");a.append("div").style("position","relative").style("float","left").style("margin-right","10px").text(e.name+":"),a.append("span").style("position","relative").style("float","left").html(t._tooltip.yFormat(e.value))}),i.node().outerHTML},xFormat:t=>t,yFormat:t=>t}),a=Object.assign(i.api,{tooltipXFormat:(e=(t=>t))=>(t._tooltip.xFormat=e,a),tooltipYFormat:(e=(t=>t))=>(t._tooltip.yFormat=e,a)}),{self:t,api:a}},$=(t,e)=>{let a={policy:void 0,getStrokeDashArray:t=>{switch(t){case"solid":default:return null;case"dashed":return"4 4";case"dotted":return"2 5"}}};return{self:t=Object.assign(t||{},{_lineStyles:{strokeDashArray:t=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[t]),style:t=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[t],background:(t,e)=>{switch(t){case"solid":default:return e;case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${e} 2px, ${e} 4px`;case"dotted":return`radial-gradient(${e} 30%, transparent 30%) 0.5px 0.5px/4px 4px, radial-gradient(${e} 30%, transparent 30%) 2.5px 2.5px/4px 4px transparent`}}}}),api:e=Object.assign(e||{},{lineStyle:t=>(a.policy=t,e)})}};t.AreaChart=((t,s)=>{let n={x:h("linear"),y:h("linear")},{self:o,api:d}=i(g("area-chart",t,s,"svg"),k,w,x,v,b,(t,e)=>m(t,e,"y",n.y),(t,e)=>_(t,e,"x",n.x)),p={scales:n,update:t=>{const i=o._chart.data.reduce((t,e)=>t.concat(e.values),[]);p.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(i.map(t=>t.x)),p.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(i.map(t=>t.y).concat(0));const l=e.area().x(t=>p.scales.x.scale(t.x)).y0(()=>p.scales.y.scale(0)).y1(t=>p.scales.y.scale(t.y)).curve(o._smoothing.curve());o._chart.plotGroups({enter:t=>(t.append("path").attr("class",t=>`area ${r(t.name)}`).attr("d",t=>l(t.values)).style("stroke","none").style("fill-opacity",0),t),update:t=>(t.select(".area").attrTween("d",function(t){let i=e.select(this).attr("d"),r=l(t.values);return a.interpolatePath(i,r,null)}).style("fill-opacity",o._opacity.value()),console.log(t),t),exit:t=>t.style("opacity",0)},t)}};return o._highlight.container=o._chart.plots,o._highlight.selectors=[".area",".plot-marker"],o._tooltip.content=(t=>{if(void 0===t)return void o._plotMarker.remove();let a=e.bisector(t=>p.scales.x.scale(t.x)).left,i=t?o._chart.data.map(e=>a(e.values,t[0])):void 0;if(void 0===i)return void o._plotMarker.remove();let r=p.scales.x.scale.invert(t[0]),l=o._chart.data.map((t,e)=>{let a=i[e],l=t.values,s=l[a-1]?l[a-1]:l[a],n=l[a]?l[a]:l[a-1],d=r-s.x>n.x-r?n:s;return r=d.x,o._plotMarker.add(p.scales.x.scale(r),p.scales.y.scale(d.y),t.name),{name:t.name,background:o._colors.mapping(t.name),value:d.y}});return{title:r,content:{type:"plots",data:l}}}),o._chart.transformData=(t=>t.map(t=>({name:t.name,values:t.values.sort((t,e)=>t.x-e.x).map(t=>({x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}))}))),o._widget.update=l(o._widget.update,p.update,!0),d}),t.BarChart=((t,a)=>{let s={x:h("band"),y:h("linear")},{self:n,api:o}=i(g("bar-chart",t,a,"svg"),C,b,(t,e)=>m(t,e,"y",s.y),(t,e)=>_(t,e,"x",s.x)),d={current:void 0,scales:{x:s.x,y:s.y},measureX:(t,e,a)=>{const i=M(n._barChart.valueFormat(t.value),a),r=Math.max((e-parseFloat(a.size))/2,5),l=d.scales.x.scale(t.value),s=l>3*r+i;return{inside:s,x:s?l-r:l+r+i,y:d.scales.y.scale(t.name)+e/2,color:s?F(n._colors.mapping(t.name))>.179?"#000":"#fff":a.color}},measureY:(t,e,a)=>{const i=parseFloat(a.size),r=Math.max((e-M(n._barChart.valueFormat(t.value),a))/2,5),l=d.scales.y.scale(t.value),s=parseFloat(n._widget.size.innerHeight)-l>2*r+i;return{inside:s,x:d.scales.x.scale(t.name)+e/2,y:s?l+r:l-r-i,color:s?F(n._colors.mapping(t.name))>.179?"#000":"#fff":a.color}},update:t=>{const a=window.getComputedStyle(n._widget.container.node()),i={size:a.fontSize,family:a.fontFamily,color:a.color},l=n._chart.data.map(t=>t.name),s=1.1*e.max(n._chart.data.map(t=>t.value))||1;d.scales.x.range(0,parseInt(n._widget.size.innerWidth)).domain(n._barChart.horizontal?[0,s]:l),d.scales.y.range(parseInt(n._widget.size.innerHeight),0).domain(n._barChart.horizontal?l:[0,s]),n._chart.plotGroups({enter:t=>{const e=n._barChart.horizontal?d.scales.y.scale.bandwidth():d.scales.x.scale.bandwidth(),a=t.append("rect").attr("class",t=>`bar ${r(t.name)}`).style("stroke-with","2px").on("mouseover",t=>d.current=t).on("mouseleave",()=>d.current=void 0);if(n._barChart.horizontal?a.attr("x",d.scales.x.scale(0)).attr("width",0).attr("y",t=>d.scales.y.scale(t.name)).attr("height",e):a.attr("x",t=>d.scales.x.scale(t.name)).attr("width",e).attr("y",d.scales.y.scale(0)).attr("height",0),n._barChart.values){const a=n._barChart.horizontal?d.measureX:d.measureY;t.append("text").attr("class",t=>`bar-value ${r(t.name)}`).attr("dominant-baseline",n._barChart.horizontal?"central":"hanging").attr("text-anchor",n._barChart.horizontal?"end":"middle").style("font-size",n._font.size).style("fill",n._font.color).style("stroke","none").text(t=>n._barChart.valueFormat(t.value)).each(t=>Object.assign(t,{_m:a(t,e,i)})).style("fill",t=>t._m.color).attr("x",t=>n._barChart.horizontal?d.scales.x.scale(0):t._m.x).attr("y",t=>n._barChart.horizontal?t._m.y:d.scales.y.scale(0))}return t},update:t=>{const a=n._barChart.horizontal?d.scales.y.scale.bandwidth():d.scales.x.scale.bandwidth(),r=t.select(".bar");if(n._barChart.horizontal?r.attr("x",d.scales.x.scale(0)).attr("width",t=>d.scales.x.scale(t.value)).attr("y",t=>d.scales.y.scale(t.name)).attr("height",a):r.attr("x",t=>d.scales.x.scale(t.name)).attr("width",a).attr("y",t=>d.scales.y.scale(t.value)).attr("height",t=>parseInt(n._widget.size.innerHeight)-d.scales.y.scale(t.value)),n._barChart.values){const r=n._barChart.horizontal?d.measureX:d.measureY;t.select(".bar-value").textTween(function(t){let a=parseFloat(e.select(this).text()),i=e.interpolateNumber(a,t.value);return t=>n._barChart.valueFormat(i(t))}).each(t=>Object.assign(t,{_m:r(t,a,i)})).style("fill",t=>t._m.color).attr("x",t=>t._m.x).attr("y",t=>t._m.y)}return t},exit:t=>t.style("opacity",0)},t)}};return(n=Object.assign(n,{_barChart:{horizontal:!1,values:!1,valueFormat:Math.round}}))._highlight.container=n._chart.plots,n._highlight.selectors=[".bar",".bar-value"],n._tooltip.content=(()=>{if(void 0!==d.current)return{title:d.current.name,stripe:n._colors.mapping(d.current.name),content:{type:"plots",data:[{name:"value",value:d.current.value}]}}}),n._widget.update=l(n._widget.update,d.update,!0),o=Object.assign(o,{horizontal:t=>(n._barChart.horizontal=t,t?(d.scales.x=s.y,d.scales.y=s.x):(d.scales.x=s.x,d.scales.y=s.y),n._axisBottom.scale(d.scales.x),n._axisLeft.scale(d.scales.y),o),values:t=>(n._barChart.values=t,o),valueFormat:t=>(n._barChart.valueFormat=t,o)})}),t.LineChart=((t,s="body")=>{let n={x:h("linear"),y:h("linear")},{self:o,api:d}=i(g("line-chart",t,s,"svg"),$,k,x,v,b,(t,a)=>((t,a,i)=>{let s={markers:new Map,adjustMarker:(a,i,r)=>{let l=t._chart.data.find(t=>t.name===a);if(void 0===l)return;let s=e.bisector(t=>t.x).left,n=s(l.values,i),o=s(l.values,r);if(null===n||null===o)return;let d=l.values[n].x,p=l.values[n].y,c=l.values[o].x,y=l.values[o].y;return{start:{x:d,y:p},end:{x:c,y:y},plateau:p<y?y:p}}};return t._widget.update=l(t._widget.update,t=>{s.markers.forEach(e=>e.update(t))}),a=Object.assign(a||{},{addMarker:(e,l,n,o,d,p=400)=>{if(s.markers.has(e))return;let c=i.x.scale,y=i.y.scale,g=s.adjustMarker(l,n,o),h=t._chart.plots.append("g").attr("class","trend-marker "+r(l)).style("opacity",0),u=h.append("line").attr("class","horizontal").attr("x1",c(Math.max(g.start.x,g.start.x))).attr("y1",y(g.plateau)).attr("x2",c(Math.min(g.end.x,g.end.x))).attr("y2",y(g.plateau)).style("stroke",t._colors.mapping(l)).style("stroke-dasharray","3 3").style("stroke-width",1),m=h.append("line").attr("class","vertical-start").attr("x1",c(g.start.x)).attr("y1",y(g.start.y)).attr("x2",c(g.start.x)).attr("y2",y(g.plateau)).style("stroke",t._colors.mapping(l)).style("stroke-dasharray","3 3").style("stroke-width",1),_=h.append("circle").attr("class","start").attr("cx",c(g.start.x)).attr("cy",y(g.start.y)).attr("r",4).style("stroke","none").style("fill",t._colors.mapping(l)),x=h.append("line").attr("class","vertical-end").attr("x1",c(g.end.x)).attr("y1",y(g.end.y)).attr("x2",c(g.end.x)).attr("y2",y(g.plateau)).style("stroke",t._colors.mapping(l)).style("stroke-dasharray","3 3").style("stroke-width",1),f=h.append("circle").attr("class","end").attr("cx",c(g.end.x)).attr("cy",y(g.end.y)).attr("r",4).style("stroke","none").style("fill",t._colors.mapping(l)),v=h.append("text").attr("x",c(g.start.x)).attr("y",y(g.plateau)).attr("dy",-5).attr("text-anchor","start").style("fill",t._font.color).style("font-family","inherit").style("font-size",t._font.size).text(d);h.transition().duration(p).style("opacity",1);let b={remove:(t=400)=>{h.transition().duration(t).style("opacity",0).on("end",()=>{h.remove()})},update:e=>{let a=s.adjustMarker(l,n,o);u.transition().duration(e).attr("x1",c(Math.max(a.start.x,a.start.x))).attr("y1",y(a.plateau)).attr("x2",c(Math.min(a.end.x,a.end.x))).attr("y2",y(a.plateau)).style("stroke",t._colors.mapping(l)),m.transition().duration(e).attr("x1",c(a.start.x)).attr("y1",y(a.start.y)).attr("x2",c(a.start.x)).attr("y2",y(a.plateau)).style("stroke",t._colors.mapping(l)),_.transition().duration(e).attr("cx",c(a.start.x)).attr("cy",y(a.start.y)).style("fill",t._colors.mapping(l)),x.transition().duration(e).attr("x1",c(a.end.x)).attr("y1",y(a.end.y)).attr("x2",c(a.end.x)).attr("y2",y(a.plateau)).style("stroke",t._colors.mapping(l)),f.transition().duration(e).attr("cx",c(a.end.x)).attr("cy",y(a.end.y)).style("fill",t._colors.mapping(l)),v.style("font-size",t._font.size).style("fill",t._font.color).transition().duration(e).attr("x",c(a.start.x)).attr("y",y(a.plateau))}};return s.markers.set(e,b),a},removeMarker:t=>(s.markers.has(t)&&(s.markers.get(t).remove(),s.markers.delete(t)),a)}),{self:t,api:a}})(t,a,n),(t,e)=>m(t,e,"y",n.y),(t,e)=>_(t,e,"x",n.x)),p={scales:n,update:t=>{const i=o._chart.data.reduce((t,e)=>t.concat(e.values),[]),l=i.map(t=>t.y),s=Math.min(...l),n=Math.max(...l);p.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(i.map(t=>t.x)),p.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(i.map(t=>t.y));const d=e.line().x(t=>p.scales.x.scale(t.x)).y(t=>p.scales.y.scale(t.y)).curve(o._smoothing.curve()),c=e.area().x(t=>p.scales.x.scale(t.x)).y0(t=>p.scales.y.scale(Math.max(s,t.y-t.lo))).y1(t=>p.scales.y.scale(Math.min(n,t.y+t.hi))).curve(o._smoothing.curve());o._chart.plotGroups({enter:t=>(t.append("path").attr("class",t=>`error-band ${r(t.name)}`).attr("d",t=>c(t.values)).style("stroke","none").style("fill-opacity",0),t.append("path").attr("class",t=>`line ${r(t.name)}`).attr("d",t=>d(t.values)).style("stroke-width","2px").style("opacity",0).style("fill","none"),t),update:t=>(t.select(".error-band").attrTween("d",function(t){let i=e.select(this).attr("d"),r=c(t.values);return a.interpolatePath(i,r,null)}).style("fill-opacity",.2),t.select(".line").attrTween("d",function(t){let i=e.select(this).attr("d"),r=d(t.values);return a.interpolatePath(i,r,null)}).style("opacity",1).style("stroke-dasharray",t=>o._lineStyles.strokeDashArray(t.name)),t),exit:t=>t.style("opacity",0)},t)}};return o._highlight.container=o._chart.plots,o._highlight.selectors=[".line",".error-band",".plot-marker",".trend-marker"],o._tooltip.content=(t=>{if(void 0===t)return void o._plotMarker.remove();let a=e.bisector(t=>p.scales.x.scale(t.x)).left,i=t?o._chart.data.map(e=>a(e.values,t[0])):void 0;if(void 0===i)return void o._plotMarker.remove();let r=p.scales.x.scale.invert(t[0]),l=o._chart.data.map((t,e)=>{let a=i[e],l=t.values,s=l[a-1]?l[a-1]:l[a],n=l[a]?l[a]:l[a-1],d=r-s.x>n.x-r?n:s;return r=d.x,o._plotMarker.add(p.scales.x.scale(r),p.scales.y.scale(d.y),t.name),{name:t.name,background:o._lineStyles.background(o._lineStyles.style(t.name),o._colors.mapping(t.name)),value:d.y}});return{title:r,content:{type:"plots",data:l}}}),o._chart.transformData=(t=>t.map(t=>({name:t.name,values:t.values.sort((t,e)=>t.x-e.x).map(t=>({x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}))}))),o._widget.update=l(o._widget.update,p.update,!0),d}),t.PieChart=((t,a="body")=>{h("linear");let{self:r,api:s}=i(g("pie-chart",t,a,"svg"),C,b),n=t=>{e.arc().innerRadius(0).outerRadius(r._pieChart.outerRadius),e.pie().value(t=>t.value).sort(null)};return(r=Object.assign(r,{_pieChart:{innerRadius:10,outerRadius:50,values:!1,valueFormat:Math.round}}))._highlight.container=r._chart.plots,r._highlight.selectors=[".slice"],r._tooltip.content=(()=>{}),r._widget.update=l(r._widget.update,n,!0),s=Object.assign(s,{values:t=>(r._pieChart.values=t,s),valueFormat:t=>(r._pieChart.valueFormat=t,s)})}),Object.defineProperty(t,"__esModule",{value:!0})});
