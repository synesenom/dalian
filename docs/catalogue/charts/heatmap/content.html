<script class="card-example">
  dalian.Heatmap('heatmap-card', '#heatmap')
    .data((() => {
      const normal1 = new ranjs.dist.Normal(7, 2)
      const normal2 = new ranjs.dist.Normal(1, 3)

      return Array.from({length: 1e5}, () => {
        return Math.random() < 0.3 ? {
          x: normal1.sample(),
          y: normal2.sample()
        } : {
          x: normal2.sample(),
          y: normal1.sample()
        }
      })
    })())
    .x(0)
    .y(0)
    .width(WIDTH)
    .height(HEIGHT)
    .margins({ left: 30, right: 10, top: 20, bottom: 30 })
    .font.size(11)
    .color.palette(COLORS.widget[0])
    .bottomAxis.label('x')
    .leftAxis.label('y')
    .radius(20)
    .render()
</script>

<div id="desc">
  <p>
    <a href="https://en.wikipedia.org/wiki/Bubble_chart">Heatmaps</a> TODO Desc
  </p>
  <p>
    When should be used
  </p>
  <p>
    When should be avoided.
  </p>
    <!-- TODO Data types: x: continuous, y: continuous.-->
</div>
<div id="controls">
  <ul>
    <li onclick="changeData()">.data()</li>
    <li onclick="toggleGrid()">.grid()</li>
    <li onclick="toggleColorPalette()">.color.palette()</li>
    <li onclick="toggleColorOn()">.color.on()</li>
  </ul>
</div>

<script class="doc">
// generate data
function getData () {
  const peak1x = new ranjs.dist.Normal(30 + Math.random() * 40, 16)
  const peak1y = new ranjs.dist.Normal(Math.random() * 10, 4)
  const peak2x = new ranjs.dist.Normal(10 + Math.random() * 20, 10)
  const peak2y = new ranjs.dist.Normal(70 + Math.random() * 20, 10)

  return Array.from({length: 100}, (i, x) => {
    return Array.from({length: 100}, (j, y) => ({
      x, y,
      value: peak1x.pdf(x) * peak1y.pdf(y) + peak2x.pdf(x) * peak2y.pdf(y)
    }))
  }).flat()
}
</script>

<script class="doc">
// create chart
const heatmap = dalian.Heatmap('heatmap', '#widget')
  .data(getData())
  .width(WIDTH)
  .height(HEIGHT)
  .margins({left: 70, top: 40, bottom: 40, right: 40})
  .font.size(14)
  .bottomAxis.label('x')
  .leftAxis.label('y')
  //.tooltip.on(true)
  //.tooltip.valueFormat(y => y.toFixed(2))
  .render(1000)
</script>

<script class="doc">
// api methods
const changeData = () => heatmap.data(getData()).render(1000)

const toggleGrid = () => {
  this.g = 1 - (this.g || 0)
  heatmap.grid(this.g ? [20, 20] : [100, 100])
    .render()
}

const toggleColorPalette = () => {
  this.c = 1 - (this.c || 0)
  heatmap.color.palette(this.c ? ['transparent', '#000'] : undefined)
    .render(1000)
}

const toggleColorOn = () => {
  this.o = 1 - (this.o || 0)
  heatmap.color.on(this.o ? d => Math.pow(d, 3) : d => d)
    .render(1000)
}
</script>
