// https://www.npmjs.com/package/@dalian/chart v0.1.0 Copyright 2019 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-ease"),require("d3-selection")):"function"==typeof define&&define.amd?define(["d3-ease","d3-selection"],e):(t=t||self).Chart=e(t.d3,t.d3)}(this,function(t,e){"use strict";var i=t=>(""+t).replace(/ /g,"__"),o=(i,o)=>{let n=i||{};n.tooltip={containerId:"dalian-tooltip-container",containerElem:void 0,id:`${n.widget.id}-tooltip`,elem:void 0,on:!1};n.tooltip.createContent=(()=>{console.warn("createTooltip(mouse) is not implemented")}),n.tooltip.show=(()=>{let i=e.mouse(n.widget.dom.container.node()),o=e.event.pageX,a=e.event.pageY,s=n.widget.dom.container.node().getBoundingClientRect(),l={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(o<s.left+n.widget.margins.left-l.left||o>s.right-n.widget.margins.right+l.left||a<s.top+n.widget.margins.top-l.top||a>s.bottom-n.widget.margins.bottom+l.top)return void e.select("#"+n.tooltip.id).transition().duration(200).style("opacity",0).on("end",function(){e.select(this).style("display","none")});n.tooltip.containerElem=(()=>{if(e.select("#"+n.tooltip.containerId).empty())return e.select("body").append("div").attr("id",n.tooltip.containerId)})(),n.tooltip.elem=((t,e)=>void 0===n.tooltip.elem||n.tooltip.elem.empty()?n.tooltip.containerElem.append("div").attr("id",n.tooltip.id).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-r","2px").style("box-shadow","0 0 3px grey").style("font-family",'"Courier", monospace').style("font-size","0.7em").style("color","black").style("pointer-events","none").style("left",(t.left+t.right)/2+e.left+"px").style("top",(t.top+t.bottom)/2+e.top+"px"):n.tooltip.elem)(s,l);let r=n.tooltip.createContent([i[0]-n.widget.margins.left,i[1]-n.widget.margins.top]);if(void 0===r){if(void 0!==n.tooltip.elem)return void n.tooltip.elem.transition().duration(200).style("opacity",0).on("end",function(){e.select(this).style("display","none")})}else n.tooltip.elem.html(r);let d=n.tooltip.elem.node().getBoundingClientRect(),p=d.width,g=d.height,c=o+20,m=a+20;c+p>s.right-n.widget.margins.right+l.left-5&&(c-=p+l.left+40),m+g>s.bottom-n.widget.margins.bottom+l.top-5&&(m=s.bottom-n.widget.margins.bottom+l.top-10-g),n.tooltip.elem.style("display","block").transition().duration(0).style("opacity",1).transition(),n.tooltip.elem.transition().duration(200).ease(t.easeLinear).style("left",c+"px").style("top",m+"px")});let a=o||{};return a.tooltip=(t=>(n.tooltip.on=t,a)),{self:n,api:a}};return(t,n,a,s)=>{let{self:l,api:r}=((t,i,o,n)=>{let a={};a._widget={id:`dalian-widget-${t}-${i}`,container:void 0,pos:{x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}},size:{width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},margins:{left:0,right:0,top:0,bottom:0}};try{a._widget.container=e.select(o).append(n).attr("id",a._widget.id).attr("class",`dalian-widget dalian-widget-${t}`).style("display","none").style("position","absolute").style("width",a._widget.size.width).style("height",a._widget.size.height).style("left",a._widget.pos.x+"px").style("top",a._widget.pos.y+"px")}catch(t){throw Error("MissingDOMException: DOM is not present.")}a._widget.update=(()=>{console.warn("Widget.update(duration) is not implemented")});let s={x:(t=0)=>(a._widget.pos.x.attr=t>=0?"left":"right",a._widget.pos.x.ignore=t>=0?"right":"left",a._widget.pos.x.value=Math.abs(t)+"px",s),y:(t=0)=>(a._widget.pos.y.attr=t>=0?"top":"bottom",a._widget.pos.y.ignore=t>=0?"bottom":"top",a._widget.pos.y.value=Math.abs(t)+"px",s),width:(t=300)=>(a._widget.size.width=t+"px",a._widget.size.innerWidth=t-a._widget.margins.left-a._widget.margins.right+"px",s),height:(t=200)=>(a._widget.size.height=t+"px",a._widget.size.innerHeight=t-a._widget.margins.top-a._widget.margins.bottom+"px",s),margins:t=>{switch(typeof t){case"undefined":default:a._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":a._widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":a._widget.margins=Object.assign(a._widget.margins,t)}return a._widget.size.innerWidth=parseInt(a._widget.size.width)-a._widget.margins.left-a._widget.margins.right+"px",a._widget.size.innerHeight=parseInt(a._widget.size.height)-a._widget.margins.top-a._widget.margins.bottom+"px",s},render:t=>(a._widget.update(t),a._widget.container.style(a._widget.pos.x.ignore,null).style(a._widget.pos.x.attr,a._widget.pos.x.value).style(a._widget.pos.y.ignore,null).style(a._widget.pos.y.attr,a._widget.pos.y.value).style("width",a._widget.size.width).style("height",a._widget.size.height),a._widget.container.style("display","block"),s)};return{self:a,api:s}})(t,n,a,s);return l.chart={plots:l.widget.dom.container.append("g").attr("class","plots-container"),data:void 0,transition:!1},l.chart.transformData=(()=>{console.warn("Chart.transformData(data) is not implemented.")}),l.chart.update=(()=>{console.warn("Chart.update(duration) is not implemented.")}),l.chart.plotGroups=((t,e,o=700)=>{let n=t.selectAll(".plot-group").data(l.chart.data,t=>t.name),a=n.exit().transition().duration(o).style("opacity",0).remove(),s=n.enter().append("g").attr("class",t=>`plot-group ${i(t.name)}`).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent").style("stroke","transparent");e&&e.enter&&(s=e.enter(s));let r=s.merge(n).each(()=>{t.style("pointer-events","none"),l.chart.transition=!0}).on("mouseover",t=>{void 0!==l.mouse.enter&&l.mouse.enter(t)}).on("mouseleave",t=>{void 0!==l.mouse.leave&&l.mouse.leave(t)}).on("click",t=>{void 0!==l.mouse.click&&l.mouse.click(t)});e&&e.union&&e.union.before&&(r=e.union.before(r));let d=r.transition().duration(o).style("opacity",1).style("fill",t=>l.colors.mapping(t.name)).style("stroke",t=>l.colors.mapping(t.name));return e&&e.union&&e.union.after&&(d=e.union.after(d)),d.on("end",()=>{t.style("pointer-events","all"),l.chart.transition=!1}),{groups:n,enter:s,exit:a,union:{before:r,after:d}}}),l.chart.highlight=((t,o,n=0)=>{if(l.chart.transition)return r;let a=l.chart.plots.selectAll(t);if(a.transition(),"string"==typeof o)a.transition().duration(n).style("opacity",function(){return e.select(this).classed(i(o))?1:.1});else if(Array.isArray(o)){let t=o.map(t=>i(t));a.transition().duration(n).style("opacity",function(){let i=e.select(this);return t.reduce((t,e)=>t||i.classed(e),!1)?1:.1})}else a.transition().duration(n||0).style("opacity",1);return r}),l.widget.update=(t=>{l.chart.update(t),l.chart.plots.attr("width",l.widget.size.innerWidth+"px").attr("height",l.widget.size.innerHeight+"px").attr("transform","translate("+l.widget.margins.left+","+l.widget.margins.top+")")}),(r=r||{}).data=(t=>(l.chart.data=l.chart.transformData(t),r.colors(),r)),Object.assign(r,((t,e)=>{let i=t||{};i.colors={policy:void 0,mapping:t=>o()};const o=()=>{let t=[];return e=>{let i=t.indexOf(e);return["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"][i>-1?i:t.push(e)-1]}};let n=e||{};return n.colors=(t=>(i.colors.policy=t,i.colors.mapping=void 0===t?o():"string"==typeof t?()=>t:e=>t[e],n)),{self:i,api:n}})(l,r),o(l,r),((t,e)=>((t=t||{})._mouse={callbacks:{}},t._mouse.mouseover=((...e)=>{void 0!==t._mouse.callbacks.over&&t._mouse.callbacks.over(...e)}),t._mouse.mouseleave=((...e)=>{void 0!==t._mouse.callbacks.leave&&t._mouse.callbacks.leave(...e)}),t._mouse.click=((...e)=>{void 0!==t._mouse.callbacks.click&&t._mouse.callbacks.click(...e)}),(e=e||{}).mouseover=(i=>(t._mouse.callbacks.over=i,e)),e.mouseleave=(i=>(t._mouse.callbacks.leave=i,e)),e.click=(i=>(t._mouse.callbacks.click=i,e)),{self:t,api:e}))(l,r),((t,e)=>{let i=t||{};i.font={size:"14px",color:"black"};let o=e||{};return o.fontSize=((t=14)=>(i.font.size=t+"px",o)),o.fontColor=(t=>(i.font.color=t,o)),{self:i,api:o}})(l,r))}});
