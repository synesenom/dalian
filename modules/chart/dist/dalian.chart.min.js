// https://www.npmjs.com/package/@dalian/chart v0.1.0 Copyright 2019 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-ease"),require("d3-selection")):"function"==typeof define&&define.amd?define(["d3-ease","d3-selection"],e):(t=t||self).Chart=e(t.d3,t.d3)}(this,function(t,e){"use strict";var i=t=>(""+t).replace(/ /g,"__"),o=(i,o)=>{let n=i||{};n.tooltip={containerId:"dalian-tooltip-container",containerElem:void 0,id:`${n.widget.id}-tooltip`,elem:void 0,on:!1};n.tooltip.createContent=(()=>{console.warn("createTooltip(mouse) is not implemented")}),n.tooltip.show=(()=>{let i=e.mouse(n.widget.dom.container.node()),o=e.event.pageX,r=e.event.pageY,s=n.widget.dom.container.node().getBoundingClientRect(),a={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(o<s.left+n.widget.margins.left-a.left||o>s.right-n.widget.margins.right+a.left||r<s.top+n.widget.margins.top-a.top||r>s.bottom-n.widget.margins.bottom+a.top)return void e.select("#"+n.tooltip.id).transition().duration(200).style("opacity",0).on("end",function(){e.select(this).style("display","none")});n.tooltip.containerElem=(()=>{if(e.select("#"+n.tooltip.containerId).empty())return e.select("body").append("div").attr("id",n.tooltip.containerId)})(),n.tooltip.elem=((t,e)=>void 0===n.tooltip.elem||n.tooltip.elem.empty()?n.tooltip.containerElem.append("div").attr("id",n.tooltip.id).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-r","2px").style("box-shadow","0 0 3px grey").style("font-family",'"Courier", monospace').style("font-size","0.7em").style("color","black").style("pointer-events","none").style("left",(t.left+t.right)/2+e.left+"px").style("top",(t.top+t.bottom)/2+e.top+"px"):n.tooltip.elem)(s,a);let l=n.tooltip.createContent([i[0]-n.widget.margins.left,i[1]-n.widget.margins.top]);if(void 0===l){if(void 0!==n.tooltip.elem)return void n.tooltip.elem.transition().duration(200).style("opacity",0).on("end",function(){e.select(this).style("display","none")})}else n.tooltip.elem.html(l);let d=n.tooltip.elem.node().getBoundingClientRect(),p=d.width,g=d.height,c=o+20,m=r+20;c+p>s.right-n.widget.margins.right+a.left-5&&(c-=p+a.left+40),m+g>s.bottom-n.widget.margins.bottom+a.top-5&&(m=s.bottom-n.widget.margins.bottom+a.top-10-g),n.tooltip.elem.style("display","block").transition().duration(0).style("opacity",1).transition(),n.tooltip.elem.transition().duration(200).ease(t.easeLinear).style("left",c+"px").style("top",m+"px")});let r=o||{};return r.tooltip=(t=>(n.tooltip.on=t,r)),{self:n,api:r}};return(t,n,r,s,a,l)=>{let{self:d,api:p}=((t,i,o,n,r,s)=>{(r=r||{}).widget={id:`dalian-widget-${t}-${i}`,dom:{}},r.widget.pos={x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}},r.widget.size={width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},r.widget.margins={left:0,right:0,top:0,bottom:0};try{r.widget.dom.container=e.select(o).append(n).attr("id",r.widget.id).attr("class",`dalian-widget dalian-widget-${t}`).style("display","none").style("position","absolute").style("width",r.widget.size.width).style("height",r.widget.size.height).style("left",r.widget.pos.x+"px").style("top",r.widget.pos.y+"px")}catch(t){throw Error("MissingDOMException: DOM is not present.")}return r.widget.update=(()=>{console.warn("Widget.update(duration) is not implemented")}),(s=s||{}).x=((t=0)=>(r.widget.pos.x.attr=t>=0?"left":"right",r.widget.pos.x.ignore=t>=0?"right":"left",r.widget.pos.x.value=Math.abs(t)+"px",s)),s.y=((t=0)=>(r.widget.pos.y.attr=t>=0?"top":"bottom",r.widget.pos.y.ignore=t>=0?"bottom":"top",r.widget.pos.y.value=Math.abs(t)+"px",s)),s.width=((t=300)=>(r.widget.size.width=t+"px",r.widget.size.innerWidth=t-r.widget.margins.left-r.widget.margins.right+"px",s)),s.height=((t=200)=>(r.widget.size.height=t+"px",r.widget.size.innerHeight=t-r.widget.margins.top-r.widget.margins.bottom+"px",s)),s.margins=(t=>{switch(typeof t){case"undefined":default:r.widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":r.widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":r.widget.margins=Object.assign(r.widget.margins,t)}return r.widget.size.innerWidth=parseInt(r.widget.size.width)-r.widget.margins.left-r.widget.margins.right+"px",r.widget.size.innerHeight=parseInt(r.widget.size.height)-r.widget.margins.top-r.widget.margins.bottom+"px",s}),s.render=(t=>(r.widget.update(t),r.widget.dom.container.style(r.widget.pos.x.ignore,null).style(r.widget.pos.x.attr,r.widget.pos.x.value).style(r.widget.pos.y.ignore,null).style(r.widget.pos.y.attr,r.widget.pos.y.value).style("width",r.widget.size.width).style("height",r.widget.size.height),r.widget.dom.container.style("display","block"),s)),{self:r,api:s}})(t,n,r,s,a,l);return d.chart={plots:d.widget.dom.container.append("g").attr("class","plots-container"),data:void 0,transition:!1},d.chart.transformData=(()=>{console.warn("Chart.transformData(data) is not implemented.")}),d.chart.update=(()=>{console.warn("Chart.update(duration) is not implemented.")}),d.chart.plotGroups=((t,e,o=700)=>{let n=t.selectAll(".plot-group").data(d.chart.data,t=>t.name),r=n.exit().transition().duration(o).style("opacity",0).remove(),s=n.enter().append("g").attr("class",t=>`plot-group ${i(t.name)}`).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent").style("stroke","transparent");e&&e.enter&&(s=e.enter(s));let a=s.merge(n).each(()=>{t.style("pointer-events","none"),d.chart.transition=!0}).on("mouseover",t=>{void 0!==d.mouse.enter&&d.mouse.enter(t)}).on("mouseleave",t=>{void 0!==d.mouse.leave&&d.mouse.leave(t)}).on("click",t=>{void 0!==d.mouse.click&&d.mouse.click(t)});e&&e.union&&e.union.before&&(a=e.union.before(a));let l=a.transition().duration(o).style("opacity",1).style("fill",t=>d.colors.mapping(t.name)).style("stroke",t=>d.colors.mapping(t.name));return e&&e.union&&e.union.after&&(l=e.union.after(l)),l.on("end",()=>{t.style("pointer-events","all"),d.chart.transition=!1}),{groups:n,enter:s,exit:r,union:{before:a,after:l}}}),d.chart.highlight=((t,o,n=0)=>{if(d.chart.transition)return p;let r=d.chart.plots.selectAll(t);if(r.transition(),"string"==typeof o)r.transition().duration(n).style("opacity",function(){return e.select(this).classed(i(o))?1:.1});else if(Array.isArray(o)){let t=o.map(t=>i(t));r.transition().duration(n).style("opacity",function(){let i=e.select(this);return t.reduce((t,e)=>t||i.classed(e),!1)?1:.1})}else r.transition().duration(n||0).style("opacity",1);return p}),d.widget.update=(t=>{d.chart.update(t),d.chart.plots.attr("width",d.widget.size.innerWidth+"px").attr("height",d.widget.size.innerHeight+"px").attr("transform","translate("+d.widget.margins.left+","+d.widget.margins.top+")")}),(p=p||{}).data=(t=>(d.chart.data=d.chart.transformData(t),p.colors(),p)),Object.assign(p,((t,e)=>{(t=t||{}).colors={policy:void 0,mapping:t=>i()};const i=()=>{let t=[];return e=>{let i=t.indexOf(e);return["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"][i>-1?i:t.push(e)-1]}};return(e=e||{}).colors=(o=>(t.colors.policy=o,t.colors.mapping=void 0===o?i():"string"==typeof o?()=>o:t=>o[t],e)),e})(d,p),o(d,p),((t,e)=>((t=t||{}).mouse={enter:void 0,leave:void 0,click:void 0},(e=e||{}).mouseover=(i=>(t.mouse.enter=i,e)),e.mouseleave=(i=>(t.mouse.leave=i,e)),e.click=(i=>(t.mouse.click=i,e)),e))(d,p),((t,e)=>((t=t||{}).font={size:"14px",color:"black"},(e=e||{}).fontSize=((i=14)=>(t.font.size=i+"px",e)),e.fontColor=(i=>(t.font.color=i,e)),e))(d,p))}});
