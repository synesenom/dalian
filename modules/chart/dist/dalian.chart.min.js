// https://www.npmjs.com/package/@dalian/chart v0.0.14 Copyright 2019 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-scale"),require("d3-axis"),require("d3-transition"),require("d3-selection"),require("@dalian/widget")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-axis","d3-transition","d3-selection","@dalian/widget"],e):e((t=t||self).chart={},t.d3,t.d3,t.d3,t.d3,t.Widget)}(this,function(t,e,a,s,i,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;t.Axes=class{constructor(t){this._dom=t.container.append("g").attr("class","axis-container"),this._fn={x:a.axisBottom().ticks(5),y:a.axisLeft().ticks(5)},this._axes={x:this._dom.append("g").attr("class","x axis"),y:this._dom.append("g").attr("class","y axis")},this._labels={x:this._dom.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:this._dom.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}update(t,e){this._dom.attr("transform","translate("+t.margins.left+","+t.margins.top+")").style("width",t.size.innerWidth).style("height",t.size.innerHeight).style("pointer-events","all"),this._fn.x.tickFormat(t.ticks.format.x),this._axes.x.transition().duration(700).call(this._fn.x.scale(e.x.scale)),this._axes.x.attr("transform","translate(0,"+parseFloat(t.size.innerHeight)+")"),this._axes.x.selectAll("path").style("fill","none").style("stroke",t.font.color).style("stroke-width","1px").style("shape-rendering","crispEdges"),this._fn.y.tickFormat(t.ticks.format.y),this._axes.y.transition().duration(700).call(this._fn.y.scale(e.y.scale)),this._axes.y.attr("transform","translate(0,1)"),this._axes.y.selectAll("path").style("fill","none").style("stroke",t.font.color).style("stroke-width","1px").style("shape-rendering","crispEdges"),this._labels.x.attr("x",t.size.innerWidth).attr("y",parseFloat(t.size.innerHeight)+2.2*parseInt(t.font.size)+"px").attr("fill",t.font.color).style("font-size",t.font.size).text(t.labels.x),this._labels.y.attr("x","5px").attr("y","-5px").attr("fill",t.font.color).style("font-size",t.font.size).text(t.labels.y)}},t.Chart=class extends r{constructor(t,e,a){super("chart-"+t,e,a),this._attr.labels={x:"",y:"",single:""},this._attr.ticks={format:{single:r.defaultFormat(),x:r.defaultFormat(),y:r.defaultFormat()}},this._state={transition:!1},this._dom.plots=this._dom.container.append("g").attr("class","plots-container"),this._data=[]}static scaleFactory(t){let a;switch(t){default:case"linear":a=e.scaleLinear();break;case"band":a=e.scaleBand().padding(.1);break;case"point":a=e.scalePoint().padding(.5)}return{g:()=>a,update:(e,s)=>{switch(t){default:case"linear":a.domain([Math.min(...e),Math.max(...e)]);break;case"band":case"point":a.domain(e)}s&&a.range(s)}}}static axisFactory(t){let e=t.container.append("g").attr("class","axis-container"),s={x:a.axisBottom(null).ticks(5),y:a.axisLeft(null).ticks(5)},i={x:e.append("g").attr("class","x axis"),y:e.append("g").attr("class","y axis")},r={x:e.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:e.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)};return{g:()=>e,update:(t,a)=>{e.attr("transform","translate("+t.margins.left+","+t.margins.top+")").style("width",t.size.innerWidth).style("height",t.size.innerHeight).style("pointer-events","all"),i.x.transition().duration(700).call(s.x.scale(a.x.g())),i.y.transition().duration(700).call(s.y.scale(a.y.g())),s.x.tickFormat(t.ticks.format.x),i.x.attr("transform","translate(0,"+parseFloat(t.size.innerHeight)+")"),s.y.tickFormat(t.ticks.format.y),i.y.attr("transform","translate(0,1)"),r.x.attr("x",t.size.innerWidth).attr("y",parseFloat(t.size.innerHeight)+2.2*parseInt(t.font.size)+"px").attr("fill",t.font.color).style("font-size",t.font.size).text(t.labels.x),r.y.attr("x","5px").attr("y","-5px").attr("fill",t.font.color).style("font-size",t.font.size).text(t.labels.y)}}}label(t){return this._attr.labels.single=t,this}xLabel(t){return this._attr.labels.x=t,this}yLabel(t){return this._attr.labels.y=t,this}tickFormat(t){return this._attr.ticks.format.single=null!=t?t:r.defaultFormat(),this}xTickFormat(t){return this._attr.ticks.format.x=null!=t?t:r.defaultFormat(),this}yTickFormat(t){return this._attr.ticks.format.y=null!=t?t:r.defaultFormat(),this}data(t){return this._data=this._transformData(t),null!==this._attr.colors.policy&&void 0!==this._attr.colors.policy||(this._attr.colors.mapping=r.defaultColors()),this}_transformData(t){console.warn("Chart._transformData(values) is not implemented")}_chartUpdate(){console.warn("Chart._chartUpdate() is not implemented")}_createTooltipContent(t){return console.warn("Chart._createTooltipContent() is not implemented"),null}_plotGroups(t,e,a=700){let s=t.selectAll(".plot-group").data(this._data,t=>t.name),i=s.exit().transition().duration(a).style("opacity",0).remove(),n=s.enter().append("g").attr("class",t=>`plot-group ${r.encode(t.name)}`).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent").style("stroke","transparent");e&&e.enter&&(n=e.enter(n));let l=this,o=n.merge(s).each(()=>{t.style("pointer-events","none"),this._state.transition=!0}).on("mouseover",t=>{l._attr.mouse.enter&&l._attr.mouse.enter(t)}).on("mouseleave",t=>{l._attr.mouse.leave&&l._attr.mouse.leave(t)}).on("click",t=>{l._attr.mouse.click&&l._attr.mouse.click(t)});e&&e.union&&e.union.before&&(o=e.union.before(o));let c=o.transition().duration(a).style("opacity",1).style("fill",t=>l._attr.colors.mapping(t.name)).style("stroke",t=>l._attr.colors.mapping(t.name));return e&&e.union&&e.union.after&&(c=e.union.after(c)),c.on("end",()=>{t.style("pointer-events","all"),this._state.transition=!1}),{groups:s,enter:n,exit:i,union:{before:o,after:c}}}_highlight(t,e,a){if(this._state.transition)return this;let s=this._dom.plots.selectAll(t);if(s.transition(),"string"==typeof e)s.transition().duration(a||0).style("opacity",function(){return i.select(this).classed(r.encode(e))?1:.1});else if(Array.isArray(e)){let t=e.map(function(t){return r.encode(t)});s.transition().duration(a||0).style("opacity",function(){let e=i.select(this);return t.reduce(function(t,a){return t||e.classed(a)},!1)?1:.1})}else s.transition().duration(a||0).style("opacity",1);return this}_update(t=700){this._chartUpdate(t),this._dom.plots.attr("width",this._attr.size.innerWidth+"px").attr("height",this._attr.size.innerHeight+"px").attr("transform","translate("+this._attr.margins.left+","+this._attr.margins.top+")")}_tooltip(t){let e=this._createTooltipContent(t);if(null==e)return null;let a=i.select(document.createElement("div"));switch(a.style("border-r","2px").style("padding","5px").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(e.title),a.style("border-left",e.stripe?"solid 2px "+e.stripe:null),e.content.type){case"metrics":e.content.data.forEach(function(t){let e=a.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label),e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":e.content.data.sort(function(t,e){return t.name.localeCompare(e.name)}).forEach(function(t){let e=a.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px"),s=e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);t.dashed&&s.style("background",`repeating-linear-gradient(45deg, transparent, transparent 2px, ${t.color} 2px, ${t.color} 4px`),e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)})}return a.node().outerHTML}},t.Scale=class{constructor(t){switch(this._type=t,t){default:case"linear":this._scale=e.scaleLinear();break;case"band":this._scale=e.scaleBand().padding(.1);break;case"point":this._scale=e.scalePoint().padding(.5)}}get scale(){return this._scale}update(t,e){switch(this._type){default:case"linear":this._scale.domain([Math.min(...t),Math.max(...t)]);break;case"band":case"point":this._scale.domain(t)}e&&this._scale.range(e)}},Object.defineProperty(t,"__esModule",{value:!0})});
