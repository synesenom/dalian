// https://www.npmjs.com/package/@dalian/chart v0.1.0 Copyright 2019 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-selection"),require("d3-ease"),require("@dalian/core")):"function"==typeof define&&define.amd?define(["d3-selection","d3-ease","@dalian/core"],e):((t=t||self).dalian=t.dalian||{},t.dalian.Chart=e(t.d3,t.d3,t.dalian.core))}(this,function(t,e,i){"use strict";var o=t=>(""+t).replace(/ /g,"__"),n=(t,e)=>((t=t||{})._font={size:"14px",color:"black"},(e=e||{}).fontSize=((i=14)=>(t._font.size=i+"px",e)),e.fontColor=(i=>(t._font.color=i,e)),{self:t,api:e}),a=(t,e)=>{(t=t||{})._colors={policy:void 0,mapping:t=>i()};const i=()=>{let t=[];return e=>{let i=t.indexOf(e);return["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"][i>-1?i:t.push(e)-1]}};return(e=e||{}).colors=(o=>(t._colors.policy=o,t._colors.mapping=void 0===o?i():"string"==typeof o?()=>o:t=>o[t],e)),{self:t,api:e}},l=(o,n)=>{(o=o||{})._tooltip={containerId:"dalian-tooltip-container",containerElem:void 0,id:`${o._widget.id}-tooltip`,elem:void 0,on:!1};return o._widget.update=i.extend(o._widget.update,()=>{o._widget.container.style("pointer-events",o._tooltip.on?"all":null).on("mousemove",()=>o._tooltip.on&&o._tooltip.show())}),o._tooltip.createContent=(()=>{console.warn("createTooltip(mouse) is not implemented")}),o._tooltip.show=(()=>{let i=t.mouse(o._widget.container.node()),n=t.event.pageX,a=t.event.pageY,l=o._widget.container.node().getBoundingClientRect(),s={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(n<l.left+o._widget.margins.left-s.left||n>l.right-o._widget.margins.right+s.left||a<l.top+o._widget.margins.top-s.top||a>l.bottom-o._widget.margins.bottom+s.top)return void t.select("#"+o._tooltip.id).transition().duration(200).style("opacity",0).on("end",function(){t.select(this).style("display","none")});o._tooltip.containerElem=(()=>{if(t.select("#"+o._tooltip.containerId).empty())return t.select("body").append("div").attr("id",o.tooltip.containerId)})(),o._tooltip.elem=((t,e)=>void 0===o._tooltip.elem||o._tooltip.elem.empty()?o._tooltip.containerElem.append("div").attr("id",o._tooltip.id).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-r","2px").style("box-shadow","0 0 3px grey").style("font-family",'"Courier", monospace').style("font-size","0.7em").style("color","black").style("pointer-events","none").style("left",(t.left+t.right)/2+e.left+"px").style("top",(t.top+t.bottom)/2+e.top+"px"):o._tooltip.elem)(l,s);let r=o._tooltip.createContent([i[0]-o._widget.margins.left,i[1]-o._widget.margins.top]);if(void 0===r){if(void 0!==o._tooltip.elem)return void o._tooltip.elem.transition().duration(200).style("opacity",0).on("end",function(){t.select(this).style("display","none")})}else o._tooltip.elem.html(r);let d=o._tooltip.elem.node().getBoundingClientRect(),p=d.width,g=d.height,c=n+20,_=a+20;c+p>l.right-o._widget.margins.right+s.left-5&&(c-=p+s.left+40),_+g>l.bottom-o._widget.margins.bottom+s.top-5&&(_=l.bottom-o._widget.margins.bottom+s.top-10-g),o._tooltip.elem.style("display","block").transition().duration(0).style("opacity",1).transition(),o._tooltip.elem.transition().duration(200).ease(e.easeLinear).style("left",c+"px").style("top",_+"px")}),(n=n||{}).tooltip=(t=>(o._tooltip.on=t,n)),{self:o,api:n}},s=(t,e)=>((t=t||{})._mouse={callbacks:{}},t._mouse.mouseover=((...e)=>{void 0!==t._mouse.callbacks.over&&t._mouse.callbacks.over(...e)}),t._mouse.mouseleave=((...e)=>{void 0!==t._mouse.callbacks.leave&&t._mouse.callbacks.leave(...e)}),t._mouse.click=((...e)=>{void 0!==t._mouse.callbacks.click&&t._mouse.callbacks.click(...e)}),(e=e||{}).mouseover=(i=>(t._mouse.callbacks.over=i,e)),e.mouseleave=(i=>(t._mouse.callbacks.leave=i,e)),e.click=(i=>(t._mouse.callbacks.click=i,e)),{self:t,api:e});return(e,i,r,d)=>{let{self:p,api:g}=((t,...e)=>{let{self:i,api:o}=t;return e.reduce((t,e)=>{let{s:n,a:a}=e(t.self,t.api);return{self:Object.assign(i,n),api:Object.assign(o,a)}},{self:i,api:o})})(((e,i,o,n)=>{let a={};a._widget={parent:t.select(o),id:`dalian-widget-${e}-${i}`,container:void 0,pos:{x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}},size:{width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},margins:{left:0,right:0,top:0,bottom:0}};try{a._widget.container=a._widget.parent.append(n).attr("id",a._widget.id).attr("class",`dalian-widget dalian-widget-${e}`).style("display","none").style("position","absolute").style("width",a._widget.size.width).style("height",a._widget.size.height).style("left",a._widget.pos.x+"px").style("top",a._widget.pos.y+"px")}catch(t){throw Error("MissingDOMException: DOM is not present.")}a._widget.update=(()=>{console.warn("Widget.update(duration) is not implemented")});let l={x:(t=0)=>(a._widget.pos.x.attr=t>=0?"left":"right",a._widget.pos.x.ignore=t>=0?"right":"left",a._widget.pos.x.value=Math.abs(t)+"px",l),y:(t=0)=>(a._widget.pos.y.attr=t>=0?"top":"bottom",a._widget.pos.y.ignore=t>=0?"bottom":"top",a._widget.pos.y.value=Math.abs(t)+"px",l),width:(t=300)=>(a._widget.size.width=t+"px",a._widget.size.innerWidth=t-a._widget.margins.left-a._widget.margins.right+"px",l),height:(t=200)=>(a._widget.size.height=t+"px",a._widget.size.innerHeight=t-a._widget.margins.top-a._widget.margins.bottom+"px",l),margins:t=>{switch(typeof t){case"undefined":default:a._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":a._widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":a._widget.margins=Object.assign(a._widget.margins,t)}return a._widget.size.innerWidth=parseInt(a._widget.size.width)-a._widget.margins.left-a._widget.margins.right+"px",a._widget.size.innerHeight=parseInt(a._widget.size.height)-a._widget.margins.top-a._widget.margins.bottom+"px",l},render:t=>(a._widget.update(t),a._widget.container.style(a._widget.pos.x.ignore,null).style(a._widget.pos.x.attr,a._widget.pos.x.value).style(a._widget.pos.y.ignore,null).style(a._widget.pos.y.attr,a._widget.pos.y.value).style("width",a._widget.size.width).style("height",a._widget.size.height),a._widget.container.style("display","block"),l)};return{self:a,api:l}})(e,i,r,d),n,a,s,l);return p._chart={plots:p._widget.container.append("g").attr("class","plots-container"),transition:!1},p._chart.transformData=(()=>{console.warn("Chart.transformData(data) is not implemented.")}),p._chart.update=(()=>{console.warn("Chart.update(duration) is not implemented.")}),p._chart.plotGroups=((t,e,i=700)=>{let n=t.selectAll(".plot-group").data(p._chart.data,t=>t.name),a=n.exit().transition().duration(i).style("opacity",0).remove(),l=n.enter().append("g").attr("class",t=>`plot-group ${o(t.name)}`).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent").style("stroke","transparent");e&&e.enter&&(l=e.enter(l));let s=l.merge(n).each(()=>{t.style("pointer-events","none"),p._chart.transition=!0}).on("mouseover",t=>{void 0!==p.mouse.enter&&p.mouse.enter(t)}).on("mouseleave",t=>{void 0!==p.mouse.leave&&p.mouse.leave(t)}).on("click",t=>{void 0!==p.mouse.click&&p.mouse.click(t)});e&&e.union&&e.union.before&&(s=e.union.before(s));let r=s.transition().duration(i).style("opacity",1).style("fill",t=>p.colors.mapping(t.name)).style("stroke",t=>p.colors.mapping(t.name));return e&&e.union&&e.union.after&&(r=e.union.after(r)),r.on("end",()=>{t.style("pointer-events","all"),p._chart.transition=!1}),{groups:n,enter:l,exit:a,union:{before:s,after:r}}}),p._chart.highlight=((e,i,n=0)=>{if(p._chart.transition)return g;let a=p._chart.plots.selectAll(e);if(a.transition(),"string"==typeof i)a.transition().duration(n).style("opacity",function(){return t.select(this).classed(o(i))?1:.1});else if(Array.isArray(i)){let e=i.map(t=>o(t));a.transition().duration(n).style("opacity",function(){let i=t.select(this);return e.reduce((t,e)=>t||i.classed(e),!1)?1:.1})}else a.transition().duration(n||0).style("opacity",1);return g}),p._widget.update=(t=>{p._chart.update(t),p._chart.plots.attr("width",p._widget.size.innerWidth+"px").attr("height",p._widget.size.innerHeight+"px").attr("transform","translate("+p._widget.margins.left+","+p._widget.margins.top+")")}),(g=g||{}).data=(t=>(p._chart.data=p._chart.transformData(t),g.colors(),g)),{self:p,api:g}}});
