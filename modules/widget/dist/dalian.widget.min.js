// https://www.npmjs.com/package/@dalian/widget v0.0.10 Copyright 2019 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-selection"),require("d3-transition"),require("d3-color"),require("d3-format"),require("d3-ease")):"function"==typeof define&&define.amd?define(["d3-selection","d3-transition","d3-color","d3-format","d3-ease"],e):(t=t||self).Widget=e(t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,i,s,o){"use strict";class r{constructor(e,i,s="body",o="svg"){this._id=`dalian-widget-${e}-${i}`,this._dom={};try{this._dom.container=t.select(s).append(o).attr("id",this._id).attr("class",`dalian-widget dalian-widget-${e}`).style("display","none").style("position","absolute")}catch(t){throw Error("MissingDOMException: DOM is not present.")}return this._attr={pos:{x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}},size:{width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},margins:{left:0,right:0,top:0,bottom:0},font:{size:"14px",color:"black"},colors:{policy:null,mapping:()=>"black"},mouse:{enter:null,leave:null,click:null},flags:{tooltip:!1}},this._placeholder=null,this}static encode(t){return(""+t).replace(/ /g,"__")}static defaultColors(){let t=[];return e=>{let i=t.indexOf(e);return["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"][i>-1?i:t.push(e)-1]}}static defaultFormat(){return t=>t>1?s.format(".2s")(t):t+""}_update(t=700){console.warn("Widget._update(duration) is not implemented")}_tooltip(t){console.warn("Widget._tooltip(mouse) is not implemented")}_showTooltip(){let e=`${this._id}-tooltip`,s=t.mouse(this._dom.container.node()),r=t.event.pageX,l=t.event.pageY,n=this._dom.container.node().getBoundingClientRect(),a=window.pageXOffset||document.documentElement.scrollLeft,h=window.pageYOffset||document.documentElement.scrollTop;if(r<n.left+this._attr.margins.left-a||r>n.right-this._attr.margins.right+a||l<n.top+this._attr.margins.top-h||l>n.bottom-this._attr.margins.bottom+h)return t.select("#"+e).transition().duration(200).style("opacity",0).on("end",function(){t.select(this).style("display","none")}),void this._tooltip();t.select("#dalian-widget-tooltip-container").empty()&&t.select("body").append("div").attr("id","dalian-widget-tooltip-container");let p=t.select("#"+e);if(t.select("#"+e).empty()){let s=i.color(this._attr.font.color);s.opacity=.3,p=t.select("#dalian-widget-tooltip-container").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-r","2px").style("box-shadow","0 0 3px "+s).style("font-family",'"Courier", monospace').style("font-size","0.7em").style("color",this._attr.font.color).style("pointer-events","none").style("left",(n.left+n.right)/2+a+"px").style("top",(n.top+n.bottom)/2+h+"px")}let d=this._tooltip([s[0]-this._attr.margins.left,s[1]-this._attr.margins.top]);if(!d)return t.select("#"+e).transition().duration(200).style("opacity",0).on("end",function(){t.select(this).style("display","none")}),void this._tooltip();p.html(d);let c=p.node().getBoundingClientRect(),y=c.width,_=c.height,u=r+20,m=l+20;u+y>n.right-this._attr.margins.right+a-5&&(u-=y+a+40),m+_>n.bottom-this._attr.margins.bottom+h-5&&(m=n.bottom-this._attr.margins.bottom+h-10-_),p.style("display","block").transition().duration(0).style("opacity",1).transition(),p.transition().duration(200).ease(o.easeLinear).style("left",u+"px").style("top",m+"px")}render(t=700){return this._update(t),this._dom.container.transition().duration(t).style(this._attr.pos.x.ignore,null).style(this._attr.pos.x.attr,this._attr.pos.x.value).style(this._attr.pos.y.ignore,null).style(this._attr.pos.y.attr,this._attr.pos.y.value).style("width",this._attr.size.width).style("height",this._attr.size.height),this._dom.container.style("font-family","inherit"),this._dom.container.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",this._attr.font.size).style("fill",this._attr.font.color),this._dom.container.selectAll("g").attr("font-family","inherit"),this._dom.container.style("pointer-events",this._attr.flags.tooltip?"all":null).on("mousemove",()=>this._attr.flags.tooltip&&this._showTooltip()),null===this._placeholder||this._placeholder.empty()||this._placeholder.style(this._attr.pos.x.ignore,null).style(this._attr.pos.x.attr,this._attr.pos.x.value).style(this._attr.pos.y.ignore,null).style(this._attr.pos.y.attr,this._attr.pos.y.value).style("width",this._attr.size.width).style("height",this._attr.size.height).style("color",this._attr.font.color).style("font-size",this._attr.font.size),this._dom.container.style("display","block"),this}description(e){if(e){let i=this._id+"-description";this._dom.container.on("contextmenu",()=>{t.event.preventDefault(),t.select("#"+i).empty()&&t.select("body").append("div").attr("id",i).style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-r","3px").style("color","black").style("font-size","0.8em").style("font-family","inherit").style("line-height","1.35em").style("pointer-events","none").html(e)}).on("mouseleave",()=>{let e=t.select("#"+i);e.empty()||e.remove()})}else this._dom.container.on("contextmenu",null);return this}placeholder(e,i=700){let s=this._id+"-placeholder";return e?(this._dom.container.transition().duration(i).style("opacity",0),(null===this._placeholder||this._placeholder.empty())&&(this._placeholder=t.select("body").append("div").attr("id",s).style("display","table").style("position","absolute").style("width",this._attr.size.innerWidth).style("height",this._attr.size.innerHeight).style(this._attr.pos.x.attr,this._attr.pos.x.value).style(this._attr.pos.y.attr,this._attr.pos.y.value).style("color",this._attr.font.color).style("font-family","inherit").style("font-size",this._attr.font.size).style("pointer-events","none"),this._placeholder.append("span").style("display","table-cell").style("vertical-align","middle").style("line-height","normal").style("text-align","center").style("color","inherit").style("font-family","inherit").style("font-size","inherit").style("opacity",0).html(e).transition().duration(i).style("opacity",1))):(this._dom.container.transition().duration(i).style("opacity",1),null===this._placeholder||this._placeholder.empty()||(this._placeholder.transition().duration(i).style("opacity",0).remove(),this._placeholder=null)),this}x(t=0){return this._attr.pos.x.attr=t>=0?"left":"right",this._attr.pos.x.ignore=t>=0?"right":"left",this._attr.pos.x.value=Math.abs(t)+"px",this}y(t=0){return this._attr.pos.y.attr=t>=0?"top":"bottom",this._attr.pos.y.ignore=t>=0?"bottom":"top",this._attr.pos.y.value=Math.abs(t)+"px",this}width(t=300){return this._attr.size.width=t+"px",this._attr.size.innerWidth=t-this._attr.margins.left-this._attr.margins.right+"px",this}height(t=200){return this._attr.size.height=t+"px",this._attr.size.innerHeight=t-this._attr.margins.top-this._attr.margins.bottom+"px",this}margins(t=0){switch(typeof t){case"number":this._attr.margins={left:t,right:t,top:t,bottom:t};break;case"object":for(let e in this._attr.margins)this._attr.margins.hasOwnProperty(e)&&e in t&&(this._attr.margins[e]=t[e])}return this._attr.size.innerWidth=parseInt(this._attr.size.width)-this._attr.margins.left-this._attr.margins.right+"px",this._attr.size.innerHeight=parseInt(this._attr.size.height)-this._attr.margins.top-this._attr.margins.bottom+"px",this}fontSize(t=14){return this._attr.font.size=t+"px",this}fontColor(t="black"){return this._attr.font.color=t,this}colors(t=null){return this._attr.colors.policy=t,this._attr.colors.mapping=null===t?r.defaultColors():"string"==typeof t?()=>t:e=>t[e],this}mouseover(t=null){return this._attr.mouse.enter=t,this}mouseleave(t=null){return this._attr.mouse.leave=t,this}click(t=null){return this._attr.mouse.click=t,this}tooltip(t=!1){return this._attr.flags.tooltip=t,this}}return r});
