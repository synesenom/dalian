// https://www.npmjs.com/package/@dalian/chart v0.1.0 Copyright 2019 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-selection"),require("d3-ease"),require("@dalian/core")):"function"==typeof define&&define.amd?define(["d3-selection","d3-ease","@dalian/core"],e):((t=t||self).dalian=t.dalian||{},t.dalian.components=t.dalian.components||{},t.dalian.components.Chart=e(t.d3,t.d3,t.dalian.core))}(this,function(t,e,i){"use strict";var o=t=>(""+t).replace(/ /g,"__"),n=(t,e)=>{(t=t||{})._font={size:"12px",color:"black"};return t._widget.update=((t,e,i=!1)=>{let o=t;return(...t)=>{i?(e(...t),o(...t)):(o(...t),e(...t))}})(t._widget.update,()=>{t._widget.container.style("font-size",t._font.size).style("color",t._font.color)},!0),(e=e||{}).fontSize=((i=12)=>(t._font.size=i+"px",e)),e.fontColor=(i=>(t._font.color=i,e)),{self:t,api:e}},s=(t,e)=>{const i=()=>{let t=[];return e=>{let i=t.indexOf(e);return["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"][i>-1?i:t.push(e)-1]}};return(t=t||{})._colors={policy:void 0,mapping:i()},(e=e||{}).colors=(o=>(t._colors.policy=o,t._colors.mapping=void 0===o?i():"string"==typeof o?()=>o:t=>o[t],e)),{self:t,api:e}},a=(o,n)=>{(o=o||{})._tooltip={container:{id:"dalian-tooltip-container"},id:`${o._widget.id}-tooltip`,on:!1};const s=()=>{void 0!==o._tooltip.elem&&o._tooltip.elem.transition().duration(200).style("opacity",0).on("end",function(){t.select(this).style("display","none")})};return o._widget.update=i.extend(o._widget.update,()=>{o._widget.container.style("pointer-events",o._tooltip.on?"all":null).on("mousemove",()=>{o._tooltip.on&&o._tooltip.show()}).on("mouseout",s)}),o._tooltip.createContent=(()=>{console.warn("createTooltip(mouse) is not implemented")}),o._tooltip.show=(()=>{console.log("show");let i=t.event.pageX,n=t.event.pageY,a=o._widget.container.node().getBoundingClientRect(),l={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(i<a.left+o._widget.margins.left-l.left||i>a.right-o._widget.margins.right+l.left||n<a.top+o._widget.margins.top-l.top||n>a.bottom-o._widget.margins.bottom+l.top)return void s();o._tooltip.container.elem=(()=>{if(t.select("#"+o._tooltip.container.id).empty())return t.select("body").append("div").attr("id",o._tooltip.container.id)})(),o._tooltip.elem=((t,e)=>void 0===o._tooltip.elem||o._tooltip.elem.empty()?o._tooltip.container.elem.append("div").attr("id",o._tooltip.id).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-radius","2px").style("padding","5px").style("box-shadow","0 0 3px grey").style("font-family",'"Courier", monospace').style("font-size","0.7em").style("color","black").style("pointer-events","none").style("left",(t.left+t.right)/2+e.left+"px").style("top",(t.top+t.bottom)/2+e.top+"px"):o._tooltip.elem)(a,l);let r=t.mouse(o._widget.container.node()),d=o._tooltip.createContent([r[0]-o._widget.margins.left,r[1]-o._widget.margins.top]);if(void 0===d){if(void 0!==o._tooltip.elem)return void s()}else o._tooltip.elem.html(d);let p=o._tooltip.elem.node().getBoundingClientRect(),g=p.width,c=p.height,_=i+20,m=n+20;_+g>a.right-o._widget.margins.right+l.left-5&&(_-=g+l.left+40),m+c>a.bottom-o._widget.margins.bottom+l.top-5&&(m=a.bottom-o._widget.margins.bottom+l.top-10-c),o._tooltip.elem.style("display","block").transition().duration(0).style("opacity",1).transition(),o._tooltip.elem.transition().duration(200).ease(e.easeLinear).style("left",_+"px").style("top",m+"px")}),(n=n||{}).tooltip=(t=>(o._tooltip.on=t,n)),{self:o,api:n}},l=(t,e)=>((t=t||{})._mouse={callbacks:{}},t._mouse.mouseover=((...e)=>{void 0!==t._mouse.callbacks.over&&t._mouse.callbacks.over(...e)}),t._mouse.mouseleave=((...e)=>{void 0!==t._mouse.callbacks.leave&&t._mouse.callbacks.leave(...e)}),t._mouse.click=((...e)=>{void 0!==t._mouse.callbacks.click&&t._mouse.callbacks.click(...e)}),(e=e||{}).mouseover=(i=>(t._mouse.callbacks.over=i,e)),e.mouseleave=(i=>(t._mouse.callbacks.leave=i,e)),e.click=(i=>(t._mouse.callbacks.click=i,e)),{self:t,api:e});return(e,i,r,d)=>{let{self:p,api:g}=((t,...e)=>{let{self:i,api:o}=t;return e.reduce((t,e)=>{let{s:n,a:s}=e(t.self,t.api);return{self:Object.assign(i,n),api:Object.assign(o,s)}},{self:i,api:o})})(((e,i,o,n)=>{let s={};s._widget={parent:t.select(o),id:`dalian-widget-${e}-${i}`,container:void 0,pos:{x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}},size:{width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},margins:{left:0,right:0,top:0,bottom:0}};try{s._widget.container=s._widget.parent.append("div").attr("id",s._widget.id).attr("class",`dalian-widget dalian-widget-${e}`).style("display","none").style("position","absolute").style("width",s._widget.size.width).style("height",s._widget.size.height).style("left",s._widget.pos.x+"px").style("top",s._widget.pos.y+"px").style("font-family","inherit").style("font-size","inherit").style("font-color","inherit"),s._widget.content=s._widget.container.append(n).attr("id",`${s._widget.id}-content`).attr("class","dalian-widget-content").style("position","absolute").style("width",s._widget.size.width).style("height",s._widget.size.height).style("left",0).style("top",0).style("font-family","inherit").style("font-size","inherit").style("font-color","inherit")}catch(t){throw Error("MissingDOMException: DOM is not present.")}s._widget.update=(()=>{});let a={x:(t=0)=>(s._widget.pos.x.attr=t>=0?"left":"right",s._widget.pos.x.ignore=t>=0?"right":"left",s._widget.pos.x.value=Math.abs(t)+"px",a),y:(t=0)=>(s._widget.pos.y.attr=t>=0?"top":"bottom",s._widget.pos.y.ignore=t>=0?"bottom":"top",s._widget.pos.y.value=Math.abs(t)+"px",a),width:(t=300)=>(s._widget.size.width=t+"px",s._widget.size.innerWidth=t-s._widget.margins.left-s._widget.margins.right+"px",a),height:(t=200)=>(s._widget.size.height=t+"px",s._widget.size.innerHeight=t-s._widget.margins.top-s._widget.margins.bottom+"px",a),margins:t=>{switch(typeof t){case"undefined":default:s._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":s._widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":s._widget.margins=Object.assign(s._widget.margins,t)}return s._widget.size.innerWidth=parseInt(s._widget.size.width)-s._widget.margins.left-s._widget.margins.right+"px",s._widget.size.innerHeight=parseInt(s._widget.size.height)-s._widget.margins.top-s._widget.margins.bottom+"px",a},render:t=>(s._widget.update(t),s._widget.container.style(s._widget.pos.x.ignore,null).style(s._widget.pos.x.attr,s._widget.pos.x.value).style(s._widget.pos.y.ignore,null).style(s._widget.pos.y.attr,s._widget.pos.y.value).style("width",s._widget.size.width).style("height",s._widget.size.height),s._widget.content.style("width",s._widget.size.width).style("height",s._widget.size.height),s._widget.container.style("display","block"),a)};return{self:s,api:a}})(e,i,r,d),n,s,l,a);return p._chart={plots:p._widget.container.append("g").attr("class","plots-container"),transition:!1},p._chart.transformData=(()=>{console.warn("Chart.transformData(data) is not implemented.")}),p._chart.update=(()=>{console.warn("Chart.update(duration) is not implemented.")}),p._chart.plotGroups=((t,e,i=700)=>{let n=t.selectAll(".plot-group").data(p._chart.data,t=>t.name),s=n.exit().transition().duration(i).style("opacity",0).remove(),a=n.enter().append("g").attr("class",t=>`plot-group ${o(t.name)}`).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent").style("stroke","transparent");e&&e.enter&&(a=e.enter(a));let l=a.merge(n).each(()=>{t.style("pointer-events","none"),p._chart.transition=!0}).on("mouseover",t=>{void 0!==p.mouse.enter&&p.mouse.enter(t)}).on("mouseleave",t=>{void 0!==p.mouse.leave&&p.mouse.leave(t)}).on("click",t=>{void 0!==p.mouse.click&&p.mouse.click(t)});e&&e.union&&e.union.before&&(l=e.union.before(l));let r=l.transition().duration(i).style("opacity",1).style("fill",t=>p.colors.mapping(t.name)).style("stroke",t=>p.colors.mapping(t.name));return e&&e.union&&e.union.after&&(r=e.union.after(r)),r.on("end",()=>{t.style("pointer-events","all"),p._chart.transition=!1}),{groups:n,enter:a,exit:s,union:{before:l,after:r}}}),p._chart.highlight=((e,i,n=0)=>{if(p._chart.transition)return g;let s=p._chart.plots.selectAll(e);if(s.transition(),"string"==typeof i)s.transition().duration(n).style("opacity",function(){return t.select(this).classed(o(i))?1:.1});else if(Array.isArray(i)){let e=i.map(t=>o(t));s.transition().duration(n).style("opacity",function(){let i=t.select(this);return e.reduce((t,e)=>t||i.classed(e),!1)?1:.1})}else s.transition().duration(n||0).style("opacity",1);return g}),p._widget.update=(t=>{p._chart.update(t),p._chart.plots.attr("width",p._widget.size.innerWidth+"px").attr("height",p._widget.size.innerHeight+"px").attr("transform","translate("+p._widget.margins.left+","+p._widget.margins.top+")")}),(g=g||{}).data=(t=>(p._chart.data=p._chart.transformData(t),g.colors(),g)),{self:p,api:g}}});
