// https://www.npmjs.com/package/dalian v0.0.2 Copyright 2020 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],t):t((e=e||self).dalian={},e.d3,e.d3)}(this,function(e,t,a){"use strict";var i=e=>(""+e).replace(/ /g,"__"),r=(e,t,a=!1)=>{let i=e;return(...e)=>{a?(t(...e),i(...e)):(i(...e),t(...e))}},n=(e,...t)=>{let{self:a,api:i}=e;return t.reduce((e,t)=>{let r=t(e.self,e.api);return{self:Object.assign(a,r.self),api:Object.assign(i,r.api)}},{self:a,api:i})},o=["#333333","#0072b2","#56b4e9","#009e73","#f0e442","#e69f00","#d55e00","#cc79a7"],l=["#77aadd","#99ddff","#44bb99","#bbcc33","#aaaa00","#eedd88","#ee8866","#ffaabb","#dddddd"];const s={protan:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deutan:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritan:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}};function d(e){return{r:3.063218*e.x-1.393325*e.y-.475802*e.z,g:-.969243*e.x+1.875966*e.y+.041555*e.z,b:.067871*e.x-.228834*e.y+1.069251*e.z}}function c(e,t){let a=1.75,i=a+1;return d3.rgb((a*t.r+e.r)/i,(a*t.g+e.g)/i,(a*t.b+e.b)/i)}function p(e){let t=Math.round(.299*e.r+.587*e.g+.114*e.b);return d3.rgb(t,t,t)}function u(e,t){let a={r:Math.pow(e.r/255,2.2),g:Math.pow(e.g/255,2.2),b:Math.pow(e.b/255,2.2)};var i;const r=(a={x:.430574*(i=a).r+.34155*i.g+.178325*i.b,y:.222015*i.r+.706655*i.g+.07133*i.b,z:.020183*i.r+.129553*i.g+.93918*i.b}).x+a.y+a.z;a.u=0,a.v=0,0!==r&&(a.u=a.x/r,a.v=a.y/r);let n,o=.312713*a.y/.329016,l=.358271*a.y/.329016,c={y:0};n=a.u<s[t].cpu?(s[t].cpv-a.v)/(s[t].cpu-a.u):(a.v-s[t].cpv)/(a.u-s[t].cpu);let p=a.v-a.u*n;c.u=(s[t].ayi-p)/(n-s[t].am),c.v=n*c.u+p;let u={x:c.u*a.y/c.v,y:a.y,z:(1-(c.u+c.v))*a.y/c.v};c.x=o-u.x,c.z=l-u.z,c=d(c),u=d(u);let g={r:c.r?((u.r<0?0:1)-u.r)/c.r:0,g:c.g?((u.g<0?0:1)-u.g)/c.g:0,b:c.b?((u.b<0?0:1)-u.b)/c.b:0},m=Math.max(g.r>1||g.r<0?0:g.r,g.g>1||g.g<0?0:g.g,g.b>1||g.b<0?0:g.b);u.r=u.r+m*c.r,u.g=u.g+m*c.g,u.b=u.b+m*c.b;const y=e=>255*(e<=0?0:e>=1?1:Math.pow(e,1/2.2));return d3.rgb(y(u.r),y(u.g),y(u.b))}const g={protanopia:e=>u(e,"protan"),protanomaly:e=>c(e,u(e,"protan")),deuteranopia:e=>u(e,"deutan"),deuteranomaly:e=>c(e,u(e,"deutan")),tritanopia:e=>u(e,"tritan"),tritanomaly:e=>c(e,u(e,"tritan")),achromatopsia:e=>p(e),achromatomaly:e=>c(e,p(e))};const m=e=>"string"==typeof e?()=>e:Array.isArray(e)?(()=>{let t=[];return a=>{let i=t.indexOf(a);return e[i>-1?i:t.push(a)-1]}})():"object"==typeof e?t=>e[t]:void 0;var y=(e,t)=>{let a={on:e=>e,palette:o,converter:e=>e,getMapping:()=>m(((e,t)=>{if(void 0===e||"palette-wong"===e)return o.map(t);if("palette-light"===e)return l.map(t);if("string"==typeof e)return t(e)+"";if(Array.isArray(e))return e.map(t);{let a={};for(let i in e)a[i]=t(e[i]);return a}})(a.palette,a.converter)),mapping:m(o)};return{self:e=Object.assign(e||{},{_color:{mapGroup:e=>a.mapping(a.on(e))}}),api:t=Object.assign(t||{},{color:{palette:(e,i)=>(a.palette=e||o,a.on=i||(e=>e),a.mapping=a.getMapping(),t),deficiency:e=>(a.converter=(e=>void 0===g[e]?e=>e:t=>g[e](d3.rgb(t)))(e),a.mapping=a.getMapping(),t)}})}},h=(e,t)=>{for(let a in t)t.hasOwnProperty(a)&&e.style(a,t[a]);return e},x=(e,a)=>{let i={id:`${e._widget.id}-description`,getDescription:()=>void 0===i.elem||i.elem.empty()?h(t.select("body").append("div").attr("id",i.id),{position:"absolute",left:t.event.pageX+20+"px",top:t.event.pageY-20+"px",width:"auto","max-width":"500px",padding:"10px",background:"#fff","box-shadow":"0 0 3px #000","border-radius":"3px",color:"#000","font-size":".8em","font-family":"inherit","line-height":"1.35em","pointer-events":"none"}):i.elem,removeDescription:()=>{void 0===i.elem||i.elem.empty()||(i.elem.remove(),delete i.elem)}};return a=Object.assign(a||{},{description:r=>(void 0===r?e._widget.container.on("contextmenu.description",null):e._widget.container.on("contextmenu.description",()=>{t.event.preventDefault(),i.elem=i.getDescription().html(r)}).on("mouseleave.description",()=>{i.removeDescription()}),a)}),{self:e,api:a}},f=(e,t)=>{let a={size:12,color:"black"};return(e=Object.assign(e||{},{_font:{size:a.size+"px",color:a.color}}))._widget.update=r(e._widget.update,()=>{e._widget.container.style("font-size",e._font.size).style("color",e._font.color)},!0),t=Object.assign(t||{},{font:{size:i=>(e._font.size=(i||a.size)+"px",t),color:i=>(e._font.color=i||a.color,t)}}),{self:e,api:t}},_=(e,t)=>{let a={callbacks:{}};return{self:e=Object.assign(e||{},{_mouse:{over:(...e)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...e)},leave:(...e)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...e)},click:(...e)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...e)},isEnabled:e=>"function"==typeof a.callbacks[e],hasAny:()=>Object.values(a.callbacks).reduce((e,t)=>e||"function"==typeof t,!1)}}),api:t=Object.assign(t||{},{mouse:{over:e=>(a.callbacks.over=e,t),leave:e=>(a.callbacks.leave=e,t),click:e=>(a.callbacks.click=e,t)}})}},v=(e,t)=>{let a={id:`${e._widget.id}-placeholder`};return e._widget.update=r(e._widget.update,t=>{void 0!==a.elem&&a.elem.style("font-size","inherit").transition().duration(t).style("width",e._widget.size.width).style("height",e._widget.size.height).style("color","inherit")}),t=Object.assign(t||{},{placeholder:(i,r=400)=>(void 0===i?(e._widget.content.style("display","block").transition().duration(r).style("opacity",1),e._widget.disable(!1),void 0===a.elem||a.elem.empty()||(a.elem.transition().duration(r).style("opacity",0).remove(),delete a.elem)):(e._widget.content.transition().duration(r).style("opacity",0).on("end",()=>{e._widget.content.style("display","none")}),e._widget.disable(!0),(void 0===a.elem||a.elem.empty())&&(a.elem=e._widget.container.append("div").attr("id",a.id).attr("class","dalian-placeholder"),h(a.elem,{display:"table",position:"absolute",width:e._widget.size.width,height:e._widget.size.height,left:0,top:0,color:"inherit","font-family":"inherit","font-size":"inherit","pointer-events":"none"}),h(a.elem.append("span"),{display:"table-cell","vertical-align":"middle","line-height":"normal","text-align":"center",color:"inherit","font-family":"inherit","font-size":"inherit",opacity:0}).html(i).transition().duration(r).style("opacity",1))),t)}),{self:e,api:t}},w=(e,a,o,l)=>{let{self:s,api:d}=n(((e,a,i,r)=>{let n={parent:t.select(i),initialized:!1,pos:{x:{attr:"left",ignore:"right",value:"0px"},y:{attr:"top",ignore:"bottom",value:"0px"}}},o={};o._widget={id:`dalian-widget-${e}-${a}`,container:void 0,size:{width:"300px",height:"200px",innerWidth:"300px",innerHeight:"200px"},margins:{left:0,right:0,top:0,bottom:0},transition:!1,disabled:!1,get:(e,t)=>n.initialized?e.transition().duration(t):(setTimeout(()=>n.initialized=!0,t),e),update:e=>{o._widget.get(o._widget.container,e).style(n.pos.x.ignore,null).style(n.pos.x.attr,n.pos.x.value).style(n.pos.y.ignore,null).style(n.pos.y.attr,n.pos.y.value).style("width",o._widget.size.width).style("height",o._widget.size.height)},disable:e=>{o._widget.disabled=e}};try{o._widget.container=n.parent.append("div").attr("id",o._widget.id).attr("class",`dalian-widget dalian-widget-${e}`),h(o._widget.container,{position:"absolute",width:o._widget.size.width,height:o._widget.size.height,left:n.pos.x+"px",top:n.pos.y+"px","font-family":"inherit","font-size":"inherit","font-color":"inherit"}),o._widget.content=o._widget.container.append(r).attr("class","dalian-widget-content"),h(o._widget.content,{position:"absolute",width:"100%",height:"100%",left:0,top:0,"font-family":"inherit","font-size":"inherit","font-color":"inherit","pointer-events":"none"})}catch(e){throw Error("MissingDOMException: DOM is not present.")}let l={x:(e=0)=>(n.pos.x.attr=e>=0?"left":"right",n.pos.x.ignore=e>=0?"right":"left",n.pos.x.value=Math.abs(e)+"px",l),y:(e=0)=>(n.pos.y.attr=e>=0?"top":"bottom",n.pos.y.ignore=e>=0?"bottom":"top",n.pos.y.value=Math.abs(e)+"px",l),width:(e=300)=>(o._widget.size.width=e+"px",o._widget.size.innerWidth=e-o._widget.margins.left-o._widget.margins.right+"px",l),height:(e=200)=>(o._widget.size.height=e+"px",o._widget.size.innerHeight=e-o._widget.margins.top-o._widget.margins.bottom+"px",l),margins:e=>{switch(typeof e){case"undefined":default:o._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":o._widget.margins={left:e,right:e,top:e,bottom:e};break;case"object":o._widget.margins=Object.assign(o._widget.margins,e)}return o._widget.size.innerWidth=parseInt(o._widget.size.width)-o._widget.margins.left-o._widget.margins.right+"px",o._widget.size.innerHeight=parseInt(o._widget.size.height)-o._widget.margins.top-o._widget.margins.bottom+"px",l},render:e=>(o._widget.update(e),l)};return{self:o,api:l}})(e,a,o,l),y,x,v,f,_),c=(()=>{const e=`${a}-dalian-plots-clipper`;return{clipId:e,clip:s._widget.content.append("defs").append("clipPath").attr("id",e).append("rect").attr("x",0).attr("y",0).attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight),update:e=>{s._widget.get(c.clip,e).attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight),s._widget.get(s._chart.plots,e).attr("width",s._widget.size.innerWidth+"px").attr("height",s._widget.size.innerHeight+"px").attr("transform","translate("+s._widget.margins.left+","+s._widget.margins.top+")")}}})();return(s=Object.assign(s||{},{_chart:{data:[],plots:s._widget.content.append("g").attr("class","dalian-plots-container"),plotSelectors:[],clipId:c.clipId,transformData:e=>e,plotGroups:(e,t)=>{let a=s._chart.plots.selectAll(".plot-group").data(s._chart.data,e=>e.name).join(t=>{let a=t.append("g").attr("class",e=>`plot-group ${i(e.name)}`).attr("clip-path",`url(#${c.clipId})`).style("color",e=>s._color.mapGroup(e.name)).style("shape-rendering","geometricPrecision");return e.enter?e.enter(a):a},e=>e,a=>{let i=a.transition().duration(t);(i=e.exit?e.exit(i):i).remove()}).on("mouseover.mouse",s._mouse.over).on("mouseleave.mouse",s._mouse.leave).on("click.mouse",s._mouse.click).each(()=>{s._chart.plots.style("pointer-events","none"),s._widget.transition=!0});a=(a=e.updateBefore?e.updateBefore(a):a).transition().duration(t).style("color",e=>s._color.mapGroup(e.name)),(a=e.update?e.update(a):a).on("end",()=>{s._chart.plots.style("pointer-events",s._tooltip&&s._tooltip.isOn()||s._mouse.hasAny()?"all":"none"),s._widget.transition=!1})}}}))._widget.update=r(s._widget.update,c.update),d=Object.assign(d,{data:e=>(s._chart.data=s._chart.transformData(e),d)}),{self:s,api:d}},b=(e,t,a,i)=>{let r=t._widget.content.append("g").attr("class",`dalian-axis-container ${e}`).style("font-family","inherit").style("font-size","inherit"),n=r.append("g").attr("class",`axis ${e}`).style("font-family","inherit").style("font-size","inherit");n.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");let o={format:e=>e,scale:i,container:r,ticks:!0,axisLine:!0},l={label:"",fn:a().ticks(5),axis:n,axisLabel:r.append("text").attr("class",`axis-label ${e}`).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text(""),scale:e=>{o.scale=e},adjustLabel:e=>{Object.entries(e).forEach(e=>{l.axisLabel.attr(...e)})},update:(e,a,i)=>{t._widget.get(o.container,e).attr("transform","translate("+i.left+","+i.top+")").style("width",a.innerWidth).style("height",a.innerHeight),l.fn.scale(o.scale.scale).tickFormat(o.format).tickSize(o.ticks?6:0).tickPadding(o.ticks?3:9),t._widget.get(l.axis,e).call(l.fn).selectAll("path").style("opacity",o.axisLine?1:0),l.axisLabel.text(l.label)},hideAxisLine:e=>o.axisLine=!e,hideTicks:e=>o.ticks=!e,tickFormat:(e=(e=>e))=>o.format=e,setLabel:e=>l.label=e};return l},k=e=>(a,i)=>{let n=b("x",a,t.axisBottom,e);n.adjustLabel({"text-anchor":"end",dy:"2.5em"});let o=e=>{a._widget.get(n.axis,e).attr("transform","translate(0,"+parseFloat(a._widget.size.innerHeight)+")"),a._widget.get(n.axisLabel,e).attr("x",a._widget.size.innerWidth).attr("y",parseFloat(a._widget.size.innerHeight)+"px")};return n.update=r(n.update,o),a._widget.update=r(a._widget.update,e=>n.update(e,a._widget.size,a._widget.margins)),a=Object.assign(a||{},{_bottomAxis:{axis:n.fn,update:n.update,scale:n.scale,label:()=>n.label}}),i=Object.assign(i||{},{bottomAxis:{label:(e="")=>(n.setLabel(e),i),tickFormat:e=>(n.tickFormat(e),i),hideTicks:e=>(n.hideTicks(e),i),hideAxisLine:e=>(n.hideAxisLine(e),i)}}),{self:a,api:i}},z=e=>(()=>(a,r)=>{let n={selectors:e,highlightSelection:(e,r,n)=>{if(a._widget.transition)return;let o=a._highlight.container.selectAll(e);if(o.transition(),"string"==typeof r)o.transition().duration(n).style("opacity",function(){return t.select(this).classed(i(r))?1:.1});else if(Array.isArray(r)){let e=r.map(i);o.transition().duration(n).style("opacity",function(){let a=t.select(this);return e.reduce((e,t)=>e||a.classed(t),!1)?1:.1})}else o.transition().duration(n||0).style("opacity",1)}};return a=Object.assign(a||{},{_highlight:{container:void 0,selectors:void 0}}),r=Object.assign(r||{},{highlight:(e,t)=>{if(void 0===a._highlight.container)throw Error("Highlight.container is not specified");return n.selectors.forEach(a=>n.highlightSelection(a,e,t)),r}}),{self:a,api:r}})(),M=e=>(a,i)=>{let n=b("y",a,t.axisLeft,e);n.adjustLabel({"text-anchor":"begin",x:"5px",y:"-5px"});let o=e=>{n.update(e,a._widget.size,a._widget.margins)};return(a=Object.assign(a||{},{_leftAxis:{axis:n.fn,update:n.update,scale:n.scale,label:()=>n.label}}))._widget.update=r(a._widget.update,o,!0),i=Object.assign(i||{},{leftAxis:{label:e=>(n.setLabel(e),i),tickFormat:e=>(n.tickFormat(e),i),hideTicks:e=>(n.hideTicks(e),i),hideAxisLine:e=>(n.hideAxisLine(e),i)}}),{self:a,api:i}},j=e=>(t,a)=>{let i={value:e};return{self:t=Object.assign(t||{},{_opacity:{value:()=>i.value}}),api:a=Object.assign(a||{},{opacity:t=>(i.value=t||e,a)})}},O=(e,t)=>{for(let a in t)t.hasOwnProperty(a)&&e.attr(a,t[a]);return e},F=(e,t)=>{let a={markers:new Map};return{self:e=Object.assign(e||{},{_plotMarker:{add(t,r,n,o,l){a.markers.set(n,a.markers.get(n)||e._chart.plots.append("circle")),O(a.markers.get(n),{class:`plot-marker ${i(o)}`,cx:t,cy:r,r:l||4}),h(a.markers.get(n),{stroke:"white",fill:e._color.mapGroup(o),"pointer-events":"none"})},remove(e){void 0===e?a.markers.forEach((e,t)=>{e.remove(),a.markers.delete(t)}):a.markers.has(e)&&(a.markers.get(e).remove(),a.markers.delete(e))}}}),api:t}},$=(e,a)=>{let i={container:{id:"dalian-tooltip-container"},id:`${e._widget.id}-tooltip`,on:!1,getContainer:()=>{let a=t.select("#"+i.container.id);return a.empty()&&(a=t.select("body").append("div").attr("id",i.container.id)),a.style("color",e._font.color),a},getTooltip:(e,t)=>void 0===i.elem||i.elem.empty()?h(i.container.elem.append("div").attr("id",i.id),{position:"absolute","background-color":"rgba(255, 255, 255, 0.95)","border-radius":"2px","box-shadow":"0 0 2px #aaa",color:"currentColor","pointer-events":"none","font-size":"0.85em","font-family":"inherit",width:"auto","line-height":"1",left:(e.left+e.right)/2+t.left+"px",top:(e.top+e.bottom)/2+t.top+"px"}):i.elem,hideTooltip:()=>{void 0!==i.elem&&i.elem.style("opacity",0)},showTooltip:()=>{let a=t.event.pageX,r=t.event.pageY,n=e._widget.container.node().getBoundingClientRect(),o={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(a<n.left+e._widget.margins.left-o.left||a>n.right-e._widget.margins.right+o.left||r<n.top+e._widget.margins.top-o.top||r>n.bottom-e._widget.margins.bottom+o.top)return e._tooltip.builder(),void i.hideTooltip();i.container.elem=i.getContainer(),i.elem=i.getTooltip(n,o);let l=t.mouse(e._widget.container.node()),s=e._tooltip.builder(e._tooltip.content([l[0]-e._widget.margins.left,l[1]-e._widget.margins.top]));if(void 0===s){if(void 0!==i.elem)return void i.hideTooltip()}else i.elem.html(s);let d=i.elem.node().getBoundingClientRect(),c=d.width,p=d.height,u=a+20,g=r+20;u+c>n.right-e._widget.margins.right+o.left-10&&(u-=c+o.left+40),g+p>n.bottom-e._widget.margins.bottom+o.top-10&&(g=n.bottom-e._widget.margins.bottom+o.top-10-p),i.elem.style("left",u+"px").style("top",g+"px").style("opacity",1)}};return e._widget.update=r(e._widget.update,()=>{e._widget.container.style("pointer-events",i.on?"all":null).on("mousemove.tooltip",()=>i.on&&!e._widget.disabled&&i.showTooltip()).on("mouseout.tooltip",i.hideTooltip)}),e=Object.assign(e||{},{_tooltip:{isOn:()=>i.on,content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented"),titleFormat:e=>e,rowFormat:e=>e,xFormat:e=>e,yFormat:e=>e,ignore:[]}}),a.tooltip={on:(e=!1)=>(i.on=e,a),ignore:t=>(e._tooltip.ignore=t||[],a),titleFormat:t=>(e._tooltip.titleFormat=t||(e=>e),a),rowFormat:t=>(e._tooltip.rowFormat=t||(e=>e),a),xFormat:t=>(e._tooltip.xFormat=t||(e=>e),a),yFormat:t=>(e._tooltip.yFormat=t||(e=>e),a)},{self:e,api:a}},A=(e,a)=>{let i=$(e,a);return e._tooltip=Object.assign(i.self._tooltip,{builder:a=>{if(void 0===a)return void e._tooltip.content();let i=h(t.select(document.createElement("div")),{display:"table",padding:"10px"});return h(i.append("div"),{display:"table-row",position:"relative"}).text(e._tooltip.xFormat(a.title)),a.content.data.sort((e,t)=>e.name.localeCompare(t.name)).forEach((t,a)=>{let r=h(i.append("div"),{display:"table-row",position:"relative"});h(r.append("div"),{display:"table-cell",position:"relative",width:"9px",height:"9px",top:"1px",float:"left","margin-top":(0===a?6:3)+"px","margin-right":"10px",background:t.background}),h(r.append("div"),{display:"table-cell",position:"relative","max-width":"120px","margin-top":(0===a?6:3)+"px",float:"left"}).html(e._tooltip.yFormat(t.value,t.name))}),i.node().outerHTML}}),{self:e,api:a}},C=(e="linear",a="linear")=>{let i={kind:e,type:a,scale:(()=>{switch(e){default:case"linear":return t.scaleLinear();case"band":return t.scaleBand().padding(.1);case"point":return t.scalePoint().padding(.5)}})()},r={scale:i.scale,range:(e,t)=>(i.scale.range([e,t]),r),domain:e=>{switch(i.kind){default:case"linear":i.scale.domain([Math.min(...e),Math.max(...e)]);break;case"band":case"point":i.scale.domain(e)}return r},kind:e=>{if(void 0===e)return i.kind;switch(e){default:case"linear":i.scale=t.scaleLinear();break;case"band":i.scale=t.scaleBand().padding(.1);break;case"point":i.scale=t.scalePoint().padding(.5)}}};return r},T=(e,a)=>{let i={on:!1};return{self:e=Object.assign(e||{},{_smoothing:{curve:()=>i.on?t.curveMonotoneX:t.curveLinear}}),api:a=Object.assign(a||{},{smoothing:e=>(i.on=e||!1,a)})}},L=()=>{let e={min:null,max:null,scaleMax:0,scaleMin:0};return{min:t=>e.min=t,max:t=>e.max=t,expandMin:t=>e.scaleMin=Math.abs(t||0),expandMax:t=>e.scaleMax=Math.abs(t||0),range:t=>{let a=void 0!==e.min&&null!==e.min?e.min:Math.min(...t),i=void 0!==e.max&&null!==e.max?e.max:Math.max(...t),r=i-a;return[a-=e.scaleMin>0?e.scaleMin*r:0,i+=e.scaleMax>0?e.scaleMax*r:0]},contains:t=>(void 0===e.min||null===e.min||t>=e.min)&&(void 0===e.max||null===e.max||t<=e.max)}},S=(e,t)=>{let a=L();return{self:e=Object.assign(e||{},{_yRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{yRange:{min:e=>(a.min(e),t),expandMin:e=>(a.expandMin(e),t),max:e=>(a.max(e),t),expandMax:e=>(a.expandMax(e),t)}})}};const E=document.createElement("canvas").getContext("2d");function G(e,t){return E.font=t.size+" "+t.family,E.measureText(e).width}const H=e=>(function(a){let i=this._current||0;this._current=a.value;let r=t.interpolateNumber(i,a.value);return t=>e(r(t))}),R=(e,a)=>(function(i){let r=t.interpolate(this["_current"+(a||"")],i);return this["_current"+(a||"")]=r(0),t=>e(r(t))});function I(e){let t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function D(e){return function(e){let a=t.color(e);return.2126*I(a.r)+.7152*I(a.g)+.0722*I(a.b)}(e)>.179?"#000":"#fff"}var W=(e,a)=>{let i=$(e,a);return e._tooltip=Object.assign(i.self._tooltip,{builder:a=>{if(void 0===a)return void e._tooltip.content();let i=h(t.select(document.createElement("div")),{"border-radius":"2px",padding:"10px","font-family":"inherit","border-left":a.stripe?"solid 4px "+a.stripe:null});return h(i.append("div"),{position:"relative",width:"calc(100% - 10px)","line-height":"11px",margin:"2px","margin-bottom":"10px"}).text(e._tooltip.titleFormat(a.title)),a.content.data.forEach(t=>{let a=h(i.append("div"),{position:"relative",height:"10px",margin:"2px","padding-right":"10px","line-height":"11px"});h(a.append("div"),{position:"relative",float:"left","margin-right":"10px"}).text(t.name+":"),h(a.append("span"),{position:"relative",float:"left"}).html(e._tooltip.rowFormat(t.value))}),i.node().outerHTML}}),{self:e,api:a}},P=e=>(t,a)=>{let i={defaults:{opacity:.3,lineStyle:"4 8"},type:e,on:!1,grid:void 0,opacity:void 0,lineStyle:void 0,update:e=>{if(i.on){void 0===i.grid&&(i.grid=t._chart.plots.insert("g",":first-child").attr("class","grid").style("opacity",0).style("stroke","currentColor").style("stroke-width","1px"));const a="x"===i.type?t._bottomAxis.axis:t._leftAxis.axis,r="x"===i.type?parseFloat(t._widget.size.innerHeight):-parseFloat(t._widget.size.innerWidth);i.grid.transition().duration(e).call(a.tickSizeInner(r).tickFormat("")).style("stroke-opacity",i.opacity||i.defaults.opacity).style("stroke-dasharray",i.lineStyle||i.defaults.lineStyle).style("opacity",1),i.grid.select("path").remove()}else void 0!==i.grid&&(i.grid.transition().duration(e).style("opacity",0).remove(),i.grid=void 0)}};t._widget.update=r(t._widget.update,i.update);let n={type:e=>{i.type=e,i.grid&&(i.grid.remove(),i.grid=void 0)}};const o={on:e=>(i.on=e,a),opacity:e=>(i.opacity=e,a),lineStyle:e=>{switch(e){case"solid":i.lineStyle="1 0";break;case"dashed":default:i.lineStyle="4 8";break;case"dotted":i.lineStyle="2 5"}return a}};return a=Object.assign(a||{},"x"===e?{xGrid:o}:{yGrid:o}),{baseSelf:n,self:t,api:a}},B=(e,t)=>{let a=P("y")(e,t);return{self:e=Object.assign(e||{},{_yGrid:a.baseSelf}),api:a.api}},X=(e,t)=>{let a={policy:void 0,getStrokeDashArray:e=>{switch(e){case"solid":default:return null;case"dashed":return"4 8";case"dotted":return"2 5"}}};return{self:e=Object.assign(e||{},{_lineStyles:{strokeDashArray:e=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[e]),style:e=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[e],background:(e,t)=>{switch(e){case"solid":default:return t;case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${t} 2px, ${t} 4px`;case"dotted":return`radial-gradient(${t} 30%, transparent 30%) 0.5px 0.5px/4px 4px, radial-gradient(${t} 30%, transparent 30%) 2.5px 2.5px/4px 4px transparent`}}}}),api:t=Object.assign(t||{},{lineStyle:e=>(a.policy=e,t)})}},Y=(e,t)=>{let a={mapping:()=>"2px"};return{self:e=Object.assign(e||{},{_lineWidth:{mapping:e=>a.mapping(e)}}),api:t=Object.assign(t||{},{lineWidth:e=>(a.mapping=void 0===e?()=>"2px":"number"==typeof e?()=>e+"px":t=>(e[t]||2)+"px",t)})}},V=P("x"),q=(e,t)=>{let a=L();return{self:e=Object.assign(e||{},{_xRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{xRange:{min:e=>(a.min(e),t),expandMin:e=>(a.expandMin(e),t),max:e=>(a.max(e),t),expandMax:e=>(a.expandMax(e),t)}})}};e.AreaChart=((e,o="body")=>{let l={x:C("linear"),y:C("linear")},{self:s,api:d}=n(w("area-chart",e,o,"svg"),M(l.y),k(l.x),F,j(.4),T,A,z([".plot-group",".plot-marker"]),S),c={scales:l,update:e=>{const r=s._chart.data.map(e=>e.values).flat(),n=r.map(e=>e.y),o=t.extent(n),l=.01*(o[1]-o[0]);o[1]+=l,c.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(r.map(e=>e.x)),c.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(s._yRange.range(o));const d=t.area().x(e=>c.scales.x.scale(e.x)).y0(()=>c.scales.y.scale(0)).y1(e=>c.scales.y.scale(e.y)).curve(s._smoothing.curve()),p=t.line().x(e=>c.scales.x.scale(e.x)).y(e=>c.scales.y.scale(e.y)).curve(s._smoothing.curve());s._chart.plotGroups({enter:e=>(e.style("opacity",0),e.append("path").attr("class",e=>`area ${i(e.name)}`).attr("d",e=>d(e.values)).attr("stroke","none").attr("fill","currentColor"),e.append("path").attr("class",e=>`line ${i(e.name)}`).attr("d",e=>p(e.values)).attr("fill","none").attr("stroke","currentColor"),e),update:e=>(e.select(".area").attrTween("d",function(e){let i=t.select(this).attr("d"),r=d(e.values);return a.interpolatePath(i,r,null)}).style("fill-opacity",s._opacity.value()),e.select(".line").attrTween("d",function(e){let i=t.select(this).attr("d"),r=p(e.values);return a.interpolatePath(i,r,null)}),e.style("opacity",1),e),exit:e=>e.style("opacity",0)},e)}};return s._highlight.container=s._chart.plots,s._tooltip.content=(e=>{if(void 0===e)return void s._plotMarker.remove();let a=t.bisector(e=>c.scales.x.scale(e.x)).left,i=e?s._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===i)return void s._plotMarker.remove();let r=c.scales.x.scale.invert(e[0]),n=s._chart.data.filter(e=>-1===s._tooltip.ignore.indexOf(e.name)).map((e,t)=>{let a=i[t],n=e.values,o=n[a-1]?n[a-1]:n[a],l=n[a]?n[a]:n[a-1],d=r-o.x>l.x-r?l:o;return r=d.x,s._plotMarker.add(c.scales.x.scale(r),c.scales.y.scale(d.y),e.name,e.name),{name:e.name,background:s._color.mapGroup(e.name),value:d.y}});return{title:r,content:{type:"plots",data:n}}}),s._chart.transformData=(e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:e.x,y:e.y}))}))),s._widget.update=r(s._widget.update,c.update,!0),d}),e.BarChart=((e,a="body")=>{let o={x:C("band"),y:C("linear")},{self:l,api:s}=n(w("bar-chart",e,a,"svg"),M(o.y),k(o.x),W,z([".plot-group"]),B),d={current:void 0,scales:{x:o.x,y:o.y},horizontal:!1,values:!1,valueFormat:e=>e.toFixed(1),measureX:(e,t,a)=>{const i=G(d.valueFormat(e.value),a),r=Math.max((t-parseFloat(a.size))/2,5),n=d.scales.x.scale(e.value),o=n>2*r+i;return{inside:o,x:o?n-r:n+r+i,y:d.scales.y.scale(e.name)+t/2,color:o?D(l._color.mapGroup(e.name)):a.color}},measureY:(e,t,a)=>{const i=parseFloat(a.size),r=Math.max((t-G(d.valueFormat(e.value),a))/2,5),n=d.scales.y.scale(e.value),o=parseFloat(l._widget.size.innerHeight)-n>2*r+i;return{inside:o,x:d.scales.x.scale(e.name)+t/2,y:o?n+r:n-r-i,color:o?D(l._color.mapGroup(e.name)):a.color}},update:e=>{const a=window.getComputedStyle(l._widget.container.node()),r={size:a.fontSize,family:a.fontFamily,color:a.color},n=l._chart.data.map(e=>e.name),o=1.01*t.max(l._chart.data.map(e=>e.value))||1;d.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(d.horizontal?[0,o]:n),d.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(d.horizontal?n:[0,o]),l._chart.plotGroups({enter:e=>{const t=d.horizontal?d.scales.y.scale.bandwidth():d.scales.x.scale.bandwidth(),a=e.append("rect").attr("class",e=>`bar ${i(e.name)}`).attr("fill","currentColor").on("mouseover.barChart",e=>{d.current=e}).on("mouseleave.barChart",()=>{d.current=void 0});d.horizontal?a.attr("x",d.scales.x.scale(0)).attr("width",0).attr("y",e=>d.scales.y.scale(e.name)).attr("height",t):a.attr("x",e=>d.scales.x.scale(e.name)).attr("width",t).attr("y",d.scales.y.scale(0)).attr("height",0);const n=d.horizontal?d.measureX:d.measureY;return e.append("text").style("display","none").attr("class",e=>`bar-value ${i(e.name)}`).attr("stroke","none").style("pointer-events","none").text(e=>d.valueFormat(e.value)).each(e=>Object.assign(e,{_measures:n(e,t,r)})).attr("fill",e=>e._measures.color).attr("x",e=>d.horizontal?d.scales.x.scale(0):e._measures.x).attr("y",e=>d.horizontal?e._measures.y:d.scales.y.scale(0)),e},update:e=>{const t=d.horizontal?d.scales.y.scale.bandwidth():d.scales.x.scale.bandwidth(),a=e.select(".bar");d.horizontal?a.attr("x",d.scales.x.scale(0)).attr("width",e=>d.scales.x.scale(e.value)).attr("y",e=>d.scales.y.scale(e.name)).attr("height",t):a.attr("x",e=>d.scales.x.scale(e.name)).attr("width",t).attr("y",e=>d.scales.y.scale(e.value)).attr("height",e=>parseInt(l._widget.size.innerHeight)-d.scales.y.scale(e.value));const i=d.horizontal?d.measureX:d.measureY;return e.select(".bar-value").attr("text-anchor",d.horizontal?"end":"middle").attr("dominant-baseline",d.horizontal?"central":"hanging").attr("font-size",l._font.size).attr("fill",l._font.color).textTween(H(d.valueFormat)).each(e=>Object.assign(e,{_measures:i(e,t,r)})).attr("fill",e=>e._measures.color).attr("x",e=>e._measures.x).attr("y",e=>e._measures.y).style("display",d.values?null:"none"),e},exit:e=>e.style("opacity",0)},e)}};return l._highlight.container=l._chart.plots,l._tooltip.content=(()=>{if(void 0!==d.current)return{title:d.current.name,stripe:l._color.mapGroup(d.current.name),content:{type:"plots",data:[{name:"value",value:d.current.value}]}}}),l._widget.update=r(l._widget.update,d.update,!0),s=Object.assign(s,{horizontal:e=>(d.horizontal=e,d.scales.x=e?o.y:o.x,d.scales.y=e?o.x:o.y,l._bottomAxis.scale(d.scales.x),l._leftAxis.scale(d.scales.y),l._yGrid.type(e?"x":"y"),s),values:e=>(d.values=e,s),valueFormat:e=>(d.valueFormat=e||(e=>e.toFixed(1)),s)})}),e.LineChart=((e,o="body")=>{let l={x:C("linear"),y:C("linear")},{self:s,api:d}=n(w("line-chart",e,o,"svg"),M(l.y),k(l.x),z([".plot-group",".plot-marker",".trend-marker"]),X,Y,(e=>(()=>(t,a)=>{let i={container:void 0,pins:new Map,getContainer:()=>(void 0===i.container&&(i.container=t._chart.plots.append("g").attr("class","pin-container").attr("clip-path",`url(#${t._chart.clipId})`)),i.container)};return t._widget.update=r(t._widget.update,e=>{i.pins.forEach(t=>t.update(e))}),a.pin={add:(r,n,o={},l)=>{if(i.pins.has(r))return;let s=e.x.scale,d=e.y.scale;const c=o.color||t._font.color,p=(1-(o.height||1))*d.range()[0],u=o.text||"",g=i.getContainer().append("g").attr("class","pin").style("color",c).style("opacity",0),m=g.append("g").attr("class","pin-label").style("opacity",0).style("pointer-events","none"),y=O(m.append("text"),{class:"pin-label-text",y:p-(o.size||6)-10,"text-anchor":"start",stroke:"none",fill:D(c)}).text(u),h=1.05*y.node().getComputedTextLength();y.attr("x",Math.min(s(n),s.range()[1]-h)-10).attr("textLength",h);let x=y.node().getBBox();const f=O(m.append("rect"),{class:"pin-label-box",x:x.x-5,y:x.y-5,width:x.width+10,height:x.height+10,rx:2,stroke:"none",fill:""===u?"none":c});m.node().insertBefore(f.node(),y.node());const _=()=>{m.transition().duration(300).style("opacity",1),i.pins.forEach(e=>{e.g.transition().duration(300).style("opacity",e.g===g?1:.1)})},v=()=>{m.transition().duration(300).style("opacity",0),i.pins.forEach(e=>{e.g.transition().duration(300).style("opacity",1)})},w=(()=>{let e=!1;return()=>{e?(m.transition().duration(300).style("opacity",0),i.pins.forEach(e=>{e.g.transition().duration(300).style("opacity",1)}),e=!1):(m.transition().duration(300).style("opacity",1),i.pins.forEach(e=>{e.g.transition().duration(300).style("opacity",e.g===g?1:.1)}),e=!0)}})(),b=O(g.append("line"),{class:"pin-needle",x1:s(n)+1,y1:d.range()[0],x2:s(n)+1,y2:p,stroke:"currentColor","stroke-width":"2px"}).style("pointer-events","all").on("click.pin",w).on("mouseover.pin",_).on("mouseleave.pin",v),k=O(g.append("circle"),{class:"pin-head",cx:s(n)+1,cy:p,r:(o.size||6)+"px",stroke:"white","stroke-width":"1px",fill:"currentColor"}).style("pointer-events","all").on("mouseover.pin",_).on("mouseleave.pin",v);g.transition().duration(l).style("opacity",1);const z={g:g,remove:e=>{g.transition().duration(e).style("opacity",0).on("end",()=>{g.remove()})},update:e=>{b.transition().duration(e).attr("x1",s(n)+1).attr("y1",d.range()[0]).attr("x2",s(n)+1).attr("y2",p),k.transition().duration(e).attr("cx",s(n)+1).attr("cy",p),y.attr("x",Math.min(s(n),s.range()[1]-h)-10).attr("y",p-(o.size||6)-10),x=y.node().getBBox(),f.attr("x",x.x-5).attr("y",x.y-5).attr("width",x.width+10).attr("height",x.height+10)}};return i.pins.set(r,z),a},remove:(e,t)=>{void 0===e&&(i.pins.forEach(e=>e.remove()),i.pins.clear()),i.pins.has(e)&&(i.pins.get(e).remove(t),i.pins.delete(e))}},{self:t,api:a}})())(l),F,A,T,(e=>(()=>(a,n)=>{let o={container:void 0,trends:new Map,getContainer:()=>(void 0===o.container&&(o.container=a._chart.plots.append("g").attr("class","trend-container").attr("clip-path",`url(#${a._chart.clipId})`)),o.container),adjustTrend:(e,i,r)=>{let n=a._chart.data.find(t=>t.name===e);if(void 0===n)return;let o=t.bisector(e=>e.x).left,l=o(n.values,i),s=o(n.values,r);if(null===l||null===s)return;let d=n.values[l].x,c=n.values[l].y,p=n.values[s].x,u=n.values[s].y;return{start:{x:d,y:c},end:{x:p,y:u},plateau:c<u?u:c}}};return a._widget.update=r(a._widget.update,e=>{o.trends.forEach(t=>t.update(e))}),n.trend={add:(t,r,l,s,d,c=400)=>{if(o.trends.has(t))return n;let p=e.x.scale,u=e.y.scale,g=o.adjustTrend(r,l,s);const m=o.getContainer().append("g").attr("class","trend trend-"+i(r)).style("color",a._color.mapGroup(r)).style("opacity",0),y=O(m.append("path"),{fill:"none",stroke:"currentColor","stroke-dasharray":"3 3","stroke-width":1,d:`M${p(g.start.x)},${u(g.start.y)}V${u(g.plateau)}H${p(g.end.x)}V${u(g.end.y)}`}),h=O(m.append("circle"),{cx:p(g.start.x),cy:u(g.start.y),r:4,stroke:"none",fill:"currentColor"}),x=O(m.append("circle"),{cx:p(g.end.x),cy:u(g.end.y),r:4,stroke:"none",fill:"currentColor"}),f=O(m.append("text"),{x:p(g.start.x),y:u(g.plateau),dy:-5,"text-anchor":"start",fill:a._font.color}).style("font-family","inherit").style("font-size",a._font.size).text(d);m.transition().duration(c).style("opacity",1);const _={g:m,remove:e=>{m.transition().duration(e).style("opacity",0).on("end",()=>{m.remove()})},update:e=>{m.transition().duration(e).style("color",a._color.mapGroup(r));const t=o.adjustTrend(r,l,s);y.transition().duration(e).attr("d",`M${p(t.start.x)},${u(t.start.y)}V${u(t.plateau)}H${p(t.end.x)}V${u(t.end.y)}`),h.transition().duration(e).attr("cx",p(t.start.x)).attr("cy",u(t.start.y)),x.transition().duration(e).attr("cx",p(t.end.x)).attr("cy",u(t.end.y)),f.attr("font-size",a._font.size).attr("fill",a._font.color).transition().duration(e).attr("x",p(t.start.x)).attr("y",u(t.plateau))}};return o.trends.set(t,_),n},remove:(e,t)=>{void 0===e&&(o.trends.forEach(e=>e.remove()),o.trends.clear()),o.trends.has(e)&&(o.trends.get(e).remove(t),o.trends.delete(e))}},{self:a,api:n}})())(l),V,q,B,S),c={scales:l,update:e=>{const r=s._chart.data.map(e=>e.values).flat().filter(e=>null!==e.y),n=r.map(e=>e.y-e.lo).concat(r.map(e=>e.y+e.hi)),o=t.extent(n),l=.01*(o[1]-o[0]);o[1]+=l,o[0]-=l,c.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(s._xRange.range(r.map(e=>e.x))),c.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(s._yRange.range(o));const d=t.line().defined(e=>null!==e.y).x(e=>c.scales.x.scale(e.x)).y(e=>c.scales.y.scale(e.y)).curve(s._smoothing.curve()),p=t.area().defined(e=>null!==e.y).x(e=>c.scales.x.scale(e.x)).y0(e=>c.scales.y.scale(e.y-e.lo)).y1(e=>c.scales.y.scale(e.y+e.hi)).curve(s._smoothing.curve());s._chart.plotGroups({enter:e=>(e.style("opacity",0),e.append("path").attr("class",e=>`error-band ${i(e.name)}`).attr("d",e=>p(e.values)).attr("stroke","none").attr("fill","currentColor").style("fill-opacity",.2),e.append("path").attr("class",e=>`line ${i(e.name)}`).attr("d",e=>d(e.values)).attr("stroke","currentColor").attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round"),e),update:e=>(e.select(".error-band").attrTween("d",function(e){let i=t.select(this).attr("d"),r=p(e.values);return a.interpolatePath(i,r,null)}),e.select(".line").attrTween("d",function(e){let i=t.select(this).attr("d"),r=d(e.values);return a.interpolatePath(i,r,null)}).style("stroke-dasharray",e=>s._lineStyles.strokeDashArray(e.name)),e.style("opacity",1),e),exit:e=>e.style("opacity",0)},e)}};return s._highlight.container=s._chart.plots,s._tooltip.content=(e=>{if(void 0===e)return void s._plotMarker.remove();let a=t.bisector(e=>c.scales.x.scale(e.x)).left,i=e?s._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===i)return void s._plotMarker.remove();let r=c.scales.x.scale.invert(e[0]),n=s._chart.data.filter(e=>-1===s._tooltip.ignore.indexOf(e.name)).map((e,t)=>{let a=i[t],n=e.values,o=n[a-1]?n[a-1]:n[a],l=n[a]?n[a]:n[a-1],d=r-o.x>l.x-r?l:o;return r=d.x,null!==d.y&&s._yRange.contains(d.y)?s._plotMarker.add(c.scales.x.scale(r),c.scales.y.scale(d.y),e.name,e.name):s._plotMarker.remove(e.name),{name:e.name,background:s._lineStyles.background(s._lineStyles.style(e.name),s._color.mapGroup(e.name)),value:d.y}});return{title:r,content:{type:"plots",data:n}}}),s._chart.transformData=(e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:e.x,y:e.y,lo:e.lo||0,hi:e.hi||0}))}))),s._widget.update=r(s._widget.update,c.update,!0),d}),e.PieChart=((e,a="body")=>{let{self:o,api:l}=n(w("pie-chart",e,a,"svg"),W,z([".plot-group"])),s={innerRadius:0,outerRadius:100,values:!1,valueFormat:!1,current:void 0,arc:null,update:e=>{s.arc=t.arc().innerRadius(s.innerRadius).outerRadius(s.outerRadius),o._chart.plotGroups({enter:e=>{e.style("opacity",0);let t=e.append("g").attr("class","pie-wedge").attr("transform",`translate(${parseFloat(o._widget.size.width)/2}, ${parseFloat(o._widget.size.height)/2})`);return t.append("path").attr("class",e=>`slice ${i(e.data.name)}`).attr("d",s.arc).attr("stroke-linejoin","round").attr("stroke","white").attr("fill","currentColor"),t.append("text").attr("text-anchor","middle").attr("x",e=>s.arc.centroid(e)[0]).attr("y",e=>s.arc.centroid(e)[1]).text(e=>e.value.toFixed(1)).each(function(e){this._current=e.value}),e},update:e=>{e.style("opacity",1);let t=e.select(".pie-wedge").attr("transform",`translate(${parseFloat(o._widget.size.width)/2}, ${parseFloat(o._widget.size.height)/2})`);return t.select(".slice").attrTween("d",R(e=>s.arc(e))),t.select("text").attrTween("x",R(e=>s.arc.centroid(e)[0],"x")).attrTween("y",R(e=>s.arc.centroid(e)[1],"y")).textTween(H(s.valueFormat)),e}},e)}};return o._chart.transformData=(e=>{const a=t.pie().value(e=>e.value).sort(null);let i=new Set(e.map(e=>e.name)),r=o._chart.data.map(e=>e.name).filter(e=>!i.has(e)).map(e=>({name:e,value:0}));return a(t.merge([e,r]).sort((e,t)=>t.value-e.value)).map(e=>Object.assign(e,{name:e.data.name}))}),o._highlight.container=o._chart.plots,o._tooltip.content=(()=>{if(void 0!==s.current)return{title:s.current.name,stripe:o._color.mapGroup(s.current.name),content:{type:"plots",data:[{name:"value",value:s.current.value}]}}}),o._widget.update=r(o._widget.update,s.update,!0),l=Object.assign(l,{innerRadius:e=>(s.innerRadius=e||0,l),outerRadius:e=>(s.outerRadius=e||100,l),values:e=>(s.values=e||!1,l),valueFormat:e=>(s.valueFormat=e||(e=>e.toFixed(1)),l)})}),e.ScatterPlot=((e,a="body")=>{let o={x:C("linear"),y:C("linear")},{self:l,api:s}=n(w("scatter-plot",e,a,"svg"),k(o.x),W,z([".plot-group"]),M(o.y),j(.6),F,q,S),d={scales:o,diagram:void 0,size:4,computeDiagram:e=>{const a=e.map(e=>e.values.map(t=>({name:e.name,x:t.x,y:t.y}))).flat();return t.voronoi().x(e=>d.scales.x.scale(e.x)).y(e=>d.scales.y.scale(e.y)).extent([[0,0],[parseInt(l._widget.size.innerWidth),parseInt(l._widget.size.innerHeight)]])(a)},update:e=>{const a=l._chart.data.map(e=>e.values).flat(),r=t.extent(a.map(e=>e.x));d.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(l._xRange.range([r[0]-d.size,r[1]+d.size]));const n=t.extent(a.map(e=>e.y));d.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(l._yRange.range([n[0]-d.size,n[1]+d.size])),l._chart.plotGroups({enter:e=>(e.style("opacity",0).attr("stroke","none").attr("fill","currentColor"),e.selectAll("circle").data(e=>e.values).enter().append("circle").attr("class",e=>`dot ${i(e.name)}`).attr("cx",e=>d.scales.x.scale(e.x)).attr("cy",e=>d.scales.y.scale(e.y)).attr("r",d.size).style("opacity",0),e),updateBefore:t=>(t.style("opacity",1),t.selectAll("circle").data(e=>e.values,e=>e.label).join(e=>e.append("circle").attr("class",e=>`dot ${i(e.name)}`).attr("cx",e=>d.scales.x.scale(e.x)).attr("cy",e=>d.scales.y.scale(e.y)).attr("r",d.size).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",e=>d.scales.x.scale(e.x)).attr("cy",e=>d.scales.y.scale(e.y)).attr("r",d.size).style("opacity",l._opacity.value()),t),exit:e=>e.style("opacity",0)}),d.diagram=d.computeDiagram(l._chart.data)}};return(l=Object.assign(l,{_scatterPlot:{}}))._highlight.container=l._chart.plots,l._tooltip.content=(e=>{if(void 0===e)return void l._plotMarker.remove();const t=d.diagram.find(e[0],e[1],20);if(t)return l._plotMarker.add(d.scales.x.scale(t.data.x),d.scales.y.scale(t.data.y),"marker",t.data.name,Math.max(5,1.5*d.size)),{title:t.data.name,stripe:l._color.mapGroup(t.data.name),content:{type:"plots",data:[{name:l._bottomAxis.label(),value:t.data.x},{name:l._leftAxis.label(),value:t.data.y}]}};l._plotMarker.remove()}),l._widget.update=r(l._widget.update,d.update,!0),s=Object.assign(s,{size:e=>(d.size=e||4,s)})}),Object.defineProperty(e,"__esModule",{value:!0})});
