// https://www.npmjs.com/package/dalian v0.4.3 Copyright 2021 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],t):t((e=e||self).dalian={},e.d3,e.d3)}(this,(function(e,t,a){"use strict";var r=(e,t,a=!1)=>{const r=e;return(...e)=>{a?(t(...e),r(...e)):(r(...e),t(...e))}},n=(e,...t)=>t.reduce((e,t)=>t(e.self,e.api),e);function i(e){return""===e?"da":"da-"+Array.from(e).map(e=>{const t=e.toLowerCase();return"0123456789abcdefghijklmnopqrstuvwxyz".indexOf(t)>-1?t:" "===t?"_":"U"+t.charCodeAt(0).toString(32)+"-"}).join("")}function l(e){const t=window.getComputedStyle(e),a={};for(let e=0;e<t.length;e++)a[t[e]]=t.getPropertyValue(t[e]);return a}function s(e,t){for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e.style[a]=t[a])}const o=document.createElement("canvas"),c=o.getContext("2d"),d=document.createElement("div");d.style.opacty=0;const p=document.createElement("img");var u=async(e,t=3,a="png",r=.92)=>{const n=(new window.XMLSerializer).serializeToString(e),i=function(e){d.appendChild(e),document.body.appendChild(d);const t=e.getBoundingClientRect();return document.body.removeChild(d),t}(e);return o.width=i.width*t,o.height=i.height*t,o.style.width=i.width+"px",o.style.height=i.height+"px",c.scale(t,t),p.setAttribute("src","data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(n)))),new Promise(e=>{p.onload=()=>{c.drawImage(p,0,0),e(o.toDataURL("image/"+a,r))}})};const g=document.createElement("a");var m=["#333333","#0072b2","#56b4e9","#009e73","#f0e442","#e69f00","#d55e00","#cc79a7"],h=["#4477aa","#ee6677","#228833","#ccbb44","#66ccee","#aa3377","#bbbbbb"],y=["#77aadd","#ee8866","#eedd88","#ffaabb","#99ddff","#44bb99","#bbcc33","#aaaa00","#dddddd"],x=["#ee7733","#0077bb","#33bbee","#ee3377","#cc3311","#009988","#bbbbbb"],b="#eee",f=["#364b9a","#4a7bb7","#6ea6cd","#98cae1","#c2e4ef","#eaeccc","#feda8b","#fdb366","#f67e4b","#dd3d2d","#a50026"],v="#eee",_=["#fefbe9","#fcf7d5","#f5f3c1","#eaf0b5","#ddecbf","#d0e7ca","#c2e3d2","#b5ddd8","#a8d8dc","#9bd2e1","#8dcbe4","#81c4e7","#7bbce7","#7eb2e4","#88a5dd","#9398d2","#9b8ac4","#9d7db2","#9a709e","#906388","#805770","#684957","#46353a"];const w={protan:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deutan:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritan:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}};function k(e){return{r:3.063218*e.x-1.393325*e.y-.475802*e.z,g:-.969243*e.x+1.875966*e.y+.041555*e.z,b:.067871*e.x-.228834*e.y+1.069251*e.z}}function z(e,a){let r=1.75,n=2.75;return t.rgb((r*a.r+e.r)/n,(r*a.g+e.g)/n,(r*a.b+e.b)/n)}function M(e){let a=Math.round(.299*e.r+.587*e.g+.114*e.b);return t.rgb(a,a,a)}function C(e,a){let r={r:Math.pow(e.r/255,2.2),g:Math.pow(e.g/255,2.2),b:Math.pow(e.b/255,2.2)};var n;r={x:.430574*(n=r).r+.34155*n.g+.178325*n.b,y:.222015*n.r+.706655*n.g+.07133*n.b,z:.020183*n.r+.129553*n.g+.93918*n.b};const i=r.x+r.y+r.z;r.u=0,r.v=0,0!==i&&(r.u=r.x/i,r.v=r.y/i);let l,s=.312713*r.y/.329016,o=.358271*r.y/.329016,c={y:0};l=r.u<w[a].cpu?(w[a].cpv-r.v)/(w[a].cpu-r.u):(r.v-w[a].cpv)/(r.u-w[a].cpu);let d=r.v-r.u*l;c.u=(w[a].ayi-d)/(l-w[a].am),c.v=l*c.u+d;let p={x:c.u*r.y/c.v,y:r.y,z:(1-(c.u+c.v))*r.y/c.v};c.x=s-p.x,c.z=o-p.z,c=k(c),p=k(p);const u={r:c.r?((p.r<0?0:1)-p.r)/c.r:0,g:c.g?((p.g<0?0:1)-p.g)/c.g:0,b:c.b?((p.b<0?0:1)-p.b)/c.b:0},g=Math.max(u.r>1||u.r<0?0:u.r,u.g>1||u.g<0?0:u.g,u.b>1||u.b<0?0:u.b);p.r=p.r+g*c.r,p.g=p.g+g*c.g,p.b=p.b+g*c.b;const m=e=>255*(e<=0?0:e>=1?1:Math.pow(e,1/2.2));return t.rgb(m(p.r),m(p.g),m(p.b))}const A={protanopia:e=>C(e,"protan"),protanomaly:e=>z(e,C(e,"protan")),deuteranopia:e=>C(e,"deutan"),deuteranomaly:e=>z(e,C(e,"deutan")),tritanopia:e=>C(e,"tritan"),tritanomaly:e=>z(e,C(e,"tritan")),achromatopsia:e=>M(e),achromatomaly:e=>z(e,M(e))};const j="categorical",$="sequential",O="diverging";function F(e){switch(e){default:case j:return m;case $:return _;case O:return f}}function S(e){switch(e){default:case j:return"#fff";case $:return v;case O:return b}}var T=(e,a)=>{const r={policy:j,on:e=>e.name},n={policy:r.policy,palette:F(r.policy),missing:S(r.policy),deficiency:void 0,on:r.on,scale:e=>e,buildMapper(){const e=function(e,t){if("string"==typeof e)return t(e)+"";if(Array.isArray(e))return e.map(t);{const a={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=t(e[r]));return a}}(n.palette||F(n.policy),(a=n.deficiency,void 0===A[a]?e=>e:e=>A[a](t.rgb(e))));var a;const r=e=>{const t=n.on(e);return null===t?null:n.scale(t)};switch(n.policy){default:case j:return i=e,l=n.missing,s=r,"string"==typeof i?()=>i:Array.isArray(i)?(()=>{const e=[];return t=>{const a=s(t);if(null===a)return l;{const t=e.indexOf(a);return i[t>-1?t:e.push(a)-1]}}})():"object"==typeof i?e=>{const t=s(e);return null===t?l:i[t]}:void 0;case $:return function(e,a,r){if("string"==typeof e||Array.isArray(e)||(console.warn(`Palette type (${typeof e}) is incompatible with ${$} color policy, fallback to default color palette.`),e=F($)),"string"==typeof e){const n=t.interpolateRgb("#fff",e);return e=>{const t=r(e);return null===t?a:n(t)}}if(Array.isArray(e)){const n=t.piecewise(t.interpolateRgb.gamma(2.2),e);return e=>{const t=r(e);return null===t?a:n(t)}}}(e,n.missing,r);case O:return function(e,a,r){Array.isArray(e)||(console.warn(`Palette type (${typeof e}) is incompatible with ${O} color policy, fallback to default color palette.`),e=F(O));const n=t.piecewise(t.interpolateRgb.gamma(2.2),e);return e=>{const t=r(e);return n((t+1)/2)}}(e,n.missing,r)}var i,l,s}};return e=Object.assign(e||{},{_color:{init(t,a){n.policy=t,n.on=a,n.palette=F(t),n.missing=S(t),e._color.mapper=n.buildMapper()},scale(t){n.scale=t,e._color.mapper=n.buildMapper()},mapper:n.buildMapper()}}),a=Object.assign(a||{},{color:{policy:(t=r.policy)=>(n.policy=t,e._color.mapper=n.buildMapper(),a),palette(t,r){if("string"==typeof t&&t.startsWith("palette-"))switch(t){case"palette-bright":n.palette=h;break;case"palette-vibrant":n.palette=x;break;case"palette-wong":n.palette=m;break;case"palette-light":n.palette=y;break;case"palette-sunset":n.palette=f;break;case"palette-iridescent":n.palette=_}else n.palette=t;return n.missing=r||"#fff",e._color.mapper=n.buildMapper(),a},deficiency:t=>(n.deficiency=t,e._color.mapper=n.buildMapper(),a),on:(t=r.on)=>(n.on=t,e._color.mapper=n.buildMapper(),a),getMapper:()=>n.buildMapper()}}),{self:e,api:a}},W=(()=>{const e={styles:[]};function a(){return void 0===e.container&&(e.container=t.select("head").append("style").attr("id","dalian-style-container")),e.container}function r(e){switch(e){default:case"class":return".";case"id":return"#"}}function n(e,t){return`${e}{${Object.entries(t).map(([e,t])=>`${e}:${t}`).join(";")}}`}function i(t,i,l="class"){const s=r(l)+t;if(void 0===e.styles.find(e=>e.selector===s)){const t=n(s,i),r=a();r.text(r.text()+t),e.styles.push({selector:s,entry:t})}}function l(t,i,l){const s=r(l)+t,o=e.styles.find(e=>e.selector===s);void 0!==o&&(o.entry=n(s,i),a().text(e.styles.map(e=>e.entry).join("")))}const s={addClass:(e,t)=>(i(e,t,"class"),s),updateClass:(e,t)=>(l(e,t,"class"),s),addId:(e,t)=>(i(e,t,"id"),s),updateId:(e,t)=>(l(e,t,"id"),s)};return s})();const I="dalian-description";var D=(e,a)=>{W.addClass(I,{position:"absolute",width:"auto","max-width":"500px",padding:"10px",background:"#fff","box-shadow":"0 0 3px #000","border-radius":"3px",color:"#000","font-size":".8em","font-family":"inherit","line-height":"1.35em","pointer-events":"none"});const r={id:e._widget.id+"-description",getDescription:()=>void 0===r.elem||r.elem.empty()?t.select("body").append("div").attr("id",r.id).attr("class",I).style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px"):r.elem,removeDescription:()=>{void 0===r.elem||r.elem.empty()||(r.elem.remove(),delete r.elem)}};return a=Object.assign(a||{},{description:n=>(void 0===n?e._widget.container.on("contextmenu.description",null):e._widget.container.on("contextmenu.description",()=>{t.event.preventDefault(),r.elem=r.getDescription().html(n)}).on("mouseleave.description",()=>{r.removeDescription()}),a)}),{self:e,api:a}},R=(e,t)=>{const a=12,n="black";return(e=Object.assign(e||{},{_font:{size:a+"px",color:n}}))._widget.update=r(e._widget.update,()=>{e._widget.container.style("font-size",e._font.size).style("color",e._font.color)},!0),t=Object.assign(t||{},{font:{size:(r=a)=>(e._font.size=r+"px",t),color:(a=n)=>(e._font.color=a,t)}}),{self:e,api:t}},H=(e,t)=>{const a={callbacks:{}};return{self:e=Object.assign(e||{},{_mouse:{over:(...e)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...e)},leave:(...e)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...e)},click:(...e)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...e)},isEnabled:e=>"function"==typeof a.callbacks[e],hasAny:()=>Object.values(a.callbacks).reduce((e,t)=>e||"function"==typeof t,!1)}}),api:t=Object.assign(t||{},{mouse:{over:e=>(a.callbacks.over=e,t),leave:e=>(a.callbacks.leave=e,t),click:e=>(a.callbacks.click=e,t)}})}};const B="dalian-placeholder",E="dalian-placeholder-message";var L=(e,t)=>{W.addClass(B,{display:"table",position:"absolute",left:0,top:0,color:"inherit","font-family":"inherit","font-size":"inherit","pointer-events":"none"}).addClass(E,{display:"table-cell","vertical-align":"middle","line-height":"normal","text-align":"center",color:"inherit","font-family":"inherit","font-size":"inherit"});const a={id:e._widget.id+"-placeholder"};return e._widget.update=r(e._widget.update,t=>{e._widget.content.transition().duration(t).style("opacity",void 0===a.placeholder?1:0),e._widget.disable(void 0!==a.placeholder),void 0===a.placeholder?void 0===a.container||a.container.empty()||(a.container.transition().duration(t).style("opacity",0).remove(),delete a.container):((void 0===a.container||a.container.empty())&&(a.container=e._widget.container.append("div").attr("id",a.id).attr("class",B).style("width",e._widget.size.width).style("height",e._widget.size.height).style("opacity",0),a.content=a.container.append("span").attr("class",E).html(a.placeholder)),a.container.style("font-size","inherit").style("color","inherit").transition().duration(t).style("width",e._widget.size.width).style("height",e._widget.size.height).style("opacity",1),a.content.html(a.placeholder))}),t=Object.assign(t||{},{placeholder:e=>(a.placeholder=e,t)}),{self:e,api:t}},P=(e,t)=>(Object.entries(t).forEach(([t,a])=>{e.style(t,a)}),e),q=(()=>{const e={};function t(){return void 0===e.canvas&&(e.canvas=document.createElement("canvas")),e.canvas}function a(a,r,n){const i=function(){const a=t();return void 0===e.context&&(e.context=a.getContext("2d")),e.context}(),l=n,s=200+i.measureText(a).width,o=200+l;!function(e,a){const r=t();r.style.width=e+"px",r.width=e,r.style.height=a+"px",r.height=a}(s,o),i.font=n+"px "+r,i.fillStyle="#fff",i.fillRect(0,0,s,o),i.fillStyle="#000",i.fillText(a,100,100+l);const c=i.getImageData(0,0,s,o).data.filter((e,t)=>t%4==0),d=Math.floor(c.findIndex(e=>e<255)/s);return c.reverse(),{min:d,max:o-Math.floor(c.findIndex(e=>e<255)/s)}}return e=>{const t=a("x",e,100),r=a("y",e,100),n=a("h",e,100),i=a("H",e,100),l=t.max-t.min;return{xHeight:l/100,capHeight:(i.max-i.min)/100,descender:(r.max-r.min-l)/100,ascender:(n.max-n.min)/100}}})(),X=(e,a,r,n)=>{const i={x:0,y:0},l={width:300,height:200},s=0,o={parent:"string"==typeof r||r instanceof HTMLElement?t.select(r):r,initialized:!1,pos:{x:{attr:"left",ignore:"right",value:i.x+"px"},y:{attr:"top",ignore:"bottom",value:i.y+"px"}}},c={};c._widget={id:`dalian-widget-${e}-${a}`,container:void 0,size:{width:l.width+"px",height:l.height+"px",innerWidth:l.width+"px",innerHeight:l.height+"px"},margins:{left:s,right:s,top:s,bottom:s},transition:!1,disabled:!1,getMouse:()=>{const e=t.mouse(c._widget.container.node());return[e[0]-c._widget.margins.left,e[1]-c._widget.margins.top]},getElem:(e,t)=>o.initialized?e.transition().duration(t):(setTimeout(()=>{o.initialized=!0},t),e),getDefs:()=>(void 0===o.defs&&(o.defs=c._widget.content.append("defs")),o.defs),getStyle:()=>window.getComputedStyle(c._widget.container.node()),getFontMetrics:()=>q(window.getComputedStyle(c._widget.container.node()).fontFamily),update:e=>{c._widget.getElem(c._widget.container,e).style(o.pos.x.ignore,null).style(o.pos.x.attr,o.pos.x.value).style(o.pos.y.ignore,null).style(o.pos.y.attr,o.pos.y.value).style("width",c._widget.size.width).style("height",c._widget.size.height)},disable:e=>{c._widget.disabled=e}};try{c._widget.container=o.parent.append("div").attr("id",c._widget.id).attr("class","dalian-widget dalian-widget-"+e),P(c._widget.container,{position:"absolute",width:c._widget.size.width,height:c._widget.size.height,left:o.pos.x+"px",top:o.pos.y+"px","font-family":"inherit","font-size":"inherit","font-color":"inherit"}),c._widget.content=c._widget.container.append(n).attr("class","dalian-widget-content"),P(c._widget.content,{position:"absolute",width:"100%",height:"100%",left:0,top:0,"font-family":"inherit","font-size":"inherit","font-color":"inherit","pointer-events":"none"})}catch(e){throw Error("MissingDOMException: DOM is not present.")}const d={id:()=>c._widget.id,x:(e=i.x)=>(o.pos.x.attr=e>=0?"left":"right",o.pos.x.ignore=e>=0?"right":"left",o.pos.x.value=Math.abs(e)+"px",d),y:(e=i.y)=>(o.pos.y.attr=e>=0?"top":"bottom",o.pos.y.ignore=e>=0?"bottom":"top",o.pos.y.value=Math.abs(e)+"px",d),width:(e=l.width)=>(c._widget.size.width=e+"px",c._widget.size.innerWidth=e-c._widget.margins.left-c._widget.margins.right+"px",d),height:(e=l.height)=>(c._widget.size.height=e+"px",c._widget.size.innerHeight=e-c._widget.margins.top-c._widget.margins.bottom+"px",d),margins:(e=s)=>{switch(typeof e){case"undefined":default:c._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":c._widget.margins={left:e,right:e,top:e,bottom:e};break;case"object":c._widget.margins=Object.assign(c._widget.margins,e)}return c._widget.size.innerWidth=parseInt(c._widget.size.width)-c._widget.margins.left-c._widget.margins.right+"px",c._widget.size.innerHeight=parseInt(c._widget.size.height)-c._widget.margins.top-c._widget.margins.bottom+"px",d},render:e=>(c._widget.update(e),d)};return{self:c,api:d}},V=(e,t,a,o="svg")=>{let{self:c,api:d}=n(X(e,t,a,o),T,D,R,H,L);const p=(()=>{const e=t+"-dalian-plots-clipper";return{clipId:e,clip:c._widget.getDefs().append("clipPath").attr("id",e).append("rect").attr("x",0).attr("y",0).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),update(e){c._widget.getElem(p.clip,e).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),c._widget.getElem(c._chart.plots,e).attr("width",c._widget.size.innerWidth+"px").attr("height",c._widget.size.innerHeight+"px").attr("transform",`translate(${c._widget.margins.left}, ${c._widget.margins.top})`)}}})();return c=Object.assign(c||{},{_chart:{data:[],plots:c._widget.content.append("g").attr("class","dalian-plots-container"),clipId:p.clipId,transformData:e=>e,plotGroups(e,t){const a=c._chart.plots.attr("clip-path",`url(#${p.clipId})`).transition().duration(t);c._chart.plots.selectAll(".plot-group").data(c._chart.data,e=>e.name).join(t=>t.append("g").attr("class",e=>"plot-group "+i(e.name)).style("shape-rendering","geometricPrecision").on("mouseover.chart",c._mouse.over).on("mouseleave.chart",c._mouse.leave).on("click.chart",c._mouse.click).call(e.enter||(e=>e)),e=>e,t=>t.transition(a).call(e.exit||(e=>e)).remove()).each(()=>{c._chart.plots.style("pointer-events","none"),c._widget.transition=!0}).call(e.updateBefore||(e=>e)).transition(a).call(e.update||(e=>e)).on("end",()=>{c._chart.plots.style("pointer-events",c._tooltip&&c._tooltip.isOn()||c._mouse.hasAny()?"all":"none"),c._widget.transition=!1})}}}),c._widget.update=r(c._widget.update,p.update),d=Object.assign(d,{data:e=>(c._chart.data=c._chart.transformData(e),d),download:async e=>{const t=(e=>{const t=Array.from(e.querySelectorAll("*")).map(l),a=e.cloneNode(!0);return s(a,l(e)),a.querySelectorAll("*").forEach((e,a)=>s(e,t[a])),a.style.backgroundColor=e.parentNode.style.backgroundColor||"#fff",a})(c._widget.content.node());((e,t,a)=>{g.download=`${t}.${a}`,g.href=e,document.body.appendChild(g),g.click(),document.body.removeChild(g)})(await u(t),e,"png")}}),{self:c,api:d}};function G(e,t){return Object.entries(t).forEach(([t,a])=>{e.attr(t,a)}),e}var Y=(e,t,a,n,i)=>{const l={format:e=>e,values:null,tickAnchor:null,tickColor:"currentColor"};let s=t._widget.content.append("g").attr("class","dalian-axis-container "+e).style("font-family","inherit").style("font-size","inherit"),o=s.append("g").attr("class","axis "+e).style("font-family","inherit").style("font-size","inherit");o.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");let c={margin:{left:0,top:0,right:0,bottom:0},format:l.format,values:l.values,scale:n,container:s,tickColor:l.tickColor,ticks:!0,tickAnchor:l.tickAnchor,axisLine:!0,update:e=>{t._widget.getElem(c.container,e).attr("transform","translate("+(t._widget.margins.left+c.margin.left-c.margin.right)+","+(t._widget.margins.top+c.margin.top-c.margin.bottom)+")").style("width",t._widget.size.innerWidth).style("height",t._widget.size.innerHeight),d.fn.scale(c.scale.scale).tickFormat(c.format).tickSize(c.ticks?6:0).tickPadding(c.ticks?3:9).tickValues(c.values||null),t._widget.getElem(d.axis,e).call(d.fn).selectAll("path").style("opacity",c.axisLine?1:0),o.selectAll(".tick > text").attr("text-anchor",c.tickAnchor),o.selectAll(".tick > line").attr("stroke",c.tickColor)}};t._widget.update=r(t._widget.update,c.update);let d={fn:a().ticks(5),axis:o,margin:e=>(c.margin=Object.assign(c.margin,e),d),label:G(s.append("text").attr("class","axis-label "+e).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text(""),i),tickAnchor:(e=l.tickAnchor)=>(c.tickAnchor=e,d),scale:e=>(c.scale=e,d),hideAxisLine:e=>(c.axisLine=!e,d),hideTicks:e=>(c.ticks=!e,d),format:(e=l.format)=>(c.format=e,d),values:(e=l.values)=>(c.values=e,d),tickColor:(e="currentColor")=>(c.tickColor=e,d)};return d},N=e=>(a,n)=>{let i=Y("x",a,t.axisBottom,e,{"text-anchor":"end",dy:"2.5em"}),l=e=>{a._widget.getElem(i.axis,e).attr("transform",`translate(0, ${parseFloat(a._widget.size.innerHeight)})`),a._widget.getElem(i.label,e).attr("x",a._widget.size.innerWidth).attr("y",parseFloat(a._widget.size.innerHeight)+"px")};return(a=Object.assign(a||{},{_bottomAxis:i}))._widget.update=r(a._widget.update,l),n=Object.assign(n||{},{bottomAxis:{label:(e="")=>(i.label.text(e),n),format:e=>(i.format(e),n),values:e=>(i.values(e),n),hideTicks:e=>(i.hideTicks(e),n),hideAxisLine:e=>(i.hideAxisLine(e),n)}}),{self:a,api:n}},U=(e,a,r={blur:{opacity:.1}})=>(n,l)=>{function s(e){return Object.keys(e.focus||{}).concat(Object.keys(e.blur||{})).reduce((e,t)=>Object.assign(e,{[t]:null}),{})}const o={container:void 0,selectors:a,highlightStyle:r,removeStyle:s(r),highlight:(a,r,l)=>{if(n._widget.transition)return;const s=(o.container||(o.container=e())).selectAll(a).interrupt(),c=s.transition().duration(l||0);let d;if("string"==typeof r)d=[i(r)];else{if(!Array.isArray(r))return void P(s.transition(c),o.removeStyle);d=r.map(i)}P(s.filter((function(){const e=t.select(this);return d.reduce((t,a)=>t||e.classed(a),!1)})).transition(c),o.highlightStyle.focus||o.removeStyle),P(s.filter((function(){const e=t.select(this);return!d.reduce((t,a)=>t||e.classed(a),!1)})).transition(c),o.highlightStyle.blur||o.removeStyle)}};return n=Object.assign(n||{},{_highlight:{style(e){o.highlightStyle=e,o.removeStyle=s(e)},selectors:void 0}}),l=Object.assign(l||{},{highlight:(t,a=0)=>{if(void 0===e())throw Error("Highlight.container is not specified");return o.selectors.forEach(e=>o.highlight(e,t,a)),l}}),{self:n,api:l}},J=e=>(a,r)=>{let n=Y("y",a,t.axisLeft,e,{"text-anchor":"begin",x:"5px",y:"-5px"});return{self:a=Object.assign(a||{},{_leftAxis:n}),api:r=Object.assign(r||{},{leftAxis:{label:(e="")=>(n.label.text(e),r),format:e=>(n.format(e),r),values:e=>(n.values(e),r),hideTicks:e=>(n.hideTicks(e),r),hideAxisLine:e=>(n.hideAxisLine(e),r)}})}},K=e=>(t,a)=>{const r={mapping:()=>e+"px"};return{self:t=Object.assign(t||{},{_lineWidth:{mapping:e=>r.mapping(e)}}),api:a=Object.assign(a||{},{lineWidth:(t=e)=>(r.mapping="number"==typeof t?()=>t+"px":a=>(t[a]||e)+"px",a)})}},Q=e=>(a,n)=>{const i={containers:{},objects:new Map,getContainer:(e="background")=>(void 0===i.containers[e]&&(i.containers[e]=a._chart.plots.append("g").attr("class","objects-container"),"background"===e?i.containers[e].lower():i.containers[e].raise()),i.containers[e])};return a._widget.update=r(a._widget.update,e=>{i.objects.forEach(t=>t.update(e))}),n=Object.assign(n||{},{objects:{add(t,a,r,l,s=0){const o=e.x.scale,c=e.y.scale,d=i.getContainer(l&&l.foreground?"foreground":"background").append("g").attr("transform",l&&l.floating?`translate(${o(r.x)}, ${c(r.y)})`:`translate(${r.x}, ${r.y})`).style("opacity",0);d.node().appendChild(a),i.objects.has(t)?(n.objects.remove(t,s),d.transition().duration(s).style("opacity",1)):d.transition().duration(s).style("opacity",1);const p={g:d,remove:e=>{d.transition().duration(e).style("opacity",0).on("end",()=>{d.remove()})},update:e=>{d.transition().duration(e).attr("transform",l&&l.floating?`translate(${o(r.x)}, ${c(r.y)})`:`translate(${r.x}, ${r.y})`)}};return i.objects.set(t,p),n},remove:(e,t=0)=>(null==e&&(i.objects.forEach(e=>e.remove(t)),i.objects.clear()),i.objects.has(e)&&(i.objects.get(e).remove(t),i.objects.delete(e)),n),svg:()=>(void 0===i.svg&&(i.svg=t.select("body").append("svg").style("display","none").style("opacity",0).style("position","fixed")),i.svg)}}),{self:a,api:n}},Z=e=>(t,a)=>{const r={value:e};return{self:t=Object.assign(t||{},{_opacity:{value:()=>r.value}}),api:a=Object.assign(a||{},{opacity:(t=e)=>(r.value=t||e,a)})}},ee=(e,t)=>{const a={markers:new Map};return(e=Object.assign(e||{},{_plotMarker:{add(t,r,n,l,s){a.markers.set(n,a.markers.get(n)||e._chart.plots.append("circle")),G(a.markers.get(n),{class:"plot-marker "+i(l.name),cx:t,cy:r,r:s||4}),P(a.markers.get(n),{stroke:"white",fill:e._color.mapper(l),"pointer-events":"none"})},remove(e){void 0===e?a.markers.forEach((e,t)=>{e.remove(),a.markers.delete(t)}):a.markers.has(e)&&(a.markers.get(e).remove(),a.markers.delete(e))}}}))._widget.update=r(e._widget.update,()=>{e._widget.container.on("mouseout.plot-marker",e._plotMarker.remove)}),{self:e,api:t}};const te="dalian-tooltip";var ae=(e,a)=>{W.addClass(te,{position:"absolute","background-color":"rgba(255, 255, 255, 0.95)","border-radius":"2px","box-shadow":"1px 1px 2px #888, 0 0 1px #aaa",color:"currentColor","pointer-events":"none","font-family":"inherit","font-size":"0.8em",width:"auto","min-width":"80px","line-height":"1","z-index":9999});const n=!1;let i={container:e._widget.container.append("div").attr("class","dalian-tooltip-container"),id:e._widget.id+"-tooltip",on:n,getTooltip:()=>void 0===i.elem||i.elem.empty()?i.container.append("div").attr("id",i.id).attr("class",te).style("font-size",.85*parseFloat(e._font.size)+"px"):i.elem.style("font-size",.85*parseFloat(e._font.size)+"px"),hideTooltip(){void 0!==i.elem&&i.elem.style("opacity",0)},showTooltip(){const[a,r]=t.mouse(e._widget.container.node()),n=parseFloat(e._widget.size.width)-e._widget.margins.right,l=parseFloat(e._widget.size.height)-e._widget.margins.bottom;if(a<e._widget.margins.left||a>n||r<e._widget.margins.top||r>l)return e._tooltip.builder(),void i.hideTooltip();i.elem=i.getTooltip();let s=e._tooltip.builder(e._tooltip.content(e._widget.getMouse()));if(void 0===s){if(void 0!==i.elem)return void i.hideTooltip()}else i.elem.html(s);const o=i.elem.node().getBoundingClientRect(),c=o.width,d=o.height;let p=a+20,u=r+20;p+c>n-10&&(p-=c+30),u+d>l-10&&(u=l-10-d),i.elem.style("left",p+"px").style("top",u+"px").style("opacity",1)}};return e._widget.update=r(e._widget.update,()=>{e._widget.container.style("pointer-events",i.on?"all":null).on("mousemove.tooltip",()=>i.on&&!e._widget.disabled&&i.showTooltip()).on("touchmove.tooltip",()=>i.on&&!e._widget.disabled&&i.showTooltip(),{passive:!0}).on("mouseout.tooltip",i.hideTooltip)}),e=Object.assign(e||{},{_tooltip:{isOn:()=>i.on,content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented")}}),a.tooltip={on:(e=n)=>(i.on=e,a)},{self:e,api:a}};const re="dalian-point-tooltip-",ne={content:re+"content",entry:re+"entry",container:re+"container",inner:re+"inner",marker:re+"marker",label:re+"label"};var ie=(e,a)=>{W.addClass(ne.content,{display:"table",padding:"10px","min-width":"60px"}).addClass(ne.entry,{display:"table-row",position:"relative"}).addClass(ne.container,{display:"inline-block",position:"relative",height:"1em"}).addClass(ne.inner,{display:"flex",position:"relative",height:"1em","justify-content":"center","align-items":"center"}).addClass(ne.marker,{display:"inline-block",position:"relative",float:"left","margin-right":"6px","border-radius":"2px"}).addClass(ne.label,{display:"table-cell",position:"relative","max-width":"120px",float:"left",height:".9em"});const r={ignore:[],titleFormat:e=>e,valueFormat:e=>e.y};let n=ae(e,a),i={titleFormat:r.titleFormat,valueFormat:r.valueFormat};return e._tooltip=Object.assign(n.self._tooltip,{ignore:[],builder:a=>{if(void 0===a)return void e._tooltip.content();let r=t.select(document.createElement("div")).attr("class",ne.content);return r.append("div").attr("class",ne.entry).text(i.titleFormat(a.title)),a.content.data.filter(e=>null!==i.valueFormat(e)).forEach((e,t)=>{let a=r.append("div").attr("class",ne.entry).append("div").attr("class",ne.container).style("margin-top",(0===t?6:3)+"px").append("div").attr("class",ne.inner);a.append("div").attr("class",ne.marker).style("width","1em").style("height","1em").style("background",e.background),a.append("div").attr("class",ne.label).html(i.valueFormat(e))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(e=r.titleFormat)=>(i.titleFormat=e,a),valueFormat:(e=r.valueFormat)=>(i.valueFormat=e,a)}),{self:e,api:a}},le=(e="linear")=>{const a={type:e,scale:(()=>{switch(e){default:case"linear":return t.scaleLinear();case"sqrt":return t.scalePow().exponent(.5);case"band":return t.scaleBand().padding(.1);case"point":return t.scalePoint().padding(.5)}})()},r={scale:a.scale,range:(e,t)=>(a.scale.range([e,t]),r),domain:e=>{switch(a.type){default:case"linear":case"sqrt":a.scale.domain([Math.min(...e),Math.max(...e)]);break;case"band":case"point":a.scale.domain(e)}return r},type:e=>{if(void 0===e)return a.type;switch(e){default:case"linear":a.scale=t.scaleLinear();break;case"sqrt":a.scale=t.scalePow().exponent(.5);break;case"band":a.scale=t.scaleBand().padding(.1);break;case"point":a.scale=t.scalePoint().padding(.5)}},measure:e=>Math.abs(a.scale.invert(e)-a.scale.invert(0))};return r},se=(e,a)=>{const r=!1,n={on:r};return{self:e=Object.assign(e||{},{_smoothing:{curve:()=>n.on?t.curveMonotoneX:t.curveLinear}}),api:a=Object.assign(a||{},{smoothing:(e=r)=>(n.on=e,a)})}},oe=()=>{let e={min:void 0,max:void 0,compressMax:0,compressMin:0};return{min:t=>e.min=t,max:t=>e.max=t,compressMin:t=>e.compressMin=Math.abs(t||0),compressMax:t=>e.compressMax=Math.abs(t||0),range:t=>{let a=void 0!==e.min?e.min:Math.min(...t),r=void 0!==e.max?e.max:Math.max(...t),n=r-a;return a-=e.compressMin>0?e.compressMin*n:0,r+=e.compressMax>0?e.compressMax*n:0,[a,r]},contains:t=>(void 0===e.min||t>=e.min)&&(void 0===e.max||t<=e.max)}},ce=(e,t)=>{let a=oe();return{self:e=Object.assign(e||{},{_yRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{yRange:{min:e=>(a.min(e),t),compressMin:(e=0)=>(a.compressMin(e),t),max:e=>(a.max(e),t),compressMax:(e=0)=>(a.compressMax(e),t)}})}};const de=document.createElement("canvas").getContext("2d");function pe(e,t){return de.font=t.fontSize+" "+t.fontFamily,{width:de.measureText(e).width,height:parseFloat(t.fontSize)}}function ue(e,a=.4){const r=t.hsl(e);return r.l+=a*(1-r.l),r}function ge(e){return function(e){const a=t.color(e);return.229*a.r+.587*a.g+.114*a.b}(e)>150?"#000":"#fff"}const me="dalian-element-tooltip-",he={content:me+"content",title:me+"title",entry:me+"entry",label:me+"label",value:me+"value"};var ye=(e,a)=>{W.addClass(he.content,{"border-radius":"2px","font-family":"inherit",padding:"0.7em"}).addClass(he.title,{position:"relative",margin:"2px","margin-bottom":"10px","line-height":"1em"}).addClass(he.entry,{position:"relative",margin:"2px",height:"1em","padding-right":"10px","line-height":"1em"}).addClass(he.label,{position:"relative",float:"left","margin-right":"10px"}).addClass(he.value,{position:"relative",float:"right"});const r={titleFormat:e=>e,labelFormat:e=>e+":",valueFormat:e=>e};let n=ae(e,a),i={titleFormat:r.titleFormat,labelFormat:r.labelFormat,valueFormat:r.valueFormat};return e._tooltip=Object.assign(n.self._tooltip,{builder:a=>{if(void 0===a)return void e._tooltip.content();let r=t.select(document.createElement("div")).attr("class",he.content).style("border-left",a.stripe?"solid 4px "+a.stripe:null);return r.append("div").attr("class",he.title).html(i.titleFormat(a.title)),a.content.data.forEach(e=>{let t=r.append("div").attr("class",he.entry);t.append("div").attr("class",he.label).html(i.labelFormat(e.name)),t.append("span").attr("class",he.value).html(i.valueFormat(e.value,e.name))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(e=r.titleFormat)=>(i.titleFormat=e,a),labelFormat:(e=r.labelFormat)=>(i.labelFormat=e,a),valueFormat:(e=r.valueFormat)=>(i.valueFormat=e,a)}),{self:e,api:a}},xe=e=>(t,a)=>{const r=!1,n={on:r,scales:{x:e.x,y:e.y}};return t=Object.assign(t||{},{_horizontal:{on:()=>n.on,scales:()=>n.scales}}),a=Object.assign(a||{},{horizontal:(i=r)=>(n.on=i,n.scales.x=i?e.y:e.x,n.scales.y=i?e.x:e.y,t._bottomAxis.scale(n.scales.x),t._leftAxis.scale(n.scales.y),void 0!==t._yGrid&&t._yGrid.type(i?"x":"y"),a)}),{self:t,api:a}},be=(e,t)=>{const a={format:()=>""};return e=Object.assign(e||{},{_label:{show:!1,format:a.format}}),t=Object.assign(t||{},{label:r=>(e._label.show=null!=r,e._label.format=r||a.format,t)}),{self:e,api:t}},fe=e=>(t,a)=>{let n={defaults:{opacity:.3,lineStyle:"4 8"},type:e,on:!1,grid:void 0,opacity:void 0,lineStyle:void 0,update:e=>{if(n.on){void 0===n.grid&&(n.grid=t._chart.plots.insert("g",":first-child").attr("class","grid").style("opacity",0).style("stroke","currentColor").style("stroke-width","1px"));const a="x"===n.type?t._bottomAxis.fn:t._leftAxis.fn,r="x"===n.type?parseFloat(t._widget.size.innerHeight):-parseFloat(t._widget.size.innerWidth);n.grid.transition().duration(e).call(a.tickSizeInner(r).tickFormat("")).style("stroke-opacity",n.opacity||n.defaults.opacity).style("stroke-dasharray",n.lineStyle||n.defaults.lineStyle).style("opacity",1),n.grid.select("path").remove()}else void 0!==n.grid&&(n.grid.transition().duration(e).style("opacity",0).remove(),n.grid=void 0)}};t._widget.update=r(t._widget.update,n.update);let i={type:e=>{n.type=e,n.grid&&(n.grid.remove(),n.grid=void 0)}};const l={on:e=>(n.on=e,a),opacity:e=>(n.opacity=e,a),lineStyle:e=>{switch(e){case"solid":n.lineStyle="1 0";break;case"dashed":default:n.lineStyle="4 8";break;case"dotted":n.lineStyle="2 5"}return a}};return a=Object.assign(a||{},"x"===e?{xGrid:l}:{yGrid:l}),{baseSelf:i,self:t,api:a}},ve=(e,t)=>{let a=fe("y")(e,t);return{self:e=Object.assign(e||{},{_yGrid:a.baseSelf}),api:a.api}},_e=(e,t)=>{let a=oe();return{self:e=Object.assign(e||{},{_xRange:{range:a.range,contains:a.contains}}),api:t=Object.assign(t||{},{xRange:{min:e=>(a.min(e),t),compressMin:(e=0)=>(a.compressMin(e),t),max:e=>(a.max(e),t),compressMax:(e=0)=>(a.compressMax(e),t)}})}};function we(e,t,a){return new Date(Date.UTC(e,t,a))}function ke(e){const t=e.split("-");return we(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))}const ze="dalian-checkbox-",Me={wrapper:ze+"wrapper",label:ze+"label",box:ze+"box",mark:ze+"mark"};const Ce=(e,a)=>{const r="_current"+(a||"");return function(a){const n=t.interpolate(this[r],a);return this[r]=n(0),t=>e(n(t),a)}};var Ae=(()=>{const e={};function a(){return void 0===e.defs&&(console.log("create defs"),e.defs=t.select("body").append("svg").attr("id","dalian-defs").append("defs")),e.defs}const r={addMask:(e,t,r)=>a().append("mask").attr("id",e).attr("x",t.x).attr("y",t.y).attr("width",r.width).attr("height",r.height),addPattern:(e,t,r)=>a().append("pattern").attr("id",e).attr("x",t.x).attr("y",t.y).attr("width",r.width).attr("height",r.height).attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(-45)")};return r})(),je=(()=>{const e={pattern:"dalian-pattern-dashed",mask:"dalian-mask-dashed"},t={pattern:"dalian-pattern-dotted",mask:"dalian-mask-dotted"},a={};function r(e){return Ae.addPattern(e,{x:0,y:0},{width:4,height:4})}function n(e,t){return Ae.addMask(e,{x:0,y:0},{width:4,height:4}).append("rect").attr("x","-50%").attr("y","-50%").attr("width","100%").attr("height","100%").attr("fill",`url(#${t})`)}const i={get:i=>{switch(i){case"solid":default:return null;case"dashed":if(void 0===a.dashedId){const t=e.pattern;r(t).append("path").attr("d","m 0 0 h 4").attr("stroke","#fff").attr("stroke-width",4),a.dashedId=e.mask,n(a.dashedId,t)}return`url(#${a.dashedId})`;case"dotted":if(void 0===a.dottedId){const e=t.pattern;r(e).append("circle").attr("cx",2).attr("cy",2).attr("r",1.5).attr("fill","#fff"),a.dottedId=t.mask,n(a.dottedId,e)}return`url(#${a.dottedId})`}}};return i})(),$e=(e,t)=>{const a={policy:void 0,getStrokeDashArray:e=>{switch(e){case"solid":default:return null;case"dashed":return"5 8";case"dotted":return"1 8"}}};return{self:e=Object.assign(e||{},{_lineStyle:{strokeDashArray:e=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[e]),style:e=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[e],background(e,t){switch(e){case"solid":default:return t;case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${t} 2px, ${t} 4px`;case"dotted":return`radial-gradient(${t} 37%, transparent 37%) 0px 0px/6px 6px, radial-gradient(${t} 37%, transparent 37%) 3px 3px/6px 6px transparent`}}}}),api:t=Object.assign(t||{},{lineStyle:e=>(a.policy=e,t)})}},Oe=fe("x");const Fe="dalian-radio-button-",Se={entry:Fe+"entry",label:Fe+"label",marker:Fe+"marker"};const Te="#888",We=0,Ie="dalian-table-",De={container:Ie+"container",table:Ie+"table",head:Ie+"head",headContainer:Ie+"head-container",headLabel:Ie+"ead-label",headSvg:Ie+"head-svg",headMarker:Ie+"head-marker",scrollbarTrack:Ie+"container::-webkit-scrollbar-track",scrollbarThumb:e=>e+" .dalian-table-container::-webkit-scrollbar-thumb",scrollbarThumbHover:e=>e+" .dalian-table-container::-webkit-scrollbar-thumb:hover",paging:Ie+"paging",pagingBlock:Ie+"paging-block",pagingNumber:Ie+"paging-number",pagingTotalBefore:Ie+"paging-total:before",pagingButton:Ie+"paging-button",pagingButtonHover:Ie+"paging-button:hover"};e.AreaChart=(e,i="body")=>{const l={x:le("linear"),y:le("linear")};let{self:s,api:o}=n(V("area-chart",e,i),J(l.y),(c="transparent",(e,t)=>{const a={mapping:()=>c+"px"};return{self:e=Object.assign(e||{},{_lineColor:{mapping:e=>a.mapping(e)}}),api:t=Object.assign(t||{},{lineColor:(e=c)=>(a.mapping="string"==typeof e?()=>e:t=>e[t]||c,t)})}}),K(1),N(l.x),ee,Q(l),Z(.4),se,ie,U(()=>s._chart.plots,[".plot-group",".plot-marker"]),ce);var c;const d={scales:l,update(e){const r=s._chart.data.map(e=>e.values).flat(),n=r.map(e=>e.y),i=t.extent(n),l=.01*(i[1]-i[0]);i[1]+=l,d.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(r.map(e=>e.x)),d.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(s._yRange.range(i));const o=t.area().x(e=>d.scales.x.scale(e.x)).y0(d.scales.y.scale(0)).y1(e=>d.scales.y.scale(e.y)).curve(s._smoothing.curve()),c=t.line().x(e=>d.scales.x.scale(e.x)).y(e=>d.scales.y.scale(e.y)).curve(s._smoothing.curve());s._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",s._color.mapper),e.append("path").attr("class","area").attr("d",e=>o(e.values)).attr("stroke","none").attr("fill","currentColor"),e.append("path").attr("class","line").attr("d",e=>c(e.values)).attr("fill","none"),e),update:e=>(e.style("opacity",1).style("color",s._color.mapper),e.select(".area").attrTween("d",(function(e){const r=t.select(this).attr("d"),n=o(e.values);return a.interpolatePath(r,n,null)})).attr("fill-opacity",s._opacity.value()),e.select(".line").attr("stroke",s._lineColor.mapping).attr("stroke-width",e=>s._lineWidth.mapping(e.name)).attrTween("d",(function(e){const r=t.select(this).attr("d"),n=c(e.values);return a.interpolatePath(r,n,null)})),e),exit:e=>e.style("opacity",0)},e)}};return s._tooltip.content=e=>{if(void 0===e)return void s._plotMarker.remove();const a=t.bisector(e=>d.scales.x.scale(e.x)).left,r=e?s._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===r)return void s._plotMarker.remove();let n=d.scales.x.scale.invert(e[0]);const i=s._chart.data.filter(e=>-1===s._tooltip.ignore.indexOf(e.name)).map((e,t)=>{const a=r[t],i=e.values,l=i[a-1]?i[a-1]:i[a],o=i[a]?i[a]:i[a-1],c=n-l.x>o.x-n?o:l;return n=c.x,s._plotMarker.add(d.scales.x.scale(n),d.scales.y.scale(c.y),e.name,e),{name:e.name,background:s._color.mapper(e),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:n,content:{data:i}}},s._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:+e.x,y:+e.y}))})),s._widget.update=r(s._widget.update,d.update,!0),o=Object.assign(o||{},{}),o},e.BarChart=(e,a="body")=>{const i={x:le("band"),y:le("linear")},{self:l,api:s}=n(V("bar-chart",e,a),J(i.y),N(i.x),ye,U(()=>l._chart.plots,[".plot-group"]),xe(i),be,Q(i),ve),o={current:void 0,scales:l._horizontal.scales(),horizontal:!1,measureX:(e,t,a)=>{const r=pe(l._label.format(e),a),n=Math.max((t-r.height)/2,5),i=o.scales.x.scale(Math.max(0,e.value)),s=Math.abs(i-o.scales.x.scale(0))>2*n+r.width;return{inside:s,x:s?i-n:i+n+r.width,y:o.scales.y.scale(e.name)+t/2,color:s?ge(l._color.mapper(e)):a.color}},measureY:(e,t,a)=>{const r=pe(l._label.format(e),a),n=Math.max((t-r.width)/2,5),i=o.scales.y.scale(Math.max(0,e.value)),s=Math.abs(i-o.scales.y.scale(0))>2*n+r.height;return{inside:s,x:o.scales.x.scale(e.name)+t/2,y:s?i+n:i-n-r.height,color:s?ge(l._color.mapper(e)):a.color}},update:e=>{o.scales=l._horizontal.scales();const a=l._horizontal.on(),r=l._widget.getStyle(),n=l._chart.data.map(e=>e.name);let i=Math.min(0,t.min(l._chart.data.map(e=>e.value))),s=t.max(l._chart.data.map(e=>e.value))||1;const c=s-i;s+=.01*c,i<0&&(i-=.01*c),o.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(a?[i,s]:n),o.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(a?n:[i,s]),l._chart.plotGroups({enter:e=>{const t=a?o.scales.y.scale.bandwidth():o.scales.x.scale.bandwidth();e.append("rect").attr("class","bar").on("mouseover.bar",e=>{o.current=e}).on("mouseleave.bar",()=>{o.current=void 0}).attr("x",e=>o.scales.x.scale(a?0:e.name)).attr("y",e=>o.scales.y.scale(a?e.name:0)).attr("width",a?0:t).attr("height",a?t:0).attr("fill",l._color.mapper);const n=a?o.measureX:o.measureY;return e.append("text").attr("class","bar-label").attr("stroke","none").style("display","none").style("pointer-events","none").text(l._label.format).each(e=>Object.assign(e,{_measures:n(e,t,r)})).attr("fill",e=>e._measures.color).attr("x",e=>a?o.scales.x.scale(0):e._measures.x).attr("y",e=>a?e._measures.y:o.scales.y.scale(0)),e},update:e=>{e.style("opacity",1);const t=a?o.scales.y.scale.bandwidth():o.scales.x.scale.bandwidth();e.select(".bar").attr("x",e=>o.scales.x.scale(a?Math.min(0,e.value):e.name)).attr("y",e=>o.scales.y.scale(a?e.name:Math.max(e.value,0))).attr("width",e=>a?Math.abs(o.scales.x.scale(e.value)-o.scales.x.scale(0)):t).attr("height",e=>a?t:Math.abs(o.scales.y.scale(e.value)-o.scales.y.scale(0))).attr("fill",l._color.mapper);const n=a?o.measureX:o.measureY;return e.select(".bar-label").each(e=>Object.assign(e,{_measures:n(e,t,r)})).attr("text-anchor",a?"end":"middle").attr("dominant-baseline",a?"central":"hanging").attr("font-size","inherit").attr("fill",l._font.color).attr("fill",e=>e._measures.color).attr("x",e=>e._measures.x).attr("y",e=>e._measures.y).text(l._label.format).style("display",l._label.show?null:"none"),e},exit:e=>e.style("opacity",0)},e)}};return l._tooltip.content=()=>void 0===o.current?void 0:{title:o.current.name,stripe:l._color.mapper(o.current),content:{data:[{name:"value",value:o.current.value}]}},l._widget.update=r(l._widget.update,o.update,!0),s},e.BoxPlot=(e,a="body")=>{const i={x:le("point"),y:le("linear")};let{self:l,api:s}=n(V("box-plot",e,a),N(i.x),ye,U(()=>l._chart.plots,[".plot-group"]),xe(i),J(i.y),K(1),Q(i),Z(.2));const o={current:void 0,scales:l._horizontal.scales(),boxWidth:20,horizontal:!1,whiskerPath(e){const t="lower"===e?"q1":"q3";return a=>`M${o.scales.x.scale(o.horizontal?a.value[t]:a.name)} ${o.scales.y.scale(o.horizontal?a.name:a.value[t])}\n      L${o.scales.x.scale(o.horizontal?a.value.whiskers[e]:a.name)} ${o.scales.y.scale(o.horizontal?a.name:a.value.whiskers[e])}\n      m${o.horizontal?0:-.4*o.boxWidth} ${o.horizontal?-.4*o.boxWidth:0}\n      l${o.horizontal?0:.8*o.boxWidth} ${o.horizontal?.8*o.boxWidth:0}`},outlierX:e=>o.scales.x.scale(o.horizontal?e:e.name),outlierY:e=>o.scales.y.scale(o.horizontal?e.name:e),update(e){const a=l._chart.data.map(e=>e.name);let r=t.min(l._chart.data,e=>t.min(e.value.outliers.extreme.concat(e.value.outliers.mild).concat([e.value.whiskers.lower]))),n=t.max(l._chart.data,e=>t.max(e.value.outliers.extreme.concat(e.value.outliers.mild).concat([e.value.whiskers.upper])));const i=n-r;r-=.05*i,n+=.05*i,o.horizontal=l._horizontal.on(),o.scales=l._horizontal.scales(),o.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(o.horizontal?[r,n]:a),o.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(o.horizontal?a:[r,n]);const s=o.horizontal?0:o.boxWidth/2,c=o.horizontal?o.boxWidth/2:0;l._chart.plotGroups({enter:e=>(e.style("opacity",0).on("mouseover.box",e=>{o.current=e}).on("mouseleave.box",()=>{o.current=void 0}).style("color",l._color.mapper),e.append("rect").attr("class","box-body").attr("rx","2px").attr("ry","2px").attr("stroke","currentColor").attr("stroke-width",e=>l._lineWidth.mapping(e.name)).attr("fill","currentColor").attr("fill-opacity",l._opacity.value()).attr("x",e=>o.scales.x.scale(o.horizontal?e.value.q1:e.name)-s).attr("y",e=>o.scales.y.scale(o.horizontal?e.name:e.value.q3)-c).attr("width",e=>o.horizontal?o.scales.x.scale(e.value.q3)-o.scales.x.scale(e.value.q1):o.boxWidth).attr("height",e=>o.horizontal?o.boxWidth:o.scales.y.scale(e.value.q1)-o.scales.y.scale(e.value.q3)),e.append("line").attr("class","box-median").attr("x1",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)-s).attr("y1",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)-c).attr("x2",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)+s).attr("y2",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)+c).attr("stroke","currentColor").attr("stroke-width","2px"),e.append("path").attr("class","box-whisker-lower").attr("d",o.whiskerPath("lower")).attr("stroke","currentColor").attr("stroke-width",e=>l._lineWidth.mapping(e.name)).attr("fill","none"),e.append("path").attr("class","box-whisker-upper").attr("d",o.whiskerPath("upper")).attr("stroke","currentColor").attr("stroke-width",e=>l._lineWidth.mapping(e.name)).attr("fill","none"),e.selectAll(".box-mild-outlier").data(e=>e.value.outliers.mild.map(t=>Object.assign(t,{name:e.name}))).enter().append("circle").attr("class","box-mild-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor"),e.selectAll(".box-extreme-outlier").data(e=>e.value.outliers.extreme.map(t=>Object.assign(t,{name:e.name}))).enter().append("circle").attr("class","box-extreme-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor").style("opacity",.3),e),updateBefore:t=>(t.selectAll(".box-mild-outlier").data(e=>e.value.outliers.mild.map(t=>Object.assign(t,{name:e.name}))).join(e=>e.append("circle").attr("class","box-mild-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",o.outlierX).attr("cy",o.outlierY).style("opacity",1),t.selectAll(".box-extreme-outlier").data(e=>e.value.outliers.extreme.map(t=>Object.assign(t,{name:e.name}))).join(e=>e.append("circle").attr("class","box-extreme-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",o.outlierX).attr("cy",o.outlierY).style("opacity",l._opacity.value()),t),update:e=>(e.style("opacity",1).style("color",l._color.mapper),e.select(".box-body").attr("x",e=>o.scales.x.scale(o.horizontal?e.value.q1:e.name)-s).attr("y",e=>o.scales.y.scale(o.horizontal?e.name:e.value.q3)-c).attr("width",e=>o.horizontal?o.scales.x.scale(e.value.q3)-o.scales.x.scale(e.value.q1):o.boxWidth).attr("height",e=>o.horizontal?o.boxWidth:o.scales.y.scale(e.value.q1)-o.scales.y.scale(e.value.q3)).attr("stroke-width",e=>l._lineWidth.mapping(e.name)).attr("fill-opacity",l._opacity.value()),e.select(".box-median").attr("x1",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)-s).attr("y1",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)-c).attr("x2",e=>o.scales.x.scale(o.horizontal?e.value.median:e.name)+s).attr("y2",e=>o.scales.y.scale(o.horizontal?e.name:e.value.median)+c),e.select(".box-whisker-lower").attr("d",o.whiskerPath("lower")).attr("stroke-width",e=>l._lineWidth.mapping(e.name)),e.select(".box-whisker-upper").attr("d",o.whiskerPath("upper")).attr("stroke-width",e=>l._lineWidth.mapping(e.name)),e),exit:e=>e.style("opacity",0)},e)}};return l._tooltip.content=()=>void 0===o.current?void 0:{title:o.current.name,stripe:l._color.mapper(o.current),content:{data:[{name:"median",value:o.current.value.median},{name:"q1",value:o.current.value.q1},{name:"q3",value:o.current.value.q3},{name:"low",value:o.current.value.whiskers.lower},{name:"high",value:o.current.value.whiskers.upper},{name:"mild outliers",value:o.current.value.outliers.mild.length},{name:"extreme outliers",value:o.current.value.outliers.extreme.length}]}},l._widget.update=r(l._widget.update,o.update,!0),s=Object.assign(s||{},{boxWidth:(e=20)=>(o.boxWidth=e,s)}),s},e.BubbleChart=(e,a="body")=>{const i={x:le("linear"),y:le("linear"),size:le("sqrt")};let{self:l,api:s}=n(V("bubble-chart",e,a),J(i.y),N(i.x),ye,U(()=>l._chart.plots,[".plot-group"]),Q(i),Z(.6),_e,ce);const o={scales:i,current:{hovered:void 0,closest:void 0},diagram:void 0,radius:30,computeDiagram:e=>t.voronoi().x(e=>o.scales.x.scale(e.value.x)).y(e=>o.scales.y.scale(e.value.y)).extent([[0,0],[parseInt(l._widget.size.innerWidth),parseInt(l._widget.size.innerHeight)]])(e),update(e){const a=l._chart.data.map(e=>e.value).flat(),r=t.max(a.map(e=>e.size));o.scales.size.range(0,o.radius).domain([0,r]);let n=t.extent(a.map(e=>e.x));o.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(n);let i=t.extent(a.map(e=>e.y));o.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(i),n=a.map(e=>{const t=o.scales.x.measure(1.5*o.scales.size.scale(e.size));return[e.x-t,e.x+t]}).flat(),o.scales.x.domain(l._xRange.range(n)),i=a.map(e=>{const t=o.scales.y.measure(1.5*o.scales.size.scale(e.size));return[e.y-t,e.y+t]}).flat(),o.scales.y.domain(l._yRange.range(i)),l._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",l._color.mapper).on("mouseover.bubble",e=>{o.current.hovered=e,void 0===o.current.closest&&l._mouse.over(o.current.hovered)}).on("mouseleave.bubble",()=>{void 0===o.current.closest&&l._mouse.leave(o.current.hovered),o.current.hovered=void 0}).on("mouseover.chart",null).on("mouseleave.chart",null),e.append("circle").attr("class","bubble").attr("cx",e=>o.scales.x.scale(e.value.x)).attr("cy",e=>o.scales.y.scale(e.value.y)).attr("r",e=>Math.max(o.scales.size.scale(e.value.size),1)).attr("stroke","currentColor").attr("fill","currentColor").raise(),e),update:e=>(e.style("opacity",1).style("color",l._color.mapper),e.select(".bubble").attr("cx",e=>o.scales.x.scale(e.value.x)).attr("cy",e=>o.scales.y.scale(e.value.y)).attr("r",e=>Math.max(o.scales.size.scale(e.value.size),1)).attr("fill-opacity",l._opacity.value()),e),exit:e=>e.style("opacity",0)},e),o.diagram=o.computeDiagram(l._chart.data),l._widget.container.on("mousemove.bubble",()=>{const e=o.diagram.find(...l._widget.getMouse(),20),t=e&&e.data||void 0;t!==o.current.closest&&(void 0===t?(l._mouse.leave(o.current.closest),o.current.closest=void 0,void 0!==o.current.hovered&&l._mouse.over(o.current.hovered)):(void 0!==o.current.hovered&&l._mouse.leave(o.current.hovered),o.current.closest=t,l._mouse.over(o.current.closest)))}).on("click.bubble",()=>{void 0!==o.current.closest&&l._mouse.click(o.current.closest)})}};return l._tooltip.content=e=>{if(void 0===e)return;const t=o.current.closest||o.current.hovered;return t?{title:t.name,stripe:l._color.mapper(t),content:{data:[{name:l._bottomAxis.label.text(),value:t.value.x},{name:l._leftAxis.label.text(),value:t.value.y},{name:"size",value:t.value.size}]}}:void 0},l._chart.transformData=e=>e.sort((e,t)=>t.value.size-e.value.size),l._widget.update=r(l._widget.update,o.update,!0),s=Object.assign(s||{},{radius:(e=30)=>(o.radius=e,s)}),s},e.BulletChart=(e,a="body")=>{const i={value:0,forecast:1,ranges:[0,50,80,100],thickness:30,valueColor:"#000",rangeColor:"#888"},l=le("linear");let{self:s,api:o}=n(X("bullet-chart",e,a,"svg"),N(l),D,L,R);const c={scale:l,ui:{thickness:i.thickness,valueColor:i.valueColor,rangeColor:i.rangeColor},data:{label:"",unit:"",min:0,max:100,ranges:i.ranges,target:95,value:i.value,forecast:i.forecast},dom:(()=>{const e=s._widget.content.append("g").attr("class","dalian-plot-container"),t=e.append("g").attr("class","bullet-range"),a=e.append("g").attr("class","bullet-value"),r=e.append("g").attr("class","bullet-title");return{plot:e,range:{g:t,high:t.append("rect").attr("stroke","none").attr("fill-opacity",.2).attr("fill","currentColor"),mid:t.append("rect").attr("stroke","none").attr("fill-opacity",.4).attr("fill","currentColor"),low:t.append("rect").attr("stroke","none").attr("fill-opacity",.6).attr("fill","currentColor")},value:{g:a,forecast:a.append("rect").attr("stroke","none"),bar:a.append("rect").attr("stroke","none").attr("fill","currentColor"),target:a.append("line").attr("stroke","currentColor").attr("stroke-width","3px")},title:{label:r.append("text").attr("dx",-10).attr("text-anchor","end").attr("dominant-baseline","baseline"),unit:r.append("text").attr("dx",-10).attr("font-size","0.75em").attr("text-anchor","end").attr("dominant-baseline","hanging")}}})(),update(e){c.scale.range(0,parseInt(s._widget.size.innerWidth)).domain([c.data.ranges[0],c.data.ranges[3]]);const a=(parseFloat(s._widget.size.innerHeight)-c.ui.thickness)/2;s._widget.getElem(c.dom.plot,e).attr("transform",`translate(${s._widget.margins.left}, ${a+s._widget.margins.top})`),s._bottomAxis.margin({bottom:a}).tickColor(c.ui.rangeColor);const r=s._widget.container.transition().duration(e);c.dom.range.g.transition(r).attr("color",c.ui.rangeColor),c.dom.value.g.transition(r).attr("color",c.ui.valueColor),c.dom.range.high.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[3])+1).attr("height",c.ui.thickness),c.dom.range.mid.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[2])+1).attr("height",c.ui.thickness),c.dom.range.low.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[1])+1).attr("height",c.ui.thickness),c.dom.value.bar.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",c.ui.thickness/3).attr("width",c.scale.scale(c.data.value)).attr("height",c.ui.thickness/3),c.dom.value.forecast.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",c.ui.thickness/3).attr("width",c.scale.scale(Math.min(c.data.value*c.data.forecast,c.data.ranges[3]))).attr("height",c.ui.thickness/3).attr("fill",(e=>{const a=t.hsl(e);return a.l+=.4*(1-a.l),a})(c.ui.valueColor)),c.dom.value.target.transition(r).attr("x1",c.scale.scale(c.data.target)).attr("y1",c.ui.thickness/6).attr("x2",c.scale.scale(c.data.target)).attr("y2",5*c.ui.thickness/6),c.dom.title.label.transition(r).attr("y",c.ui.thickness/2).text(c.data.label),c.dom.title.unit.transition(r).attr("y",2*c.ui.thickness/3).text(c.data.unit)}};return s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o,{value:(e=i.value)=>(c.data.value=e,o),forecast:(e=i.forecast)=>(c.data.forecast=e,o),target:e=>(c.data.target=e,o),ranges:(e=[0,50,80,100])=>(c.data.ranges=e,o),thickness:(e=i.thickness)=>(c.ui.thickness=e,o),valueColor:(e=i.valueColor)=>(c.ui.valueColor=e,o),rangeColor:(e=i.rangeColor)=>(c.ui.rangeColor=e,o),label:e=>(c.data.label=e,o),unit:e=>(c.data.unit=e,o)}),s._bottomAxis.hideAxisLine(!0),o},e.CalendarPlot=(e,a="body")=>{const i={blocks:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],margin:0,align:"start"},tiles:{names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekStart:0}},l={x:le("linear"),y:le("band")};let{self:s,api:o}=n(V("calendar-plot",e,a),ye,U(()=>s._chart.plots,[".plot-group"]),be,J(l.y),(c=l.x,(e,a)=>{let n=Y("x",e,t.axisTop,c,{"text-anchor":"end",dy:"2.5em"}),i=t=>{e._widget.getElem(n.label,t).attr("x",e._widget.size.innerWidth)};return(e=Object.assign(e||{},{_topAxis:n}))._widget.update=r(e._widget.update,i),a=Object.assign(a||{},{topAxis:{label:(e="")=>(n.label.text(e),a),format:e=>(n.format(e),a),values:e=>(n.values(e),a),hideTicks:e=>(n.self.hideTicks(e),a),hideAxisLine:e=>(n.hideAxisLine(e),a)}}),{self:e,api:a}}));var c;const d={scales:l,current:void 0,metrics:{},blocks:{names:i.blocks.names,margin:i.blocks.margin,align:i.blocks.align},tiles:{names:i.tiles.names,weekStart:0},fm:s._widget.getFontMetrics(),shiftDay:(e,t)=>(e-t+7)%7,tileX(e){const t=Math.ceil((e.date-d.metrics.firstDay)/864e5);return Math.floor((t+d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart))/7)},labelFill:e=>ge(s._color.mapper(e)),addTiles(e,t,a,r){const n=e.append("g").attr("class",e=>"tile date-"+e.date.getDate()).attr("transform",e=>`translate(${d.tileX(e)*t}, ${d.shiftDay(e.date.getDay(),d.tiles.weekStart)*t})`).on("mouseover.calendar",e=>{d.current=e}).on("mouseleave.calendar",()=>{d.current=void 0});return n.append("rect").attr("x",1).attr("y",1).attr("width",t-2).attr("height",t-2).attr("rx",.1*t).attr("ry",.1*t).attr("stroke","transparent").attr("stroke-width",2).attr("fill",s._color.mapper),n.append("text").attr("x",0).attr("y",0).attr("dx",.5*t).attr("dy",a).attr("text-anchor","middle").attr("font-size",r).attr("fill",d.labelFill).style("display",s._label.show?null:"none").style("user-select","none").text(s._label.format),n},update(e){const a=7-d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart),r=Math.ceil((d.metrics.numDays-a)/7)+1;s._chart.data.forEach(e=>{e.x=Math.floor((e.daysOffset-a)/7)+1,e.length=Math.ceil((e.daysOffset+e.numDays-a)/7)+1-e.x});const n=parseFloat(s._widget.size.innerWidth)/(r+d.blocks.margin*(d.metrics.numMonths-1)),i=parseFloat(s._widget.size.innerHeight)/7,l=Math.min(n,i);s._color.scale(t.scaleLinear().domain(t.extent(s._chart.data.map(e=>e.tiles).flat(),e=>e.value)).range([0,1]));const o=(parseFloat(s._widget.size.innerWidth)-l*(r+d.blocks.margin*(d.metrics.numMonths-1)))/2,c=(parseFloat(s._widget.size.innerHeight)-7*l)/2,p=Math.min(.6*l,parseFloat(s._font.size))+"px",u=(l+d.fm.capHeight*parseFloat(p))/2;var g,m;d.scales.x.range(o,parseInt(s._widget.size.innerWidth)-o).domain([0,r+d.blocks.margin*(d.metrics.numMonths-1)]),d.scales.y.range(c,parseInt(s._widget.size.innerHeight)-c).domain((g=d.tiles.names,m=d.tiles.weekStart,g.slice(m).concat(g.slice(0,m)))),s._leftAxis.hideAxisLine(!0).hideTicks(!0).margin({left:o}),s._topAxis.tickAnchor(d.blocks.align).hideAxisLine(!0).hideTicks(!0).margin({top:c}).values(s._chart.data.map(e=>e.x+("middle"===d.blocks.align?.5*e.length:0)+d.blocks.margin*e.index)).format((e,t)=>d.blocks.names[s._chart.data[t].month]),s._chart.plotGroups({enter:e=>(e.style("opacity",0).classed("year-"+d.metrics.firstDay.getFullYear(),!0).attr("transform",e=>`translate(${o+d.blocks.margin*e.index*l}, ${c})`),d.addTiles(e.selectAll(".tile").data(e=>e.tiles).enter(),l,u,p),e),updateBefore:t=>{const a=t.selectAll(".tile").data(e=>e.tiles).join(e=>d.addTiles(e,l,u,p).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("transform",e=>`translate(${d.tileX(e)*l}, ${d.shiftDay(e.date.getDay(),d.tiles.weekStart)*l})`).style("opacity",1);return a.select("rect").attr("width",l-2).attr("height",l-2).attr("rx",.1*l).attr("ry",.1*l).attr("fill",s._color.mapper),a.select("text").attr("dx",.5*l).attr("dy",u).attr("font-size",p).attr("fill",d.labelFill).style("display",s._label.show?null:"none").text(s._label.format),t},update:e=>e.style("opacity",1).attr("transform",e=>`translate(${o+d.blocks.margin*e.index*l}, ${c})`),exit:e=>e.style("opacity",0)},e)}};return s._chart.transformData=e=>{const a=e.map(e=>({date:ke(e.date),value:+e.value})),r=t.min(a.map(e=>e.date)).getMonth(),n=t.max(a.map(e=>e.date)).getMonth(),i=a[0].date.getFullYear();let l=0;const s=Array.from({length:n-r+1},(e,t)=>{const a=(r+t)%12,n=we(i,a+1,0).getDate(),s=we(i,a,1),o={month:a,numDays:n,daysOffset:l,index:t,name:"month-"+a,tiles:Array.from({length:n},(e,t)=>{const r=new Date(s);return r.setDate(s.getDate()+t),{name:"month-"+a,date:r,value:null}})};return l+=n,o});return a.forEach(e=>{const t="month-"+e.date.getMonth();s.find(e=>e.name===t).tiles.find(t=>t.date.getDate()===e.date.getDate()).value=e.value}),d.metrics={year:s[0].tiles[0].date.getFullYear(),firstDay:s[0].tiles[0].date,numDays:t.sum(s,e=>e.tiles.length),numMonths:s.length},s},s._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.date.toISOString().substr(0,10),stripe:s._color.mapper(d.current),content:{type:"plots",data:[{name:"value",value:d.current.value}]}},s._widget.update=r(s._widget.update,d.update,!0),o=Object.assign(o||{},{months:(e=i.blocks.names)=>(d.blocks.names=e,o),blockAlign:(e=i.blocks.align)=>(d.blocks.align=e,o),blockMargin:(e=i.blocks.margin)=>(d.blocks.margin=e,o),days:(e=i.tiles.names)=>(d.tiles.names=e,o),weekStart:(e=i.tiles.weekStart)=>(d.tiles.weekStart=e,o)}),delete o.leftAxis,delete o.topAxis,s._color.init("sequential",e=>e.value),o},e.Checkbox=(e,t="body")=>{W.addClass(Me.wrapper,{display:"inline-block",position:"relative","user-select":"none"}).addClass(Me.label,{position:"absolute",top:"0.1em","margin-left":"2em","line-height":"1.35em"}).addClass(Me.box,{width:"1.35em",height:"1.35em"}).addClass(Me.mark,{position:"absolute",left:".45em",top:".15em",width:".3em",height:".7em",border:"solid white",transform:"rotate(45deg)","border-width":"0 .15em .15em 0"});const a={checked:!1,color:"grey",disabled:!1,label:""};let{self:i,api:l}=n(X("checkbox",e,t,"div"),R);function s(){o.internal.checked=!o.internal.checked,o.dom.box.style("background",o.internal.checked?o.internal.color:ue(o.internal.color,.6)),o.dom.mark.style("display",o.internal.checked?null:"none"),o.internal.callback&&o.internal.callback(o.internal.checked)}const o={internal:Object.assign({},a),dom:(()=>{const e=i._widget.content.append("div").attr("class","container"),t=e.append("div").attr("class",Me.wrapper),a=t.append("div").attr("class",Me.label).on("click",s),r=t.append("div").attr("class",Me.box).on("click",s),n=r.append("div").attr("class",Me.mark);return{container:e,wrapper:t,label:a,box:r,mark:n}})(),update(e){i._widget.getElem(o.dom.container,e).style("width",i._widget.size.width).style("height",i._widget.size.height),i._widget.getElem(o.dom.wrapper,e).style("margin-left",i._widget.margins.left+"px").style("margin-top",i._widget.margins.top+"px").style("width",i._widget.size.innerWidth).style("opacity",o.internal.disabled?.4:1).style("cursor",o.internal.disabled?"default":"pointer").style("pointer-events",o.internal.disabled?"none":"all"),o.dom.label.text(o.internal.label),i._widget.getElem(o.dom.box,e).style("background",o.internal.checked?o.internal.color:ue(o.internal.color,.6)),o.dom.mark.style("display",o.internal.checked?null:"none")}};return i._widget.update=r(i._widget.update,o.update,!0),l=Object.assign(l,{callback:e=>(o.internal.callback=e,l),check:(e=a.checked)=>(o.internal.checked=e,l),color:(e=a.color)=>(o.internal.color=e,l),disable:(e=a.disabled)=>(o.internal.disabled=e,l),label:(e=a.label)=>(o.internal.label=e,l)}),l},e.ChordDiagram=(e,a="body")=>{const l=100,s=10;let{self:o,api:c}=n(V("chord-diagram",e,a),U(()=>o._chart.plots,[".chord-ribbon"]),be);const d={radius:l,thickness:s,indexByName:new Map,nameByIndex:new Map,arc:null,ribbonId:(e,t)=>e<t?e+"-"+t:t+"-"+e,addRibbons:(e,t)=>e.append("path").attr("class",e=>`chord-ribbon ${i(e.name)} ${i(e.name2)}`).attr("fill","currentColor").attr("fill-opacity",.6).attr("stroke","#fff").attr("d",t),textTransform:e=>(e.angle=(e.startAngle+e.endAngle)/2,`rotate(${180*e.angle/Math.PI-90}) translate(${d.radius-o._widget.margins.left+5}) ${e.angle>Math.PI?" rotate(180)":""}`),textAnchor:e=>(e.startAngle+e.endAngle)/2>Math.PI?"end":"start",update:e=>{const a=d.radius-d.thickness-o._widget.margins.left,r=d.radius-o._widget.margins.left;d.arc=t.arc().innerRadius(a).outerRadius(r);const n=t.ribbon().radius(a-1),i=o._chart.plots.transition().duration(e);o._chart.plotGroups({enter:e=>(e.style("color",o._color.mapper).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2})`).style("opacity",0),e.append("text").attr("class","chord-label").attr("dy",".35em").attr("transform",d.textTransform).attr("text-anchor",d.textAnchor).style("display",o._label.show?null:"none").text(e=>e.name),e.append("path").attr("class","chord-arc").attr("d",d.arc).attr("fill","currentColor"),d.addRibbons(e.selectAll(".chord-ribbon").data(e=>e.ribbons,e=>e.id).enter(),n),e),updateBefore:e=>{e.selectAll(".chord-ribbon").data(e=>e.ribbons,e=>e.id).join(e=>d.addRibbons(e,n).style("opacity",0),e=>e,e=>e.transition(i).style("opacity",0).remove()).transition(i).style("opacity",1).attrTween("d",Ce(n,"ribbon"))},update:e=>(e.style("color",o._color.mapper).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2})`).style("opacity",1),e.select(".chord-arc").attrTween("d",Ce(d.arc,"arc")),e.select(".chord-label").style("display",o._label.show?null:"none").attrTween("transform",Ce(d.textTransform,"transform")).attrTween("text-anchor",Ce(d.textAnchor,"textAnchor")),e),exit:e=>e.style("opacity",0)},e)}};return o._chart.transformData=e=>{d.indexByName.clear(),d.nameByIndex.clear();let a=0,r=0;e.forEach(e=>{d.indexByName.has(r=e.source)||(d.nameByIndex.set(a,r),d.indexByName.set(r,a++)),d.indexByName.has(r=e.target)||(d.nameByIndex.set(a,r),d.indexByName.set(r,a++))});const n=[];e.forEach(e=>{const t=d.indexByName.get(e.source),r=d.indexByName.get(e.target);void 0===n[t]&&(n[t]=Array(a).fill(0)),n[t][r]=e.value,void 0===n[r]&&(n[r]=Array(a).fill(0))});const i=t.chord().padAngle(.05).sortGroups(t.descending).sortSubgroups(t.descending)(n),l=i.groups.sort((e,t)=>t.value-e.value).map(e=>Object.assign(e,{name:d.nameByIndex.get(e.index),ribbons:[]}));for(const e of i){l.find(t=>t.index===e.source.index).ribbons.push(Object.assign(e,{id:d.ribbonId(e.source.index,e.target.index),name:d.nameByIndex.get(e.source.index),name2:d.nameByIndex.get(e.target.index)}))}return l},o._widget.update=r(o._widget.update,d.update),c=Object.assign(c,{radius:(e=l)=>(d.radius=e,c),thickness:(e=s)=>(d.thickness=e,c)}),c},e.CoxcombChart=(e,a="body")=>{const l=100,s=0;let{self:o,api:c}=n(X("coxcomb-chart",e,a,"svg"),T,D,R,U(()=>d.plots,[".wedge"]),be,H,L,ie);const d={scale:le("sqrt"),arc:t.arc(),radius:l,angle:s,data:[],current:void 0,plots:o._widget.content.append("g").attr("class","dalian-plot-container"),labelArc:e=>`M${e.outerRadius*Math.sin(e.startAngle)},${-e.outerRadius*Math.cos(e.startAngle)}A${e.outerRadius},${e.outerRadius},0,0,1,${e.outerRadius*Math.sin(e.endAngle)},${-e.outerRadius*Math.cos(e.endAngle)}`,updateWedges:(e,t)=>e.attr("class",e=>"wedge "+i(e.name)).order().on("mouseover.chart",e=>o._mouse.over({name:e.name,y:e.y})).on("mouseleave.chart",e=>o._mouse.leave({name:e.name,y:e.y})).on("click.chart",e=>o._mouse.click({name:e.name,y:e.y})).transition(t).attr("fill",o._color.mapper).attrTween("d",Ce(e=>d.arc(e))),update(e){const a=t.max(d.data.map(e=>e.data).flat().map(e=>e.y));d.scale.range(0,d.radius).domain([0,a]),d.data.map(e=>{e.data.map(e=>Object.assign(e,{outerRadius:d.scale.scale(e.y||0)})),e.outerRadius=Math.max(.6*d.radius,d.scale.scale(t.max(e.data,e=>e.y||0)))+.5*parseFloat(o._font.size)});const r=d.plots.transition().duration(e);o._widget.getDefs().selectAll(".wedge-label-path").data(d.data,e=>e.index).join(e=>e.append("path").attr("class","wedge-label-path").attr("id",e=>`${o._widget.id}-wedge-${e.index}`).attr("stroke","red").attr("d",d.labelArc),e=>e,t=>t.transition().duration(e).remove()).transition().duration(e).attrTween("d",Ce(e=>d.labelArc(e))),d.plots.selectAll(".wedge-group").data(d.data,e=>e.index).join(e=>e.append("g").attr("class","wedge-group").attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2}) rotate(${d.angle})`).style("opacity",0).call(e=>{const t=e.selectAll("path").data(e=>e.data).enter().append("path").attr("stroke","white");d.updateWedges(t,r),e.append("text").attr("text-anchor","middle").append("textPath").attr("href",e=>`#${o._widget.id}-wedge-${e.index}`).attr("method","stretch").attr("startOffset","50%")}),e=>e.call(e=>{const t=e.selectAll("path").data(e=>e.data).join(e=>e.append("path").attr("stroke","white").style("opacity",0),e=>e,e=>e.transition(r).style("opacity",0).remove());d.updateWedges(t,r).style("opacity",1)}),e=>e.transition(r).style("opacity",0).remove()).on("mouseover.coxcomb",e=>{d.current=e}).on("mouseleave.coxcomb",()=>{d.current=void 0}).transition(r).style("opacity",1).attr("transform",`translate(${parseFloat(o._widget.size.innerWidth)/2}, ${parseFloat(o._widget.size.innerHeight)/2}) rotate(${d.angle})`).select("text").style("display",o._label.show?null:"none").select("textPath").text(o._label.format),d.plots.style("pointer-events",o._tooltip&&o._tooltip.isOn()||o._mouse.hasAny()?"all":"none")}};return o._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.label,content:{data:d.current.data.map(e=>({name:e.name,background:o._color.mapper(e),y:e.y}))}},o._widget.update=r(o._widget.update,d.update),c=Object.assign(c||{},{data(e){const t=Array.from(e.reduce((e,t)=>new Set([...e,...t.values.map(e=>e.x)]),new Set)).sort((e,t)=>e-t),a=t.length;return d.data=t.map((t,r)=>{const n=2*r*Math.PI/a,i=2*(r+1)*Math.PI/a;return{index:r,label:t,padAngle:0,startAngle:n,endAngle:i,innerRadius:0,data:e.map(e=>{const a=e.values.find(e=>e.x===t);return{label:t,name:e.name,padAngle:0,startAngle:n,endAngle:i,innerRadius:0,y:a&&a.y||null}}).sort((e,t)=>t.y-e.y)}}),c},radius:(e=l)=>(d.radius=e,c),angle:(e=s)=>(d.angle=e,c)}),c},e.Legend=(e,t="body")=>{const a={styles:()=>"solid",markers:"square",vSep:1.4,hSep:6,columns:1};let{self:l,api:s}=n(X("legend",e,t,"svg"),T,R,U(()=>o.container,[".legend-entry"]),H);const o={entries:[],styles:a.styles,markers:a.markers,vSep:a.vSep,hSep:a.hSep,columns:a.columns,inserted:!1,container:l._widget.content.append("g").attr("class","legend-container"),entryTransform:(e,t)=>{const a=parseFloat(l._font.size);return`translate(${a*o.hSep*(t%o.columns)}, ${a*(.7+o.vSep*Math.floor(t/o.columns))})`},makeMarker(e){let t;switch(e.select(".legend-entry-marker-shape").remove(),o.markers){case"square":t=e.append("rect").attr("x",0).attr("y","-.5em").attr("width","1em").attr("height","1em").attr("rx",2).attr("ry",2);break;case"circle":t=e.append("circle").attr("cx",".5em").attr("cy",0).attr("r",".5em");break;default:t=e.append("path").attr("d",o.markers).attr("transform",`translate(${parseFloat(l._font.size)/2}, 0)`)}t.attr("class","legend-entry-marker-shape").attr("mask",o.styles)},update(e){const t=l._widget.getFontMetrics(),a=o.container.transition().duration(e);o.inserted||a.attr("transform",`translate(${parseFloat(l._widget.margins.left)}, ${parseFloat(l._widget.margins.top)})`),o.container.selectAll(".legend-entry").data(o.entries,e=>e.name).join(e=>{const r=e.append("g").attr("class",e=>"legend-entry "+i(e.name)).attr("transform",o.entryTransform).style("shape-rendering","geometricPrecision").style("opacity",0).style("pointer-events",l._mouse.hasAny()?"all":"none").style("cursor",l._mouse.hasAny()?"pointer":"default").on("mouseover",e=>l._mouse.over(e.name)).on("mouseleave",e=>l._mouse.leave(e.name));return r.transition(a).style("opacity",1),r.append("g").attr("class","legend-entry-marker").attr("fill",l._color.mapper).call(o.makeMarker,t).attr("font-size",l._font.size),r.append("text").attr("class","legend-entry-label").attr("text-anchor","start").attr("dominant-baseline","central").attr("font-size",l._font.size).attr("dx",1.3*parseFloat(l._font.size)).text(e=>e.name),r},e=>(e.style("cursor",l._mouse.hasAny()?"pointer":"default").style("pointer-events",l._mouse.hasAny()?"all":"none").transition(a).attr("transform",o.entryTransform).style("opacity",1),e.select(".legend-entry-marker").attr("font-size",l._font.size).call(o.makeMarker,t).transition(a).attr("fill",l._color.mapper),e.select(".legend-entry-label").text(e=>e.name),e),e=>e.transition(a).style("opacity",0).remove())}};return l._widget.update=r(l._widget.update,o.update,!0),s=Object.assign(s,{entries:e=>(o.entries=e.map(e=>({name:e})),s),styles:(e=a.styles)=>(o.styles=t=>je.get(e[t.name]),s),markers:(e=a.markers)=>(o.markers=e,s),columns:(e=a.columns)=>(o.columns=e,s),vSep:(e=a.vSep)=>(o.vSep=e,s),hSep:(e=a.hSep)=>(o.hSep=e,s),insert:(e,t)=>(void 0!==e&&void 0!==e.objects?(e.objects.add(e.id()+"-legend",o.container.attr("transform",null).node(),t,{foreground:!0}),l._widget.container.style("display","none"),o.inserted=!0):(l._widget.content.append(()=>o.container.attr("transform",`translate(${parseFloat(l._widget.margins.left)}, ${parseFloat(l._widget.margins.top)})`).node()),l._widget.container.style("display",null),o.inserted=!1),s)}),s},e.LineChart=(e,l="body")=>{const s={x:le("linear"),y:le("linear")},{self:o,api:c}=n(V("line-chart",e,l),J(s.y),N(s.x),Q(s),U(()=>o._chart.plots,[".plot-group",".plot-marker",".trends-marker"]),$e,K(2),(e=>(t,a)=>{const n={container:void 0,pins:new Map,getContainer:()=>(void 0===n.container&&(n.container=t._chart.plots.append("g").attr("class","pins-container")),n.container)};return t._widget.update=r(t._widget.update,e=>{n.pins.forEach(t=>t.update(e))}),a=Object.assign(a||{},{pins:{add:(r,i,l={},s=0)=>{if(n.pins.has(r))return a;const o=e.x.scale,c=e.y.scale,d=l.color||t._font.color,p=(1-(l.height||.8))*c.range()[0],u=l.text||"",g=n.getContainer().append("g").attr("class","pin").style("color",d).style("opacity",0),m=g.append("g").attr("class","pin-label").style("opacity",l.fixed?1:0).style("pointer-events","none"),h=G(m.append("text"),{class:"pin-label-text",y:p-(l.size||6)-10,"text-anchor":"start",stroke:"none",fill:ge(d)}).text(u),y=1.05*h.node().getComputedTextLength();h.attr("x",Math.min(o(i),o.range()[1]-y-10)).attr("textLength",y);let x=h.node().getBBox();const b=G(m.append("rect"),{class:"pin-label-box",x:x.x-5,y:x.y-5,width:x.width+10,height:x.height+10,rx:2,stroke:"none",fill:""===u?"none":d});m.node().insertBefore(b.node(),h.node());const f=()=>{m.transition().duration(300).style("opacity",1)},v=()=>{m.transition().duration(300).style("opacity",l.fixed?1:0)},_=G(g.append("line"),{class:"pin-needle",x1:o(i)+1,y1:c.range()[0],x2:o(i)+1,y2:p,stroke:"currentColor","stroke-width":"2px"}).style("pointer-events","all").on("mouseover.pins",f).on("mouseleave.pins",v),w=G(g.append("circle"),{class:"pin-head",cx:o(i)+1,cy:p,r:(l.size||6)+"px",stroke:"white","stroke-width":"1px",fill:"currentColor"}).style("pointer-events","all").on("mouseover.pins",f).on("mouseleave.pins",v);g.transition().duration(s).style("opacity",1);const k={g:g,remove:e=>{g.transition().duration(e).style("opacity",0).on("end",()=>{g.remove()})},update:e=>{_.transition().duration(e).attr("x1",o(i)+1).attr("y1",c.range()[0]).attr("x2",o(i)+1).attr("y2",p),w.transition().duration(e).attr("cx",o(i)+1).attr("cy",p),h.attr("x",Math.min(o(i),o.range()[1]-y-10)).attr("y",p-(l.size||6)-10),x=h.node().getBBox(),b.attr("x",x.x-5).attr("y",x.y-5).attr("width",x.width+10).attr("height",x.height+10)}};return n.pins.set(r,k),a},remove:(e,t=0)=>(void 0===e&&(n.pins.forEach(e=>e.remove()),n.pins.clear()),n.pins.has(e)&&(n.pins.get(e).remove(t),n.pins.delete(e)),a)}}),{self:t,api:a}})(s),ee,ie,se,(e=>(a,n)=>{const l={container:void 0,trends:new Map,getContainer:()=>(void 0===l.container&&(l.container=a._chart.plots.append("g").attr("class","trends-container")),l.container),adjustTrend:(e,r,n)=>{const i=a._chart.data.find(t=>t.name===e);if(void 0===i)return;const l=t.bisector(e=>e.x).left,s=l(i.values,r),o=l(i.values,n);if(null===s||null===o)return;const c=i.values[s].x,d=i.values[s].y,p=i.values[o].x,u=i.values[o].y;return{start:{x:c,y:d},end:{x:p,y:u},plateau:d<u?u:d}}};return a._widget.update=r(a._widget.update,e=>{l.trends.forEach(t=>t.update(e))}),n=Object.assign(n||{},{trends:{add:(t,r,s,o,c,d,p=0)=>{if(l.trends.has(t))return n;const u=e.x.scale,g=e.y.scale,m=l.adjustTrend(r,s,o),h=l.getContainer().append("g").attr("class","trend trend-"+i(r)).style("color",d||"#000").style("opacity",0),y=G(h.append("path"),{fill:"none",stroke:"currentColor","stroke-dasharray":"3 3","stroke-width":1,d:`M${u(m.start.x)},${g(m.start.y)}V${g(m.plateau)}H${u(m.end.x)}V${g(m.end.y)}`}),x=G(h.append("circle"),{cx:u(m.start.x),cy:g(m.start.y),r:4,stroke:"none",fill:"currentColor"}),b=G(h.append("circle"),{cx:u(m.end.x),cy:g(m.end.y),r:4,stroke:"none",fill:"currentColor"}),f=G(h.append("text"),{x:u(m.start.x),y:g(m.plateau),dy:-5,"text-anchor":"start",fill:a._font.color}).style("font-family","inherit").style("font-size",a._font.size).text(c);h.transition().duration(p).style("opacity",1);const v={g:h,remove:e=>{h.transition().duration(e).style("opacity",0).on("end",()=>{h.remove()})},update:e=>{h.transition().duration(e).style("color",d||"#000");const t=l.adjustTrend(r,s,o);y.transition().duration(e).attr("d",`M${u(t.start.x)},${g(t.start.y)}V${g(t.plateau)}H${u(t.end.x)}V${g(t.end.y)}`),x.transition().duration(e).attr("cx",u(t.start.x)).attr("cy",g(t.start.y)),b.transition().duration(e).attr("cx",u(t.end.x)).attr("cy",g(t.end.y)),f.attr("font-size",a._font.size).attr("fill",a._font.color).transition().duration(e).attr("x",u(t.start.x)).attr("y",g(t.plateau))}};return l.trends.set(t,v),n},remove:(e,t=0)=>{void 0===e&&(l.trends.forEach(e=>e.remove()),l.trends.clear()),l.trends.has(e)&&(l.trends.get(e).remove(t),l.trends.delete(e))}}}),{self:a,api:n}})(s),Oe,_e,ve,ce),d={scales:s,update:e=>{const r=o._chart.data.reduce((e,t)=>e.concat(t.values),[]).filter(e=>null!==e.y),n=r.filter(e=>e.lo+e.hi>0).length>0,i=r.map(e=>e.y-e.lo).concat(r.map(e=>e.y+e.hi)),l=t.extent(i),s=.01*(l[1]-l[0]);l[1]+=s,l[0]-=s,d.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(o._xRange.range(r.map(e=>e.x))),d.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(o._yRange.range(l));const c=t.line().defined(e=>null!==e.y).x(e=>d.scales.x.scale(e.x)).y(e=>d.scales.y.scale(e.y)).curve(o._smoothing.curve()),p=t.area().defined(e=>null!==e.y).x(e=>d.scales.x.scale(e.x)).y0(e=>d.scales.y.scale(e.y-e.lo)).y1(e=>d.scales.y.scale(e.y+e.hi)).curve(o._smoothing.curve());o._chart.plotGroups({enter:e=>(e.style("opacity",0),e.append("path").attr("class","error-band").attr("d",e=>p(e.values)).attr("stroke","none").attr("fill","currentColor").attr("fill-opacity",0),e.append("path").attr("class","line").attr("d",e=>c(e.values)).attr("stroke","currentColor").attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round"),e),update:e=>(e.style("opacity",1).style("color",o._color.mapper),e.select(".error-band").attr("fill-opacity",n?.2:0).attrTween("d",(function(e){const r=t.select(this).attr("d"),n=p(e.values);return a.interpolatePath(r,n,null)})),e.select(".line").attrTween("d",(function(e){const r=t.select(this).attr("d"),n=c(e.values);return a.interpolatePath(r,n,null)})).attr("stroke-width",e=>o._lineWidth.mapping(e.name)).attr("stroke-dasharray",e=>o._lineStyle.strokeDashArray(e.name)),e),exit:e=>e.style("opacity",0)},e)}};return o._tooltip.content=e=>{if(void 0===e)return void o._plotMarker.remove();const a=t.bisector(e=>d.scales.x.scale(e.x)).left,r=e?o._chart.data.map(t=>a(t.values,e[0])):void 0;if(void 0===r)return void o._plotMarker.remove();let n=d.scales.x.scale.invert(e[0]);const i=o._chart.data.filter(e=>-1===o._tooltip.ignore.indexOf(e.name)).map((e,t)=>{const a=r[t],i=e.values,l=i[a-1]?i[a-1]:i[a],s=i[a]?i[a]:i[a-1],c=n-l.x>s.x-n?s:l;return n=c.x,null!==c.y&&o._yRange.contains(c.y)?o._plotMarker.add(d.scales.x.scale(n),d.scales.y.scale(c.y),e.name,e):o._plotMarker.remove(e.name),{name:e.name,background:o._lineStyle.background(o._lineStyle.style(e.name),o._color.mapper(e)),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:n,content:{data:i}}},o._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.sort((e,t)=>e.x-t.x).map(e=>({x:+e.x,y:null===e.y?e.y:+e.y,lo:+e.lo||0,hi:+e.hi||0}))})),o._widget.update=r(o._widget.update,d.update,!0),c},e.PieChart=(e,a="body")=>{const i=0,l=100;let{self:s,api:o}=n(V("pie-chart",e,a),ye,U(()=>s._chart.plots,[".plot-group"]),be);const c={innerRadius:i,outerRadius:l,current:void 0,arc:null,labels:{format:()=>"",left:e=>.5*(e.startAngle+e.endAngle)>Math.PI,arcs:{inner:null,outer:null}},numSlices:0,measure:(e,t,a)=>{const r=pe(s._label.format(e),a);return{outside:1.1*Math.sqrt(r.width*r.width+r.height*r.height)>Math.min(.5*(c.innerRadius+c.outerRadius)*(e.endAngle-e.startAngle),c.outerRadius-c.innerRadius),x:-.25*c.outerRadius*(c.numSlices-t),y:-1.25*c.outerRadius+1.1*r.height*(c.numSlices-1-t)}},labelLinePath:e=>{let t=c.labels.arcs.inner.centroid(e);const a=c.labels.arcs.outer.centroid(e),r=Math.max(a[1],e._measures.y),n=[a[1]!==t[1]?a[0]-(a[0]-t[0])*(a[1]-r)/(a[1]-t[1]):a[0],r],i=.25*c.outerRadius,l=[c.labels.left(e)?Math.min(n[0]-i,e._measures.x):n[0]+i,n[1]];return n[1]>t[1]&&(t=n),`M${t[0]} ${t[1]} L${n[0]} ${n[1]} L${l[0]} ${l[1]}`},labelTextAnchor:e=>c.labels.left(e)?"end":"start",labelTextX:e=>{const t=.25*c.outerRadius;return c.labels.left(e)?Math.min(c.labels.arcs.outer.centroid(e)[0]-t,e._measures.x)-5:c.labels.arcs.outer.centroid(e)[0]+t+5},labelTextY:e=>Math.max(c.labels.arcs.outer.centroid(e)[1],e._measures.y),update:e=>{const a=s._widget.getStyle();c.arc=t.arc().innerRadius(c.innerRadius).outerRadius(c.outerRadius),c.labels.arcs.inner=t.arc().innerRadius(c.outerRadius+5).outerRadius(c.outerRadius+5),c.labels.arcs.outer=t.arc().innerRadius(1.25*c.outerRadius).outerRadius(1.25*c.outerRadius),c.numSlices=s._chart.data.filter(e=>e.value>0).length,s._chart.plotGroups({enter:e=>{e.style("opacity",0).style("color",s._color.mapper).each((e,t)=>Object.assign(e,{_measures:c.measure(e,t,a)}));const t=e.append("g").attr("class","slice").attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`).on("mouseover.pie",e=>{c.current=e}).on("mouseleave.pie",()=>{c.current=void 0});t.append("path").attr("class","slice-wedge").attr("d",c.arc).attr("stroke-linejoin","round").attr("stroke","white").attr("fill","currentColor");const r=t.append("g").attr("class","slice-label").style("display",s._label.show?null:"none");r.append("text").attr("class","inner-label").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",e=>c.arc.centroid(e)[0]).attr("y",e=>c.arc.centroid(e)[1]).style("cursor","default").style("opacity",e=>e._measures.outside?0:1).text(e=>e.value.toFixed(1));const n=r.append("g").attr("class","outer-label").style("opacity",e=>e._measures.outside?1:0);return n.append("path").attr("class","outer-label-line").attr("stroke-linejoin","round").attr("fill","none").attr("d",c.labelLinePath),n.append("text").attr("class","outer-label-text").attr("dominant-baseline","middle").attr("text-anchor",c.labelTextAnchor).attr("x",c.labelTextX).attr("y",c.labelTextY).style("cursor","default").text(e=>e.value.toFixed(1)),e},update:e=>{e.style("opacity",1).style("color",s._color.mapper).each((e,t)=>Object.assign(e,{_measures:c.measure(e,t,a)}));const t=e.select(".slice").attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`);t.select(".slice-wedge").attrTween("d",Ce(e=>c.arc(e)));const r=t.select(".slice-label").style("display",s._label.show?null:"none");r.select(".inner-label").style("opacity",e=>e._measures.outside?0:1).attr("fill",e=>ge(s._color.mapper(e))).attrTween("x",Ce(e=>c.arc.centroid(e)[0],"x")).attrTween("y",Ce(e=>c.arc.centroid(e)[1],"y")).text(s._label.format);const n=r.select(".outer-label").style("opacity",e=>e._measures.outside?1:0);return n.select(".outer-label-line").attr("stroke",s._font.color).attrTween("d",Ce(c.labelLinePath,"r")),n.select(".outer-label-text").attr("fill",s._font.color).attrTween("text-anchor",Ce(c.labelTextAnchor,"align")).attrTween("x",Ce(c.labelTextX,"x")).attrTween("y",Ce(c.labelTextY,"y")).text(s._label.format),e},exit:e=>e.style("opacity",0)},e)}};return s._chart.transformData=e=>t.pie().value(e=>e.value).sort(null)(e.sort((e,t)=>t.value-e.value)).map(e=>Object.assign(e,{name:e.data.name})),s._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:s._color.mapper(c.current),content:{type:"plots",data:[{name:"value",value:c.current.value}]}},s._widget.update=r(s._widget.update,c.update),o=Object.assign(o,{innerRadius:(e=i)=>(c.innerRadius=e,o),outerRadius:(e=l)=>(c.outerRadius=e,o)}),o},e.RadioButton=(e,t="body")=>{W.addClass(Se.entry,{position:"absolute",display:"block"}).addClass(Se.marker,{position:"relative",float:"left",display:"inline-block",width:".5em",height:".5em",border:".4em solid transparent","border-radius":"50%",background:"#fff"}).addClass(Se.label,{display:"inline-block",float:"right",width:"calc(100% - 1.75em)",height:"100%","line-height":"1.35em"});const a={checked:!1,color:"grey",columns:1,disabled:!1,hSep:null,vSep:2};let{self:i,api:l}=n(X("checkbox",e,t,"div"),R);function s(e){o.internal.selected!==e&&(o.internal.selected=e,o.dom.container.selectAll("."+Se.entry).select("."+Se.marker).style("border-color",e=>e===o.internal.selected?o.internal.color:"transparent").style("background",e=>e===o.internal.selected?"#fff":ue(o.internal.color,.6)),o.internal.callback&&o.internal.callback(o.internal.selected))}const o={internal:Object.assign({entries:[],rows:1},a),dom:{container:i._widget.content.append("div")},entryWidth:()=>null===o.internal.hSep||1===o.internal.columns?parseFloat(i._widget.size.innerWidth)/o.internal.columns+"px":parseFloat(i._font.size)*o.internal.hSep+"px",entryHeight:()=>parseFloat(i._font.size)*o.internal.vSep+"px",entryLeft(e,t){const a=t%o.internal.columns;return null===o.internal.hSep?parseFloat(i._widget.margins.left)+a*parseFloat(i._widget.size.innerWidth)/o.internal.columns+"px":parseFloat(i._widget.margins.left)+a*parseFloat(i._font.size)*o.internal.hSep+"px"},entryTop:(e,t)=>parseFloat(i._widget.margins.top)+Math.floor(t/o.internal.columns)*parseFloat(i._font.size)*o.internal.vSep+"px",update(e){i._widget.getElem(o.dom.container,e).style("width",i._widget.size.width).style("height",i._widget.size.height);const t=o.dom.container.transition().duration(e);o.dom.container.selectAll("."+Se.entry).data(o.internal.entries,e=>e).join(e=>{const t=e.append("div").attr("class",Se.entry).style("width",o.entryWidth).style("height",o.entryHeight).style("left",o.entryLeft).style("top",o.entryTop).style("cursor",o.internal.disabled?"default":"pointer").style("pointer-events",o.internal.disabled?"none":"all").style("opacity",o.internal.disabled?.4:1).on("click",s);return t.append("div").attr("class",Se.marker).style("border-color",e=>e===o.internal.selected?o.internal.color:"transparent").style("background",e=>e===o.internal.selected?"#fff":ue(o.internal.color,.6)),t.append("div").attr("class",Se.label).text(e=>e),t},e=>(e.style("cursor",o.internal.disabled?"default":"pointer").style("pointer-events",o.internal.disabled?"none":"all").style("opacity",o.internal.disabled?.4:1).call(e=>e.transition(t).style("width",o.entryWidth).style("height",o.entryHeight).style("left",o.entryLeft).style("top",o.entryTop)),e.transition(t).select("."+Se.marker).style("border-color",e=>e===o.internal.selected?o.internal.color:"transparent").style("background",e=>e===o.internal.selected?"#fff":ue(o.internal.color,.6)),e),e=>e.transition(t).style("opacity",0).remove())}};return i._widget.update=r(i._widget.update,o.update,!0),l=Object.assign(l,{callback:e=>(o.internal.callback=e,l),color:(e=a.color)=>(o.internal.color=e,l),columns:(e=a.columns)=>(o.internal.columns=e,o.internal.rows=Math.ceil(o.internal.entries.length/e),l),disable:(e=a.disabled)=>(o.internal.disabled=e,l),entries:(e=[])=>(o.internal.entries=e,o.internal.rows=Math.ceil(e.length/o.internal.columns),l),hSep:(e=a.hSep)=>(o.internal.hSep="number"==typeof e?e:null,l),select:e=>(o.internal.entries.indexOf(e)>-1?o.internal.selected=e:o.internal.selected=void 0,l),vSep:(e=a.vSep)=>(o.internal.vSep=e,l)}),l},e.ScatterPlot=(e,a="body")=>{const i=4,l={x:le("linear"),y:le("linear")};let{self:s,api:o}=n(V("scatter-plot",e,a),N(l.x),ye,U(()=>s._chart.plots,[".plot-group"]),J(l.y),Q(l),Z(.6),ee,_e,ce);const c={scales:l,current:void 0,diagram:void 0,size:i,computeDiagram:e=>{const a=e.map(e=>e.values.map(t=>({name:e.name,x:t.x,y:t.y}))).flat();return t.voronoi().x(e=>c.scales.x.scale(e.x)).y(e=>c.scales.y.scale(e.y)).extent([[0,0],[parseInt(s._widget.size.innerWidth),parseInt(s._widget.size.innerHeight)]])(a)},update:e=>{const a=s._chart.data.map(e=>e.values).flat(),r=t.extent(a.map(e=>e.x));c.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(r);const n=t.extent(a.map(e=>e.y));c.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(n);const i=c.scales.x.measure(c.size);c.scales.x.domain(s._xRange.range([r[0]-i,r[1]+i]));const l=c.scales.y.measure(c.size);c.scales.y.domain(s._yRange.range([n[1]+l,n[0]-l])),s._chart.plotGroups({enter:e=>(e.style("opacity",0).style("color",s._color.mapper).attr("stroke","none").attr("fill","currentColor"),e.selectAll("circle").data(e=>e.values).enter().append("circle").attr("class","dot").attr("cx",e=>c.scales.x.scale(e.x)).attr("cy",e=>c.scales.y.scale(e.y)).attr("r",c.size/2).style("opacity",0),e),updateBefore:t=>(t.style("opacity",1).style("color",s._color.mapper),t.selectAll("circle").data(e=>e.values).join(e=>e.append("circle").attr("class","dot").attr("cx",e=>c.scales.x.scale(e.x)).attr("cy",e=>c.scales.y.scale(e.y)).attr("r",c.size/2).style("opacity",0),e=>e,t=>t.transition().duration(e).style("opacity",0).remove()).transition().duration(e).attr("cx",e=>c.scales.x.scale(e.x)).attr("cy",e=>c.scales.y.scale(e.y)).attr("r",c.size/2).style("opacity",s._opacity.value()),t),exit:e=>e.style("opacity",0)}),c.diagram=c.computeDiagram(s._chart.data),s._widget.container.on("mousemove.scatter",()=>{const e=c.diagram.find(...s._widget.getMouse(),Math.max(20,c.size/2))||void 0;void 0!==e&&e!==c.current?s._mouse.over(e.data):void 0!==c.current&&s._mouse.leave(c.current),c.current=e&&e.data||void 0}).on("click.scatter",()=>{void 0!==c.current&&s._mouse.click(c.current)})}};return s._tooltip.content=e=>{if(void 0!==e){if(c.current)return s._plotMarker.add(c.scales.x.scale(c.current.x),c.scales.y.scale(c.current.y),"marker",c.current,Math.max(5,.75*c.size)),{title:c.current.name,stripe:s._color.mapper(c.current),content:{type:"plots",data:[{name:s._bottomAxis.label.text(),value:c.current.x},{name:s._leftAxis.label.text(),value:c.current.y}]}};s._plotMarker.remove()}else s._plotMarker.remove()},s._chart.transformData=e=>e.map(e=>({name:e.name,values:e.values.map(e=>({x:+e.x,y:+e.y}))})),s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o,{size:(e=i)=>(c.size=e,o)}),o},e.Slider=(e,a="body")=>{const i={color:"grey",max:1,min:0,step:0,thickness:8,trackColor:"#ccc",value:0},l=le("linear");let{self:s,api:o}=n(X("slider",e,a,"svg"),N(l),R);const c={scale:l,internal:Object.assign({domain:[]},i),dom:(()=>{const e=s._widget.content.append("g").attr("class","dalian-slider-container"),a=e.append("line").attr("class","slider-track").attr("y1",0).attr("y2",0).attr("stroke-linecap","round"),r=e.append("line").attr("class","slider-track").attr("y1",0).attr("y2",0).attr("stroke-linecap","round"),n=e.append("line").attr("class","slider-overlay").attr("y1",0).attr("y2",0).attr("stroke","none").style("cursor","pointer").style("pointer-events","all").call(t.drag().on("start drag",()=>{i.attr("fill",c.internal.color).attr("stroke","#fff").attr("stroke-width",2),c.updateValue(),c.dom.handle.attr("cx",c.scale.scale(c.internal.value)+.5),c.dom.value.attr("x2",c.scale.scale(c.internal.value)+.5),c.internal.callback&&c.internal.callback(c.internal.value)}).on("end",()=>{i.attr("fill","#fff").attr("stroke",c.internal.trackColor).attr("stroke-width",1)})),i=e.append("circle").attr("class","slider-handle").attr("cy",0).attr("fill","#fff");return{container:e,track:a,value:r,overlay:n,handle:i}})(),updateDomain(){if(0===c.internal.step)return[];c.internal.domain=[];for(let e=c.internal.min;e<=c.internal.max;e+=c.internal.step)c.internal.domain.push(e)},updateValue(e){const a=void 0===e?t.event.x:c.scale.scale(e);c.internal.step>0?c.internal.value=c.internal.domain.reduce((e,t)=>Math.abs(c.scale.scale(t)-a)<Math.abs(c.scale.scale(e)-a)?t:e):c.internal.value=Math.max(c.internal.min,Math.min(c.internal.max,c.scale.scale.invert(a)))},update(e){c.scale.range(0,parseFloat(s._widget.size.innerWidth)).domain([c.internal.min,c.internal.max]),c.updateDomain(),c.updateValue(c.internal.value);const t=parseFloat(s._widget.size.height)/2;s._widget.getElem(c.dom.container,e).attr("transform",`translate(${s._widget.margins.left}, ${t})`),s._widget.getElem(c.dom.track,e).attr("x2",s._widget.size.innerWidth).attr("stroke",c.internal.trackColor).attr("stroke-width",c.internal.thickness),s._widget.getElem(c.dom.overlay,e).attr("x1",-c.internal.thickness).attr("x2",parseFloat(s._widget.size.innerWidth)+c.internal.thickness).attr("stroke-width",2*c.internal.thickness),s._widget.getElem(c.dom.value,e).attr("x2",c.scale.scale(c.internal.value)+.5).attr("stroke",c.internal.color).attr("stroke-width",c.internal.thickness),s._widget.getElem(c.dom.handle,e).attr("cx",c.scale.scale(c.internal.value)+.5).attr("r",1.1*c.internal.thickness).attr("stroke",c.internal.trackColor),s._bottomAxis.margin({bottom:t-s._widget.margins.bottom-c.internal.thickness/2})}};return s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o,{callback:e=>(c.internal.callback=e,o),color:(e=i.color)=>(c.internal.color=e,o),max:(e=i.max)=>(c.internal.max=e,o),min:(e=i.min)=>(c.internal.min=e,o),step:(e=i.step)=>(c.internal.step=Math.abs(e),o),thickness:(e=i.thickness)=>(c.internal.thickness=e,o),trackColor:(e=i.trackColor)=>(c.internal.trackColor=e,o),value:e=>(void 0!==e&&(c.internal.value=e),o)}),s._bottomAxis.hideAxisLine(!0).hideTicks(!0),o},e.Table=(e,t="body")=>{W.addClass(De.container,{position:"relative",overflow:"auto","pointer-events":"all"}).addClass(De.scrollbarTrack,{background:"transparent"}).addClass(De.table,{width:"100%","border-collapse":"collapse","user-select":"none"}).addClass(De.head,{position:"sticky",top:0,padding:"5px 10px",cursor:"pointer","white-space":"nowrap","font-weight":"normal","font-variant":"all-small-caps"}).addClass(De.headContainer,{position:"relative",display:"inline-block"}).addClass(De.headLabel,{"margin-right":"12px"}).addClass(De.headSvg,{position:"absolute",right:0,top:"calc(50% - 4px)"}).addClass(De.paging,{position:"relative",float:"right",width:"100px",height:"25px","pointer-events":"all","user-select":"none"}).addClass(De.pagingBlock,{position:"relative",float:"left",width:"25px",height:"25px"}).addClass(De.pagingNumber,{"text-align":"center","line-height":"25px"}).addClass(De.pagingTotalBefore,{content:'"/"',position:"absolute",left:"-2px"}).addClass(De.pagingButton,{cursor:"pointer",opacity:.2}).addClass(De.pagingButtonHover,{opacity:1});let{self:a,api:i}=n(X("table",e,t,"div"),D,U(()=>l.dom.table,["td"],(()=>{const e=ue(Te,.8);return{focus:{color:ge(e),background:e}}})()),H,R,L);W.addId(De.scrollbarThumb(a._widget.id),{background:ue(Te,.8)}).addId(De.scrollbarThumbHover(a._widget.id),{background:Te});const l={fm:a._widget.getFontMetrics(),colors:{main:Te,light:ue(Te,.8)},data:{cols:[],schema:[],values:[]},dom:(()=>{const e=a._widget.content.append("div").attr("class",De.container),t=e.append("table").attr("class",De.table);return{container:e,table:t,header:t.append("thead").append("tr"),body:t.append("tbody")}})(),sorting:{key:null,ascending:!0,arrow:e=>void 0===e?"":"up"===e?"m 1 8 l 4 -6.92 l 4 6.92 z":"m 1 2 l 4 6.92 l 4 -6.92 z",update(e,t){l.sorting.key=e,l.sorting.ascending=t},sorter(e,t="string",a=!1){const r=a?-1:1;switch(t){default:case"string":return(t,a)=>r*t[e].localeCompare(a[e]);case"number":return(t,a)=>r*(t[e]-a[e]);case"date":return(t,a)=>r*(ke(t[e])-ke(a[e]))}},sort(e){switch(l.sorting.key){default:case null:l.data.values.sort(l.sorting.sorter(e.key,e.type)),l.sorting.update(e.key,!0);break;case e.key:l.sorting.ascending?(l.data.values.sort(l.sorting.sorter(e.key,e.type,!0)),l.sorting.update(e.key,!1)):(l.data.values.sort((e,t)=>e._id-t._id),l.sorting.update(null,!0))}l.updateBody(),l.dom.header.selectAll("."+De.headMarker).attr("d",e=>l.sorting.arrow(e.key===l.sorting.key?l.sorting.ascending?"up":"down":void 0))}},paging:(()=>{let e=We,t=0;const r=(()=>{const n=a._widget.content.append("div").attr("class",De.paging);n.append("div").attr("class",`${De.pagingBlock} ${De.pagingButton}`).on("click",()=>{e>0&&t>0&&(t--,l.updateBody(),r.current.text(t+1))}).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 10 4 l -6.92 4 l 6.92 4 z");const i=n.append("div").attr("class",`${De.pagingBlock} ${De.pagingNumber}`),s=n.append("div").attr("class",`${De.pagingBlock} ${De.pagingNumber} ${Ie}paging-total`);return n.append("div").attr("class",`${De.pagingBlock} ${De.pagingButton}`).on("click",()=>{e>0&&t<Math.ceil(l.data.values.length/e)-1&&(t++,l.updateBody(),r.current.text(t+1))}).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 2 4 l 6.92 4 l -6.92 4 z"),{g:n,current:i,total:s}})();return{update(n){r.g.style("display",e>0?null:"none"),e>0&&(r.g.transition().duration(n).style("margin-right",a._widget.margins.right+"px"),r.current.text(t+1),r.total.text(Math.ceil(l.data.values.length/e)))},filter(a){if(e>0){const r=t*e,n=r+e;return a.filter((e,t)=>t>=r&&t<n)}return a},reset(a){void 0!==a&&(e=a),t=0},size:()=>e}})(),align(e){switch(e.type){default:case"string":case"date":return"left";case"number":return"right"}},updateBody(){const e=l.data.schema.filter(e=>l.data.cols.indexOf(e.key)>-1),t=l.paging.filter(l.data.values);l.dom.body.selectAll("tr").data(t,()=>Date.now()+""+Math.random()).join(t=>{const r=t.append("tr").style("height","2em").style("line-height","2em");return r.selectAll("td").data(t=>e.map(e=>({row:t._id,column:e.key,value:t[e.key],type:e.type,displayValue:void 0===e.format?t[e.key]:e.format(t[e.key])}))).enter().append("td").attr("class",e=>`row-${e.row} column-${e.column} cell-${e.row}-${e.column}`).style("padding","0.25em 0.5em").style("white-space","nowrap").style("text-align",l.align).on("mouseover.table",a._mouse.over).on("mouseleave.table",a._mouse.leave).on("click.table",a._mouse.click).text(e=>e.displayValue),r},e=>e,e=>{const a=l.paging.size()-t.length;e.filter((e,t)=>t<a).raise().selectAll("td").remove(),e.filter((e,t)=>t>=a).remove()})},update(e){l.dom.container.transition().duration(e).style("width",a._widget.size.innerWidth).style("height",a._widget.size.innerHeight).style("margin-left",a._widget.margins.left+"px").style("margin-top",a._widget.margins.top+"px"),l.dom.table.style("height",a._widget.size.innerHeight);const t=l.data.schema.filter(e=>l.data.cols.indexOf(e.key)>-1);l.dom.header.selectAll("th").data(t,e=>e.key).join(e=>{const t=e.append("th").style("user-select","none"),a=t.append("div").attr("class",De.headContainer).style("float",l.align);return a.append("span").attr("class",De.headLabel),a.append("svg").attr("class",De.headSvg).attr("viewBox","0 0 10 10").style("width",l.fm.capHeight+"em").style("height",l.fm.capHeight+"em").append("path").attr("class",De.headMarker).attr("fill","currentColor").attr("d",l.sorting.arrow()),t},e=>e,e=>e.remove()).on("click",l.sorting.sort).attr("class",De.head).style("background",l.colors.main).style("color",ge(l.colors.main)).select("."+De.headLabel).html(e=>e.name),l.updateBody(),l.paging.update(e)}};return a._widget.update=r(a._widget.update,l.update,!0),i=Object.assign(i,{data:e=>(l.data.values=e.map((e,t)=>Object.assign(e,{_id:t})),l.paging.reset(),l.data.cols=Object.keys(e[0]||{}),l.sorting.update(null,!0),l.dom.header.selectAll(".table-head-sorting").text(""),i),schema:e=>(l.data.schema=e,i),color:(e=Te)=>(l.colors={main:e,light:ue(e,.8)},W.updateId(De.scrollbarThumb(a._widget.id),{background:l.colors.light}).updateId(De.scrollbarThumbHover(a._widget.id),{background:e}),a._highlight.style({focus:{color:ge(l.colors.light),background:l.colors.light}}),i),paging:(e=We)=>(l.paging.reset(e),i)}),i},e.Trackpad=(e,a="body")=>{const i={color:"grey",guide:!1,ranges:[[0,1],[0,1]],type:"cartesian",values:[0,0]},l={x:le("linear"),y:le("linear")};let{self:s,api:o}=n(X("trackpad",e,a,"svg"),N(l.x),J(l.y),R);const c={scales:l,internal:Object.assign({},i),dom:(()=>{const e=s._widget.content.append("g").attr("class","dalian-trackpad-container"),a=e.append("rect").attr("class","trackpad-track").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3),r=(()=>{const t=s._widget.id+"-guides-clipper",a=s._widget.getDefs().append("clipPath").attr("id",t).append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight),r=e.append("g").attr("class","trackpad-guides").attr("clip-path",`url(#${t})`);return{clip:a,x:r.append("line").attr("class","trackpad-guide-x").attr("x1",0).attr("stroke-dasharray","2 4"),y:r.append("line").attr("class","trackpad-guide-y").attr("y1",0).attr("stroke-dasharray","2 4")}})(),n=e.append("circle").attr("class","trackpad-handle").attr("r",8).attr("fill","#fff"),i=e.append("rect").attr("class","trackpad-overlay").attr("x",-10).attr("y",-10).attr("fill","none").attr("stroke","none").style("cursor","pointer").style("pointer-events","all").call(t.drag().on("start drag",()=>{n.attr("fill",c.internal.color).attr("stroke","#fff").attr("stroke-width",2),c.updateValues(),c.updateHandle(c.dom.handle,c.dom.guide),c.internal.callback&&c.internal.callback(c.internal.values)}).on("end",()=>{n.attr("fill","#fff").attr("stroke",c.internal.color).attr("stroke-width",1)}));return{container:e,track:a,guide:r,handle:n,overlay:i}})(),updateValues(e){const a=void 0===e?t.event.x:c.scales.x.scale(e[0]),r=void 0===e?t.event.y:c.scales.y.scale(e[1]);c.internal.values=[Math.max(c.internal.ranges[0][0],Math.min(c.internal.ranges[0][1],c.scales.x.scale.invert(a))),Math.max(c.internal.ranges[1][0],Math.min(c.internal.ranges[1][1],c.scales.y.scale.invert(r)))]},updateHandle(e,t){const a=c.scales.x.scale(c.internal.values[0])+.5,r=c.scales.y.scale(c.internal.values[1])+.5;e.attr("cx",a).attr("cy",r).attr("stroke",c.internal.color),t.clip.attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight),t.x.attr("x2",s._widget.size.innerWidth).attr("y1",r).attr("y2",r).attr("stroke",c.internal.color),t.y.attr("x1",a).attr("x2",a).attr("y2",s._widget.size.innerHeight).attr("stroke",c.internal.color)},update(e){c.scales.x.range(0,parseFloat(s._widget.size.innerWidth)).domain(c.internal.ranges[0]),c.scales.y.range(parseFloat(s._widget.size.innerHeight),0).domain(c.internal.ranges[1]),c.updateValues(c.internal.values),s._widget.getElem(c.dom.container,e).attr("transform",`translate(${s._widget.margins.left}, ${s._widget.margins.top})`),s._widget.getElem(c.dom.track,e).attr("width",s._widget.size.innerWidth).attr("height",s._widget.size.innerHeight).attr("fill",ue(c.internal.color,.8)).attr("stroke",c.internal.color),s._widget.getElem(c.dom.overlay,e).attr("width",parseFloat(s._widget.size.innerWidth)+20).attr("height",parseFloat(s._widget.size.innerHeight)+20),c.updateHandle(s._widget.getElem(c.dom.handle,e),{clip:s._widget.getElem(c.dom.guide.clip,e),x:s._widget.getElem(c.dom.guide.x,e).style("opacity",c.internal.guide?1:0),y:s._widget.getElem(c.dom.guide.y,e).style("opacity",c.internal.guide?1:0)})}};return s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o,{callback:e=>(c.internal.callback=e,o),color:(e=i.color)=>(c.internal.color=e,o),guide:(e=i.guide)=>(c.internal.guide=e,o),range:(e,t)=>(c.internal.ranges=[Array.isArray(e)?e:c.internal.range[0],Array.isArray(t)?t:c.internal.range[1]],o),value:(e,t)=>(c.internal.values=["number"==typeof e?e:c.internal.values[0],"number"==typeof t?t:c.internal.values[1]],o)}),s._bottomAxis.hideAxisLine(!0).hideTicks(!0),s._leftAxis.hideAxisLine(!0).hideTicks(!0),o},e.ViolinPlot=(e,i="body")=>{const l={x:le("point"),y:le("linear")};let{self:s,api:o}=n(V("violin-plot",e,i),N(l.x),ye,U(()=>s._chart.plots,[".plot-group"]),xe(l),J(l.y),K(1),Q(l),Z(.2),ce);const c={data:[],current:void 0,scales:s._horizontal.scales(),violinWidth:30,horizontal:!1,bandwidth:1,kde:(e,a)=>r=>a.map(a=>({x:a,y:t.mean(r,t=>e(a-t))})),epanechnikovKernel:e=>t=>Math.abs(t/=e)<=1?.75*(1-t*t)/e:0,makeViolin(e){const a=t.min(e),r=t.max(e),n=r-a,i=c.kde(c.epanechnikovKernel(c.bandwidth),t.range(Math.floor(n/c.bandwidth)+1).map(e=>a+c.bandwidth*e))(e);return{yMin:a,yMax:r,values:i,scale:t.scaleLinear().range([c.violinWidth/2-1,0]).domain([0,t.max(i,e=>e.y)])}},bimodality(e){const a=e.length,r=t.mean(e),n=t.sum(e,e=>(e-r)*(e-r))/a,i=t.sum(e,e=>Math.pow(e-r,3))/a,l=t.sum(e,e=>Math.pow(e-r,4))/a,s=Math.sqrt(a*(a-1))*i/((a-2)*Math.pow(n,1.5));return(s*s+1)/(l/(n*n)-3+3*(a-1)*(a-1)/((a-2)*(a-3)))},update(e){const r=s._chart.data.map(e=>e.name),n=[t.min(s._chart.data.map(e=>e.min)),t.max(s._chart.data.map(e=>e.max))],i=.05*(n[1]-n[0]);n[1]+=i,n[0]-=i,c.horizontal=s._horizontal.on(),c.scales=s._horizontal.scales(),c.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(c.horizontal?s._yRange.range(n):r),c.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(c.horizontal?r:s._yRange.range(n));const l=c.violinWidth/2-.5,o=c.horizontal?"":"rotate(90)";s._chart.plotGroups({enter:e=>(e.style("opacity",0).on("mouseover.violin",e=>{c.current=e}).on("mouseleave.violin",()=>{c.current=void 0}).style("color",s._color.mapper),e.append("path").attr("class","violin").attr("transform",e=>`translate(${c.horizontal?0:c.scales.x.scale(e.name)+l}, ${c.horizontal?c.scales.y.scale(e.name)-l:0}) ${o}`).attr("d",e=>e.area.x(e=>c.horizontal?c.scales.x.scale(e.x):c.scales.y.scale(e.x))(e.values)).attr("stroke","currentColor").attr("fill","currentColor").style("fill-opacity",0),e),update:e=>(e.style("opacity",1).style("color",s._color.mapper),e.select(".violin").attr("transform",e=>`translate(${c.horizontal?0:c.scales.x.scale(e.name)+l}, ${c.horizontal?c.scales.y.scale(e.name)-l:0}) ${o}`).attrTween("d",(function(e){const r=t.select(this).attr("d"),n=e.area.x(e=>c.horizontal?c.scales.x.scale(e.x):c.scales.y.scale(e.x))(e.values);return a.interpolatePath(r,n,null)})).attr("stroke-width",e=>s._lineWidth.mapping(e.name)).style("fill-opacity",s._opacity.value()),e),exit:e=>e.style("opacity",0)},e)}};return s._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:s._color.mapper(c.current),content:{data:[{name:"mean",value:c.current.stats.mean},{name:"median",value:c.current.stats.median},{name:"bimodality",value:c.current.stats.bimodality}]}},s._chart.transformData=e=>(c.data=e,e.map(e=>{const{yMin:a,yMax:r,values:n,scale:i}=c.makeViolin(e.values);return{name:e.name,min:a,max:r,stats:{mean:t.mean(e.values),median:t.median(e.values.sort((e,t)=>e-t)),bimodality:c.bimodality(e.values)},values:n,scale:i,area:t.area().curve(t.curveBasis).y0(e=>i(-e.y)).y1(e=>i(e.y))}})),s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o||{},{violinWidth:(e=30)=>(c.violinWidth=e,s._chart.data.map(e=>Object.assign(e,{scale:e.scale&&e.scale.range([c.violinWidth/2-1,0]),area:e.area&&e.area.y0(t=>e.scale(-t.y)).y1(t=>e.scale(t.y))})),o),bandwidth:(e=1)=>(c.bandwidth=e,s._chart.data.map((e,t)=>{const{values:a,scale:r}=c.makeViolin(c.data[t].values);Object.assign(e,{values:a,scale:r,area:e.area&&e.area.y0(e=>r(-e.y)).y1(e=>r(e.y))})}),o)}),o},Object.defineProperty(e,"__esModule",{value:!0})}));
