// https://www.npmjs.com/package/dalian v0.4.0 Copyright 2020 Enys Mones
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3","d3-interpolate-path"],e):e((t=t||self).dalian={},t.d3,t.d3)}(this,(function(t,e,a){"use strict";var r=(t,e,a=!1)=>{const r=t;return(...t)=>{a?(e(...t),r(...t)):(r(...t),e(...t))}},n=(t,...e)=>{const{self:a,api:r}=t;return e.reduce((t,e)=>{const n=e(t.self,t.api);return{self:Object.assign(a,n.self),api:Object.assign(r,n.api)}},{self:a,api:r})},i=t=>(""+t).replace(/ /g,"__");function l(t){const e=window.getComputedStyle(t),a={};for(let t=0;t<e.length;t++)a[e[t]]=e.getPropertyValue(e[t]);return a}function s(t,e){for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t.style[a]=e[a])}const o=document.createElement("canvas"),c=o.getContext("2d"),d=document.createElement("div");d.style.opacty=0;const p=document.createElement("img");var u=async(t,e=3,a="png",r=.92)=>{const n=(new window.XMLSerializer).serializeToString(t),i=function(t){d.appendChild(t),document.body.appendChild(d);const e=t.getBoundingClientRect();return document.body.removeChild(d),e}(t);return o.width=i.width*e,o.height=i.height*e,o.style.width=i.width+"px",o.style.height=i.height+"px",c.scale(e,e),p.setAttribute("src","data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(n)))),new Promise(t=>{p.onload=()=>{c.drawImage(p,0,0),t(o.toDataURL("image/"+a,r))}})};const g=document.createElement("a");var m=["#333333","#0072b2","#56b4e9","#009e73","#f0e442","#e69f00","#d55e00","#cc79a7"],h=["#77aadd","#99ddff","#44bb99","#bbcc33","#aaaa00","#eedd88","#ee8866","#ffaabb","#dddddd"],y="#eee",x=["#364b9a","#4a7bb7","#6ea6cd","#98cae1","#c2e4ef","#eaeccc","#feda8b","#fdb366","#f67e4b","#dd3d2d","#a50026"],v="#eee",b=["#fefbe9","#fcf7d5","#f5f3c1","#eaf0b5","#ddecbf","#d0e7ca","#c2e3d2","#b5ddd8","#a8d8dc","#9bd2e1","#8dcbe4","#81c4e7","#7bbce7","#7eb2e4","#88a5dd","#9398d2","#9b8ac4","#9d7db2","#9a709e","#906388","#805770","#684957","#46353a"];const f={protan:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deutan:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritan:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}};function _(t){return{r:3.063218*t.x-1.393325*t.y-.475802*t.z,g:-.969243*t.x+1.875966*t.y+.041555*t.z,b:.067871*t.x-.228834*t.y+1.069251*t.z}}function w(t,a){let r=1.75,n=2.75;return e.rgb((r*a.r+t.r)/n,(r*a.g+t.g)/n,(r*a.b+t.b)/n)}function k(t){let a=Math.round(.299*t.r+.587*t.g+.114*t.b);return e.rgb(a,a,a)}function z(t,a){let r={r:Math.pow(t.r/255,2.2),g:Math.pow(t.g/255,2.2),b:Math.pow(t.b/255,2.2)};var n;r={x:.430574*(n=r).r+.34155*n.g+.178325*n.b,y:.222015*n.r+.706655*n.g+.07133*n.b,z:.020183*n.r+.129553*n.g+.93918*n.b};const i=r.x+r.y+r.z;r.u=0,r.v=0,0!==i&&(r.u=r.x/i,r.v=r.y/i);let l,s=.312713*r.y/.329016,o=.358271*r.y/.329016,c={y:0};l=r.u<f[a].cpu?(f[a].cpv-r.v)/(f[a].cpu-r.u):(r.v-f[a].cpv)/(r.u-f[a].cpu);let d=r.v-r.u*l;c.u=(f[a].ayi-d)/(l-f[a].am),c.v=l*c.u+d;let p={x:c.u*r.y/c.v,y:r.y,z:(1-(c.u+c.v))*r.y/c.v};c.x=s-p.x,c.z=o-p.z,c=_(c),p=_(p);const u={r:c.r?((p.r<0?0:1)-p.r)/c.r:0,g:c.g?((p.g<0?0:1)-p.g)/c.g:0,b:c.b?((p.b<0?0:1)-p.b)/c.b:0},g=Math.max(u.r>1||u.r<0?0:u.r,u.g>1||u.g<0?0:u.g,u.b>1||u.b<0?0:u.b);p.r=p.r+g*c.r,p.g=p.g+g*c.g,p.b=p.b+g*c.b;const m=t=>255*(t<=0?0:t>=1?1:Math.pow(t,1/2.2));return e.rgb(m(p.r),m(p.g),m(p.b))}const C={protanopia:t=>z(t,"protan"),protanomaly:t=>w(t,z(t,"protan")),deuteranopia:t=>z(t,"deutan"),deuteranomaly:t=>w(t,z(t,"deutan")),tritanopia:t=>z(t,"tritan"),tritanomaly:t=>w(t,z(t,"tritan")),achromatopsia:t=>k(t),achromatomaly:t=>w(t,k(t))};const M="categorical",j="sequential",O="diverging";function A(t){switch(t){default:case M:return m;case j:return b;case O:return x}}function $(t){switch(t){default:case M:return"#fff";case j:return v;case O:return y}}var F=(t,a)=>{const r={policy:M,on:t=>t.name},n={policy:r.policy,palette:A(r.policy),missing:$(r.policy),deficiency:void 0,on:r.on,scale:t=>t,buildMapper(){const t=function(t,e){if("string"==typeof t)return e(t)+"";if(Array.isArray(t))return t.map(e);{const a={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=e(t[r]));return a}}(n.palette||A(n.policy),(a=n.deficiency,void 0===C[a]?t=>t:t=>C[a](e.rgb(t))));var a;const r=t=>{const e=n.on(t);return null===e?null:n.scale(e)};switch(n.policy){default:case M:return i=t,l=n.missing,s=r,"string"==typeof i?()=>i:Array.isArray(i)?(()=>{const t=[];return e=>{const a=s(e);if(null===a)return l;{const e=t.indexOf(a);return i[e>-1?e:t.push(a)-1]}}})():"object"==typeof i?t=>{const e=s(t);return null===e?l:i[e]}:void 0;case j:return function(t,a,r){if("string"==typeof t||Array.isArray(t)||(console.warn(`Palette type (${typeof t}) is incompatible with ${j} color policy, fallback to default color palette.`),t=A(j)),"string"==typeof t){const n=e.interpolateRgb("#fff",t);return t=>{const e=r(t);return null===e?a:n(e)}}if(Array.isArray(t)){const n=e.piecewise(e.interpolateRgb.gamma(2.2),t);return t=>{const e=r(t);return null===e?a:n(e)}}}(t,n.missing,r);case O:return function(t,a,r){Array.isArray(t)||(console.warn(`Palette type (${typeof t}) is incompatible with ${O} color policy, fallback to default color palette.`),t=A(O));const n=e.piecewise(e.interpolateRgb.gamma(2.2),t);return t=>{const e=r(t);return n((e+1)/2)}}(t,n.missing,r)}var i,l,s}};return t=Object.assign(t||{},{_color:{init(e,a){n.policy=e,n.on=a,n.palette=A(e),n.missing=$(e),t._color.mapper=n.buildMapper()},scale(e){n.scale=e,t._color.mapper=n.buildMapper()},mapper:n.buildMapper()}}),a=Object.assign(a||{},{color:{policy:(e=r.policy)=>(n.policy=e,t._color.mapper=n.buildMapper(),a),palette(e,r){if("string"==typeof e&&e.startsWith("palette-"))switch(e){case"palette-wong":n.palette=m;break;case"palette-light":n.palette=h;break;case"palette-sunset":n.palette=x;break;case"palette-iridescent":n.palette=b}else n.palette=e;return n.missing=r||"#fff",t._color.mapper=n.buildMapper(),a},deficiency:e=>(n.deficiency=e,t._color.mapper=n.buildMapper(),a),on:(e=r.on)=>(n.on=e,t._color.mapper=n.buildMapper(),a)}}),{self:t,api:a}};const T="dalian-style-container";var S=(()=>{const t={container:void 0,styles:[]};function a(){return(t.container||e.select("#"+T)).empty()&&(t.container=e.select("head").append("style").attr("id",T)),t.container}function r(t,e,a){const r=Object.entries(e).map(([t,e])=>`${t}:${e};`).join("");return`${function(t){switch(t){default:case"class":return".";case"id":return"#"}}(a)}${t}{${r}}`}function n(e,n,i="class"){if(void 0===t.styles.find(t=>t.selector===e)){const l=r(e,n,i),s=a();s.text(s.text()+l),t.styles.push({selector:e,type:i,entry:l})}}function i(e,n,i){let l=t.styles.find(t=>t.selector===e);void 0!==n&&(l.entry=r(e,n,i),a().text(t.styles.map(t=>t.entry).join("")))}let l={addClass:(t,e)=>(n(t,e,"class"),l),updateClass:(t,e)=>(i(t,e,"class"),l),addId:(t,e)=>(n(t,e,"id"),l),updateId:(t,e)=>(i(t,e,"id"),l)};return l})();const W="dalian-description";var D=(t,a)=>{S.addClass(W,{position:"absolute",width:"auto","max-width":"500px",padding:"10px",background:"#fff","box-shadow":"0 0 3px #000","border-radius":"3px",color:"#000","font-size":".8em","font-family":"inherit","line-height":"1.35em","pointer-events":"none"});const r={id:t._widget.id+"-description",getDescription:()=>void 0===r.elem||r.elem.empty()?e.select("body").append("div").attr("id",r.id).attr("class",W).style("left",e.event.pageX+20+"px").style("top",e.event.pageY-20+"px"):r.elem,removeDescription:()=>{void 0===r.elem||r.elem.empty()||(r.elem.remove(),delete r.elem)}};return a=Object.assign(a||{},{description:n=>(void 0===n?t._widget.container.on("contextmenu.description",null):t._widget.container.on("contextmenu.description",()=>{e.event.preventDefault(),r.elem=r.getDescription().html(n)}).on("mouseleave.description",()=>{r.removeDescription()}),a)}),{self:t,api:a}},R=(t,e)=>{const a=12,n="black";return(t=Object.assign(t||{},{_font:{size:a+"px",color:n}}))._widget.update=r(t._widget.update,()=>{t._widget.container.style("font-size",t._font.size).style("color",t._font.color)},!0),e=Object.assign(e||{},{font:{size:(r=a)=>(t._font.size=r+"px",e),color:(a=n)=>(t._font.color=a,e)}}),{self:t,api:e}},I=(t,e)=>{const a={callbacks:{}};return{self:t=Object.assign(t||{},{_mouse:{over:(...t)=>{"function"==typeof a.callbacks.over&&a.callbacks.over(...t)},leave:(...t)=>{"function"==typeof a.callbacks.leave&&a.callbacks.leave(...t)},click:(...t)=>{"function"==typeof a.callbacks.click&&a.callbacks.click(...t)},isEnabled:t=>"function"==typeof a.callbacks[t],hasAny:()=>Object.values(a.callbacks).reduce((t,e)=>t||"function"==typeof e,!1)}}),api:e=Object.assign(e||{},{mouse:{over:t=>(a.callbacks.over=t,e),leave:t=>(a.callbacks.leave=t,e),click:t=>(a.callbacks.click=t,e)}})}};const H="dalian-placeholder",B="dalian-placeholder-message";var E=(t,e)=>{S.addClass(H,{display:"table",position:"absolute",left:0,top:0,color:"inherit","font-family":"inherit","font-size":"inherit","pointer-events":"none"}).addClass(B,{display:"table-cell","vertical-align":"middle","line-height":"normal","text-align":"center",color:"inherit","font-family":"inherit","font-size":"inherit"});const a={id:t._widget.id+"-placeholder"};return t._widget.update=r(t._widget.update,e=>{void 0!==a.elem&&a.elem.style("font-size","inherit").transition().duration(e).style("width",t._widget.size.width).style("height",t._widget.size.height).style("color","inherit")}),e=Object.assign(e||{},{placeholder:(r,n=0)=>(void 0===r?(t._widget.content.style("display","block").transition().duration(n).style("opacity",1),t._widget.disable(!1),void 0===a.elem||a.elem.empty()||(a.elem.transition().duration(n).style("opacity",0).remove(),delete a.elem)):(t._widget.content.transition().duration(n).style("opacity",0).on("end",()=>{t._widget.content.style("display","none")}),t._widget.disable(!0),(void 0===a.elem||a.elem.empty())&&(a.elem=t._widget.container.append("div").attr("id",a.id).attr("class",H).style("width",t._widget.size.width).style("height",t._widget.size.height),a.elem.append("span").attr("class",B).style("opacity",0).html(r).transition().duration(n).style("opacity",1))),e)}),{self:t,api:e}},L=(t,e)=>{for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.style(a,e[a]);return t};const P=document.createElement("canvas"),q=P.getContext("2d");function X(t,e,a){const r=a,n=200+q.measureText(t).width,i=200+r;!function(t,e){P.style.width=t+"px",P.width=t,P.style.height=e+"px",P.height=e}(n,i),q.font=a+"px "+e,q.fillStyle="#fff",q.fillRect(0,0,n,i),q.fillStyle="#000",q.fillText(t,100,100+r);const l=q.getImageData(0,0,n,i).data.filter((t,e)=>e%4==0),s=Math.floor(l.findIndex(t=>t<255)/n);return l.reverse(),{min:s,max:i-Math.floor(l.findIndex(t=>t<255)/n)}}var Y=(t,a,r,n)=>{const i={x:0,y:0},l={width:300,height:200},s=0,o={parent:e.select(r),initialized:!1,pos:{x:{attr:"left",ignore:"right",value:i.x+"px"},y:{attr:"top",ignore:"bottom",value:i.y+"px"}}},c={};c._widget={id:`dalian-widget-${t}-${a}`,container:void 0,size:{width:l.width+"px",height:l.height+"px",innerWidth:l.width+"px",innerHeight:l.height+"px"},margins:{left:s,right:s,top:s,bottom:s},transition:!1,disabled:!1,getMouse:()=>{const t=e.mouse(c._widget.container.node());return[t[0]-c._widget.margins.left,t[1]-c._widget.margins.top]},getElem:(t,e)=>o.initialized?t.transition().duration(e):(setTimeout(()=>{o.initialized=!0},e),t),getStyle:()=>window.getComputedStyle(c._widget.container.node()),getFontMetrics:()=>(t=>{const e=X("x",t,100),a=X("y",t,100),r=X("h",t,100),n=X("H",t,100),i=e.max-e.min;return{xHeight:i/100,capHeight:(n.max-n.min)/100,descender:(a.max-a.min-i)/100,ascender:(r.max-r.min)/100}})(window.getComputedStyle(c._widget.container.node()).fontFamily),update:t=>{c._widget.getElem(c._widget.container,t).style(o.pos.x.ignore,null).style(o.pos.x.attr,o.pos.x.value).style(o.pos.y.ignore,null).style(o.pos.y.attr,o.pos.y.value).style("width",c._widget.size.width).style("height",c._widget.size.height)},disable:t=>{c._widget.disabled=t}};try{c._widget.container=o.parent.append("div").attr("id",c._widget.id).attr("class","dalian-widget dalian-widget-"+t),L(c._widget.container,{position:"absolute",width:c._widget.size.width,height:c._widget.size.height,left:o.pos.x+"px",top:o.pos.y+"px","font-family":"inherit","font-size":"inherit","font-color":"inherit"}),c._widget.content=c._widget.container.append(n).attr("class","dalian-widget-content"),L(c._widget.content,{position:"absolute",width:"100%",height:"100%",left:0,top:0,"font-family":"inherit","font-size":"inherit","font-color":"inherit","pointer-events":"none"})}catch(t){throw Error("MissingDOMException: DOM is not present.")}const d={x:(t=i.x)=>(o.pos.x.attr=t>=0?"left":"right",o.pos.x.ignore=t>=0?"right":"left",o.pos.x.value=Math.abs(t)+"px",d),y:(t=i.y)=>(o.pos.y.attr=t>=0?"top":"bottom",o.pos.y.ignore=t>=0?"bottom":"top",o.pos.y.value=Math.abs(t)+"px",d),width:(t=l.width)=>(c._widget.size.width=t+"px",c._widget.size.innerWidth=t-c._widget.margins.left-c._widget.margins.right+"px",d),height:(t=l.height)=>(c._widget.size.height=t+"px",c._widget.size.innerHeight=t-c._widget.margins.top-c._widget.margins.bottom+"px",d),margins:(t=s)=>{switch(typeof t){case"undefined":default:c._widget.margins={left:0,right:0,top:0,bottom:0};break;case"number":c._widget.margins={left:t,right:t,top:t,bottom:t};break;case"object":c._widget.margins=Object.assign(c._widget.margins,t)}return c._widget.size.innerWidth=parseInt(c._widget.size.width)-c._widget.margins.left-c._widget.margins.right+"px",c._widget.size.innerHeight=parseInt(c._widget.size.height)-c._widget.margins.top-c._widget.margins.bottom+"px",d},render:t=>(c._widget.update(t),d)};return{self:c,api:d}},G=(t,e,a,o="svg")=>{let{self:c,api:d}=n(Y(t,e,a,o),F,D,R,I,E);const p=(()=>{const t=e+"-dalian-plots-clipper";return{clipId:t,clip:c._widget.content.append("defs").append("clipPath").attr("id",t).append("rect").attr("x",0).attr("y",0).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),update(t){c._widget.getElem(p.clip,t).attr("width",c._widget.size.innerWidth).attr("height",c._widget.size.innerHeight),c._widget.getElem(c._chart.plots,t).attr("width",c._widget.size.innerWidth+"px").attr("height",c._widget.size.innerHeight+"px").attr("transform",`translate(${c._widget.margins.left}, ${c._widget.margins.top})`)}}})();return c=Object.assign(c||{},{_chart:{data:[],plots:c._widget.content.append("g").attr("class","dalian-plots-container"),clipId:p.clipId,transformData:t=>t,plotGroups(t,e){const a=c._chart.plots.transition().duration(e);c._chart.plots.selectAll(".plot-group").data(c._chart.data,t=>t.name).join(e=>e.append("g").attr("class",t=>"plot-group "+i(t.name)).attr("clip-path",`url(#${p.clipId})`).style("shape-rendering","geometricPrecision").call(t.enter||(t=>t)),t=>t,e=>e.transition(a).call(t.exit||(t=>t)).remove()).on("mouseover.chart",c._mouse.over).on("mouseleave.chart",c._mouse.leave).on("click.chart",c._mouse.click).each(()=>{c._chart.plots.style("pointer-events","none"),c._widget.transition=!0}).call(t.updateBefore||(t=>t)).transition(a).call(t.update||(t=>t)).on("end",()=>{c._chart.plots.style("pointer-events",c._tooltip&&c._tooltip.isOn()||c._mouse.hasAny()?"all":"none"),c._widget.transition=!1})}}}),c._widget.update=r(c._widget.update,p.update),d=Object.assign(d,{data:t=>(c._chart.data=c._chart.transformData(t),d),download:async t=>{const e=(t=>{const e=Array.from(t.querySelectorAll("*")).map(l),a=t.cloneNode(!0);return s(a,l(t)),a.querySelectorAll("*").forEach((t,a)=>s(t,e[a])),a.style.backgroundColor=t.parentNode.style.backgroundColor||"#fff",a})(c._widget.content.node());((t,e,a)=>{g.download=`${e}.${a}`,g.href=t,document.body.appendChild(g),g.click(),document.body.removeChild(g)})(await u(e),t,"png")}}),{self:c,api:d}},V=(t,e)=>{for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.attr(a,e[a]);return t},N=(t,e,a,n,i)=>{const l={format:t=>t,values:null,tickAnchor:null,tickColor:"currentColor"};let s=e._widget.content.append("g").attr("class","dalian-axis-container "+t).style("font-family","inherit").style("font-size","inherit"),o=s.append("g").attr("class","axis "+t).style("font-family","inherit").style("font-size","inherit");o.selectAll("path").style("fill","none").style("stroke-width","1px").style("shape-rendering","crispEdges").style("stroke","currentColor");let c={margin:{left:0,top:0,right:0,bottom:0},format:l.format,values:l.values,scale:n,container:s,tickColor:l.tickColor,ticks:!0,tickAnchor:l.tickAnchor,axisLine:!0,update:t=>{e._widget.getElem(c.container,t).attr("transform","translate("+(e._widget.margins.left+c.margin.left-c.margin.right)+","+(e._widget.margins.top+c.margin.top-c.margin.bottom)+")").style("width",e._widget.size.innerWidth).style("height",e._widget.size.innerHeight),d.fn.scale(c.scale.scale).tickFormat(c.format).tickSize(c.ticks?6:0).tickPadding(c.ticks?3:9).tickValues(c.values||null),e._widget.getElem(d.axis,t).call(d.fn).selectAll("path").style("opacity",c.axisLine?1:0),o.selectAll(".tick > text").attr("text-anchor",c.tickAnchor),o.selectAll(".tick > line").attr("stroke",c.tickColor)}};e._widget.update=r(e._widget.update,c.update);let d={fn:a().ticks(5),axis:o,margin:t=>(c.margin=Object.assign(c.margin,t),d),label:V(s.append("text").attr("class","axis-label "+t).attr("stroke-width",0).attr("fill","currentColor").style("font-size","1em").text(""),i),tickAnchor:(t=l.tickAnchor)=>(c.tickAnchor=t,d),scale:t=>(c.scale=t,d),hideAxisLine:t=>(c.axisLine=!t,d),hideTicks:t=>(c.ticks=!t,d),format:(t=l.format)=>(c.format=t,d),values:(t=l.values)=>(c.values=t,d),tickColor:(t="currentColor")=>(c.tickColor=t,d)};return d},J=t=>(a,n)=>{let i=N("x",a,e.axisBottom,t,{"text-anchor":"end",dy:"2.5em"}),l=t=>{a._widget.getElem(i.axis,t).attr("transform",`translate(0, ${parseFloat(a._widget.size.innerHeight)})`),a._widget.getElem(i.label,t).attr("x",a._widget.size.innerWidth).attr("y",parseFloat(a._widget.size.innerHeight)+"px")};return(a=Object.assign(a||{},{_bottomAxis:i}))._widget.update=r(a._widget.update,l),n=Object.assign(n||{},{bottomAxis:{label:(t="")=>(i.label.text(t),n),format:t=>(i.format(t),n),values:t=>(i.values(t),n),hideTicks:t=>(i.hideTicks(t),n),hideAxisLine:t=>(i.hideAxisLine(t),n)}}),{self:a,api:n}},U=(t,a,r={blur:{opacity:.1}})=>(n,l)=>{function s(t){return Object.keys(t.focus||{}).concat(Object.keys(t.blur||{})).reduce((t,e)=>Object.assign(t,{[e]:null}),{})}const o={container:void 0,selectors:a,highlightStyle:r,removeStyle:s(r),highlight:(a,r,l)=>{if(n._widget.transition)return;const s=(o.container||(o.container=t())).selectAll(a).interrupt(),c=s.transition().duration(l||0);let d;if("string"==typeof r)d=[i(r)];else{if(!Array.isArray(r))return void L(s.transition(c),o.removeStyle);d=r.map(i)}L(s.filter((function(){const t=e.select(this);return d.reduce((e,a)=>e||t.classed(a),!1)})).transition(c),o.highlightStyle.focus||o.removeStyle),L(s.filter((function(){const t=e.select(this);return!d.reduce((e,a)=>e||t.classed(a),!1)})).transition(c),o.highlightStyle.blur||o.removeStyle)}};return n=Object.assign(n||{},{_highlight:{style(t){o.highlightStyle=t,o.removeStyle=s(t)},selectors:void 0}}),l=Object.assign(l||{},{highlight:(e,a=0)=>{if(void 0===t())throw Error("Highlight.container is not specified");return o.selectors.forEach(t=>o.highlight(t,e,a)),l}}),{self:n,api:l}},K=t=>(a,r)=>{let n=N("y",a,e.axisLeft,t,{"text-anchor":"begin",x:"5px",y:"-5px"});return{self:a=Object.assign(a||{},{_leftAxis:n}),api:r=Object.assign(r||{},{leftAxis:{label:(t="")=>(n.label.text(t),r),format:t=>(n.format(t),r),values:t=>(n.values(t),r),hideTicks:t=>(n.hideTicks(t),r),hideAxisLine:t=>(n.hideAxisLine(t),r)}})}},Q=t=>(e,a)=>{const n={containers:{background:void 0},objects:new Map,getContainer:(t="background")=>(void 0===n.containers[t]&&(n.containers[t]=e._chart.plots.append("g").attr("class","objects-container").attr("clip-path",`url(#${e._chart.clipId})`),"background"===t?n.containers[t].lower():n.containers[t].raise()),n.containers[t])};return e._widget.update=r(e._widget.update,t=>{n.objects.forEach(e=>e.update(t))}),a=Object.assign(a||{},{objects:{add:(e,r,i,l={},s=0)=>{const o=t.x.scale,c=t.y.scale,d=n.getContainer(l.foreground?"foreground":"background").append("g").attr("transform",`translate(${o(i.x)}, ${c(i.y)})`).style("opacity",0);d.node().appendChild(r),n.objects.has(e)?(a.objects.remove(e,s),d.transition().duration(s).style("opacity",1)):d.transition().duration(s).style("opacity",1);const p={g:d,remove:t=>{d.transition().duration(t).style("opacity",0).on("end",()=>{d.remove()})},update:t=>{d.transition().duration(t).attr("transform",`translate(${o(i.x)}, ${c(i.y)})`)}};return n.objects.set(e,p),a},remove:(t,e=0)=>(null==t&&(n.objects.forEach(t=>t.remove(e)),n.objects.clear()),n.objects.has(t)&&(n.objects.get(t).remove(e),n.objects.delete(t)),a)}}),{self:e,api:a}},Z=t=>(e,a)=>{const r={value:t};return{self:e=Object.assign(e||{},{_opacity:{value:()=>r.value}}),api:a=Object.assign(a||{},{opacity:(e=t)=>(r.value=e||t,a)})}},tt=(t,e)=>{const a={markers:new Map};return(t=Object.assign(t||{},{_plotMarker:{add(e,r,n,l,s){a.markers.set(n,a.markers.get(n)||t._chart.plots.append("circle")),V(a.markers.get(n),{class:"plot-marker "+i(l.name),cx:e,cy:r,r:s||4}),L(a.markers.get(n),{stroke:"white",fill:t._color.mapper(l),"pointer-events":"none"})},remove(t){void 0===t?a.markers.forEach((t,e)=>{t.remove(),a.markers.delete(e)}):a.markers.has(t)&&(a.markers.get(t).remove(),a.markers.delete(t))}}}))._widget.update=r(t._widget.update,()=>{t._widget.container.on("mouseout.plot-marker",t._plotMarker.remove)}),{self:t,api:e}};const et="dalian-tooltip";var at=(t,a)=>{S.addClass(et,{position:"absolute","background-color":"rgba(255, 255, 255, 0.95)","border-radius":"2px","box-shadow":"1px 1px 2px #888, 0 0 1px #aaa",color:"currentColor","pointer-events":"none","font-family":"inherit",width:"auto","min-width":"80px","line-height":"1","z-index":9999});const n=!1;let i={container:{id:"dalian-tooltip-container"},id:t._widget.id+"-tooltip",on:n,getContainer:()=>{let a=e.select("#"+i.container.id);return a.empty()&&(a=e.select("body").append("div").attr("id",i.container.id)),a.style("color",t._font.color),a},getTooltip:(t,e)=>void 0===i.elem||i.elem.empty()?i.container.elem.append("div").attr("id",i.id).attr("class",et).style("font-size","0.85em").style("left",(t.left+t.right)/2+e.left+"px").style("top",(t.top+t.bottom)/2+e.top+"px"):i.elem.style("font-size","0.85em"),hideTooltip:()=>{void 0!==i.elem&&i.elem.style("opacity",0)},showTooltip:()=>{let a=e.event.pageX,r=e.event.pageY,n=t._widget.container.node().getBoundingClientRect(),l={left:window.pageXOffset||document.documentElement.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop};if(a<n.left+t._widget.margins.left-l.left||a>n.right-t._widget.margins.right+l.left||r<n.top+t._widget.margins.top-l.top||r>n.bottom-t._widget.margins.bottom+l.top)return t._tooltip.builder(),void i.hideTooltip();i.container.elem=i.getContainer(),i.elem=i.getTooltip(n,l);let s=t._tooltip.builder(t._tooltip.content(t._widget.getMouse()));if(void 0===s){if(void 0!==i.elem)return void i.hideTooltip()}else i.elem.html(s);let o=i.elem.node().getBoundingClientRect(),c=o.width,d=o.height,p=a+20,u=r+20;p+c>n.right-t._widget.margins.right+l.left-10&&(p-=c+l.left+40),u+d>n.bottom-t._widget.margins.bottom+l.top-10&&(u=n.bottom-t._widget.margins.bottom+l.top-10-d),i.elem.style("left",p+"px").style("top",u+"px").style("opacity",1)}};return t._widget.update=r(t._widget.update,()=>{t._widget.container.style("pointer-events",i.on?"all":null).on("mousemove.tooltip",()=>i.on&&!t._widget.disabled&&i.showTooltip()).on("mouseout.tooltip",i.hideTooltip)}),t=Object.assign(t||{},{_tooltip:{isOn:()=>i.on,content:()=>console.warn("content(mouse) is not implemented"),builder:()=>console.warn("builder(mouse) is not implemented")}}),a.tooltip={on:(t=n)=>(i.on=t,a)},{self:t,api:a}};const rt="dalian-point-tooltip-",nt={content:rt+"content",entry:rt+"entry",container:rt+"container",inner:rt+"inner",square:rt+"square",label:rt+"label"};var it=(t,a)=>{S.addClass(nt.content,{display:"table",padding:"10px","min-width":"60px"}).addClass(nt.entry,{display:"table-row",position:"relative"}).addClass(nt.container,{display:"inline-block",position:"relative"}).addClass(nt.inner,{display:"flex",position:"relative","justify-content":"center","align-items":"center"}).addClass(nt.square,{display:"inline-block",position:"relative",float:"left","margin-right":"6px","border-radius":"2px"}).addClass(nt.label,{display:"table-cell",position:"relative","max-width":"120px",float:"left"});const r={ignore:[],titleFormat:t=>t,valueFormat:t=>t.y};let n=at(t,a),i={titleFormat:r.titleFormat,valueFormat:r.valueFormat};return t._tooltip=Object.assign(n.self._tooltip,{ignore:[],builder:a=>{if(void 0===a)return void t._tooltip.content();let r=e.select(document.createElement("div")).attr("class",nt.content);return r.append("div").attr("class",nt.entry).text(i.titleFormat(a.title)),a.content.data.forEach((t,e)=>{let a=r.append("div").attr("class",nt.entry).append("div").attr("class",nt.container).style("height","1em").style("margin-top",(0===e?6:3)+"px").append("div").attr("class",nt.inner).style("height","1em");a.append("div").attr("class",nt.square).style("width","0.85em").style("height","0.85em").style("background",t.background),a.append("div").attr("class",nt.label).style("line-height","0.8em").html(i.valueFormat(t))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{ignore:(e=r.ignore)=>(t._tooltip.ignore=e,a),titleFormat:(t=r.titleFormat)=>(i.titleFormat=t,a),valueFormat:(t=r.valueFormat)=>(i.valueFormat=t,a)}),{self:t,api:a}},lt=(t="linear")=>{const a={type:t,scale:(()=>{switch(t){default:case"linear":return e.scaleLinear();case"sqrt":return e.scalePow().exponent(.5);case"band":return e.scaleBand().padding(.1);case"point":return e.scalePoint().padding(.5)}})()},r={scale:a.scale,range:(t,e)=>(a.scale.range([t,e]),r),domain:t=>{switch(a.type){default:case"linear":case"sqrt":a.scale.domain([Math.min(...t),Math.max(...t)]);break;case"band":case"point":a.scale.domain(t)}return r},type:t=>{if(void 0===t)return a.type;switch(t){default:case"linear":a.scale=e.scaleLinear();break;case"sqrt":a.scale=e.scalePow().exponent(.5);break;case"band":a.scale=e.scaleBand().padding(.1);break;case"point":a.scale=e.scalePoint().padding(.5)}},measure:t=>Math.abs(a.scale.invert(t)-a.scale.invert(0))};return r},st=(t,a)=>{const r=!1,n={on:r};return{self:t=Object.assign(t||{},{_smoothing:{curve:()=>n.on?e.curveMonotoneX:e.curveLinear}}),api:a=Object.assign(a||{},{smoothing:(t=r)=>(n.on=t,a)})}},ot=()=>{let t={min:void 0,max:void 0,compressMax:0,compressMin:0};return{min:e=>t.min=e,max:e=>t.max=e,compressMin:e=>t.compressMin=Math.abs(e||0),compressMax:e=>t.compressMax=Math.abs(e||0),range:e=>{let a=void 0!==t.min?t.min:Math.min(...e),r=void 0!==t.max?t.max:Math.max(...e),n=r-a;return a-=t.compressMin>0?t.compressMin*n:0,r+=t.compressMax>0?t.compressMax*n:0,[a,r]},contains:e=>(void 0===t.min||e>=t.min)&&(void 0===t.max||e<=t.max)}},ct=(t,e)=>{let a=ot();return{self:t=Object.assign(t||{},{_yRange:{range:a.range,contains:a.contains}}),api:e=Object.assign(e||{},{yRange:{min:t=>(a.min(t),e),compressMin:(t=0)=>(a.compressMin(t),e),max:t=>(a.max(t),e),compressMax:(t=0)=>(a.compressMax(t),e)}})}};const dt=document.createElement("canvas").getContext("2d");function pt(t,e){return dt.font=e.fontSize+" "+e.fontFamily,{width:dt.measureText(t).width,height:parseFloat(e.fontSize)}}function ut(t,a=.4){const r=e.hsl(t);return r.l+=a*(1-r.l),r}function gt(t){return function(t){const a=e.color(t);return.229*a.r+.587*a.g+.114*a.b}(t)>150?"#000":"#fff"}const mt="dalian-element-tooltip-",ht={content:mt+"content",title:mt+"title",entry:mt+"entry",label:mt+"label",value:mt+"value"};var yt=(t,a)=>{S.addClass(ht.content,{"border-radius":"2px","font-family":"inherit"}).addClass(ht.title,{position:"relative",margin:"2px","margin-bottom":"10px"}).addClass(ht.entry,{position:"relative",margin:"2px","padding-right":"10px"}).addClass(ht.label,{position:"relative",float:"left","margin-right":"10px"}).addClass(ht.value,{position:"relative",float:"right"});const r={titleFormat:t=>t,labelFormat:t=>t+":",valueFormat:t=>t};let n=at(t,a),i={titleFormat:r.titleFormat,labelFormat:r.labelFormat,valueFormat:r.valueFormat};return t._tooltip=Object.assign(n.self._tooltip,{builder:a=>{if(void 0===a)return void t._tooltip.content();let r=e.select(document.createElement("div")).attr("class",ht.content).style("padding","0.7em").style("border-left",a.stripe?"solid 4px "+a.stripe:null);return r.append("div").attr("class",ht.title).style("line-height","1em").html(i.titleFormat(a.title)),a.content.data.forEach(t=>{let e=r.append("div").attr("class",ht.entry).style("height","1em").style("line-height","1em");e.append("div").attr("class",ht.label).html(i.labelFormat(t.name)),e.append("span").attr("class",ht.value).html(i.valueFormat(t.value,t.name))}),r.node().outerHTML}}),a.tooltip=Object.assign(a.tooltip||{},{titleFormat:(t=r.titleFormat)=>(i.titleFormat=t,a),labelFormat:(t=r.labelFormat)=>(i.labelFormat=t,a),valueFormat:(t=r.valueFormat)=>(i.valueFormat=t,a)}),{self:t,api:a}},xt=t=>(e,a)=>{const r=!1,n={on:r,scales:{x:t.x,y:t.y}};return e=Object.assign(e||{},{_horizontal:{on:()=>n.on,scales:()=>n.scales}}),a=Object.assign(a||{},{horizontal:(i=r)=>(n.on=i,n.scales.x=i?t.y:t.x,n.scales.y=i?t.x:t.y,e._bottomAxis.scale(n.scales.x),e._leftAxis.scale(n.scales.y),void 0!==e._yGrid&&e._yGrid.type(i?"x":"y"),a)}),{self:e,api:a}},vt=(t,e)=>{const a={format:()=>""};return t=Object.assign(t||{},{_label:{show:!1,format:a.format}}),e=Object.assign(e||{},{label:r=>(t._label.show=null!=r,t._label.format=r||a.format,e)}),{self:t,api:e}},bt=t=>(e,a)=>{let n={defaults:{opacity:.3,lineStyle:"4 8"},type:t,on:!1,grid:void 0,opacity:void 0,lineStyle:void 0,update:t=>{if(n.on){void 0===n.grid&&(n.grid=e._chart.plots.insert("g",":first-child").attr("class","grid").style("opacity",0).style("stroke","currentColor").style("stroke-width","1px"));const a="x"===n.type?e._bottomAxis.fn:e._leftAxis.fn,r="x"===n.type?parseFloat(e._widget.size.innerHeight):-parseFloat(e._widget.size.innerWidth);n.grid.transition().duration(t).call(a.tickSizeInner(r).tickFormat("")).style("stroke-opacity",n.opacity||n.defaults.opacity).style("stroke-dasharray",n.lineStyle||n.defaults.lineStyle).style("opacity",1),n.grid.select("path").remove()}else void 0!==n.grid&&(n.grid.transition().duration(t).style("opacity",0).remove(),n.grid=void 0)}};e._widget.update=r(e._widget.update,n.update);let i={type:t=>{n.type=t,n.grid&&(n.grid.remove(),n.grid=void 0)}};const l={on:t=>(n.on=t,a),opacity:t=>(n.opacity=t,a),lineStyle:t=>{switch(t){case"solid":n.lineStyle="1 0";break;case"dashed":default:n.lineStyle="4 8";break;case"dotted":n.lineStyle="2 5"}return a}};return a=Object.assign(a||{},"x"===t?{xGrid:l}:{yGrid:l}),{baseSelf:i,self:e,api:a}},ft=(t,e)=>{let a=bt("y")(t,e);return{self:t=Object.assign(t||{},{_yGrid:a.baseSelf}),api:a.api}},_t=t=>(e,a)=>{const r={mapping:()=>t+"px"};return{self:e=Object.assign(e||{},{_lineWidth:{mapping:t=>r.mapping(t)}}),api:a=Object.assign(a||{},{lineWidth:(e=t)=>(r.mapping="number"==typeof e?()=>e+"px":a=>(e[a]||t)+"px",a)})}},wt=(t,e)=>{let a=ot();return{self:t=Object.assign(t||{},{_xRange:{range:a.range,contains:a.contains}}),api:e=Object.assign(e||{},{xRange:{min:t=>(a.min(t),e),compressMin:(t=0)=>(a.compressMin(t),e),max:t=>(a.max(t),e),compressMax:(t=0)=>(a.compressMax(t),e)}})}};const kt=(t,e,a)=>new Date(Date.UTC(t,e,a)),zt=t=>{const e=t.split("-");return kt(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]))};const Ct=(t,a)=>{const r="_current"+(a||"");return function(a){const n=e.interpolate(this[r],a);return this[r]=n(0),e=>t(n(e),a)}};var Mt=(t,e)=>{const a={policy:void 0,getStrokeDashArray:t=>{switch(t){case"solid":default:return null;case"dashed":return"4 8";case"dotted":return"2 5"}}};return{self:t=Object.assign(t||{},{_lineStyle:{strokeDashArray:t=>void 0===a.policy?null:"string"==typeof a.policy?a.getStrokeDashArray(a.policy):a.getStrokeDashArray(a.policy[t]),style:t=>void 0===a.policy?"solid":"string"==typeof a.policy?a.policy:a.policy[t],background:(t,e)=>{switch(t){case"solid":default:return e;case"dashed":return`repeating-linear-gradient(-45deg, transparent, transparent 2px, ${e} 2px, ${e} 4px`;case"dotted":return`radial-gradient(${e} 30%, transparent 30%) 0.5px 0.5px/4px 4px, radial-gradient(${e} 30%, transparent 30%) 2.5px 2.5px/4px 4px transparent`}}}}),api:e=Object.assign(e||{},{lineStyle:t=>(a.policy=t,e)})}},jt=bt("x");const Ot="#888",At=0,$t="dalian-table-",Ft={container:$t+"container",table:$t+"table",head:$t+"head",headContainer:$t+"head-container",headLabel:$t+"ead-label",headSvg:$t+"head-svg",headMarker:$t+"head-marker",scrollbarTrack:$t+"container::-webkit-scrollbar-track",scrollbarThumb:t=>t+" .dalian-table-container::-webkit-scrollbar-thumb",scrollbarThumbHover:t=>t+" .dalian-table-container::-webkit-scrollbar-thumb:hover",paging:$t+"paging",pagingBlock:$t+"paging-block",pagingNumber:$t+"paging-number",pagingTotalBefore:$t+"paging-total:before",pagingButton:$t+"paging-button",pagingButtonHover:$t+"paging-button:hover"};t.AreaChart=(t,i="body")=>{const l={x:lt("linear"),y:lt("linear")};let{self:s,api:o}=n(G("area-chart",t,i),K(l.y),(c="currentColor",(t,e)=>{const a={mapping:()=>c+"px"};return{self:t=Object.assign(t||{},{_lineColor:{mapping:t=>a.mapping(t)}}),api:e=Object.assign(e||{},{lineColor:(t=c)=>(a.mapping="string"==typeof t?()=>t:e=>t[e]||c,e)})}}),J(l.x),tt,Q(l),Z(.4),st,it,U(()=>s._chart.plots,[".plot-group",".plot-marker"]),ct);var c;const d={scales:l,update(t){const r=s._chart.data.map(t=>t.values).flat(),n=r.map(t=>t.y),i=e.extent(n),l=.01*(i[1]-i[0]);i[1]+=l,d.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(r.map(t=>t.x)),d.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(s._yRange.range(i));const o=e.area().x(t=>d.scales.x.scale(t.x)).y0(d.scales.y.scale(0)).y1(t=>d.scales.y.scale(t.y)).curve(s._smoothing.curve()),c=e.line().x(t=>d.scales.x.scale(t.x)).y(t=>d.scales.y.scale(t.y)).curve(s._smoothing.curve());s._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",s._color.mapper),t.append("path").attr("class","area").attr("d",t=>o(t.values)).attr("stroke","none").attr("fill","currentColor"),t.append("path").attr("class","line").attr("d",t=>c(t.values)).attr("fill","none").attr("stroke",s._lineColor.mapping),t),update:t=>(t.style("opacity",1).style("color",s._color.mapper),t.select(".area").attrTween("d",(function(t){const r=e.select(this).attr("d"),n=o(t.values);return a.interpolatePath(r,n,null)})).attr("fill-opacity",s._opacity.value()),t.select(".line").attr("stroke",s._lineColor.mapping).attrTween("d",(function(t){const r=e.select(this).attr("d"),n=c(t.values);return a.interpolatePath(r,n,null)})),t),exit:t=>t.style("opacity",0)},t)}};return s._tooltip.content=t=>{if(void 0===t)return void s._plotMarker.remove();const a=e.bisector(t=>d.scales.x.scale(t.x)).left,r=t?s._chart.data.map(e=>a(e.values,t[0])):void 0;if(void 0===r)return void s._plotMarker.remove();let n=d.scales.x.scale.invert(t[0]);const i=s._chart.data.filter(t=>-1===s._tooltip.ignore.indexOf(t.name)).map((t,e)=>{const a=r[e],i=t.values,l=i[a-1]?i[a-1]:i[a],o=i[a]?i[a]:i[a-1],c=n-l.x>o.x-n?o:l;return n=c.x,s._plotMarker.add(d.scales.x.scale(n),d.scales.y.scale(c.y),t.name,t),{name:t.name,background:s._color.mapper(t),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:n,content:{type:"plots",data:i}}},s._chart.transformData=t=>t.map(t=>({name:t.name,values:t.values.sort((t,e)=>t.x-e.x).map(t=>({x:+t.x,y:+t.y}))})),s._widget.update=r(s._widget.update,d.update,!0),o=Object.assign(o||{},{}),o},t.BarChart=(t,a="body")=>{const i={x:lt("band"),y:lt("linear")};let{self:l,api:s}=n(G("bar-chart",t,a),K(i.y),J(i.x),yt,U(()=>l._chart.plots,[".plot-group"]),xt(i),vt,ft);const o={current:void 0,scales:l._horizontal.scales(),horizontal:!1,measureX:(t,e,a)=>{const r=pt(l._label.format(t),a),n=Math.max((e-r.height)/2,5),i=o.scales.x.scale(t.value),s=i>2*n+r.width;return{inside:s,x:s?i-n:i+n+r.width,y:o.scales.y.scale(t.name)+e/2,color:s?gt(l._color.mapper(t)):a.color}},measureY:(t,e,a)=>{const r=pt(l._label.format(t),a),n=Math.max((e-r.width)/2,5),i=o.scales.y.scale(t.value),s=parseFloat(l._widget.size.innerHeight)-i>2*n+r.height;return{inside:s,x:o.scales.x.scale(t.name)+e/2,y:s?i+n:i-n-r.height,color:s?gt(l._color.mapper(t)):a.color}},update:t=>{o.scales=l._horizontal.scales();const a=l._horizontal.on(),r=l._widget.getStyle(),n=l._chart.data.map(t=>t.name),i=1.01*e.max(l._chart.data.map(t=>t.value))||1;o.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(a?[0,i]:n),o.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(a?n:[0,i]),l._chart.plotGroups({enter:t=>{const e=a?o.scales.y.scale.bandwidth():o.scales.x.scale.bandwidth();t.append("rect").attr("class","bar").on("mouseover.bar",t=>{o.current=t}).on("mouseleave.bar",()=>{o.current=void 0}).attr("x",t=>o.scales.x.scale(a?0:t.name)).attr("y",t=>o.scales.y.scale(a?t.name:0)).attr("width",a?0:e).attr("height",a?e:0).attr("fill",l._color.mapper);const n=a?o.measureX:o.measureY;return t.append("text").attr("class","bar-label").attr("stroke","none").style("display","none").style("pointer-events","none").text(l._label.format).each(t=>Object.assign(t,{_measures:n(t,e,r)})).attr("fill",t=>t._measures.color).attr("x",t=>a?o.scales.x.scale(0):t._measures.x).attr("y",t=>a?t._measures.y:o.scales.y.scale(0)),t},update:t=>{t.style("opacity",1);const e=a?o.scales.y.scale.bandwidth():o.scales.x.scale.bandwidth();t.select(".bar").attr("x",t=>o.scales.x.scale(a?0:t.name)).attr("y",t=>o.scales.y.scale(a?t.name:t.value)).attr("width",t=>a?o.scales.x.scale(t.value):e).attr("height",t=>a?e:parseInt(l._widget.size.innerHeight)-o.scales.y.scale(t.value)).attr("fill",l._color.mapper);const n=a?o.measureX:o.measureY;return t.select(".bar-label").each(t=>Object.assign(t,{_measures:n(t,e,r)})).attr("text-anchor",a?"end":"middle").attr("dominant-baseline",a?"central":"hanging").attr("font-size","inherit").attr("fill",l._font.color).attr("fill",t=>t._measures.color).attr("x",t=>t._measures.x).attr("y",t=>t._measures.y).text(l._label.format).style("display",l._label.show?null:"none"),t},exit:t=>t.style("opacity",0)},t)}};return l._tooltip.content=()=>void 0===o.current?void 0:{title:o.current.name,stripe:l._color.mapper(o.current),content:{data:[{name:"value",value:o.current.value}]}},l._widget.update=r(l._widget.update,o.update,!0),s},t.BoxPlot=(t,a="body")=>{const i={x:lt("point"),y:lt("linear")};let{self:l,api:s}=n(G("box-plot",t,a),J(i.x),yt,U(()=>l._chart.plots,[".plot-group"]),xt(i),K(i.y),_t(1),Z(.2));const o={current:void 0,scales:l._horizontal.scales(),boxWidth:20,horizontal:!1,whiskerPath(t){const e="lower"===t?"q1":"q3";return a=>`M${o.scales.x.scale(o.horizontal?a.value[e]:a.name)} ${o.scales.y.scale(o.horizontal?a.name:a.value[e])}\n      L${o.scales.x.scale(o.horizontal?a.value.whiskers[t]:a.name)} ${o.scales.y.scale(o.horizontal?a.name:a.value.whiskers[t])}\n      m${o.horizontal?0:-.4*o.boxWidth} ${o.horizontal?-.4*o.boxWidth:0}\n      l${o.horizontal?0:.8*o.boxWidth} ${o.horizontal?.8*o.boxWidth:0}`},outlierX:t=>o.scales.x.scale(o.horizontal?t:t.name),outlierY:t=>o.scales.y.scale(o.horizontal?t.name:t),update(t){const a=l._chart.data.map(t=>t.name);let r=e.min(l._chart.data,t=>e.min(t.value.outliers.extreme.concat(t.value.outliers.mild).concat([t.value.whiskers.lower]))),n=e.max(l._chart.data,t=>e.max(t.value.outliers.extreme.concat(t.value.outliers.mild).concat([t.value.whiskers.upper])));const i=n-r;r-=.05*i,n+=.05*i,o.horizontal=l._horizontal.on(),o.scales=l._horizontal.scales(),o.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(o.horizontal?[r,n]:a),o.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(o.horizontal?a:[r,n]);const s=o.horizontal?0:o.boxWidth/2,c=o.horizontal?o.boxWidth/2:0;l._chart.plotGroups({enter:t=>(t.style("opacity",0).on("mouseover.box",t=>{o.current=t}).on("mouseleave.box",()=>{o.current=void 0}).style("color",l._color.mapper),t.append("rect").attr("class","box-body").attr("rx","2px").attr("ry","2px").attr("stroke","currentColor").attr("stroke-width",t=>l._lineWidth.mapping(t.name)).attr("fill","currentColor").attr("fill-opacity",l._opacity.value()).attr("x",t=>o.scales.x.scale(o.horizontal?t.value.q1:t.name)-s).attr("y",t=>o.scales.y.scale(o.horizontal?t.name:t.value.q3)-c).attr("width",t=>o.horizontal?o.scales.x.scale(t.value.q3)-o.scales.x.scale(t.value.q1):o.boxWidth).attr("height",t=>o.horizontal?o.boxWidth:o.scales.y.scale(t.value.q1)-o.scales.y.scale(t.value.q3)),t.append("line").attr("class","box-median").attr("x1",t=>o.scales.x.scale(o.horizontal?t.value.median:t.name)-s).attr("y1",t=>o.scales.y.scale(o.horizontal?t.name:t.value.median)-c).attr("x2",t=>o.scales.x.scale(o.horizontal?t.value.median:t.name)+s).attr("y2",t=>o.scales.y.scale(o.horizontal?t.name:t.value.median)+c).attr("stroke","currentColor").attr("stroke-width","2px"),t.append("path").attr("class","box-whisker-lower").attr("d",o.whiskerPath("lower")).attr("stroke","currentColor").attr("stroke-width",t=>l._lineWidth.mapping(t.name)).attr("fill","none"),t.append("path").attr("class","box-whisker-upper").attr("d",o.whiskerPath("upper")).attr("stroke","currentColor").attr("stroke-width",t=>l._lineWidth.mapping(t.name)).attr("fill","none"),t.selectAll(".box-mild-outlier").data(t=>t.value.outliers.mild.map(e=>Object.assign(e,{name:t.name}))).enter().append("circle").attr("class","box-mild-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor"),t.selectAll(".box-extreme-outlier").data(t=>t.value.outliers.extreme.map(e=>Object.assign(e,{name:t.name}))).enter().append("circle").attr("class","box-extreme-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","none").attr("fill","currentColor").style("opacity",.3),t),updateBefore:e=>(e.selectAll(".box-mild-outlier").data(t=>t.value.outliers.mild.map(e=>Object.assign(e,{name:t.name}))).join(t=>t.append("circle").attr("class","box-mild-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),t=>t,e=>e.transition().duration(t).style("opacity",0).remove()).transition().duration(t).attr("cx",o.outlierX).attr("cy",o.outlierY).style("opacity",1),e.selectAll(".box-extreme-outlier").data(t=>t.value.outliers.extreme.map(e=>Object.assign(e,{name:t.name}))).join(t=>t.append("circle").attr("class","box-extreme-outlier").attr("cx",o.outlierX).attr("cy",o.outlierY).attr("r",3).attr("stroke","currentColor").attr("fill","currentColor").style("opacity",0),t=>t,e=>e.transition().duration(t).style("opacity",0).remove()).transition().duration(t).attr("cx",o.outlierX).attr("cy",o.outlierY).style("opacity",l._opacity.value()),e),update:t=>(t.style("opacity",1).style("color",l._color.mapper),t.select(".box-body").attr("x",t=>o.scales.x.scale(o.horizontal?t.value.q1:t.name)-s).attr("y",t=>o.scales.y.scale(o.horizontal?t.name:t.value.q3)-c).attr("width",t=>o.horizontal?o.scales.x.scale(t.value.q3)-o.scales.x.scale(t.value.q1):o.boxWidth).attr("height",t=>o.horizontal?o.boxWidth:o.scales.y.scale(t.value.q1)-o.scales.y.scale(t.value.q3)).attr("stroke-width",t=>l._lineWidth.mapping(t.name)).attr("fill-opacity",l._opacity.value()),t.select(".box-median").attr("x1",t=>o.scales.x.scale(o.horizontal?t.value.median:t.name)-s).attr("y1",t=>o.scales.y.scale(o.horizontal?t.name:t.value.median)-c).attr("x2",t=>o.scales.x.scale(o.horizontal?t.value.median:t.name)+s).attr("y2",t=>o.scales.y.scale(o.horizontal?t.name:t.value.median)+c),t.select(".box-whisker-lower").attr("d",o.whiskerPath("lower")).attr("stroke-width",t=>l._lineWidth.mapping(t.name)),t.select(".box-whisker-upper").attr("d",o.whiskerPath("upper")).attr("stroke-width",t=>l._lineWidth.mapping(t.name)),t),exit:t=>t.style("opacity",0)},t)}};return l._tooltip.content=()=>void 0===o.current?void 0:{title:o.current.name,stripe:l._color.mapper(o.current),content:{data:[{name:"median",value:o.current.value.median},{name:"q1",value:o.current.value.q1},{name:"q3",value:o.current.value.q3},{name:"low",value:o.current.value.whiskers.lower},{name:"high",value:o.current.value.whiskers.upper},{name:"mild outliers",value:o.current.value.outliers.mild.length},{name:"extreme outliers",value:o.current.value.outliers.extreme.length}]}},l._widget.update=r(l._widget.update,o.update,!0),s=Object.assign(s||{},{boxWidth:(t=20)=>(o.boxWidth=t,s)}),s},t.BubbleChart=(t,a="body")=>{const i={x:lt("linear"),y:lt("linear"),size:lt("sqrt")};let{self:l,api:s}=n(G("bubble-chart",t,a),K(i.y),J(i.x),yt,U(()=>l._chart.plots,[".plot-group"]),Z(.6),wt,ct);const o={scales:i,current:{hovered:void 0,closest:void 0},diagram:void 0,radius:30,computeDiagram:t=>e.voronoi().x(t=>o.scales.x.scale(t.value.x)).y(t=>o.scales.y.scale(t.value.y)).extent([[0,0],[parseInt(l._widget.size.innerWidth),parseInt(l._widget.size.innerHeight)]])(t),update(t){const a=l._chart.data.map(t=>t.value).flat(),r=e.max(a.map(t=>t.size));o.scales.size.range(0,o.radius).domain([0,r]);let n=e.extent(a.map(t=>t.x));o.scales.x.range(0,parseInt(l._widget.size.innerWidth)).domain(n);let i=e.extent(a.map(t=>t.y));o.scales.y.range(parseInt(l._widget.size.innerHeight),0).domain(i),n=a.map(t=>{const e=o.scales.x.measure(1.5*o.scales.size.scale(t.size));return[t.x-e,t.x+e]}).flat(),o.scales.x.domain(l._xRange.range(n)),i=a.map(t=>{const e=o.scales.y.measure(1.5*o.scales.size.scale(t.size));return[t.y-e,t.y+e]}).flat(),o.scales.y.domain(l._yRange.range(i)),l._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",l._color.mapper).on("mouseover.bubble",t=>{o.current.hovered=t}).on("mouseleave.bubble",()=>{o.current.hovered=void 0}),t.append("circle").attr("class","bubble").attr("cx",t=>o.scales.x.scale(t.value.x)).attr("cy",t=>o.scales.y.scale(t.value.y)).attr("r",t=>o.scales.size.scale(t.value.size)).attr("stroke","currentColor").attr("fill","currentColor").raise(),t),update:t=>(t.style("opacity",1).style("color",l._color.mapper),t.select(".bubble").attr("cx",t=>o.scales.x.scale(t.value.x)).attr("cy",t=>o.scales.y.scale(t.value.y)).attr("r",t=>o.scales.size.scale(t.value.size)).attr("fill-opacity",l._opacity.value()),t),exit:t=>t.style("opacity",0)},t),o.diagram=o.computeDiagram(l._chart.data),l._widget.container.on("mousemove.scatter",()=>{const t=o.diagram.find(...l._widget.getMouse(),10)||void 0;void 0!==t&&t!==o.current.closest?l._mouse.over(t.data):void 0===o.current.hovered&&void 0!==o.current.closest&&l._mouse.leave(o.current.closest),o.current.closest=t&&t.data||void 0}).on("click.scatter",()=>{void 0!==o.current.closest&&l._mouse.click(o.current.closest)})}};return l._tooltip.content=t=>{if(void 0===t)return;const e=o.current.hovered||o.current.closest;return e?{title:e.name,stripe:l._color.mapper(e),content:{data:[{name:l._bottomAxis.label.text(),value:e.value.x},{name:l._leftAxis.label.text(),value:e.value.y},{name:"size",value:e.value.size}]}}:void 0},l._chart.transformData=t=>t.sort((t,e)=>e.value.size-t.value.size),l._widget.update=r(l._widget.update,o.update,!0),s=Object.assign(s||{},{radius:(t=30)=>(o.radius=t,s)}),s},t.BulletChart=(t,a="body")=>{const i={value:0,forecast:1,ranges:[0,50,80,100],thickness:30,valueColor:"#000",rangeColor:"#888"},l=lt("linear");let{self:s,api:o}=n(Y("bullet-chart",t,a,"svg"),J(l),D,E,R);const c={scale:l,ui:{thickness:i.thickness,valueColor:i.valueColor,rangeColor:i.rangeColor},data:{label:"",unit:"",min:0,max:100,ranges:i.ranges,target:95,value:i.value,forecast:i.forecast},dom:(()=>{const t=s._widget.content.append("g").attr("class","dalian-plot-container"),e=t.append("g").attr("class","bullet-range"),a=t.append("g").attr("class","bullet-value"),r=t.append("g").attr("class","bullet-title");return{plot:t,range:{g:e,high:e.append("rect").attr("stroke","none").attr("fill-opacity",.2).attr("fill","currentColor"),mid:e.append("rect").attr("stroke","none").attr("fill-opacity",.4).attr("fill","currentColor"),low:e.append("rect").attr("stroke","none").attr("fill-opacity",.6).attr("fill","currentColor")},value:{g:a,forecast:a.append("rect").attr("stroke","none"),bar:a.append("rect").attr("stroke","none").attr("fill","currentColor"),target:a.append("line").attr("stroke","currentColor").attr("stroke-width","3px")},title:{label:r.append("text").attr("dx",-10).attr("text-anchor","end").attr("dominant-baseline","baseline"),unit:r.append("text").attr("dx",-10).attr("font-size","0.75em").attr("text-anchor","end").attr("dominant-baseline","hanging")}}})(),update(t){c.scale.range(0,parseInt(s._widget.size.innerWidth)).domain([c.data.ranges[0],c.data.ranges[3]]);const a=(parseFloat(s._widget.size.innerHeight)-c.ui.thickness)/2;s._widget.getElem(c.dom.plot,t).attr("transform",`translate(${s._widget.margins.left}, ${a+s._widget.margins.top})`),s._bottomAxis.margin({bottom:a}).tickColor(c.ui.rangeColor);const r=s._widget.container.transition().duration(t);c.dom.range.g.transition(r).attr("color",c.ui.rangeColor),c.dom.value.g.transition(r).attr("color",c.ui.valueColor),c.dom.range.high.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[3])+1).attr("height",c.ui.thickness),c.dom.range.mid.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[2])+1).attr("height",c.ui.thickness),c.dom.range.low.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",0).attr("width",c.scale.scale(c.data.ranges[1])+1).attr("height",c.ui.thickness),c.dom.value.bar.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",c.ui.thickness/3).attr("width",c.scale.scale(c.data.value)).attr("height",c.ui.thickness/3),c.dom.value.forecast.transition(r).attr("x",c.scale.scale(c.data.ranges[0])).attr("y",c.ui.thickness/3).attr("width",c.scale.scale(Math.min(c.data.value*c.data.forecast,c.data.ranges[3]))).attr("height",c.ui.thickness/3).attr("fill",(t=>{const a=e.hsl(t);return a.l+=.4*(1-a.l),a})(c.ui.valueColor)),c.dom.value.target.transition(r).attr("x1",c.scale.scale(c.data.target)).attr("y1",c.ui.thickness/6).attr("x2",c.scale.scale(c.data.target)).attr("y2",5*c.ui.thickness/6),c.dom.title.label.transition(r).attr("y",c.ui.thickness/2).text(c.data.label),c.dom.title.unit.transition(r).attr("y",2*c.ui.thickness/3).text(c.data.unit)}};return s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o,{value:(t=i.value)=>(c.data.value=t,o),forecast:(t=i.forecast)=>(c.data.forecast=t,o),target:t=>(c.data.target=t,o),ranges:(t=[0,50,80,100])=>(c.data.ranges=t,o),thickness:(t=i.thickness)=>(c.ui.thickness=t,o),valueColor:(t=i.valueColor)=>(c.ui.valueColor=t,o),rangeColor:(t=i.rangeColor)=>(c.ui.rangeColor=t,o),label:t=>(c.data.label=t,o),unit:t=>(c.data.unit=t,o)}),s._bottomAxis.hideAxisLine(!0),o},t.CalendarPlot=(t,a="body")=>{const i={blocks:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],margin:0,align:"start"},tiles:{names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekStart:0}},l={x:lt("linear"),y:lt("band")};let{self:s,api:o}=n(G("pie-chart",t,a),yt,U(()=>s._chart.plots,[".plot-group"]),vt,K(l.y),(c=l.x,(t,a)=>{let n=N("x",t,e.axisTop,c,{"text-anchor":"end",dy:"2.5em"}),i=e=>{t._widget.getElem(n.label,e).attr("x",t._widget.size.innerWidth)};return(t=Object.assign(t||{},{_topAxis:n}))._widget.update=r(t._widget.update,i),a=Object.assign(a||{},{topAxis:{label:(t="")=>(n.label.text(t),a),format:t=>(n.format(t),a),values:t=>(n.values(t),a),hideTicks:t=>(n.self.hideTicks(t),a),hideAxisLine:t=>(n.hideAxisLine(t),a)}}),{self:t,api:a}}));var c;const d={scales:l,current:void 0,metrics:{},blocks:{names:i.blocks.names,margin:i.blocks.margin,align:i.blocks.align},tiles:{names:i.tiles.names,weekStart:0},fm:s._widget.getFontMetrics(),shiftDay:(t,e)=>(t-e+7)%7,tileX(t){const e=Math.ceil((t.date-d.metrics.firstDay)/864e5);return Math.floor((e+d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart))/7)},labelFill:t=>gt(s._color.mapper(t)),addTiles(t,e,a,r){const n=t.append("g").attr("class",t=>"tile date-"+t.date.getDate()).attr("transform",t=>`translate(${d.tileX(t)*e}, ${d.shiftDay(t.date.getDay(),d.tiles.weekStart)*e})`).on("mouseover.calendar",t=>{d.current=t}).on("mouseleave.calendar",()=>{d.current=void 0});return n.append("rect").attr("x",1).attr("y",1).attr("width",e-2).attr("height",e-2).attr("rx",.1*e).attr("ry",.1*e).attr("stroke","transparent").attr("stroke-width",2).attr("fill",s._color.mapper),n.append("text").attr("x",0).attr("y",0).attr("dx",.5*e).attr("dy",a).attr("text-anchor","middle").attr("font-size",r).attr("fill",d.labelFill).style("display",s._label.show?null:"none").style("user-select","none").text(s._label.format),n},update(t){const a=7-d.shiftDay(d.metrics.firstDay.getDay(),d.tiles.weekStart),r=Math.ceil((d.metrics.numDays-a)/7)+1;s._chart.data.forEach(t=>{t.x=Math.floor((t.daysOffset-a)/7)+1,t.length=Math.ceil((t.daysOffset+t.numDays-a)/7)+1-t.x});const n=parseFloat(s._widget.size.innerWidth)/(r+d.blocks.margin*(d.metrics.numMonths-1)),i=parseFloat(s._widget.size.innerHeight)/7,l=Math.min(n,i);s._color.scale(e.scaleLinear().domain(e.extent(s._chart.data.map(t=>t.tiles).flat(),t=>t.value)).range([0,1]));const o=(parseFloat(s._widget.size.innerWidth)-l*(r+d.blocks.margin*(d.metrics.numMonths-1)))/2,c=(parseFloat(s._widget.size.innerHeight)-7*l)/2,p=Math.min(.6*l,parseFloat(s._font.size))+"px",u=(l+d.fm.capHeight*parseFloat(p))/2;var g,m;d.scales.x.range(o,parseInt(s._widget.size.innerWidth)-o).domain([0,r+d.blocks.margin*(d.metrics.numMonths-1)]),d.scales.y.range(c,parseInt(s._widget.size.innerHeight)-c).domain((g=d.tiles.names,m=d.tiles.weekStart,g.slice(m).concat(g.slice(0,m)))),s._leftAxis.hideAxisLine(!0).hideTicks(!0).margin({left:o}),s._topAxis.tickAnchor(d.blocks.align).hideAxisLine(!0).hideTicks(!0).margin({top:c}).values(s._chart.data.map(t=>t.x+("middle"===d.blocks.align?.5*t.length:0)+d.blocks.margin*t.index)).format((t,e)=>d.blocks.names[s._chart.data[e].month]),s._chart.plotGroups({enter:t=>(t.style("opacity",0).classed("year-"+d.metrics.firstDay.getFullYear(),!0).attr("transform",t=>`translate(${o+d.blocks.margin*t.index*l}, ${c})`),d.addTiles(t.selectAll(".tile").data(t=>t.tiles).enter(),l,u,p),t),updateBefore:e=>{const a=e.selectAll(".tile").data(t=>t.tiles).join(t=>d.addTiles(t,l,u,p).style("opacity",0),t=>t,e=>e.transition().duration(t).style("opacity",0).remove()).transition().duration(t).attr("transform",t=>`translate(${d.tileX(t)*l}, ${d.shiftDay(t.date.getDay(),d.tiles.weekStart)*l})`).style("opacity",1);return a.select("rect").attr("width",l-2).attr("height",l-2).attr("rx",.1*l).attr("ry",.1*l).attr("fill",s._color.mapper),a.select("text").attr("dx",.5*l).attr("dy",u).attr("font-size",p).attr("fill",d.labelFill).style("display",s._label.show?null:"none").text(s._label.format),e},update:t=>t.style("opacity",1).attr("transform",t=>`translate(${o+d.blocks.margin*t.index*l}, ${c})`),exit:t=>t.style("opacity",0)},t)}};return s._chart.transformData=t=>{const a=t.map(t=>({date:zt(t.date),value:+t.value})),r=e.min(a.map(t=>t.date)).getMonth(),n=e.max(a.map(t=>t.date)).getMonth(),i=a[0].date.getFullYear();let l=0;const s=Array.from({length:n-r+1},(t,e)=>{const a=(r+e)%12,n=kt(i,a+1,0).getDate(),s=kt(i,a,1),o={month:a,numDays:n,daysOffset:l,index:e,name:"month-"+a,tiles:Array.from({length:n},(t,e)=>{const r=new Date(s);return r.setDate(s.getDate()+e),{name:"month-"+a,date:r,value:null}})};return l+=n,o});return a.forEach(t=>{const e="month-"+t.date.getMonth();s.find(t=>t.name===e).tiles.find(e=>e.date.getDate()===t.date.getDate()).value=t.value}),d.metrics={year:s[0].tiles[0].date.getFullYear(),firstDay:s[0].tiles[0].date,numDays:e.sum(s,t=>t.tiles.length),numMonths:s.length},s},s._tooltip.content=()=>void 0===d.current?void 0:{title:d.current.date.toISOString().substr(0,10),stripe:s._color.mapper(d.current),content:{type:"plots",data:[{name:"value",value:d.current.value}]}},s._widget.update=r(s._widget.update,d.update,!0),o=Object.assign(o||{},{months:(t=i.blocks.names)=>(d.blocks.names=t,o),blockAlign:(t=i.blocks.align)=>(d.blocks.align=t,o),blockMargin:(t=i.blocks.margin)=>(d.blocks.margin=t,o),days:(t=i.tiles.names)=>(d.tiles.names=t,o),weekStart:(t=i.tiles.weekStart)=>(d.tiles.weekStart=t,o)}),delete o.leftAxis,delete o.topAxis,s._color.init("sequential",t=>t.value),o},t.CoxcombChart=(t,a="body")=>{const l=100;let{self:s,api:o}=n(Y("coxcomb-chart",t,a,"svg"),F,D,R,U(()=>c.plots,[".wedge"]),vt,I,E,it);const c={scale:lt("sqrt"),arc:e.arc(),radius:l,data:[],plots:s._widget.content.append("g").attr("class","dalian-plot-container"),updateWedges:(t,e)=>t.attr("class",t=>"wedge "+i(t.name)).order().on("mouseover.coxcomb",t=>s._mouse.over({name:t.name,value:t.value})).on("mouseleave.coxcomb",t=>s._mouse.leave({name:t.name,value:t.value})).on("click.coxcomb",t=>s._mouse.click({name:t.name,value:t.value})).transition(e).attr("fill",s._color.mapper).attrTween("d",Ct(t=>c.arc(t))),update(t){const a=e.max(c.data.map(t=>t.data).flat().map(t=>t.value));c.scale.range(0,c.radius).domain([0,a]),c.data.map(t=>t.data.map(t=>Object.assign(t,{outerRadius:c.scale.scale(t.value)})));const r=c.plots.transition().duration(t);c.plots.selectAll(".wedge-group").data(c.data,t=>t.index).join(t=>t.append("g").attr("class","wedge-group").attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`).style("opacity",0).call(t=>{let e=t.selectAll("path").data(t=>t.data).enter().append("path").attr("stroke","white");return c.updateWedges(e,r)}),t=>t.attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`).call(t=>{let e=t.selectAll("path").data(t=>t.data).join(t=>t.append("path").attr("stroke","white").style("opacity",0),t=>t,t=>t.transition(r).style("opacity",0).remove());return c.updateWedges(e,r).style("opacity",1)}),t=>t.transition(r).style("opacity",0).remove()).transition(r).style("opacity",1),c.plots.style("pointer-events",s._tooltip&&s._tooltip.isOn()||s._mouse.hasAny()?"all":"none")}};return s._widget.update=r(s._widget.update,c.update),o=Object.assign(o||{},{data(t){const e=Array.from(t.reduce((t,e)=>new Set([...t,...e.values.map(t=>t.x)]),new Set)).sort((t,e)=>t-e),a=e.length;return c.data=e.map((e,r)=>({index:r,data:t.map(t=>{let n=t.values.find(t=>t.x===e);return{name:t.name,padAngle:0,startAngle:2*r*Math.PI/a,endAngle:2*(r+1)*Math.PI/a,innerRadius:0,value:n&&n.y||0}}).sort((t,e)=>e.value-t.value)})),o},radius:(t=l)=>(c.radius=t,o)}),o},t.LineChart=(t,l="body")=>{const s={x:lt("linear"),y:lt("linear")},{self:o,api:c}=n(G("line-chart",t,l),K(s.y),J(s.x),Q(s),U(()=>o._chart.plots,[".plot-group",".plot-marker",".trends-marker"]),Mt,_t(2),(t=>(e,a)=>{const n={container:void 0,pins:new Map,getContainer:()=>(void 0===n.container&&(n.container=e._chart.plots.append("g").attr("class","pins-container").attr("clip-path",`url(#${e._chart.clipId})`)),n.container)};return e._widget.update=r(e._widget.update,t=>{n.pins.forEach(e=>e.update(t))}),a=Object.assign(a||{},{pins:{add:(r,i,l={},s=0)=>{if(n.pins.has(r))return a;const o=t.x.scale,c=t.y.scale,d=l.color||e._font.color,p=(1-(l.height||.8))*c.range()[0],u=l.text||"",g=n.getContainer().append("g").attr("class","pin").style("color",d).style("opacity",0),m=g.append("g").attr("class","pin-label").style("opacity",l.fixed?1:0).style("pointer-events","none"),h=V(m.append("text"),{class:"pin-label-text",y:p-(l.size||6)-10,"text-anchor":"start",stroke:"none",fill:gt(d)}).text(u),y=1.05*h.node().getComputedTextLength();h.attr("x",Math.min(o(i),o.range()[1]-y-10)).attr("textLength",y);let x=h.node().getBBox();const v=V(m.append("rect"),{class:"pin-label-box",x:x.x-5,y:x.y-5,width:x.width+10,height:x.height+10,rx:2,stroke:"none",fill:""===u?"none":d});m.node().insertBefore(v.node(),h.node());const b=()=>{m.transition().duration(300).style("opacity",1)},f=()=>{m.transition().duration(300).style("opacity",l.fixed?1:0)},_=V(g.append("line"),{class:"pin-needle",x1:o(i)+1,y1:c.range()[0],x2:o(i)+1,y2:p,stroke:"currentColor","stroke-width":"2px"}).style("pointer-events","all").on("mouseover.pins",b).on("mouseleave.pins",f),w=V(g.append("circle"),{class:"pin-head",cx:o(i)+1,cy:p,r:(l.size||6)+"px",stroke:"white","stroke-width":"1px",fill:"currentColor"}).style("pointer-events","all").on("mouseover.pins",b).on("mouseleave.pins",f);g.transition().duration(s).style("opacity",1);const k={g:g,remove:t=>{g.transition().duration(t).style("opacity",0).on("end",()=>{g.remove()})},update:t=>{_.transition().duration(t).attr("x1",o(i)+1).attr("y1",c.range()[0]).attr("x2",o(i)+1).attr("y2",p),w.transition().duration(t).attr("cx",o(i)+1).attr("cy",p),h.attr("x",Math.min(o(i),o.range()[1]-y-10)).attr("y",p-(l.size||6)-10),x=h.node().getBBox(),v.attr("x",x.x-5).attr("y",x.y-5).attr("width",x.width+10).attr("height",x.height+10)}};return n.pins.set(r,k),a},remove:(t,e=0)=>(void 0===t&&(n.pins.forEach(t=>t.remove()),n.pins.clear()),n.pins.has(t)&&(n.pins.get(t).remove(e),n.pins.delete(t)),a)}}),{self:e,api:a}})(s),tt,it,st,(t=>(a,n)=>{const l={container:void 0,trends:new Map,getContainer:()=>(void 0===l.container&&(l.container=a._chart.plots.append("g").attr("class","trends-container").attr("clip-path",`url(#${a._chart.clipId})`)),l.container),adjustTrend:(t,r,n)=>{const i=a._chart.data.find(e=>e.name===t);if(void 0===i)return;const l=e.bisector(t=>t.x).left,s=l(i.values,r),o=l(i.values,n);if(null===s||null===o)return;const c=i.values[s].x,d=i.values[s].y,p=i.values[o].x,u=i.values[o].y;return{start:{x:c,y:d},end:{x:p,y:u},plateau:d<u?u:d}}};return a._widget.update=r(a._widget.update,t=>{l.trends.forEach(e=>e.update(t))}),n=Object.assign(n||{},{trends:{add:(e,r,s,o,c,d,p=0)=>{if(l.trends.has(e))return n;const u=t.x.scale,g=t.y.scale,m=l.adjustTrend(r,s,o),h=l.getContainer().append("g").attr("class","trend trend-"+i(r)).style("color",d||"#000").style("opacity",0),y=V(h.append("path"),{fill:"none",stroke:"currentColor","stroke-dasharray":"3 3","stroke-width":1,d:`M${u(m.start.x)},${g(m.start.y)}V${g(m.plateau)}H${u(m.end.x)}V${g(m.end.y)}`}),x=V(h.append("circle"),{cx:u(m.start.x),cy:g(m.start.y),r:4,stroke:"none",fill:"currentColor"}),v=V(h.append("circle"),{cx:u(m.end.x),cy:g(m.end.y),r:4,stroke:"none",fill:"currentColor"}),b=V(h.append("text"),{x:u(m.start.x),y:g(m.plateau),dy:-5,"text-anchor":"start",fill:a._font.color}).style("font-family","inherit").style("font-size",a._font.size).text(c);h.transition().duration(p).style("opacity",1);const f={g:h,remove:t=>{h.transition().duration(t).style("opacity",0).on("end",()=>{h.remove()})},update:t=>{h.transition().duration(t).style("color",d||"#000");const e=l.adjustTrend(r,s,o);y.transition().duration(t).attr("d",`M${u(e.start.x)},${g(e.start.y)}V${g(e.plateau)}H${u(e.end.x)}V${g(e.end.y)}`),x.transition().duration(t).attr("cx",u(e.start.x)).attr("cy",g(e.start.y)),v.transition().duration(t).attr("cx",u(e.end.x)).attr("cy",g(e.end.y)),b.attr("font-size",a._font.size).attr("fill",a._font.color).transition().duration(t).attr("x",u(e.start.x)).attr("y",g(e.plateau))}};return l.trends.set(e,f),n},remove:(t,e=0)=>{void 0===t&&(l.trends.forEach(t=>t.remove()),l.trends.clear()),l.trends.has(t)&&(l.trends.get(t).remove(e),l.trends.delete(t))}}}),{self:a,api:n}})(s),jt,wt,ft,ct),d={scales:s,update:t=>{const r=o._chart.data.reduce((t,e)=>t.concat(e.values),[]).filter(t=>null!==t.y),n=r.filter(t=>t.lo+t.hi>0).length>0,i=r.map(t=>t.y-t.lo).concat(r.map(t=>t.y+t.hi)),l=e.extent(i),s=.01*(l[1]-l[0]);l[1]+=s,l[0]-=s,d.scales.x.range(0,parseInt(o._widget.size.innerWidth)).domain(o._xRange.range(r.map(t=>t.x))),d.scales.y.range(parseInt(o._widget.size.innerHeight),0).domain(o._yRange.range(l));const c=e.line().defined(t=>null!==t.y).x(t=>d.scales.x.scale(t.x)).y(t=>d.scales.y.scale(t.y)).curve(o._smoothing.curve()),p=e.area().defined(t=>null!==t.y).x(t=>d.scales.x.scale(t.x)).y0(t=>d.scales.y.scale(t.y-t.lo)).y1(t=>d.scales.y.scale(t.y+t.hi)).curve(o._smoothing.curve());o._chart.plotGroups({enter:t=>(t.style("opacity",0),t.append("path").attr("class","error-band").attr("d",t=>p(t.values)).attr("stroke","none").attr("fill","currentColor").attr("fill-opacity",0),t.append("path").attr("class","line").attr("d",t=>c(t.values)).attr("stroke","currentColor").attr("stroke-width",t=>o._lineWidth.mapping(t.name)).attr("fill","none").attr("stroke-linejoin","round").attr("stroke-linecap","round"),t),update:t=>(t.style("opacity",1).style("color",o._color.mapper),t.select(".error-band").attr("fill-opacity",n?.2:0).attrTween("d",(function(t){const r=e.select(this).attr("d"),n=p(t.values);return a.interpolatePath(r,n,null)})),t.select(".line").attrTween("d",(function(t){const r=e.select(this).attr("d"),n=c(t.values);return a.interpolatePath(r,n,null)})).style("stroke-dasharray",t=>o._lineStyle.strokeDashArray(t.name)),t),exit:t=>t.style("opacity",0)},t)}};return o._tooltip.content=t=>{if(void 0===t)return void o._plotMarker.remove();const a=e.bisector(t=>d.scales.x.scale(t.x)).left,r=t?o._chart.data.map(e=>a(e.values,t[0])):void 0;if(void 0===r)return void o._plotMarker.remove();let n=d.scales.x.scale.invert(t[0]);const i=o._chart.data.filter(t=>-1===o._tooltip.ignore.indexOf(t.name)).map((t,e)=>{const a=r[e],i=t.values,l=i[a-1]?i[a-1]:i[a],s=i[a]?i[a]:i[a-1],c=n-l.x>s.x-n?s:l;return n=c.x,null!==c.y&&o._yRange.contains(c.y)?o._plotMarker.add(d.scales.x.scale(n),d.scales.y.scale(c.y),t.name,t):o._plotMarker.remove(t.name),{name:t.name,background:o._lineStyle.background(o._lineStyle.style(t.name),o._color.mapper(t)),x:c.x,y:c.y,lo:c.lo,hi:c.hi}});return{title:n,content:{type:"plots",data:i}}},o._chart.transformData=t=>t.map(t=>({name:t.name,values:t.values.sort((t,e)=>t.x-e.x).map(t=>({x:+t.x,y:null===t.y?t.y:+t.y,lo:+t.lo||0,hi:+t.hi||0}))})),o._widget.update=r(o._widget.update,d.update,!0),c},t.PieChart=(t,a="body")=>{const i=0,l=100;let{self:s,api:o}=n(G("pie-chart",t,a),yt,U(()=>s._chart.plots,[".plot-group"]),vt);const c={innerRadius:i,outerRadius:l,current:void 0,arc:null,labels:{format:()=>"",left:t=>.5*(t.startAngle+t.endAngle)>Math.PI,arcs:{inner:null,outer:null}},numSlices:0,measure:(t,e,a)=>{const r=pt(s._label.format(t),a);return{outside:1.1*Math.sqrt(r.width*r.width+r.height*r.height)>Math.min(.5*(c.innerRadius+c.outerRadius)*(t.endAngle-t.startAngle),c.outerRadius-c.innerRadius),x:-.25*c.outerRadius*(c.numSlices-e),y:-1.25*c.outerRadius+1.1*r.height*(c.numSlices-1-e)}},labelLinePath:t=>{let e=c.labels.arcs.inner.centroid(t);const a=c.labels.arcs.outer.centroid(t),r=Math.max(a[1],t._measures.y),n=[a[1]!==e[1]?a[0]-(a[0]-e[0])*(a[1]-r)/(a[1]-e[1]):a[0],r],i=.25*c.outerRadius,l=[c.labels.left(t)?Math.min(n[0]-i,t._measures.x):n[0]+i,n[1]];return n[1]>e[1]&&(e=n),`M${e[0]} ${e[1]} L${n[0]} ${n[1]} L${l[0]} ${l[1]}`},labelTextAnchor:t=>c.labels.left(t)?"end":"start",labelTextX:t=>{const e=.25*c.outerRadius;return c.labels.left(t)?Math.min(c.labels.arcs.outer.centroid(t)[0]-e,t._measures.x)-5:c.labels.arcs.outer.centroid(t)[0]+e+5},labelTextY:t=>Math.max(c.labels.arcs.outer.centroid(t)[1],t._measures.y),update:t=>{const a=s._widget.getStyle();c.arc=e.arc().innerRadius(c.innerRadius).outerRadius(c.outerRadius),c.labels.arcs.inner=e.arc().innerRadius(c.outerRadius+5).outerRadius(c.outerRadius+5),c.labels.arcs.outer=e.arc().innerRadius(1.25*c.outerRadius).outerRadius(1.25*c.outerRadius),c.numSlices=s._chart.data.filter(t=>t.value>0).length,s._chart.plotGroups({enter:t=>{t.style("opacity",0).style("color",s._color.mapper).each((t,e)=>Object.assign(t,{_measures:c.measure(t,e,a)}));const e=t.append("g").attr("class","slice").attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`).on("mouseover.pie",t=>{c.current=t}).on("mouseleave.pie",()=>{c.current=void 0});e.append("path").attr("class","slice-wedge").attr("d",c.arc).attr("stroke-linejoin","round").attr("stroke","white").attr("fill","currentColor");const r=e.append("g").attr("class","slice-label").style("display",s._label.show?null:"none");r.append("text").attr("class","inner-label").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",t=>c.arc.centroid(t)[0]).attr("y",t=>c.arc.centroid(t)[1]).style("cursor","default").style("opacity",t=>t._measures.outside?0:1).text(t=>t.value.toFixed(1));const n=r.append("g").attr("class","outer-label").style("opacity",t=>t._measures.outside?1:0);return n.append("path").attr("class","outer-label-line").attr("stroke-linejoin","round").attr("fill","none").attr("d",c.labelLinePath),n.append("text").attr("class","outer-label-text").attr("dominant-baseline","middle").attr("text-anchor",c.labelTextAnchor).attr("x",c.labelTextX).attr("y",c.labelTextY).style("cursor","default").text(t=>t.value.toFixed(1)),t},update:t=>{t.style("opacity",1).style("color",s._color.mapper).each((t,e)=>Object.assign(t,{_measures:c.measure(t,e,a)}));const e=t.select(".slice").attr("transform",`translate(${parseFloat(s._widget.size.innerWidth)/2}, ${parseFloat(s._widget.size.innerHeight)/2})`);e.select(".slice-wedge").attrTween("d",Ct(t=>c.arc(t)));const r=e.select(".slice-label").style("display",s._label.show?null:"none");r.select(".inner-label").style("opacity",t=>t._measures.outside?0:1).attr("fill",t=>gt(s._color.mapper(t))).attrTween("x",Ct(t=>c.arc.centroid(t)[0],"x")).attrTween("y",Ct(t=>c.arc.centroid(t)[1],"y")).text(s._label.format);const n=r.select(".outer-label").style("opacity",t=>t._measures.outside?1:0);return n.select(".outer-label-line").attr("stroke",s._font.color).attrTween("d",Ct(c.labelLinePath,"r")),n.select(".outer-label-text").attr("fill",s._font.color).attrTween("text-anchor",Ct(c.labelTextAnchor,"align")).attrTween("x",Ct(c.labelTextX,"x")).attrTween("y",Ct(c.labelTextY,"y")).text(s._label.format),t},exit:t=>t.style("opacity",0)},t)}};return s._chart.transformData=t=>e.pie().value(t=>t.value).sort(null)(t.sort((t,e)=>e.value-t.value)).map(t=>Object.assign(t,{name:t.data.name})),s._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:s._color.mapper(c.current),content:{type:"plots",data:[{name:"value",value:c.current.value}]}},s._widget.update=r(s._widget.update,c.update),o=Object.assign(o,{innerRadius:(t=i)=>(c.innerRadius=t,o),outerRadius:(t=l)=>(c.outerRadius=t,o)}),o},t.ScatterPlot=(t,a="body")=>{const i=4,l={x:lt("linear"),y:lt("linear")};let{self:s,api:o}=n(G("scatter-plot",t,a),J(l.x),yt,U(()=>s._chart.plots,[".plot-group"]),K(l.y),Z(.6),tt,wt,ct);const c={scales:l,current:void 0,diagram:void 0,size:i,computeDiagram:t=>{const a=t.map(t=>t.values.map(e=>({name:t.name,x:e.x,y:e.y}))).flat();return e.voronoi().x(t=>c.scales.x.scale(t.x)).y(t=>c.scales.y.scale(t.y)).extent([[0,0],[parseInt(s._widget.size.innerWidth),parseInt(s._widget.size.innerHeight)]])(a)},update:t=>{const a=s._chart.data.map(t=>t.values).flat(),r=e.extent(a.map(t=>t.x));c.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(r);const n=e.extent(a.map(t=>t.y));c.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(n);const i=c.scales.x.measure(c.size);c.scales.x.domain(s._xRange.range([r[0]-i,r[1]+i]));const l=c.scales.y.measure(c.size);c.scales.y.domain(s._yRange.range([n[1]+l,n[0]-l])),s._chart.plotGroups({enter:t=>(t.style("opacity",0).style("color",s._color.mapper).attr("stroke","none").attr("fill","currentColor"),t.selectAll("circle").data(t=>t.values).enter().append("circle").attr("class","dot").attr("cx",t=>c.scales.x.scale(t.x)).attr("cy",t=>c.scales.y.scale(t.y)).attr("r",c.size/2).style("opacity",0),t),updateBefore:e=>(e.style("opacity",1).style("color",s._color.mapper),e.selectAll("circle").data(t=>t.values).join(t=>t.append("circle").attr("class","dot").attr("cx",t=>c.scales.x.scale(t.x)).attr("cy",t=>c.scales.y.scale(t.y)).attr("r",c.size/2).style("opacity",0),t=>t,e=>e.transition().duration(t).style("opacity",0).remove()).transition().duration(t).attr("cx",t=>c.scales.x.scale(t.x)).attr("cy",t=>c.scales.y.scale(t.y)).attr("r",c.size/2).style("opacity",s._opacity.value()),e),exit:t=>t.style("opacity",0)}),c.diagram=c.computeDiagram(s._chart.data),s._widget.container.on("mousemove.scatter",()=>{const t=c.diagram.find(...s._widget.getMouse(),Math.max(20,c.size/2))||void 0;void 0!==t&&t!==c.current?s._mouse.over(t.data):void 0!==c.current&&s._mouse.leave(c.current),c.current=t&&t.data||void 0}).on("click.scatter",()=>{void 0!==c.current&&s._mouse.click(c.current)})}};return s._tooltip.content=t=>{if(void 0!==t){if(c.current)return s._plotMarker.add(c.scales.x.scale(c.current.x),c.scales.y.scale(c.current.y),"marker",c.current,Math.max(5,.75*c.size)),{title:c.current.name,stripe:s._color.mapper(c.current),content:{type:"plots",data:[{name:s._bottomAxis.label.text(),value:c.current.x},{name:s._leftAxis.label.text(),value:c.current.y}]}};s._plotMarker.remove()}else s._plotMarker.remove()},s._chart.transformData=t=>t.map(t=>({name:t.name,values:t.values.map(t=>({x:+t.x,y:+t.y}))})),s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o,{size:(t=i)=>(c.size=t,o)}),o},t.Table=(t,e="body")=>{S.addClass(Ft.container,{position:"relative",overflow:"auto","pointer-events":"all"}).addClass(Ft.scrollbarTrack,{background:"transparent"}).addClass(Ft.table,{width:"100%","border-collapse":"collapse","user-select":"none"}).addClass(Ft.head,{position:"sticky",top:0,padding:"5px 10px",cursor:"pointer","white-space":"nowrap","font-weight":"normal","font-variant":"all-small-caps"}).addClass(Ft.headContainer,{position:"relative",display:"inline-block"}).addClass(Ft.headLabel,{"margin-right":"12px"}).addClass(Ft.headSvg,{position:"absolute",right:0,top:"calc(50% - 4px)"}).addClass(Ft.paging,{position:"relative",float:"right",width:"100px",height:"25px","pointer-events":"all","user-select":"none"}).addClass(Ft.pagingBlock,{position:"relative",float:"left",width:"25px",height:"25px"}).addClass(Ft.pagingNumber,{"text-align":"center","line-height":"25px"}).addClass(Ft.pagingTotalBefore,{content:'"/"',position:"absolute",left:"-2px"}).addClass(Ft.pagingButton,{cursor:"pointer",opacity:.2}).addClass(Ft.pagingButtonHover,{opacity:1});let{self:a,api:i}=n(Y("table",t,e,"div"),D,U(()=>l.dom.table,["td"],(()=>{const t=ut(Ot,.8);return{focus:{color:gt(t),background:t}}})()),I,R,E);S.addId(Ft.scrollbarThumb(a._widget.id),{background:ut(Ot,.8)}).addId(Ft.scrollbarThumbHover(a._widget.id),{background:Ot});const l={fm:a._widget.getFontMetrics(),colors:{main:Ot,light:ut(Ot,.8)},data:{cols:[],schema:[],values:[]},dom:(()=>{const t=a._widget.content.append("div").attr("class",Ft.container),e=t.append("table").attr("class",Ft.table);return{container:t,table:e,header:e.append("thead").append("tr"),body:e.append("tbody")}})(),sorting:{key:null,ascending:!0,arrow:t=>void 0===t?"":"up"===t?"m 1 8 l 4 -6.92 l 4 6.92 z":"m 1 2 l 4 6.92 l 4 -6.92 z",update(t,e){l.sorting.key=t,l.sorting.ascending=e},sorter(t,e="string",a=!1){const r=a?-1:1;switch(e){default:case"string":return(e,a)=>r*e[t].localeCompare(a[t]);case"number":return(e,a)=>r*(e[t]-a[t]);case"date":return(e,a)=>r*(zt(e[t])-zt(a[t]))}},sort(t){switch(l.sorting.key){default:case null:l.data.values.sort(l.sorting.sorter(t.key,t.type)),l.sorting.update(t.key,!0);break;case t.key:l.sorting.ascending?(l.data.values.sort(l.sorting.sorter(t.key,t.type,!0)),l.sorting.update(t.key,!1)):(l.data.values.sort((t,e)=>t._id-e._id),l.sorting.update(null,!0))}l.updateBody(),l.dom.header.selectAll("."+Ft.headMarker).attr("d",t=>l.sorting.arrow(t.key===l.sorting.key?l.sorting.ascending?"up":"down":void 0))}},paging:(()=>{let t=At,e=0;const r=(()=>{const n=a._widget.content.append("div").attr("class",Ft.paging);n.append("div").attr("class",`${Ft.pagingBlock} ${Ft.pagingButton}`).on("click",()=>{t>0&&e>0&&(e--,l.updateBody(),r.current.text(e+1))}).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 10 4 l -6.92 4 l 6.92 4 z");const i=n.append("div").attr("class",`${Ft.pagingBlock} ${Ft.pagingNumber}`),s=n.append("div").attr("class",`${Ft.pagingBlock} ${Ft.pagingNumber} ${$t}paging-total`);return n.append("div").attr("class",`${Ft.pagingBlock} ${Ft.pagingButton}`).on("click",()=>{t>0&&e<Math.ceil(l.data.values.length/t)-1&&(e++,l.updateBody(),r.current.text(e+1))}).append("svg").attr("viewBox","0 0 16 16").style("width","100%").style("width","100%").append("path").attr("d","m 2 4 l 6.92 4 l -6.92 4 z"),{g:n,current:i,total:s}})();return{update(n){r.g.style("display",t>0?null:"none"),t>0&&(r.g.transition().duration(n).style("margin-right",a._widget.margins.right+"px"),r.current.text(e+1),r.total.text(Math.ceil(l.data.values.length/t)))},filter(a){if(t>0){let r=e*t,n=r+t;return a.filter((t,e)=>e>=r&&e<n)}return a},reset(a){void 0!==a&&(t=a),e=0},size:()=>t}})(),align(t){switch(t.type){default:case"string":case"date":return"left";case"number":return"right"}},updateBody(){const t=l.data.schema.filter(t=>l.data.cols.indexOf(t.key)>-1);let e=l.paging.filter(l.data.values);l.dom.body.selectAll("tr").data(e,()=>Date.now()+""+Math.random()).join(e=>{const r=e.append("tr").style("height","2em").style("line-height","2em");return r.selectAll("td").data(e=>t.map(t=>({row:e._id,column:t.key,value:e[t.key],type:t.type,displayValue:void 0===t.format?e[t.key]:t.format(e[t.key])}))).enter().append("td").attr("class",t=>`row-${t.row} column-${t.column} cell-${t.row}-${t.column}`).style("padding","0.25em 0.5em").style("white-space","nowrap").style("text-align",l.align).on("mouseover.table",a._mouse.over).on("mouseleave.table",a._mouse.leave).on("click.table",a._mouse.click).text(t=>t.displayValue),r},t=>t,t=>{let a=l.paging.size()-e.length;t.filter((t,e)=>e<a).raise().selectAll("td").remove(),t.filter((t,e)=>e>=a).remove()})},update(t){l.dom.container.transition().duration(t).style("width",a._widget.size.innerWidth).style("height",a._widget.size.innerHeight).style("margin-left",a._widget.margins.left+"px").style("margin-top",a._widget.margins.top+"px"),l.dom.table.style("height",a._widget.size.innerHeight);const e=l.data.schema.filter(t=>l.data.cols.indexOf(t.key)>-1);l.dom.header.selectAll("th").data(e,t=>t.key).join(t=>{const e=t.append("th").style("user-select","none"),a=e.append("div").attr("class",Ft.headContainer).style("float",l.align);return a.append("span").attr("class",Ft.headLabel),a.append("svg").attr("class",Ft.headSvg).attr("viewBox","0 0 10 10").style("width",l.fm.capHeight+"em").style("height",l.fm.capHeight+"em").append("path").attr("class",Ft.headMarker).attr("fill","currentColor").attr("d",l.sorting.arrow()),e},t=>t,t=>t.remove()).on("click",l.sorting.sort).attr("class",Ft.head).style("background",l.colors.main).style("color",gt(l.colors.main)).select("."+Ft.headLabel).html(t=>t.name),l.updateBody(),l.paging.update(t)}};return a._widget.update=r(a._widget.update,l.update,!0),i=Object.assign(i,{data:t=>(l.data.values=t.map((t,e)=>Object.assign(t,{_id:e})),l.paging.reset(),l.data.cols=Object.keys(t[0]||{}),l.sorting.update(null,!0),l.dom.header.selectAll(".table-head-sorting").text(""),i),schema:t=>(l.data.schema=t,i),color:(t=Ot)=>(l.colors={main:t,light:ut(t,.8)},S.updateId(Ft.scrollbarThumb(a._widget.id),{background:l.colors.light}).updateId(Ft.scrollbarThumbHover(a._widget.id),{background:t}),a._highlight.style({focus:{color:gt(l.colors.light),background:l.colors.light}}),i),paging:(t=At)=>(l.paging.reset(t),i)}),i},t.ViolinPlot=(t,i="body")=>{const l={x:lt("point"),y:lt("linear")};let{self:s,api:o}=n(G("violin-plot",t,i),J(l.x),yt,U(()=>s._chart.plots,[".plot-group"]),xt(l),K(l.y),_t(1),Z(.2),ct);const c={data:[],current:void 0,scales:s._horizontal.scales(),violinWidth:30,horizontal:!1,bandwidth:1,kde:(t,a)=>r=>a.map(a=>({x:a,y:e.mean(r,e=>t(a-e))})),epanechnikovKernel:t=>e=>Math.abs(e/=t)<=1?.75*(1-e*e)/t:0,makeViolin(t){const a=e.min(t),r=e.max(t),n=r-a,i=c.kde(c.epanechnikovKernel(c.bandwidth),e.range(Math.floor(n/c.bandwidth)+1).map(t=>a+c.bandwidth*t))(t);return{yMin:a,yMax:r,values:i,scale:e.scaleLinear().range([c.violinWidth/2-1,0]).domain([0,e.max(i,t=>t.y)])}},bimodality(t){const a=t.length,r=e.mean(t),n=e.sum(t,t=>(t-r)*(t-r))/a,i=e.sum(t,t=>Math.pow(t-r,3))/a,l=e.sum(t,t=>Math.pow(t-r,4))/a,s=Math.sqrt(a*(a-1))*i/((a-2)*Math.pow(n,1.5));return(s*s+1)/(l/(n*n)-3+3*(a-1)*(a-1)/((a-2)*(a-3)))},update(t){const r=s._chart.data.map(t=>t.name);const n=[e.min(s._chart.data.map(t=>t.min)),e.max(s._chart.data.map(t=>t.max))],i=.05*(n[1]-n[0]);n[1]+=i,n[0]-=i,c.horizontal=s._horizontal.on(),c.scales=s._horizontal.scales(),c.scales.x.range(0,parseInt(s._widget.size.innerWidth)).domain(c.horizontal?s._yRange.range(n):r),c.scales.y.range(parseInt(s._widget.size.innerHeight),0).domain(c.horizontal?r:s._yRange.range(n));const l=c.violinWidth/2-.5,o=c.horizontal?"":"rotate(90)";s._chart.plotGroups({enter:t=>(t.style("opacity",0).on("mouseover.violin",t=>{c.current=t}).on("mouseleave.violin",()=>{c.current=void 0}).style("color",s._color.mapper),t.append("path").attr("class","violin").attr("transform",t=>`translate(${c.horizontal?0:c.scales.x.scale(t.name)+l}, ${c.horizontal?c.scales.y.scale(t.name)-l:0}) ${o}`).attr("d",t=>t.area.x(t=>c.horizontal?c.scales.x.scale(t.x):c.scales.y.scale(t.x))(t.values)).attr("stroke","currentColor").attr("fill","currentColor").style("fill-opacity",0),t),update:t=>(t.style("opacity",1).style("color",s._color.mapper),t.select(".violin").attr("transform",t=>`translate(${c.horizontal?0:c.scales.x.scale(t.name)+l}, ${c.horizontal?c.scales.y.scale(t.name)-l:0}) ${o}`).attrTween("d",(function(t){const r=e.select(this).attr("d"),n=t.area.x(t=>c.horizontal?c.scales.x.scale(t.x):c.scales.y.scale(t.x))(t.values);return a.interpolatePath(r,n,null)})).attr("stroke-width",t=>s._lineWidth.mapping(t.name)).style("fill-opacity",s._opacity.value()),t),exit:t=>t.style("opacity",0)},t)}};return s._tooltip.content=()=>void 0===c.current?void 0:{title:c.current.name,stripe:s._color.mapper(c.current),content:{data:[{name:"mean",value:c.current.stats.mean},{name:"median",value:c.current.stats.median},{name:"bimodality",value:c.current.stats.bimodality}]}},s._chart.transformData=t=>(c.data=t,t.map(t=>{const{yMin:a,yMax:r,values:n,scale:i}=c.makeViolin(t.values);return{name:t.name,min:a,max:r,stats:{mean:e.mean(t.values),median:e.median(t.values.sort((t,e)=>t-e)),bimodality:c.bimodality(t.values)},values:n,scale:i,area:e.area().curve(e.curveBasis).y0(t=>i(-t.y)).y1(t=>i(t.y))}})),s._widget.update=r(s._widget.update,c.update,!0),o=Object.assign(o||{},{violinWidth:(t=30)=>(c.violinWidth=t,s._chart.data.map(t=>Object.assign(t,{scale:t.scale&&t.scale.range([c.violinWidth/2-1,0]),area:t.area&&t.area.y0(e=>t.scale(-e.y)).y1(e=>t.scale(e.y))})),o),bandwidth:(t=1)=>(c.bandwidth=t,s._chart.data.map((t,e)=>{const{values:a,scale:r}=c.makeViolin(c.data[e].values);Object.assign(t,{values:a,scale:r,area:t.area&&t.area.y0(t=>r(-t.y)).y1(t=>r(t.y))})}),o)}),o},Object.defineProperty(t,"__esModule",{value:!0})}));
